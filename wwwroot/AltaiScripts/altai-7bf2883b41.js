var AltaiCore;!function(AltaiCore){function InstallerController($http,$state,logService,config,altaiInstaller){var ctrl=this;this.installing=!1,this.installers=altaiInstaller.list().map(function(installerData){return installerData.templateUrl="api/template/admin/"+installerData.templateUrl,installerData}),this.doInstall=function(installData){ctrl.installing=!0,$http.post(config.backendUrl+"/api/install",installData).then(function(result){logService.log("success","The install was successful!"),ctrl.installing=!1,$state.go("login")},function(error){logService.log("error",error.data.message)})}}AltaiCore.InstallerController=InstallerController}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function ModuleListController($scope,moduleFactory,logService,modulesList){$scope.modules=modulesList,$scope.installModule=function(moduleId){moduleFactory.installModule(moduleId)},$scope.uninstallModule=function(moduleId){moduleFactory.uninstallModule(moduleId)},$scope.scanModules=function(){moduleFactory.listModule(!0).then(function(modulesList){$scope.modules=modulesList,logService.log("success","Modules scan complete")})}}AltaiCore.ModuleListController=ModuleListController}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function SettingsController(settingsData,altaiSettings){this.settings=settingsData,this.updateSettings=function(newSettings){altaiSettings.update(newSettings)}}AltaiCore.SettingsController=SettingsController}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiAdminSidebarDirective(){return{scope:!0,replace:!0,restrict:"E",templateUrl:"/api/template/Admin/adminSidebar",controller:AltaiAdminSidebarController,controllerAs:"vm"}}AltaiCore.AltaiAdminSidebarDirective=AltaiAdminSidebarDirective;var AltaiAdminSidebarController=function(){function AltaiAdminSidebarController($rootScope,$scope,$state,authService,stateManager,buildingBlockType,buildingBlockManager){this.loading=!1;var vm=this;vm.stateManager=stateManager,vm.buildingBlockTypes=buildingBlockType.list(),buildingBlockManager.listInstance().then(function(instances){vm.buildingBlockInstances=instances}),$rootScope.startState=config.startState,$scope.changeMode=function(){"edit"==$rootScope.mode?$rootScope.mode="manager":$rootScope.mode="edit"},$scope.setActiveDrag=function(type,id,instance){$rootScope.activeDragId=id,$rootScope.activeDragType=type,$rootScope.activeDragInstance=instance},$scope.hasAccess=!0,$rootScope.menu=1,$rootScope.mode="manager"}return AltaiAdminSidebarController}()}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiBgDirective($rootScope){return{link:function(scope,element,attrs){attrs.$observe("altaiBg",function(){var url=attrs.altaiBg;if(attrs.altaiImagestyleset){var fullPath=url;fullPath=fullPath.split("/"),fullPath=fullPath[fullPath.length-1].split(".");var fileName=fullPath[fullPath.length-2];fullPath[fullPath.length-1]}"usercontent/"!=url&&url&&fileName&&element.css({"background-image":"url("+url+")","background-size":"cover"})})}}}AltaiCore.AltaiBgDirective=AltaiBgDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiButtonDirective(){return{scope:{type:"@type",size:"@size",label:"@label",confirm:"&confirm"},replace:!0,transclude:!0,template:"<button class='btn' ng-class='cssClass'><i ng-class='iconClass'></i>&nbsp;<span ng-transclude></span></button>",controller:function($scope){var cssClass=[],iconClass=["fa"];switch($scope.size){case"xs":cssClass.push("btn-xs")}switch($scope.type){case"cancel":cssClass.push("btn-primary"),iconClass.push("fa-reply");break;case"search":cssClass.push("btn-primary"),iconClass.push("fa-search");break;case"edit":cssClass.push("btn-primary"),iconClass.push("fa-edit");break;case"view":cssClass.push("btn-primary"),iconClass.push("fa-eye");break;case"print":cssClass.push("btn-primary"),iconClass.push("fa-print");break;case"send":cssClass.push("btn-primary"),iconClass.push("fa-envelope-o");break;case"add":cssClass.push("btn-success"),iconClass.push("fa-plus");break;case"save":cssClass.push("btn-success"),iconClass.push("fa-save");break;case"excel":cssClass.push("btn-success"),iconClass.push("fa-file-excel-o");break;case"update":cssClass.push("btn-success"),iconClass.push("fa-refresh");break;case"delete":cssClass.push("btn-danger"),iconClass.push("fa-times")}$scope.cssClass=cssClass,$scope.iconClass=iconClass},link:function(scope,element,attr){attr.confirm&&angular.element(element).bind("click",function(event){scope.$apply(scope.confirm())})}}}AltaiCore.AltaiButtonDirective=AltaiButtonDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiDragDirective($parse,$rootScope){return{restrict:"A",link:function(scope,elm,attrs){var fn=$parse(attrs.altaiDrag);elm.on("dragstart",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}}AltaiCore.AltaiDragDirective=AltaiDragDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiDropDirective($parse,$rootScope){return{restrict:"A",link:function(scope,elm,attrs){var fn=$parse(attrs.altaiDrop);elm.on("drop",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}}AltaiCore.AltaiDropDirective=AltaiDropDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiPaginationDirective(){return{scope:{pagedResult:"=",switchPage:"&",scrollTo:"@",scrollOffset:"@"},template:'<div><nav class="altai-pagination"><ul class="pagination"><li ng-click="openPage(currentPage-1)">&laquo;</li><li ng-repeat="page in pages" ng-class="{\'active\':page.active}" ng-if="$index < 3 || pageCount - $index < 3 || ($index > currentPage - 3 && $index < currentPage + 3)" ng-click="openPage($index)">{{page.id}}</li><li ng-click="openPage(currentPage+1)">&raquo;</li></ul></nav><div class="altai-pagination-page-count">{{pagedResult.totalCount > 0 ? pagedResult.pageSize*pagedResult.page + 1 : 0}}-{{(pagedResult.totalCount > (pagedResult.pageSize*(pagedResult.page + 1))) ? pagedResult.pageSize*(pagedResult.page + 1) : pagedResult.totalCount }}/{{pagedResult.totalCount}}</div></div>',replace:!0,controller:function($scope,$document){function determinePages(){$scope.pages=[],$scope.pagedResult.pageSize||($scope.pagedResult.pageSize=25),$scope.currentPage=$scope.pagedResult.page,$scope.pageCount=$scope.pagedResult.totalCount/$scope.pagedResult.pageSize;for(var p=0;p<$scope.pageCount;p++)$scope.pages.push({id:p+1,active:$scope.currentPage==p})}$scope.$watch("pagedResult",function(){$scope.pagedResult&&determinePages()}),$scope.openPage=function(page){if(!(0>page||page>=$scope.pages.length)){var prevActivePage=$scope.pages.filter(function(page){return page.active})[0];if(prevActivePage&&(prevActivePage.active=!1),$scope.pages[page].active=!0,$scope.currentPage=page,$scope.switchPage({pageIndex:page}),$scope.scrollTo){var elementToScrollTo=angular.element(document.getElementById($scope.scrollTo));elementToScrollTo.length>0&&$document.scrollToElementAnimated(elementToScrollTo,$scope.scrollOffset?$scope.scrollOffset:0)}}}}}}AltaiCore.AltaiPaginationDirective=AltaiPaginationDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiScrollfixDirective($rootScope,$timeout){return{link:function($scope,$element){function scroll(){var docViewTop=$(window).scrollTop();docViewTop>elemTop?$element.hasClass("altai-scrollfix")||$element.addClass("altai-scrollfix"):(elemTop=$element.offset().top,$element.hasClass("altai-scrollfix")&&$element.removeClass("altai-scrollfix")),elemTop+$element.height()/2<$(window).scrollTop()+$(window).height()&&$element.addClass("altai-visible")}$timeout(function(){$(window).resize(function(){$element.removeClass("altai-scrollfix"),elemTop=$element.offset().top,scroll()})},1e3);var elemTop=$element.offset().top;$rootScope.$on("$scroll",function(){scroll()})}}}AltaiCore.AltaiScrollfixDirective=AltaiScrollfixDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function PageTitleDirective($rootScope){return{scope:{title:"=pageTitle"},controller:function($scope){$scope.$watch("title",function(){$scope.title&&$rootScope.setTitle($scope.title)})}}}AltaiCore.PageTitleDirective=PageTitleDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiTreeListDirective(){return{templateUrl:"/api/template/Admin/treeList",controller:AltaiTreeListController,scope:{treeModel:"=",draggable:"=",parentId:"="},bindToController:!0,controllerAs:"vm"}}AltaiCore.AltaiTreeListDirective=AltaiTreeListDirective;var AltaiTreeListController=function(){function AltaiTreeListController($scope,$rootScope){this.$scope=$scope,this.$rootScope=$rootScope;var m=this;this.menuItemSortOptions={axis:"y",stop:function(){m.updateOrder(m.treeModel),m.$rootScope.$broadcast("treeOrderUpdate")}}}return AltaiTreeListController.prototype.toggleChildrenItems=function(index,event){event.stopPropagation();var hasSubItems=this.treeModel[index].items;hasSubItems&&(this.treeModel[index].expanded=!this.treeModel[index].expanded,this.$rootScope.$broadcast("treeExpandChange"))},AltaiTreeListController.prototype.editItem=function(hash){event.stopPropagation(),this.$rootScope.$broadcast("editTreeItem",hash)},AltaiTreeListController.prototype.addNewItem=function(parent){event.stopPropagation(),this.$rootScope.$broadcast("addTreeItem",parent)},AltaiTreeListController.prototype.addChildItem=function(hash){event.stopPropagation(),this.$rootScope.$broadcast("addChildTreeItem",hash)},AltaiTreeListController.prototype.setSecurityMenuItem=function(hash){event.stopPropagation(),this.$rootScope.$broadcast("setSecurityTreeItem",hash)},AltaiTreeListController.prototype.updateOrder=function(items){for(var i=0;i<items.length;i++)items[i].order=i,items[i].items&&this.updateOrder(items[i].items)},AltaiTreeListController}()}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiMachineNameDirective(){return{scope:{machineName:"=altaiMachineName",model:"=ngModel"},require:"ngModel",controller:function($scope,languageFactory){function parseName(value){return value?value.replace(/ /g,"").toLowerCase():value}$scope.$watch("machineName",function(){if($scope.machineName)if($scope.machineName.translatableValues){var valInCurrentLang=$scope.machineName.translatableValues.filter(function(lang){return lang.languageCode==languageFactory.getCurrentLangCode()})[0];valInCurrentLang&&($scope.model=parseName(valInCurrentLang.value))}else $scope.model=parseName($scope.machineName)},!0)}}}AltaiCore.AltaiMachineNameDirective=AltaiMachineNameDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiBodyDirective(){return{controller:function($scope,$state,$element){$scope.$on("$stateChangeSuccess",function(){0===$state.current.name.indexOf("admin")||0===$state.current.name.indexOf("login")||0===$state.current.name.indexOf("install")||0===$state.current.name.indexOf("createpassword")||0===$state.current.name.indexOf("logout")||0===$state.current.name.indexOf("lostpassword")||0===$state.current.name.indexOf("presenceregistration")||0===$state.current.name.indexOf("unsubscribeactu")||0===$state.current.name.indexOf("unsubscribe")?$element[0].className="altai-theme-admin":$element[0].className="altai-theme-content"})}}}AltaiCore.AltaiBodyDirective=AltaiBodyDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiSmoothScrollDirective($rootScope,$timeout,$state,$document){return{link:function(scope,elm,attrs){elm.on("click",function(event){var state=event.currentTarget.attributes.state.nodeValue,anchor=event.currentTarget.attributes.anchor.nodeValue,offset=event.currentTarget.attributes.offset.nodeValue;if($state.current.name==state){var elementToScrollTo=angular.element(document.getElementById(anchor));$document.scrollToElementAnimated(elementToScrollTo,parseInt(offset)-100)}else $state.go(state).then(function(){$timeout(function(){var elementToScrollTo=angular.element(document.getElementById(anchor));$document.scrollToElementAnimated(elementToScrollTo,parseInt(offset))},50)})})}}}AltaiCore.AltaiSmoothScrollDirective=AltaiSmoothScrollDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiSetBackgroundDirective($sce,$rootScope){return{scope:{image:"="},link:function($scope,$element){var watch=$scope.$watch("image",function(){if($scope.image){var fullPath=$rootScope.staticFileBase+"/"+$scope.image;$element.attr("style","background-image:url("+$sce.trustAsResourceUrl(fullPath)+")"),watch()}})}}}AltaiCore.AltaiSetBackgroundDirective=AltaiSetBackgroundDirective}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiCastFilter($filter){return function(input,typeName){return"date"===typeName?new Date(input):input}}AltaiCore.AltaiCastFilter=AltaiCastFilter}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function BinaryFilter($filter){return function(input){return input?$filter("translate")("yes"):$filter("translate")("no")}}AltaiCore.BinaryFilter=BinaryFilter}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiCutoffFilter(){return function(value,max){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;value=value.substr(0,max);var lastspace=value.lastIndexOf(" ");return-1!=lastspace&&("."!=value.charAt(lastspace-1)&&","!=value.charAt(lastspace-1)||(lastspace-=1),value=value.substr(0,lastspace)),value+" …"}}AltaiCore.AltaiCutoffFilter=AltaiCutoffFilter}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function localDateFilter(altaiLocalizationService){return function(theDate,format,lang){return void 0!=theDate?moment(theDate).locale(lang?lang:altaiLocalizationService.getCurrentLangCode()).format(format?format:"D MMMM YYYY"):void 0}}AltaiCore.localDateFilter=localDateFilter}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function escapeFilter(){return function(input){return input?encodeURIComponent(input):""}}AltaiCore.escapeFilter=escapeFilter}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function logService($q,$rootScope,$http,config,altaiNotificationFactory){var _logs=[],exports={};return exports.log=function(type,message){"error"==type?altaiNotificationFactory.error(message):"success"==type&&altaiNotificationFactory.success(message)},exports.listLog=function(take){var d=$q.defer();return $http.get(config.backendUrl+"/api/log?take="+take).then(function(result){angular.copy(result.data,_logs),d.resolve(_logs)},function(error){d.reject()}),d.promise},exports}AltaiCore.logService=logService}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiModuleManager($q,$http,$rootScope,config,logService){var _modulesList=[],_listModule=function(scan){var deferred=$q.defer();return $http.get(config.backendUrl+"/api/module?scan="+scan).then(function(result){angular.copy(result.data,_modulesList),deferred.resolve(_modulesList)},function(error){logService.log("error","Could not load the modules list"),deferred.reject()}),deferred.promise},_installModule=function(moduleId){var deferred=$q.defer();return $http.get(config.backendUrl+"/api/module/"+moduleId+"/install").then(function(result){var module=_modulesList.filter(function(module){return module.id==moduleId});module[0].installed=!0,logService.log("success","Enjoy the new module"),deferred.resolve()},function(error){logService.log("error","Could not install the module"),deferred.reject()}),deferred.promise},_uninstallModule=function(moduleId){var deferred=$q.defer();return $http.get(config.backendUrl+"/api/module/"+moduleId+"/unInstall").then(function(result){var module=_modulesList.filter(function(module){return module.id==moduleId});module[0].installed=!1,logService.log("success","Module sucesfully removed"),deferred.resolve()},function(error){logService.log("error","Could not uninstall the module"),deferred.reject()}),deferred.promise};return{listModule:_listModule,installModule:_installModule,uninstallModule:_uninstallModule}}AltaiCore.AltaiModuleManager=AltaiModuleManager}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiSettingsProvider(){var _settings={};return{$get:function($q,$http,logService){return{get:function(key){var d=$q.defer();return this.list().then(function(settings){d.resolve(_settings[key])}),d.promise},list:function(){var d=$q.defer();return d.resolve(),d.promise},update:function(newSettings){var d=$q.defer();return $http.put(config.backendUrl+"/api/settings",newSettings).success(function(settings){logService.log("success","Settings saved"),angular.copy(settings,_settings),d.resolve(_settings)}),d.promise}}}}}AltaiCore.AltaiSettingsProvider=AltaiSettingsProvider}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function urlParameterService($window){return function(name){for(var query_string={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof query_string[pair[0]])query_string[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof query_string[pair[0]]){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr}else query_string[pair[0]].push(decodeURIComponent(pair[1]))}return query_string[name]}}function urlSerialization($window){return function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}AltaiCore.urlParameterService=urlParameterService,AltaiCore.urlSerialization=urlSerialization}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiClientDataStore=function(){function AltaiClientDataStore($cookies){this.$cookies=$cookies}return AltaiClientDataStore.prototype.set=function(storeKey,storeValue){var expires=new Date;expires.setSeconds(expires.getSeconds()+864e4),"accessToken"!=storeKey&&"refreshToken"!=storeKey&&this.$cookies.put(storeKey,storeValue,{expires:expires}),localStorage.setItem(storeKey,storeValue)},AltaiClientDataStore.prototype.get=function(storeKey){return localStorage.getItem(storeKey)},AltaiClientDataStore.prototype.remove=function(storeKey){localStorage.removeItem(storeKey)},AltaiClientDataStore}();AltaiCore.AltaiClientDataStore=AltaiClientDataStore}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiInstallerProvider(){var _installers=[],methods={};return methods.list=function(){return _installers},{$get:function(){return methods},register:function(installer){_installers.push(installer)}}}AltaiCore.AltaiInstallerProvider=AltaiInstallerProvider}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiDataService=function(){function AltaiDataService(apiUrl,objectName,altaiHttp,$http,$q,altainotificationFactory){this.enableCaching=!0,this.dataList=[],this.itemDataList=[],this.apiUrl=apiUrl,this.objectName=objectName,this.$http=$http,this.altaiHttp=altaiHttp,this.$q=$q,this.notificationFactory=altainotificationFactory}return AltaiDataService.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result)}).error(function(result,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not POST "+service.apiUrl),d.reject()}),d.promise},AltaiDataService.prototype.list=function(){var d=this.$q.defer(),service=this;return service.dataList.length&&service.enableCaching?d.resolve(service.dataList):service.altaiHttp.get(service.apiUrl).then(function(result){angular.copy(result,service.dataList),d.resolve(service.dataList)},function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not GET "+service.apiUrl),d.reject()}),d.promise},AltaiDataService.prototype.getById=function(id,enableCache){void 0===enableCache&&(enableCache=!0);var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+id,cachedItems=service.itemDataList.filter(function(item){return item.id==id});return cachedItems.length>0&&this.enableCaching&&enableCache?d.resolve(cachedItems[0]):this.altaiHttp.get(requestUrl).then(function(result){service.itemDataList.push(result),d.resolve(result)},function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not GET "+requestUrl),d.reject()}),d.promise},AltaiDataService.prototype["delete"]=function(item){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+item.id;return this.$http["delete"](requestUrl).success(function(result){service.success("Succesfully deleted "+service.objectName),service.dataList.splice(service.dataList.indexOf(item),1),d.resolve(result)}).error(function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not DELETE "+requestUrl),d.reject()}),d.promise},AltaiDataService.prototype.update=function(item){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.itemDataList.splice(service.itemDataList.indexOf(service.itemDataList.filter(function(cacheItem){return cacheItem.id==item.id})[0]),1),service.dataList=[],service.success("Succesfully updated "+service.objectName),d.resolve()}).error(function(errorMessage,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},AltaiDataService.prototype.getCachedDataItem=function(id){var cachedItems=this.itemDataList.filter(function(item){return item.id==id});return cachedItems[0]},AltaiDataService.prototype.success=function(successMsg){this.notificationFactory.success(successMsg)},AltaiDataService.prototype.error=function(errorMsg){this.notificationFactory.error(errorMsg)},AltaiDataService.prototype.resetCache=function(){this.dataList=[],this.itemDataList=[]},AltaiDataService}();AltaiCore.AltaiDataService=AltaiDataService}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiNotificationFactory=function(){function AltaiNotificationFactory(toastr){this.toastr=toastr,this.toastPosition="bottom right",this.toastSpeed=3e3}return AltaiNotificationFactory.prototype.success=function(message){this.toastr.success(message)},AltaiNotificationFactory.prototype.error=function(message){this.toastr.error(message)},AltaiNotificationFactory}();AltaiCore.AltaiNotificationFactory=AltaiNotificationFactory}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiConfirmationService=function(){function AltaiConfirmationService($mdDialog){this.$mdDialog=$mdDialog}return AltaiConfirmationService.prototype.confirm=function(parent){void 0===parent&&(parent=null);var confirm=this.$mdDialog.confirm();return parent&&(confirm=confirm.parent(parent)),confirm=confirm.title("Are you sure?").ok("Yes").cancel("Cancel"),this.$mdDialog.show(confirm)},AltaiConfirmationService}();AltaiCore.AltaiConfirmationService=AltaiConfirmationService}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){function AltaiSpinnerInterceptor($q,$rootScope,$log){function decreaseLoadCount(){numLoadings>0&&(numLoadings--,0===numLoadings&&$rootScope.$broadcast("loaderHide"))}var numLoadings=0;return{request:function(config){return-1==config.url.indexOf("api/backgroundjob")&&(numLoadings++,$rootScope.$broadcast("loaderShow")),config||$q.when(config)},response:function(response){return-1==response.config.url.indexOf("api/backgroundjob")&&decreaseLoadCount(),response||$q.when(response)},responseError:function(rejection){return rejection&&rejection.config&&rejection.config.url?-1==rejection.config.url.indexOf("api/backgroundjob")&&decreaseLoadCount():decreaseLoadCount(),$q.reject(rejection)}}}AltaiCore.AltaiSpinnerInterceptor=AltaiSpinnerInterceptor}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiHttp=function(){function AltaiHttp($http,$q,$injector){this.$http=$http,this.$q=$q,this.$injector=$injector,this.requests=[]}return AltaiHttp.prototype.get=function(url){var authService=this.$injector.get("authService"),s=this;if(authService.getAccessToken()&&authService.isAccessTokenExpired()){var d=s.$q.defer();return authService.refreshToken().then(function(){console.debug("[AltaiIdentity] Token expired, getting a new one"),s.getAfterTokenValidated(url).then(function(result){d.resolve(result)},function(rejection){d.reject(rejection)})}),d.promise}return this.getAfterTokenValidated(url)},AltaiHttp.prototype.getAfterTokenValidated=function(url){var s=this,currentRequest=this.requests.filter(function(req){return req.url==url})[0];if(currentRequest){var listeningPromise=s.$q.defer();return currentRequest.listeners.push(listeningPromise),listeningPromise.promise}var d=this.$q.defer(),newRequest={url:url,listeners:[]};return s.requests.push(newRequest),s.$http.get(url).success(function(data){d.resolve(data);for(var l=0;l<newRequest.listeners.length;l++)newRequest.listeners[l].resolve(data);s.requests.splice(s.requests.indexOf(newRequest),1)}).error(function(error){d.reject(error)}),d.promise},AltaiHttp.prototype.post=function(url,data){return this.$http.post(url,data)},AltaiHttp.prototype.postNew=function(url,data){var authService=this.$injector.get("authService"),s=this;if(authService.getAccessToken()&&authService.isAccessTokenExpired()){var d=s.$q.defer();return authService.refreshToken().then(function(){console.debug("[AltaiIdentity] Token expired, getting a new one for post"),s.postAfterTokenValidated(url,data).then(function(result){d.resolve(result)},function(rejection){d.reject(rejection)})}),d.promise}return this.postAfterTokenValidated(url,data)},AltaiHttp.prototype.postAfterTokenValidated=function(url,data){var s=this,currentRequest=this.requests.filter(function(req){return req.url==url})[0];if(currentRequest){var listeningPromise=s.$q.defer();return currentRequest.listeners.push(listeningPromise),listeningPromise.promise}var d=this.$q.defer(),newRequest={url:url,listeners:[]};return s.requests.push(newRequest),s.$http.post(url,data).success(function(data){d.resolve(data);for(var l=0;l<newRequest.listeners.length;l++)newRequest.listeners[l].resolve(data);s.requests.splice(s.requests.indexOf(newRequest),1)}).error(function(error){d.reject(error);for(var l=0;l<newRequest.listeners.length;l++)newRequest.listeners[l].reject(error);s.requests.splice(s.requests.indexOf(newRequest),1)}),d.promise},AltaiHttp.prototype["delete"]=function(url){return this.$http["delete"](url)},AltaiHttp}();AltaiCore.AltaiHttp=AltaiHttp}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiJsonFormattingService=function(){function AltaiJsonFormattingService(){}return AltaiJsonFormattingService.prototype.toCamel=function(o){var build,key,destKey,value;if(o instanceof Array){build=[];for(key in o)value=o[key],"object"==typeof value&&(value=this.toCamel(value)),build.push(value)}else{build={};for(key in o)o.hasOwnProperty(key)&&(destKey=(key.charAt(0).toLowerCase()+key.slice(1)||key).toString(),value=o[key],null!==value&&"object"==typeof value&&(value=this.toCamel(value)),build[destKey]=value)}return build},AltaiJsonFormattingService}();AltaiCore.AltaiJsonFormattingService=AltaiJsonFormattingService}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiGuidService=function(){function AltaiGuidService(){}return AltaiGuidService.prototype.generateGuid=function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1).toUpperCase()}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()},AltaiGuidService}();AltaiCore.AltaiGuidService=AltaiGuidService}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var AltaiToolbarMenu=function(){function AltaiToolbarMenu(){this.bindings={menuModel:"=",languages:"=",useDefaultLangs:"="},this.controller=AltaiToolbarMenuController,this.restrict="AE",this.templateUrl="/api/template/Admin/AltaiToolbarMenu"}return AltaiToolbarMenu}();AltaiCore.AltaiToolbarMenu=AltaiToolbarMenu;var AltaiToolbarMenuController=function(){function AltaiToolbarMenuController($filter,$interval,$rootScope,$scope){this.$filter=$filter,this.$interval=$interval,this.$rootScope=$rootScope,this.$scope=$scope,this.leftMenuGroup=[],this.centerMenuGroup=[],this.rightMenuGroup=[];this.shiftToolbarInWindows($scope.$parent),this.initMenuAlignment()}return AltaiToolbarMenuController.prototype.shiftToolbarInWindows=function(parent){parent.vm&&parent.vm.shiftToolbar?parent.vm.shiftToolbar():parent.$parent&&this.shiftToolbarInWindows(parent.$parent)},AltaiToolbarMenuController.prototype.initMenuAlignment=function(){if(this.menuModel.menuGroups)for(var i=0;i<this.menuModel.menuGroups.length;i++){var group=this.menuModel.menuGroups[i];"center"==group.align?this.centerMenuGroup.push(group):"right"==group.align?this.rightMenuGroup.push(group):this.leftMenuGroup.push(group)}},AltaiToolbarMenuController.prototype.performAction=function(actionObject,disabled){disabled||actionObject.action()},AltaiToolbarMenuController.prototype.translateLable=function(translateId){return this.$filter("translate")(translateId)},AltaiToolbarMenuController}(),ToolbarMenu=function(){function ToolbarMenu(){}return ToolbarMenu}();AltaiCore.ToolbarMenu=ToolbarMenu;var ToolbarMenuGroup=function(){function ToolbarMenuGroup(){}return ToolbarMenuGroup}();AltaiCore.ToolbarMenuGroup=ToolbarMenuGroup;var ToolbarMenuItem=function(){function ToolbarMenuItem(){}return ToolbarMenuItem}();AltaiCore.ToolbarMenuItem=ToolbarMenuItem}(AltaiCore||(AltaiCore={}));var AltaiCore;!function(AltaiCore){var mod=angular.module("altai.core",["ui.router","ngCookies","oc.lazyLoad","toastr"]);mod.constant("config",config),mod.provider("altaiInstaller",AltaiCore.AltaiInstallerProvider),mod.provider("altaiSettings",AltaiCore.AltaiSettingsProvider),mod.service("altaiClientDataStore",AltaiCore.AltaiClientDataStore),mod.service("altaiNotificationFactory",AltaiCore.AltaiNotificationFactory),mod.factory("altaiModuleManager",AltaiCore.AltaiModuleManager),mod.service("altaiConfirmationService",AltaiCore.AltaiConfirmationService),mod.service("altaiHttp",AltaiCore.AltaiHttp),mod.service("altaiJsonFormattingService",AltaiCore.AltaiJsonFormattingService),mod.service("altaiSpinnerInterceptor",AltaiCore.AltaiSpinnerInterceptor),mod.service("urlParameterService",AltaiCore.urlParameterService),mod.service("urlSerialization",AltaiCore.urlSerialization),mod.service("altaiGuidService",AltaiCore.AltaiGuidService),mod.filter("altaicast",AltaiCore.AltaiCastFilter),mod.filter("binary",AltaiCore.BinaryFilter),mod.filter("altaicutoff",AltaiCore.AltaiCutoffFilter),mod.filter("localDate",AltaiCore.localDateFilter),mod.filter("escape",AltaiCore.escapeFilter),mod.controller("installerController",AltaiCore.InstallerController),mod.controller("moduleListController",AltaiCore.ModuleListController),mod.controller("settingsController",AltaiCore.SettingsController),mod.component("altaiToolbarMenu",new AltaiCore.AltaiToolbarMenu),mod.directive("altaiAdminSidebar",AltaiCore.AltaiAdminSidebarDirective),mod.directive("altaiBg",AltaiCore.AltaiBgDirective),mod.directive("altaiButton",AltaiCore.AltaiButtonDirective),mod.directive("altaiDrag",AltaiCore.AltaiDragDirective),mod.directive("altaiDrop",AltaiCore.AltaiDropDirective),mod.directive("altaiPagination",AltaiCore.AltaiPaginationDirective),mod.directive("altaiScrollfix",AltaiCore.AltaiScrollfixDirective),mod.directive("pageTitle",AltaiCore.PageTitleDirective),mod.directive("altaiMachineName",AltaiCore.AltaiMachineNameDirective),mod.directive("treeList",AltaiCore.AltaiTreeListDirective),mod.directive("altaiBody",AltaiCore.AltaiBodyDirective),mod.directive("altaiSmoothScroll",AltaiCore.AltaiSmoothScrollDirective),mod.directive("altaiBackground",AltaiCore.AltaiSetBackgroundDirective),
mod.service("logService",AltaiCore.logService),mod.config(function($stateProvider,$locationProvider,$httpProvider,toastrConfig){$httpProvider.interceptors.push("altaiSpinnerInterceptor"),angular.extend(toastrConfig,{autoDismiss:!1,containerId:"toast-container",maxOpened:0,newestOnTop:!0,positionClass:"toast-bottom-right",preventDuplicates:!1,preventOpenDuplicates:!1,target:"body"}),$locationProvider.html5Mode(!0),$stateProvider.state("installer",{url:"/install",system:!0,views:{bodyView:{altaiTemplate:"installer",altaiTemplateType:"Admin",controller:"installerController",controllerAs:"vm"}}}).state("admin.module",{url:"/module",system:!0,"abstract":!0}).state("admin.module.list",{url:"/list",system:!0,resolve:{modulesList:function(moduleFactory){return moduleFactory.listModule(!1)}},views:{"adminContentView@admin":{altaiTemplate:"moduleList",altaiTemplateType:"Admin",controller:"moduleListController"}}}).state("admin.settings",{url:"/settings",system:!0,resolve:{settingsData:function(settings){return settings.list()}},views:{"adminContentView@admin":{altaiTemplate:"settings",controller:"settingsController",controllerAs:"vm"}}})}),mod.run(function($rootScope,altaiSettings){$rootScope.staticFileBase=config.staticFileBase,$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.setTitle(toState.title)}),$rootScope.download=function(file){window.location.href=file},$rootScope.setTitle=function(title){title&&$rootScope.appname?$rootScope.pageTitle=title+" | "+$rootScope.appname:title?$rootScope.pageTitle=title:$rootScope.pageTitle=$rootScope.appname}}),config.modules.push("altai.core")}(AltaiCore||(AltaiCore={}));var AltaiAdmin;!function(AltaiAdmin){function SystemConfigController(wmContainerFactory){wmContainerFactory.createWindow(AltaiAdmin.AdminWindows.systemConfig,"System configuration","")}AltaiAdmin.SystemConfigController=SystemConfigController}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){var AdminDashboardController=function(){function AdminDashboardController(wmContainerFactory){}return AdminDashboardController}();AltaiAdmin.AdminDashboardController=AdminDashboardController}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiAdminToolbarDirective(){return{templateUrl:"/api/template/Admin/Toolbar:adminToolbar",replace:!0,controllerAs:"$ctrl",controller:function($scope,$rootScope,$state,languageFactory,$translate,contentTypeService,wmContainerFactory,authService,altaiAdminMenu,altaiLocalizationService){function determineActiveLangCode(){var activeLang=altaiLocalizationService.getCurrentLangCode();$scope.languages=$scope.languages.map(function(lang){return lang.selected=activeLang==lang.code,lang})}function checkUserInfo(){authService.getUserInfo().then(function(userInfo){$rootScope.user.authorized=!0,authService.isAuthorized("admin.menu").then(function(result){s.showMenu=result,$rootScope.user.adminmenu=result}),authService.isAuthorized("state.list").then(function(result){s.showStates=result}),authService.isAuthorized("state.build").then(function(result){s.showStateBuilderSwitch=result}),$scope.contentTypes||contentTypeService.list().then(function(contentTypes){$scope.contentTypes=contentTypes.filter(function(ct){return ct.directCreatePossible})}),$scope.menuItems=altaiAdminMenu.items(!0)},function(){$rootScope.user.authorized=!1})}var s=this;this.loading=!1,this.showMenu=!1,this.showStates=!1,this.showTaskCenter=!0,this.showBackgroundWorkInfoCenter=!0,this.showStateBuilderSwitch=!1,this.logout=function(){window.location.href="/logout"},$scope.$on("loaderShow",function(){s.loading=!0}),$scope.$on("loaderHide",function(){s.loading=!1}),$scope.user={authorized:!0},$scope.openState=function(selectedState){$state.go(selectedState.state,{},{reload:!0}),selectedState.name==$state.current.name&&$state.reload(selectedState.state)},$scope.menuItems=altaiAdminMenu.items(!0),$scope.openCt=function(ct){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,ct.name,ct.id)},$scope.openFlowCt=function(ct){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemCreate,ct.name,ct.id)},$scope.$on("userInfoChanged",function(){checkUserInfo()}),$scope.selectLang=function(lang){altaiLocalizationService.changeLang(lang.code).then(function(){$rootScope.$broadcast("refreshWindow"),$rootScope.$broadcast("languageChanged"),determineActiveLangCode(),window.location.reload()})},languageFactory.listLanguage().then(function(languages){$scope.languages=languages,determineActiveLangCode()}),checkUserInfo()}}}AltaiAdmin.AltaiAdminToolbarDirective=AltaiAdminToolbarDirective}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiAdminToolbarItemDirective(){return{scope:!0,controllerAs:"vm",controller:function(){var vm=this;this.opened=!1,this.toggle=function(){vm.opened=!vm.opened}}}}AltaiAdmin.AltaiAdminToolbarItemDirective=AltaiAdminToolbarItemDirective}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiAdminToolbarStateSelectorDirective(){return{scope:!0,template:'<select ng-model="vm.selectedState" ng-options="s as s.name for s in vm.states" ng-change="vm.selectState(vm.selectedState)"><option></option></select>',controller:AltaiAdminToolbarStateSelectorDirectiveController,controllerAs:"vm"}}AltaiAdmin.AltaiAdminToolbarStateSelectorDirective=AltaiAdminToolbarStateSelectorDirective;var AltaiAdminToolbarStateSelectorDirectiveController=function(){function AltaiAdminToolbarStateSelectorDirectiveController($state,$scope,authService,stateManager){this.$state=$state,this.$scope=$scope,this.authService=authService,this.stateManager=stateManager;var vm=this;$scope.$on("userInfoChanged",function(){vm.getStateData()}),vm.getStateData()}return AltaiAdminToolbarStateSelectorDirectiveController.prototype.getStateData=function(){var vm=this;!vm.states&&vm.authService.isAuthorizedSync("state.list")&&vm.stateManager.list().then(function(states){vm.states=states,vm.selectActiveState(),vm.$scope.$on("$stateChangeSuccess",function(){vm.selectActiveState()})})},AltaiAdminToolbarStateSelectorDirectiveController.prototype.selectState=function(state){this.$state.go(state.name,{reload:!0})},AltaiAdminToolbarStateSelectorDirectiveController.prototype.selectActiveState=function(){var controller=this,activeState=this.states.filter(function(state){return state.name===controller.$state.current.name});1===activeState.length&&(controller.selectedState=activeState[0])},AltaiAdminToolbarStateSelectorDirectiveController}()}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiToolbarModeSelectorDirective(){return{template:"<md-switch ng-model='editMode' ng-change='vm.altaiEditModeService.toggleEditMode()' aria-label='edit-mode'></md-switch>",controllerAs:"vm",controller:function(altaiEditModeService){this.altaiEditModeService=altaiEditModeService}}}AltaiAdmin.AltaiToolbarModeSelectorDirective=AltaiToolbarModeSelectorDirective}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiSystemConfigDirective(){return{templateUrl:"/api/template/Admin/Config:System",controller:AltaiSystemConfigController,controllerAs:"vm"}}AltaiAdmin.AltaiSystemConfigDirective=AltaiSystemConfigDirective;var AltaiSystemConfigController=function(){function AltaiSystemConfigController(wmContainerFactory,configManager){this.wmContainerFactory=wmContainerFactory,this.configManager=configManager}return AltaiSystemConfigController.prototype.clearCache=function(){var ctrl=this;ctrl.configManager.ClearCache()},AltaiSystemConfigController.prototype.RecycleAppPool=function(){var ctrl=this;ctrl.configManager.RecycleAppPool()},AltaiSystemConfigController}()}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiKeyboardShortcut($window){return function(str){if(str){var keys=str.split("-"),isOSX=/Mac OS X/.test($window.navigator.userAgent),seperator=!isOSX||keys.length>2?"+":"",abbreviations={M:isOSX?"⌘":"Ctrl",A:isOSX?"Option":"Alt",S:"Shift"};return keys.map(function(key,index){var last=index==keys.length-1;return last?key:abbreviations[key]}).join(seperator)}}}AltaiAdmin.AltaiKeyboardShortcut=AltaiKeyboardShortcut}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){function AltaiAdminMenuProvider(){var _sidebarItems=[],_tree=[];return{add:function(sidebarItem){if("sorted"in sidebarItem||(sidebarItem.sorted=!0),_sidebarItems.push(sidebarItem),sidebarItem.parent)var parentElm=_tree.filter(function(elm){return elm.name==sidebarItem.parent})[0];parentElm?parentElm.children.push(sidebarItem):(sidebarItem.children=[],_tree.push(sidebarItem))},$get:function($rootScope,authService){var exports={};return exports.items=function(sorted){function hasAccessToMenuItem(item){return"securable"in item?authService.isAuthorizedSync(item.securable):!0}function sortBranch(branch){branch=branch.sort(function(a,b){return a.order<b.order?-1:a.order>b.order?1:0});for(var i=0;i<branch.length;i++)"children"in branch[i]&&branch[i].sorted&&(branch[i].children=sortBranch(branch[i].children));return branch}var outputTree=[];return angular.copy(_tree,outputTree),authService.getUserInfo().then(function(user){for(var treeElements=_tree.length,i=0;treeElements>i;i++){if(!hasAccessToMenuItem(_tree[i])){var spliceIndex=outputTree.indexOf(outputTree.filter(function(elm){return elm.name==_tree[i].name&&elm.parent==_tree[i].parent})[0]);outputTree.splice(spliceIndex,1)}for(var c=0;c<_tree[i].children.length;c++)if(!hasAccessToMenuItem(_tree[i].children[c])){var parentIndex=outputTree.indexOf(outputTree.filter(function(elm){return elm.name==_tree[i].children[c].parent})[0]);if(outputTree[parentIndex]){var childIndex=outputTree[parentIndex].children.indexOf(outputTree[parentIndex].children.filter(function(elm){return elm.name==_tree[i].children[c].name})[0]);outputTree[parentIndex].children.splice(childIndex,1)}}}}),sorted?sortBranch(outputTree):outputTree},exports}}}AltaiAdmin.AltaiAdminMenuProvider=AltaiAdminMenuProvider}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){var ConfigManager=function(){function ConfigManager(altaiHttp,$q,altaiNotificationFactory){this.$q=$q,this.altaiHttp=altaiHttp,this.notificationFactory=altaiNotificationFactory}return ConfigManager.prototype.ClearCache=function(){var service=this,d=this.$q.defer();return service.altaiHttp.get(config.backendUrl+"api/cache/reset").then(function(result){result?service.notificationFactory.success("Cleared cache"):service.notificationFactory.error("Could not clear cache"),d.resolve(result)},function(error){service.notificationFactory.error("Could not clear cache"),d.reject()}),d.promise},ConfigManager.prototype.RecycleAppPool=function(){var service=this,d=service.$q.defer();return service.altaiHttp.get(config.backendUrl+"api/configuration/recycle").then(function(result){result?service.notificationFactory.success("Recycled AppPool"):service.notificationFactory.error("Could not recycle AppPool"),d.resolve(result)},function(error){service.notificationFactory.error("Could not recycle AppPool"),d.reject()}),d.promise},ConfigManager}();AltaiAdmin.ConfigManager=ConfigManager}(AltaiAdmin||(AltaiAdmin={}));var AltaiAdmin;!function(AltaiAdmin){var mod=angular.module("altai.admin",["ngMaterial"]);mod.directive("altaiAdminToolbar",AltaiAdmin.AltaiAdminToolbarDirective),mod.directive("altaiAdminToolbarItem",AltaiAdmin.AltaiAdminToolbarItemDirective),mod.directive("altaiAdminToolbarStateSelector",AltaiAdmin.AltaiAdminToolbarStateSelectorDirective),mod.directive("altaiAdminToolbarModeSelector",AltaiAdmin.AltaiToolbarModeSelectorDirective),mod.directive("altaiConfigSystem",AltaiAdmin.AltaiSystemConfigDirective),mod.filter("altaiKeyboardShortcut",AltaiAdmin.AltaiKeyboardShortcut),mod.provider("altaiAdminMenu",AltaiAdmin.AltaiAdminMenuProvider),mod.service("configManager",AltaiAdmin.ConfigManager),mod.config(function($mdAriaProvider,$stateProvider,$urlRouterProvider,altaiAdminMenuProvider,$mdThemingProvider){$mdAriaProvider.disableWarnings(),$mdThemingProvider.theme("altTheme").primaryPalette("blue"),$stateProvider.state("admin",{url:"/admin",system:!0,resolve:{auth:function($state,$timeout,$q,authService){var d=$q.defer();return authService.isAuthorizedSync("admin")?d.resolve():$timeout(function(){console.debug("cannot access admin page"),$state.go("login"),d.resolve()}),d.promise}}}).state("admin.dashboard",{url:"/dashboard",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiAdmin.AdminDashboardController}}}).state("admin.config",{url:"/config/system",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiAdmin.SystemConfigController}}}),altaiAdminMenuProvider.add({name:"config",label:"configuration",order:5,icon:"mdi mdi-settings menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"config",name:"config.systemconfig",securable:"admin.systemconfig",label:"systemconfig",icon:"mdi mdi-settings menuicon",state:"admin.config"})})}(AltaiAdmin||(AltaiAdmin={})),config.modules.push("altai.admin");var AltaiWindowManager;!function(AltaiWindowManager){function wmWindowSidebarGenericHandleDirective(){return{replace:!0,require:"^wmWindow",template:"<i ng-click='openGenericSidebar()'></i>",controllerAs:"vm",link:function($scope,$element,$attrs,wmWindow){$scope.openGenericSidebar=function(){wmWindow.toggleGenericSidebar()}}}}AltaiWindowManager.wmWindowSidebarGenericHandleDirective=wmWindowSidebarGenericHandleDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmContainerDirective(wmContainerFactory){return{name:"wmContainer",restrict:"E",replace:!0,scope:{},templateUrl:"/api/template/Admin/windowContainer",controllerAs:"vm",controller:function($scope,$element){this.windows=wmContainerFactory.getWindows(),this.grid=wmContainerFactory.getGrid()}}}AltaiWindowManager.wmContainerDirective=wmContainerDirective,wmContainerDirective.$inject=["wmContainerFactory"]}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmGridColDirective(wmContainerFactory){return{scope:{col:"="},controller:function($scope,$element){this.col=$scope.col,wmContainerFactory.registerGridCol($scope.col,$element),this.useHandle=function(movement){return wmContainerFactory.resizeCol($scope.col,movement)}}}}AltaiWindowManager.wmGridColDirective=wmGridColDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){"use strict";function wmGridDirective(){return{restrict:"A",scope:{},controller:function($scope){}}}AltaiWindowManager.wmGridDirective=wmGridDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){"use strict";function wmGridHdividerDirective(wmDragFactory,wmContainerFactory){return{template:"<div class='wm-grid-hdivider'></div>",replace:!0,link:function($scope,$element){function makeInvisible(){$element.removeClass("dragover")}function makeVisible(){$element.addClass("dragover")}$element.bind("dragover",function(e){e.preventDefault()}),$element.bind("dragenter",function(e){e.preventDefault(),makeVisible()}),$element.bind("dragleave",function(e){e.preventDefault(),makeInvisible()}),$element.bind("drop",function(e){var origin=wmDragFactory.getDragWindow(),rowId=wmContainerFactory.getRowOfWindow($scope.cols[0].windows[0]);$scope.$apply(function(){wmContainerFactory.moveWindowToNewRow(origin,rowId)}),makeInvisible()})}}}AltaiWindowManager.wmGridHdividerDirective=wmGridHdividerDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){"use strict";function wmGridRowDirective(wmContainerFactory,wmDragFactory){return{scope:{cols:"="},replace:!0,template:"<div class='wm-grid-row'><div class='wm-grid-row-inner'><div wm-grid-col col='col' class='wm-grid-col' ng-class='{\"maximized\":vm.fullscreenMode(col)}' ng-repeat='col in cols' ng-if='vm.visibleWindowCount(col)'><div class='wm-grid-col-windows'><wm-window window='window' ng-repeat='window in col.windows track by window.id' ng-show='window.visible'></wm-window><div wm-grid-col-dropzone></div></div><div wm-resize-handler class='wm-resize-handler' ng-if='!vm.fullscreenMode(col) || !$last'> </div></div> </div></div> ",controllerAs:"vm",link:function(scope,element){function doScrollSnap(){scrollSnap&&screenIsLargeEnoughForSnapping()&&innerRowElm.animate({scrollLeft:scrollSnap-rowLeftOffset},"250","swing")}function totalWidth(){var output=0;return $(element).find(".wm-grid-col").each(function(index,elm){output+=$(elm).width()}),output}function screenIsLargeEnoughForSnapping(){return totalWidth()>window.innerWidth+snapWidth}var timer,scrollSnap=0,snapWidth=100,innerRowElm=$("body"),rowLeftOffset=$(element).offset().left;wmContainerFactory.subscribe("windowCreated",function(){innerRowElm.animate({scrollLeft:innerRowElm.width()+9e3},"0","swing")}),element.on("drop",function(e){wmDragFactory.getDragWindow()}),element.on("dragover",function(event){event.preventDefault()}),innerRowElm.on("mousewheel",function(event){clearTimeout(timer),innerRowElm.scrollLeft(innerRowElm.scrollLeft()-event.originalEvent.wheelDelta),timer=setTimeout(doScrollSnap,520)}),innerRowElm.bind("mouseup",doScrollSnap)},controller:function(){this.visibleWindowCount=function(col){return col&&col.windows?col.windows.filter(function(win){return win.visible}).length:0},this.rowVisibleWindowCount=function(cols){for(var counter=0,c=0;c<cols.length;c++)counter+=this.visibleWindowCount(cols[c]);return counter},this.fullscreenMode=function(col){return 0!==col.windows.filter(function(window){return 1===window.state}).length}}}}AltaiWindowManager.wmGridRowDirective=wmGridRowDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmResizeHandlerDirective(wmContainerFactory){return{require:"^wmGridCol",link:function(scope,element,attrs,wmGridCol){function unbind(){$(element.parent().parent()).unbind("mousemove")}var start;element.bind("mousedown",function(e){e.preventDefault(),start=e.clientX,$(element.parent().parent()).mousemove(function(e){var movement=start-e.clientX,colPositionLeft=element.parent()[0].getBoundingClientRect().left,minWidth=wmContainerFactory.getMinWidthOfCol(wmGridCol.col),maxWidth=wmContainerFactory.getMaxWidthOfCol(wmGridCol.col);movement&&e.clientX>minWidth+colPositionLeft&&e.clientX<maxWidth+colPositionLeft&&wmGridCol.useHandle(movement),start=e.clientX})}),$("body").bind("mouseup",unbind)}}}AltaiWindowManager.wmResizeHandlerDirective=wmResizeHandlerDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmWindowDirective(wmContainerFactory,wmDragFactory,$timeout,$injector,$window,$rootScope){return{restrict:"E",name:"wmWindow",scope:{window:"="},replace:!0,controllerAs:"vm",templateUrl:"/api/template/Admin/window",controller:function($scope,$element,$rootScope,$timeout){function restoreSize(){wmContainerFactory.removeFocusOnWindow(),$element.removeClass("maximized"),$element.parent().removeClass("maximized"),$timeout(function(){$element.focus()}),$scope.$emit("wmWindowMaximized")}function maximize(){wmContainerFactory.focusOnWindow(controller.window),$scope.$emit("wmWindowMaximized")}function half(){wmContainerFactory.setHalfSize(controller.window),$scope.$emit("wmWindowHalf")}var controller=this;this.showRelatedMenu=!1,this.itemSidebar=!1,this.genericSidebarHandle=!1,this.containerInfo=wmContainerFactory.containerInfo,this.window=$scope.window,this.shiftToolbar=function(){controller.toolbarShift=!0},this.close=function(){this.window.state==AltaiWindowManager.wmWindowState.maximized&&restoreSize(),$rootScope.$broadcast("wmWindowClosed",this.window),wmContainerFactory.destroyWindow(this.window.id),this.window.state===AltaiWindowManager.wmWindowState.maximized&&wmContainerFactory.removeFocusOnWindow()},this.toggleGenericSidebar=function(){this.genericSidebarHandle=!this.genericSidebarHandle},this.setWindowTitle=function(newTitle){this.window.title=newTitle},this.toggleMaximize=function(){$("body").animate({scrollLeft:$element.offset().left-15},"0","swing"),this.window.state===AltaiWindowManager.wmWindowState.maximized?restoreSize():maximize(),this.window.toggleMaximize()},this.toggleHalf=function(){$("body").animate({scrollLeft:$element.offset().left-15},"0","swing"),this.window.state===AltaiWindowManager.wmWindowState.half?restoreSize():half(),this.window.toggleHalf()},this.toggleMinimize=function(){controller.window.toggleMinimize(),wmContainerFactory.minimizeWindow(controller.window)},this.toggleRelated=function(){this.showRelatedMenu=!this.showRelatedMenu},this.toggleDisplayMode=function(){switch(this.window.toggleDisplayMode(),this.window.displayMode){case AltaiWindowManager.wmWindowDisplayMode.min:wmContainerFactory.setWidthOfWindow(this.window,this.window.windowType.minWidth);break;case AltaiWindowManager.wmWindowDisplayMode.optimal:wmContainerFactory.setWidthOfWindow(this.window,this.window.windowType.optimalWidth);break;case AltaiWindowManager.wmWindowDisplayMode.max:wmContainerFactory.setWidthOfWindow(this.window,this.window.windowType.maxWidth)}},this.openItemSidebar=function(){$scope.itemSidebar=!$scope.itemSidebar}}}}AltaiWindowManager.wmWindowDirective=wmWindowDirective,AltaiWindowManager.wmContainerDirective.$inject=["wmContainerFactory","wmDragFactory","$timeout"]}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){"use strict";function wmWindowDropzoneDirective(wmContainerFactory,wmDragFactory){return{link:function($scope,$element){function hideDropZone(){$element.removeClass("dragover")}$element.bind("dragenter",function(e){$element.addClass("dragover")}),$element.bind("dragleave",function(e){hideDropZone()}),$element.bind("dragover",function(e){e.preventDefault()}),$element.bind("drop",function(e){$scope.$apply(function(){var dropWindow=wmDragFactory.getDragWindow();wmContainerFactory.addWindowToColumnAfterWindow($scope.window,dropWindow),hideDropZone()})})}}}AltaiWindowManager.wmWindowDropzoneDirective=wmWindowDropzoneDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmWindowInnerDirective(wmContainerFactory,wmDragFactory,$timeout){return{link:function($scope,$element,$attrs){function getHorizontalDragPosition(event){return event.originalEvent.clientX-$element.offset().left<$element.width()/2}function removeDropZone(){$($element).children(".dropzone-left").hide(),$($element).children(".dropzone-right").hide()}$scope.lastWindowOfRow=$($element).index()===$($element).parent().children().length-2,$element.bind("dragstart",function(e){wmDragFactory.setDragWindow($scope.window)}),$element.bind("dragover",function(e){if(wmDragFactory.getDragWindow()==$scope.window)return void e.preventDefault();var dt=e.originalEvent.dataTransfer,isFileDrag=dt.types&&(dt.types.indexOf?-1!=dt.types.indexOf("Files"):dt.types.contains("Files"));isFileDrag||(getHorizontalDragPosition(e)?($($element).children(".dropzone-left").show(),$($element).children(".dropzone-right").hide()):($($element).children(".dropzone-right").show(),$($element).children(".dropzone-left").hide())),e.preventDefault()}),$element.bind("dragleave",function(e){removeDropZone()}),$element.bind("drop",function(e){e.stopPropagation();var origin=wmDragFactory.getDragWindow(),cursor=$scope.window;if(origin){if(origin.id===cursor.id)return void removeDropZone()}else;$timeout(function(){$scope.$apply(function(){wmContainerFactory.moveWindow(origin,cursor,getHorizontalDragPosition(e))})}),removeDropZone()})}}}AltaiWindowManager.wmWindowInnerDirective=wmWindowInnerDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmWindowInnerContentDirective($compile,$rootScope){return{template:"<div></div>",link:function($scope,$element){function buildWindow(){$scope.$$childHead&&$scope.$$childHead.$destroy();var windowTemplate=$scope.vm.window.windowType.template,newScope=$scope.$new(),contentElm=$element[0].firstChild;contentElm.innerHTML=windowTemplate,$compile(contentElm)(newScope)}$scope.vm.refresh=function(){buildWindow()},$scope.$on("refreshWindow",function(){buildWindow()}),buildWindow(),$element.bind("mousewheel",function(e){$element[0].scrollHeight>$element.height()&&e.stopPropagation()})}}}AltaiWindowManager.wmWindowInnerContentDirective=wmWindowInnerContentDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmStopEvent(){return{name:"wmStopEvent",restrict:"A",link:function(scope,element,attr){attr&&attr.eventType&&element.bind(attr.eventType,function(e){e.stopPropagation()})}}}AltaiWindowManager.wmStopEvent=wmStopEvent}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){function wmRefDirective(wmContainerFactory){return{scope:{windowType:"@wmRef",entityId:"=",title:"@"},link:function(scope,element){element.bind("click",function(){var wmType=config.windows.filter(function(wmType){return wmType.value==scope.windowType})[0];wmType?scope.$apply(function(){wmContainerFactory.createWindow(wmType,scope.title,scope.entityId)}):console.error("wmType "+scope.windowType+" could not be found")})}}}AltaiWindowManager.wmRefDirective=wmRefDirective}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmGridCol=function(){function wmGridCol(){this.windows=[],this.width=100}return wmGridCol}();AltaiWindowManager.wmGridCol=wmGridCol}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmGridRow=function(){function wmGridRow(){this.cols=[]}return wmGridRow}();AltaiWindowManager.wmGridRow=wmGridRow}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmWindow=function(){function wmWindow(id,windowType,title,entityId,entityProperties){this.visible=!0,this.width=100,this.minimizedWidth=42,this.state=wmWindowState.normal,this.displayMode=wmWindowDisplayMode.min,this.enabled=!0,this.id=id,this.windowType=windowType,this.title=title,this.entityId=entityId,this.entityProperties=entityProperties,this.windowGroup=new AltaiWindowManager.wmWindowGroup}return wmWindow.prototype.hide=function(){this.visible=!1},wmWindow.prototype.show=function(){this.visible=!0},wmWindow.prototype.toggleMinimize=function(){this.state===wmWindowState.minimized?this.state=wmWindowState.normal:(this.state=wmWindowState.minimized,this.width=this.minimizedWidth)},wmWindow.prototype.toggleMaximize=function(){this.state===wmWindowState.maximized?this.state=wmWindowState.normal:this.state=wmWindowState.maximized},wmWindow.prototype.toggleHalf=function(){this.state===wmWindowState.half?this.state=wmWindowState.normal:this.state=wmWindowState.half},wmWindow.prototype.toggleDisplayMode=function(){return this.state===wmWindowState.minimized?void this.toggleMinimize():void(this.displayMode!=wmWindowDisplayMode.max?this.displayMode++:this.displayMode=wmWindowDisplayMode.min)},wmWindow.prototype.makeDisplayModeLarger=function(){this.displayMode++},wmWindow}();AltaiWindowManager.wmWindow=wmWindow;var wmWindowState;!function(wmWindowState){wmWindowState[wmWindowState.normal=0]="normal",wmWindowState[wmWindowState.maximized=1]="maximized",wmWindowState[wmWindowState.minimized=2]="minimized",wmWindowState[wmWindowState.half=3]="half"}(wmWindowState=AltaiWindowManager.wmWindowState||(AltaiWindowManager.wmWindowState={}));var wmWindowDisplayMode;!function(wmWindowDisplayMode){wmWindowDisplayMode[wmWindowDisplayMode.min=0]="min",wmWindowDisplayMode[wmWindowDisplayMode.optimal=1]="optimal",wmWindowDisplayMode[wmWindowDisplayMode.max=2]="max"}(wmWindowDisplayMode=AltaiWindowManager.wmWindowDisplayMode||(AltaiWindowManager.wmWindowDisplayMode={}))}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmWindowGroup=function(){function wmWindowGroup(){var colors=["color-orange","color-blue","color-green","color-red","color-grey"],rndNmbr=Math.random()*colors.length+"";this.color=colors[parseInt(rndNmbr)]}return wmWindowGroup}();AltaiWindowManager.wmWindowGroup=wmWindowGroup}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmWindowType=function(){function wmWindowType(value,template,minWidth,optimalWidth,maxWidth,translatable,multiLanguage){void 0===minWidth&&(minWidth=600),void 0===optimalWidth&&(optimalWidth=960),void 0===maxWidth&&(maxWidth=1600),void 0===translatable&&(translatable=!1),void 0===multiLanguage&&(multiLanguage=!1),this.value=value,this.template=template,this.minWidth=minWidth,this.optimalWidth=optimalWidth,this.maxWidth=maxWidth,this.translatable=translatable,this.multiLanguage=multiLanguage}return wmWindowType.prototype.toString=function(){return this.value},wmWindowType}();AltaiWindowManager.wmWindowType=wmWindowType}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmContainerFactory=function(){function wmContainerFactory(){this.columnCount=0,this.maxColumnsInRow=-1,this.eventCallbacks={noWindows:[],windowCreated:[]},this.windowCounter=0,this.containerInfo={singleWindowMode:!0},this.windows=[],this.grid=[]}return wmContainerFactory.prototype.getWindows=function(){return this.windows},wmContainerFactory.prototype.getGrid=function(){return this.grid},wmContainerFactory.prototype.findWindow=function(windowType,entityId){return entityId?this.windows.filter(function(win){return win.entityId==entityId&&win.windowType==windowType})[0]:this.windows.filter(function(win){return win.windowType==windowType})[0]},wmContainerFactory.prototype.createWindow=function(windowType,title,entityId,properties){var existingWindow=this.findWindow(windowType,entityId);if(existingWindow)return existingWindow;1===this.windows.length&&(this.containerInfo.singleWindowMode=!1);var newWindow=new AltaiWindowManager.wmWindow(this.windowCounter++,windowType,title,entityId,properties);this.windows.push(newWindow);var rowId=this.findRowWithAvailableSpots(),newColumn=this.createColumn();return this.fitColumnToAvgRowWidth(newColumn,rowId),this.addColumnToRow(rowId,newColumn),newColumn.windows.push(newWindow),this.reDistributeWidthInRow(rowId),this.runEventCallbacks("windowCreated"),newWindow},wmContainerFactory.prototype.createColumn=function(){this.columnCount++;var newColumn=new AltaiWindowManager.wmGridCol;return newColumn.id=this.columnCount,newColumn},wmContainerFactory.prototype.fitColumnToAvgRowWidth=function(column,rowId){this.grid[rowId].cols.length?column.width=100/this.grid[rowId].cols.length:column.width=100},wmContainerFactory.prototype.addColumnToRow=function(rowId,column){this.grid[rowId].cols.push(column)},wmContainerFactory.prototype.addColumnToRowAtPosition=function(column,rowId,position){this.grid[rowId].cols.splice(position,0,column)},wmContainerFactory.prototype.findRowWithAvailableSpots=function(){for(var r=0;r<this.grid.length;r++)if(this.grid[r].cols.length<this.maxColumnsInRow||this.maxColumnsInRow<0)return r;return this.createRow()},wmContainerFactory.prototype.createRow=function(afterRow){var newRow={id:this.grid.length,cols:[]};if(void 0!==afterRow)return this.grid.splice(afterRow+1,0,newRow),afterRow+1;var newRowId=this.grid.push(newRow);return newRowId-1},wmContainerFactory.prototype.destroyWindow=function(windowId){var memoryWin=this.windows.filter(function(win){return win.id===windowId})[0],oldRowId=this.getRowOfWindow(memoryWin),oldColId=this.getColOfWindow(memoryWin);if(!memoryWin)throw alert("could not find the window"),"Could not find the window!";var memoryWinIndex=this.windows.indexOf(memoryWin),griwRowWindows=this.grid[this.getRowOfWindow(memoryWin)].cols[oldColId].windows,memoryGridIndex=griwRowWindows.indexOf(memoryWin);
this.windows.splice(memoryWinIndex,1),griwRowWindows.splice(memoryGridIndex,1),this.reDistributeWidthInRow(oldRowId),this.columnCount--,this.checkSingleWindowMode(),this.checkNoWindowMode()},wmContainerFactory.prototype.destoryAllWindows=function(){this.grid.splice(0,this.grid.length),this.windows.splice(0,this.windows.length)},wmContainerFactory.prototype.destoryRow=function(rowId){this.grid.splice(rowId,1)},wmContainerFactory.prototype.isEmptyRow=function(rowId){return this.destroyEmptyColumnsInRow(rowId),0===this.grid[rowId].cols.length},wmContainerFactory.prototype.checkSingleWindowMode=function(){this.containerInfo.singleWindowMode=1===this.windows.length},wmContainerFactory.prototype.checkNoWindowMode=function(){0===this.windows.length&&(this.runEventCallbacks("noWindows"),this.eventCallbacks.noWindows=[])},wmContainerFactory.prototype.runEventCallbacks=function(eventName){this.eventCallbacks[eventName].forEach(function(value){value.apply()})},wmContainerFactory.prototype.subscribe=function(eventType,callback){switch(eventType){case"noWindows":this.eventCallbacks.noWindows.push(callback);break;case"windowCreated":this.eventCallbacks.windowCreated.push(callback)}},wmContainerFactory.prototype.destroyEmptyRows=function(){for(var i=0;i<this.grid.length;i++)this.isEmptyRow(i)&&this.destoryRow(i)},wmContainerFactory.prototype.resizeCol=function(col,movement){var row=this.grid[this.getRowOfColumn(col)],colIndex=row.cols.indexOf(col),windowCol=row.cols[colIndex],newWidth=$(windowCol.elementRef).width()-movement;return this.setWidthOfCol(windowCol,newWidth)},wmContainerFactory.prototype.setWidthOfCol=function(col,newWidth,force){return void 0===force&&(force=!1),newWidth>=this.getMinWidthOfCol(col)&&newWidth<=this.getMaxWidthOfCol(col)||force?(col.width=newWidth,$(col.elementRef).css({width:newWidth}),!0):(console.log("resize too small/large"),!1)},wmContainerFactory.prototype.setWidthOfWindow=function(window,newWidth,force){void 0===force&&(force=!1);var rowIndex=this.getRowOfWindow(window),row=this.grid[rowIndex],colIndex=this.getColOfWindow(window),col=row.cols[colIndex];this.setWidthOfCol(col,newWidth,force)},wmContainerFactory.prototype.focusOnWindow=function(focusWindow){focusWindow.previousWidth=focusWindow.width;var colIndex=this.getColOfWindow(focusWindow);if(colIndex==this.columnCount-1)var fullscreenWidth=window.innerWidth-70;else var fullscreenWidth=window.innerWidth-30;this.setWidthOfWindow(focusWindow,fullscreenWidth,!0)},wmContainerFactory.prototype.setHalfSize=function(focusWindow){focusWindow.previousWidth=focusWindow.width;var colIndex=this.getColOfWindow(focusWindow);if(colIndex==this.columnCount-1)var fullscreenWidth=window.innerWidth/2-70;else var fullscreenWidth=window.innerWidth/2-30;this.setWidthOfWindow(focusWindow,fullscreenWidth,!1)},wmContainerFactory.prototype.removeFocusOnWindow=function(){var fullscreenWindow=this.getFullScreenWindow();fullscreenWindow&&(fullscreenWindow.state=AltaiWindowManager.wmWindowState.normal,this.setWidthOfWindow(fullscreenWindow,fullscreenWindow.windowType.optimalWidth,!0))},wmContainerFactory.prototype.getFullScreenWindow=function(){return this.windows.filter(function(win){return win.state==AltaiWindowManager.wmWindowState.maximized})[0]},wmContainerFactory.prototype.isSameRowTransaction=function(origin,cursor){var cursorRowId=this.getRowOfWindow(cursor),originRowId=this.getRowOfWindow(origin);return cursorRowId===originRowId},wmContainerFactory.prototype.moveWindow=function(origin,cursor,before){this.isSameRowTransaction(origin,cursor)?this.moveWindowInsideRow(origin,cursor,before):this.moveWindowToExistingRow(origin,cursor,before)},wmContainerFactory.prototype.moveWindowInsideRow=function(origin,cursor,before){var rowId=this.getRowOfWindow(cursor),cursorColId=this.getColOfWindow(cursor),originColId=this.getColOfWindow(origin),temp=(this.grid[rowId].cols,origin);this.removeWindowFromCol(origin);var newColumn=this.createColumn();this.fitColumnToAvgRowWidth(newColumn,rowId),this.addWindowToColumn(temp,newColumn),this.destroyEmptyColumnsInRow(rowId);var newPosition=cursorColId>originColId?before?cursorColId-1:cursorColId:before?cursorColId:cursorColId+1;this.addColumnToRowAtPosition(newColumn,rowId,newPosition),this.reDistributeWidthInRow(rowId)},wmContainerFactory.prototype.moveWindowToExistingRow=function(origin,cursor,before){var cursorRowId=this.getRowOfWindow(cursor),cursorColId=this.getColOfWindow(cursor),originRowId=this.getRowOfWindow(origin),originColId=this.getColOfWindow(origin),temp=origin;this.destroyColumn(originRowId,originColId),this.reDistributeWidthInRow(originRowId);for(var destinationRow=this.grid[cursorRowId].cols,newCol={windows:[temp],width:100},avgWidth=0,c=0;c<this.grid[cursorRowId].cols.length;c++)avgWidth+=this.grid[cursorRowId].cols[c].width;avgWidth/=c,newCol.width=avgWidth,before?destinationRow.splice(cursorColId,0,newCol):destinationRow.splice(cursorColId+1,0,newCol),this.reDistributeWidthInRow(cursorRowId)},wmContainerFactory.prototype.moveWindowToNewRow=function(origin,afterRow){var newRowId=this.createRow(afterRow),originRowId=this.getRowOfWindow(origin),originColId=this.getColOfWindow(origin),temp=origin;temp.width=100,this.grid[originRowId].cols[originColId].windows.splice(this.grid[originRowId].cols[originColId].windows.indexOf(origin),1);var newCol=this.createColumn();newCol.windows.push(temp),this.grid[newRowId].cols.push(newCol),this.reDistributeWidthInRow(originRowId)},wmContainerFactory.prototype.removeWindowFromCol=function(window){var colId=this.getColOfWindow(window),rowId=this.getRowOfWindow(window),col=this.grid[rowId].cols[colId],windowPosition=this.getPositionOfWindowInCol(window,col);col.windows.splice(windowPosition,1)},wmContainerFactory.prototype.getPositionOfWindowInCol=function(window,column){var rowId=this.getRowOfWindow(window),colId=this.getColOfWindow(window);return this.grid[rowId].cols[colId].windows.indexOf(window)},wmContainerFactory.prototype.reDistributeWidthInRow=function(rowIndex){var totalWidth=0,usedWidthPercentage=0,children=this.grid[rowIndex].cols;this.destroyEmptyRows(),this.destroyEmptyColumnsInRow(rowIndex);for(var c=0;c<children.length;c++)totalWidth+=children[c].width;for(var d=0;d<children.length;d++){var newWidth;d===children.length-1?newWidth=100-usedWidthPercentage:(newWidth=children[d].width/totalWidth*100,usedWidthPercentage+=newWidth),children[d].width=newWidth}},wmContainerFactory.prototype.destroyEmptyColumnsInRow=function(rowIndex){if(this.grid[rowIndex])for(var columns=this.grid[rowIndex].cols,e=0;e<columns.length;e++)columns[e].windows.length||this.destroyColumn(rowIndex,e)},wmContainerFactory.prototype.destroyColumn=function(rowIndex,colIndex){this.grid[rowIndex].cols.splice(colIndex,1)},wmContainerFactory.prototype.getRowOfColumn=function(col){for(var r=0;r<this.grid.length;r++)if(this.grid[r].cols.indexOf(col)>-1)return r;throw"could not find column"},wmContainerFactory.prototype.getRowOfWindow=function(window){for(var r=0;r<this.grid.length;r++)for(var c=0;c<this.grid[r].cols.length;c++)if(this.grid[r].cols[c].windows.indexOf(window)>-1)return r;throw"could not find window"},wmContainerFactory.prototype.getColOfWindow=function(window){for(var r=0;r<this.grid.length;r++)for(var c=0;c<this.grid[r].cols.length;c++)if(this.grid[r].cols[c].windows.indexOf(window)>-1)return c;throw"could not find window"},wmContainerFactory.prototype.minimizeAll=function(){for(var w=0;w<this.windows.length;w++)this.windows[w].state=AltaiWindowManager.wmWindowState.minimized},wmContainerFactory.prototype.normalizeAll=function(){for(var w=0;w<this.windows.length;w++)this.windows[w].state=AltaiWindowManager.wmWindowState.normal},wmContainerFactory.prototype.isSingleWindowMode=function(){return 1===this.windows.length},wmContainerFactory.prototype.addWindowToColumn=function(window,column){column.windows.push(window),this.updateColWidthWhenNewWindowEnters(column)},wmContainerFactory.prototype.addWindowToColumnAfterWindow=function(afterWindow,dropWindow){var columnId=this.getColOfWindow(afterWindow),rowId=this.getRowOfWindow(afterWindow),originRowId=this.getRowOfWindow(dropWindow),originColId=this.getColOfWindow(dropWindow),afterWindowIndex=this.grid[rowId].cols[columnId].windows.indexOf(afterWindow),temp=dropWindow,targetCol=this.grid[rowId].cols[columnId];this.grid[originRowId].cols[originColId].windows.splice(this.grid[originRowId].cols[originColId].windows.indexOf(dropWindow),1),targetCol.windows.splice(afterWindowIndex+1,0,temp),this.reDistributeWidthInRow(originRowId),this.updateColWidthWhenNewWindowEnters(targetCol)},wmContainerFactory.prototype.registerGridCol=function(col,element){var row=this.grid[this.getRowOfColumn(col)],colIndex=row.cols.indexOf(col),col=row.cols[colIndex];col.elementRef=element,this.setWidthOfCol(col,col.windows[0].windowType.optimalWidth)},wmContainerFactory.prototype.getMinWidthOfCol=function(col){for(var minWidth=0,w=0;w<col.windows.length;w++){var window=col.windows[w];minWidth<window.windowType.minWidth&&(minWidth=window.windowType.minWidth)}return minWidth},wmContainerFactory.prototype.getMaxWidthOfCol=function(col){for(var maxWidth=Number.MAX_VALUE,w=0;w<col.windows.length;w++){var window=col.windows[w];maxWidth>window.windowType.maxWidth&&(maxWidth=window.windowType.maxWidth)}return maxWidth},wmContainerFactory.prototype.updateColWidthWhenNewWindowEnters=function(col){if(col.elementRef){var currentWidth=col.elementRef.width(),requiredMinWidth=this.getMinWidthOfCol(col);requiredMinWidth>currentWidth&&col.elementRef.css({"min-width":requiredMinWidth})}},wmContainerFactory.prototype.windowExists=function(window){return this.windows.indexOf(window)>=0},wmContainerFactory.prototype.minimizeWindow=function(window){var colOfWindow=this.getColOfWindow(window),rowOfWindow=this.getRowOfWindow(window);this.setWidthOfCol(this.grid[rowOfWindow].cols[colOfWindow],42,!0)},wmContainerFactory}();AltaiWindowManager.wmContainerFactory=wmContainerFactory}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var wmDragFactory=function(){function wmDragFactory(){}return wmDragFactory.prototype.setDragWindow=function(dragWindow){this.dragWindow=dragWindow},wmDragFactory.prototype.getDragWindow=function(){return this.dragWindow},wmDragFactory}();AltaiWindowManager.wmDragFactory=wmDragFactory}(AltaiWindowManager||(AltaiWindowManager={}));var AltaiWindowManager;!function(AltaiWindowManager){var mod=angular.module("altai.windowmanager",["ui.layout"]);mod.directive("wmWindow",AltaiWindowManager.wmWindowDirective),mod.directive("wmWindowInner",AltaiWindowManager.wmWindowInnerDirective),mod.directive("wmWindowInnerContent",AltaiWindowManager.wmWindowInnerContentDirective),mod.directive("wmContainer",AltaiWindowManager.wmContainerDirective),mod.directive("wmGridHdivider",AltaiWindowManager.wmGridHdividerDirective),mod.directive("wmResizeHandler",AltaiWindowManager.wmResizeHandlerDirective),mod.directive("wmGrid",AltaiWindowManager.wmGridDirective),mod.directive("wmGridCol",AltaiWindowManager.wmGridColDirective),mod.directive("wmStopEvent",AltaiWindowManager.wmStopEvent),mod.directive("wmGridRow",AltaiWindowManager.wmGridRowDirective),mod.directive("wmWindowDropzone",AltaiWindowManager.wmWindowDropzoneDirective),mod.directive("wmWindowSidebarGenericHandle",AltaiWindowManager.wmWindowSidebarGenericHandleDirective),mod.directive("wmRef",AltaiWindowManager.wmRefDirective),mod.service("wmContainerFactory",AltaiWindowManager.wmContainerFactory),mod.service("wmDragFactory",AltaiWindowManager.wmDragFactory),mod.run(function($rootScope,wmContainerFactory){$rootScope.$on("$stateChangeStart",function(){wmContainerFactory.destoryAllWindows()}),$(window).resize(function(){$rootScope.$apply(function(){wmContainerFactory.removeFocusOnWindow()})})})}(AltaiWindowManager||(AltaiWindowManager={})),config.modules.push("altai.windowmanager");var AltaiAdmin;!function(AltaiAdmin){var AdminWindows=function(){function AdminWindows(){}return AdminWindows}();AdminWindows.systemConfig=new AltaiWindowManager.wmWindowType("systemSettings","<altai-config-system></altai-config-system>",300,600,1600),AltaiAdmin.AdminWindows=AdminWindows}(AltaiAdmin||(AltaiAdmin={}));var altaiIdentity;!function(altaiIdentity){var userInfo=function(){function userInfo(){this.accesses=[],this.r=[],this.s=[]}return userInfo}();altaiIdentity.userInfo=userInfo}(altaiIdentity||(altaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var IdentityWindows=function(){function IdentityWindows(){}return IdentityWindows}();IdentityWindows.userList=new AltaiWindowManager.wmWindowType("userList","<altai-user-list></altai-user-list>",500,960,1600),IdentityWindows.userCreate=new AltaiWindowManager.wmWindowType("userCreate","<altai-user-create></altai-user-create>",500,960,1600),IdentityWindows.userUpdate=new AltaiWindowManager.wmWindowType("userCreate","<altai-user-update user-id='vm.window.entityId'></altai-user-create>",500,960,1600),IdentityWindows.userRoles=new AltaiWindowManager.wmWindowType("userRoles","<altai-user-roles user-id='vm.window.entityId'></altai-user-roles>",500,960,1600),IdentityWindows.userGroups=new AltaiWindowManager.wmWindowType("userGroups","<altai-user-groups user-id='vm.window.entityId'></altai-user-groups>",500,960,1600),IdentityWindows.roleList=new AltaiWindowManager.wmWindowType("roleList","<altai-role-list></altai-role-list>",200,400,800),IdentityWindows.roleCreate=new AltaiWindowManager.wmWindowType("roleCreate","<altai-role-create></altai-role-create>",200,400,800),IdentityWindows.rolePermissions=new AltaiWindowManager.wmWindowType("rolePermissions","<altai-role-permissions role-name='vm.window.entityId'></altai-role-permissions>",500,500,1600),IdentityWindows.groupList=new AltaiWindowManager.wmWindowType("groupList","<altai-group-list></altai-group-list>",500,960,1600),IdentityWindows.groupCreate=new AltaiWindowManager.wmWindowType("groupCreate","<altai-group-create></altai-group-create>",500,960,1600),IdentityWindows.groupProfile=new AltaiWindowManager.wmWindowType("groupProfile","<altai-group-profile group-id='vm.window.entityId'></altai-group-profile>",500,960,1600),IdentityWindows.groupRoleCreate=new AltaiWindowManager.wmWindowType("groupRoleCreate","<altai-group-role-create group-id='vm.window.entityId'></altai-group-role-create>",500,960,1600),IdentityWindows.setSecurableAccesses=new AltaiWindowManager.wmWindowType("setSecurableAccesses","<altai-securable-accesses securable-name='vm.window.entityProperties.securableName' securable-key='vm.window.entityId'></altai-securable-accesses>",500,960,3600),IdentityWindows.securableUpdate=new AltaiWindowManager.wmWindowType("securableUpdate","<securable-update></securable-update>",500,960,3600),AltaiIdentity.IdentityWindows=IdentityWindows}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var AltaiSecurableAccessesComponent=function(){function AltaiSecurableAccessesComponent(){this.controller=AltaiSecurableAccessesComponentController,this.templateUrl="/api/template/Admin/Identity:AltaiSecurableAccesses",this.bindings={securableName:"=",securableKey:"="}}return AltaiSecurableAccessesComponent}();AltaiIdentity.AltaiSecurableAccessesComponent=AltaiSecurableAccessesComponent;var AltaiSecurableAccessesComponentController=function(){function AltaiSecurableAccessesComponentController($q,authorizationService,userAdminService,roleAdminService,groupAdminFactory){function getSecurables(){var d=$q.defer();return authorizationService.getRelatedSecurables(ctrl.securableName).then(function(securables){ctrl.securables=securables,d.resolve()}),d.promise}function getRoles(){var d=$q.defer();return ctrl.roleAdminService.list().then(function(roles){ctrl.roles=roles,d.resolve()}),d.promise}function getusers(){var d=$q.defer();return ctrl.userAdminService.list().then(function(users){ctrl.users=angular.copy(users),d.resolve()}),d.promise}function getGroupRoles(){var d=$q.defer();return ctrl.groupAdminFactory.list().then(function(groups){ctrl.groups=groups,d.resolve()}),d.promise}this.authorizationService=authorizationService,this.userAdminService=userAdminService,this.roleAdminService=roleAdminService,this.groupAdminFactory=groupAdminFactory,this.selectedUsers=[],this.userAccesses={},this.roleAccesses={},this.groupRoleAccesses={};var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.saveAccesses()},name:"save","class":"altai-button-go"}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1};var work=[];work.push(getSecurables()),work.push(getRoles()),work.push(getusers()),work.push(getGroupRoles()),$q.all(work).then(function(){ctrl.getCurrentAccesses()})}return AltaiSecurableAccessesComponentController.prototype.selectUser=function(user){var ctrl=this;-1==ctrl.selectedUsers.indexOf(user)&&(ctrl.selectedUsers.push(user),ctrl.users.splice(ctrl.users.indexOf(user),1))},AltaiSecurableAccessesComponentController.prototype.selectUserById=function(userId){var ctrl=this,user=ctrl.users.filter(function(user){return user.id==userId})[0];user&&ctrl.selectUser(user)},AltaiSecurableAccessesComponentController.prototype.getCurrentAccesses=function(){var ctrl=this;ctrl.authorizationService.getSecurableAccesses(ctrl.securableName,ctrl.securableKey).then(function(accesses){for(var a=0;a<accesses.length;a++){var access=accesses[a];access.roleName?(ctrl.roleAccesses[access.securableName]||(ctrl.roleAccesses[access.securableName]={}),ctrl.roleAccesses[access.securableName][access.roleName]=access.allowAccess?"1":"0"):access.userId?(ctrl.userAccesses[access.securableName]||(ctrl.userAccesses[access.securableName]={}),ctrl.selectUserById(access.userId),ctrl.userAccesses[access.securableName][access.userId]=access.allowAccess?"1":"0"):access.identityGroupRoleId&&(ctrl.groupRoleAccesses[access.securableName]||(ctrl.groupRoleAccesses[access.securableName]={}),ctrl.groupRoleAccesses[access.securableName][access.identityGroupRoleId]=!0)}})},AltaiSecurableAccessesComponentController.prototype.saveAccesses=function(){for(var ctrl=this,output=[],s=0;s<ctrl.securables.length;s++){var securableName=ctrl.securables[s].name;if(ctrl.roleAccesses[securableName])for(var roles=Object.keys(ctrl.roleAccesses[securableName]),r=0;r<roles.length;r++){var roleName=roles[r],value=ctrl.roleAccesses[securableName][roleName];value&&output.push({roleName:roleName,securableKey:ctrl.securableKey,securableName:securableName,allowAccess:parseInt(value)})}if(ctrl.userAccesses[securableName])for(var userIds=Object.keys(ctrl.userAccesses[securableName]),r=0;r<userIds.length;r++){var userId=userIds[r],value=ctrl.userAccesses[securableName][userId];value&&output.push({userId:userId,securableKey:ctrl.securableKey,securableName:securableName,allowAccess:parseInt(value)})}if(ctrl.groupRoleAccesses[securableName])for(var groupRoleIds=Object.keys(ctrl.groupRoleAccesses[securableName]),r=0;r<groupRoleIds.length;r++){var groupRoleId=groupRoleIds[r],value=ctrl.groupRoleAccesses[securableName][groupRoleId];value&&output.push({identityGroupRoleId:groupRoleId,securableKey:ctrl.securableKey,securableName:securableName,allowAccess:parseInt(value)})}}ctrl.authorizationService.setSecurableAccesses(ctrl.securableName,ctrl.securableKey,output)},AltaiSecurableAccessesComponentController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var SecurableUpdateComponent=function(){function SecurableUpdateComponent(){this.controller=SecurableUpdateComponentController,this.templateUrl="/api/template/Admin/Identity:SecurableUpdate"}return SecurableUpdateComponent}();AltaiIdentity.SecurableUpdateComponent=SecurableUpdateComponent;var SecurableUpdateComponentController=function(){function SecurableUpdateComponentController($q,authorizationService){this.authorizationService=authorizationService;var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.saveSecurables()},name:"save","class":"altai-button-go"}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0},authorizationService.listSecurable().then(function(securables){ctrl.securables=securables})}return SecurableUpdateComponentController.prototype.saveSecurables=function(){var ctrl=this;ctrl.authorizationService.updateSecurable(ctrl.securables).then(function(){alert("ok!")})},SecurableUpdateComponentController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var LostPasswordController=function(){function LostPasswordController(authService){this.authService=authService,this.submitted=!1,this.emailFound=!1}return LostPasswordController.prototype.lostPasswordRequest=function(email){var ctrl=this;ctrl.authService.passwordRecovery(email).then(function(result){ctrl.emailFound=result,ctrl.submitted=!0},function(error){})},LostPasswordController}();AltaiIdentity.LostPasswordController=LostPasswordController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var LoginController=function(){function LoginController($scope,$state,$cookies,$rootScope,authService,config){authService.logout(),$scope.loginData={},$scope.rememberMe=!1,$scope.loading=!1;var identifier=$cookies.getObject("identifier");void 0!=identifier&&($scope.loginData=identifier,$scope.rememberMe=!0),$scope.doLogin=function(loginData){$scope.loading=!0,$scope.rememberMe?$cookies.putObject("identifier",$scope.loginData):$cookies.remove("identifier"),authService.login(loginData).then(function(){$scope.loading=!1,authService.isAuthorized("admin.menu").then(function(result){window.location.href="/admin/content/type"},function(){$rootScope.preLoginState?$state.go($rootScope.preLoginState.name,$rootScope.preLoginState.stateParams):$state.go(config.redirectUserState)})},function(error){$scope.loading=!1})}}return LoginController}();AltaiIdentity.LoginController=LoginController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function UserListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.userList,"users")}AltaiIdentity.UserListController=UserListController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function GroupListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.groupList,"groups")}AltaiIdentity.GroupListController=GroupListController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function RoleListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.roleList,"Roles")}AltaiIdentity.RoleListController=RoleListController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var AccessDebugConsoleController=function(){function AccessDebugConsoleController($http,authService){this.$http=$http,this.authService=authService;var ctrl=this;authService.getUserInfo().then(function(result){ctrl.userInfo=result,console.log(result)})}return AccessDebugConsoleController.prototype.refreshToken=function(){var ctrl=this;this.authService.refreshToken().then(function(result){console.log("ok1")}),this.authService.refreshToken().then(function(result){console.log("ok2")}),this.authService.refreshToken().then(function(result){console.log("ok3")}),this.authService.refreshToken().then(function(result){console.log("ok4")}),this.authService.refreshToken().then(function(result){console.log("ok5"),ctrl.authService.getUserInfo().then(function(result){ctrl.userInfo=result,console.log(result)})})},AccessDebugConsoleController.prototype.test=function(securable){this.$http.get("api/testSecurableAccess?securable="+securable.securableName+"&securableKey="+securable.securableKey).success(function(result){alert(result)})},AccessDebugConsoleController}();AltaiIdentity.AccessDebugConsoleController=AccessDebugConsoleController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function SecurableUpdateController(wmContainerFactory){wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.securableUpdate,"UpdateSecurable")}AltaiIdentity.SecurableUpdateController=SecurableUpdateController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function CreatePasswordController(altaiHttp,$state,authService,urlParameterService,altaiNotificationFactory,$translate,validToken){var ctrl=this;validToken&&(ctrl.validToken=validToken.data),ctrl.setPassword=function(passwordData){passwordData&&void 0!=passwordData.password&&passwordData.password==passwordData.passwordrepeated?altaiHttp.post("/api/createpassword",{userid:urlParameterService("userid"),code:urlParameterService("code"),password:passwordData.password}).then(function(result){authService.login({identifier:urlParameterService("username"),password:passwordData.password}).then(function(){$translate("passwordisupdated").then(function(successmessage){altaiNotificationFactory.success(successmessage)}),$state.go("Root.MyComeos.Dashboard")})},function(error){$translate("invalidtokenexplain").then(function(errormessage){altaiNotificationFactory.error(errormessage)})}):passwordData?passwordData.password!=passwordData.passwordrepeated&&$translate("passwordsdonotmatch").then(function(errormessage){altaiNotificationFactory.error(errormessage)}):$translate("enterpassword").then(function(errormessage){altaiNotificationFactory.error(errormessage)})}}AltaiIdentity.CreatePasswordController=CreatePasswordController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var OAuthAuthenticateController=function(){function OAuthAuthenticateController(authService,$state,urlParameterService){var urlRedirect=urlParameterService("redirect_uri"),client_id=urlParameterService("client_id").toLowerCase();authService.setOauthAuthenticateRedirectUri(urlRedirect),"servicedesk"!=client_id&&"comeostools"!=client_id&&"fashionbarometer"!=client_id||authService.getUserInfo().then(function(){-1===urlRedirect.indexOf("?")?location.href=authService.getOAuthRedirectUri():location.href=authService.getOAuthRedirectUri()},function(){$state.go("login")})}return OAuthAuthenticateController}();AltaiIdentity.OAuthAuthenticateController=OAuthAuthenticateController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiGroupCreateDirective(){return{templateUrl:"/api/template/Admin/GroupCreate",controller:GroupCreateController,controllerAs:"vm"}}AltaiIdentity.AltaiGroupCreateDirective=AltaiGroupCreateDirective;var GroupCreateController=function(){function GroupCreateController(groupAdminFactory,$state){this.groupAdminFactory=groupAdminFactory,this.state=$state}return GroupCreateController.prototype.createGroup=function(newGroup){var service=this;this.groupAdminFactory.create(newGroup).then(function(){service.state.go("admin.security.groups",{},{reload:!0})})},GroupCreateController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiGroupListDirective(){return{templateUrl:"/api/template/Aadmin/GroupList",controller:GroupListController,controllerAs:"vm"}}AltaiIdentity.AltaiGroupListDirective=AltaiGroupListDirective;var GroupListController=function(){function GroupListController(groupAdminFactory,wmContainerFactory){var s=this;s.wmContainerFactory=wmContainerFactory,groupAdminFactory.list().then(function(groupList){s.groups=groupList})}return GroupListController.prototype.createGroup=function(){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.groupCreate,"creategroup")},GroupListController.prototype.openGroup=function(group){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.groupProfile,"group",group.id)},GroupListController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiGroupProfileDirective(){return{templateUrl:"/api/template/Admin/GroupProfile",controller:GroupProfileController,controllerAs:"vm",bindToController:!0,scope:{groupId:"="}}}AltaiIdentity.AltaiGroupProfileDirective=AltaiGroupProfileDirective;var GroupProfileController=function(){function GroupProfileController(groupAdminFactory,wmContainerFactory){var c=this;c.wmContainerFactory=wmContainerFactory,groupAdminFactory.read(this.groupId).then(function(group){c.group=group})}return GroupProfileController.prototype.createGroupRole=function(){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.groupRoleCreate,"grouprolecreate",this.groupId)},GroupProfileController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiGroupRoleCreateDirective(){return{templateUrl:"/api/template/Admin/GroupRoleCreate",controller:GroupRoleCreateController,controllerAs:"vm",bindToController:!0,scope:{groupId:"="}}}AltaiIdentity.AltaiGroupRoleCreateDirective=AltaiGroupRoleCreateDirective;var GroupRoleCreateController=function(){function GroupRoleCreateController(groupAdminFactory,$stateParams){this.groupAdminFactory=groupAdminFactory}return GroupRoleCreateController.prototype.addRole=function(newRole){this.groupAdminFactory.createGroupRole(this.groupId,newRole).then(function(result){})},GroupRoleCreateController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiRoleCreateDirective(){return{templateUrl:"/api/template/Admin/RoleCreate",controller:RoleCreateController,controllerAs:"vm"}}AltaiIdentity.AltaiRoleCreateDirective=AltaiRoleCreateDirective;var RoleCreateController=function(){function RoleCreateController($state,roleAdminService){this.$state=$state,this.roleAdminService=roleAdminService}return RoleCreateController.prototype.createRole=function(newRole){var service=this;this.roleAdminService.create(newRole).then(function(){service.$state.go("admin.security.roles")})},RoleCreateController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiRoleListDirective(){return{templateUrl:"/api/template/Admin/RoleList",controller:AltaiRoleListController,controllerAs:"vm"}}AltaiIdentity.AltaiRoleListDirective=AltaiRoleListDirective;var AltaiRoleListController=function(){function AltaiRoleListController(roleAdminService,wmContainerFactory){var vm=this;vm.wmContainerFactory=wmContainerFactory,roleAdminService.list().then(function(roles){vm.roles=roles})}return AltaiRoleListController.prototype.createRole=function(){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.roleCreate,"createrole")},AltaiRoleListController.prototype.openPermissions=function(role){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.rolePermissions,"Permissions "+role.name,role.name)},AltaiRoleListController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiRolePermissionsDirective(){return{templateUrl:"/api/template/Admin/RolePermissions",controller:RolePermissionsController,controllerAs:"vm",link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{translatableTooltipId:"save",icon:"mdi-save",action:function(){scope.vm.savePermissions()},"class":"altai-button-primary",name:"save"}],align:"left"}],showLanguages:!1}},bindToController:!0,scope:{roleName:"="}}}AltaiIdentity.AltaiRolePermissionsDirective=AltaiRolePermissionsDirective;var RolePermissionsController=function(){function RolePermissionsController($rootScope,$state,roleAdminService,authService,wmContainerFactory){this.$rootScope=$rootScope,this.$state=$state,this.roleAdminService=roleAdminService,this.authService=authService,this.wmContainerFactory=wmContainerFactory,this.allSelected=!1;var ctrl=this;ctrl.securableOptions=[{value:0,label:"Deny"},{value:1,label:"Allow"},{label:""}],roleAdminService.rolePermissions(this.roleName).then(function(permissions){ctrl.rolePermissions=permissions})}return RolePermissionsController.prototype.savePermissions=function(){var ctrl=this;this.roleAdminService.updatePermissions(ctrl.roleName,ctrl.rolePermissions).then(function(result){
ctrl.authService.getUserInfo(),ctrl.$rootScope.$broadcast("userInfoChanged",null),ctrl.closeWindow()})},RolePermissionsController.prototype.closeWindow=function(){var ctrl=this,win=ctrl.wmContainerFactory.findWindow(AltaiIdentity.IdentityWindows.rolePermissions,ctrl.roleName);win&&ctrl.wmContainerFactory.destroyWindow(win.id)},RolePermissionsController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var updateProfileController=function(){function updateProfileController(authService){this.authService=authService}return updateProfileController.prototype.changePassword=function(profile){this.authService.changePassword(profile.oldPassword,profile.newPassword)},updateProfileController.prototype.changeEmail=function(newEmail){this.authService.changeEmail(newEmail)},updateProfileController}();AltaiIdentity.updateProfileController=updateProfileController}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiUserCreateDirective(){return{templateUrl:"/api/template/Admin/Identity:UserCreate",controller:UserCreateController,link:UserCreateLink,controllerAs:"$ctrl"}}AltaiIdentity.AltaiUserCreateDirective=AltaiUserCreateDirective;var UserCreateLink=function(){function UserCreateLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-plus",action:function(){scope.$ctrl.createUser()},"class":"altai-button-go",name:"create",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return UserCreateLink}(),UserCreateController=function(){function UserCreateController($state,authService,wmContainerFactory){this.$state=$state,this.authService=authService,this.wmContainerFactory=wmContainerFactory,this.$state=$state,this.authService=authService}return UserCreateController.prototype.createUser=function(){var ctrl=this;ctrl.user.userName=ctrl.user.email,ctrl.authService.register(ctrl.user).then(function(result){var win=ctrl.wmContainerFactory.findWindow(AltaiIdentity.IdentityWindows.userCreate);ctrl.wmContainerFactory.destroyWindow(win.id)})},UserCreateController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiUserUpdateDirective(){return{templateUrl:"/api/template/Admin/Identity:UserUpdate",controller:UserUpdateController,link:UserUpdateLink,controllerAs:"$ctrl",scope:{userId:"="},bindToController:!0}}AltaiIdentity.AltaiUserUpdateDirective=AltaiUserUpdateDirective;var UserUpdateLink=function(){function UserUpdateLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.updateUser()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return UserUpdateLink}(),UserUpdateController=function(){function UserUpdateController(userAdminService,wmContainerFactory){this.userAdminService=userAdminService,this.wmContainerFactory=wmContainerFactory;var ctrl=this;userAdminService.getById(ctrl.userId).then(function(userData){ctrl.user=userData})}return UserUpdateController.prototype.updateUser=function(){var ctrl=this;ctrl.userAdminService.update(ctrl.user).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiIdentity.IdentityWindows.userUpdate);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},UserUpdateController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiUserGroupDirective(){return{templateUrl:"/api/template/Admin/Identity:UserGroups",controller:UserGroupController,controllerAs:"vm",bindToController:!0,scope:{userId:"="}}}AltaiIdentity.AltaiUserGroupDirective=AltaiUserGroupDirective;var UserGroupController=function(){function UserGroupController($stateParams,groupAdminFactory,$state){var s=this;groupAdminFactory.listUser(this.userId).then(function(groupList){s.groups=groupList}),this.$stateParams=$stateParams,this.groupAdminFactory=groupAdminFactory,this.state=$state}return UserGroupController.prototype.updateGroupRoles=function(){var service=this;this.groupAdminFactory.updateUser(this.userId,this.groups).then(function(){service.state.go("admin.security.users")})},UserGroupController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiUserListDirective(){return{templateUrl:"/api/template/Admin/Identity:UserList",controller:UserListController,link:UserListLink,controllerAs:"vm"}}AltaiIdentity.AltaiUserListDirective=AltaiUserListDirective;var UserListLink=function(){function UserListLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-plus",action:function(){scope.vm.createNewUser()},"class":"altai-button-go",name:"create",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return UserListLink}(),UserListController=function(){function UserListController(userAdminService,wmContainerFactory){var s=this;s.wmContainerFactory=wmContainerFactory,userAdminService.list().then(function(users){s.users=users})}return UserListController.prototype.createNewUser=function(){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.userCreate,"createuser")},UserListController.prototype.editUser=function(user){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.userUpdate,"edit",user.id)},UserListController.prototype.openGroups=function(user){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.userGroups,"groups",user.id)},UserListController.prototype.openRoles=function(user){this.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.userRoles,"roles",user.id)},UserListController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function AltaiUserRolesDirective(){return{templateUrl:"/api/template/Admin/Identity:UserRoles",controller:UserRolesController,link:UserRolesLink,controllerAs:"$ctrl",bindToController:!0,scope:{userId:"="}}}AltaiIdentity.AltaiUserRolesDirective=AltaiUserRolesDirective;var UserRolesLink=function(){function UserRolesLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-save",action:function(){scope.$ctrl.savePermissions()},"class":"altai-button-go",name:"update",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return UserRolesLink}(),UserRolesController=function(){function UserRolesController(userAdminService,authService,wmContainerFactory){this.userAdminService=userAdminService,this.authService=authService,this.wmContainerFactory=wmContainerFactory,this.allSelected=!1;var ctrl=this;userAdminService.userRoles(ctrl.userId).then(function(roles){ctrl.userRoles=roles})}return UserRolesController.prototype.savePermissions=function(){var ctrl=this;ctrl.userAdminService.updateRoles(this.userId,this.userRoles).then(function(result){var win=ctrl.wmContainerFactory.findWindow(AltaiIdentity.IdentityWindows.userRoles);ctrl.wmContainerFactory.destroyWindow(win.id)})},UserRolesController.prototype.selectAll=function(){this.allSelected=!this.allSelected;for(var s=0;s<this.userRoles.length;s++)this.userRoles[s].active=this.allSelected},UserRolesController}()}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){function authInterceptor($q,$injector,$location,altaiClientDataStore){var $http,authService,authInterceptorServiceFactory={},_request=function(config){var d=$q.defer();config.headers=config.headers||{},authService=authService||$injector.get("authService");var accessToken=altaiClientDataStore.get("accessToken");return accessToken&&-1==config.url.indexOf("/oauth/token")&&!authService.isAccessTokenExpired()?(config.headers.Authorization="Bearer "+accessToken,d.resolve(config)):d.resolve(config),d.promise},_retryHttpRequest=function(config,deferred){$http=$http||$injector.get("$http");var authService=authService||$injector.get("authService"),accessToken=altaiClientDataStore.get("accessToken");accessToken&&(config.headers.Authorization="Bearer "+accessToken),$http(config).then(function(response){deferred.resolve(response)},function(response){console.log("error retry",config,response),deferred.reject(response)})},_responseError=function(rejection){var d=$q.defer();return rejection?(authService=authService||$injector.get("authService"),401===rejection.status?authService.getAccessToken()&&authService.isAccessTokenExpired()?authService.refreshToken().then(function(response){_retryHttpRequest(rejection.config,d)},function(){authService.logout(),$location.path("/login"),d.reject(rejection)}):(console.error("Unauthorized"),d.reject(rejection)):d.reject(rejection)):d.reject(rejection),d.promise};return authInterceptorServiceFactory.request=_request,authInterceptorServiceFactory.responseError=_responseError,authInterceptorServiceFactory}AltaiIdentity.authInterceptor=authInterceptor}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var authService=function(){function authService($rootScope,$http,$q,$state,config,altaiNotificationFactory,altaiClientDataStore){this.altaiNotificationFactory=altaiNotificationFactory,this.refreshInProgress=!1,this.refreshSubscribers=[],this.accessTokenStoreName="accessToken",this.refreshTokenStoreName="refreshToken",this.rootScope=$rootScope,this.http=$http,this.q=$q,this.altaiClientDataStore=altaiClientDataStore,this.state=$state}return authService.prototype.resetTokens=function(){this.accessTokenExp=-1,this.altaiClientDataStore.remove(this.accessTokenStoreName),this.altaiClientDataStore.remove(this.refreshTokenStoreName)},authService.prototype.login=function(loginData){var _this=this;this.resetTokens();var d=this.q.defer(),service=this;return this.http.post(config.backendUrl+"/oauth/token",{grant_type:"password",username:loginData.identifier,password:loginData.password}).success(function(result){service.altaiClientDataStore.set(service.accessTokenStoreName,result.access_token),service.altaiClientDataStore.set(service.refreshTokenStoreName,result.refresh_token),service.oauthAuthenticateRedirectUri&&(location.href=service.getOAuthRedirectUri()),service.getUserInfo().then(function(userInfo){_this.altaiNotificationFactory.success("Welcome back!"),service.rootScope.$broadcast("userInfoChanged",null),d.resolve(userInfo)})}).error(function(error){_this.altaiNotificationFactory.error("Wrong username/password entered"),d.reject()}),d.promise},authService.prototype.getOAuthRedirectUri=function(){var urlRedirect=this.oauthAuthenticateRedirectUri;return-1===urlRedirect.indexOf("?")?urlRedirect+"?access_token="+encodeURI(this.getAccessToken())+"&lng="+this.rootScope.langCode:urlRedirect+"&access_token="+encodeURI(this.getAccessToken())+"&lng="+this.rootScope.langCode},authService.prototype.register=function(registrationData){var d=this.q.defer(),service=this;return this.http.post(config.backendUrl+"/api/register",registrationData).then(function(result){service.resetTokens(),service.altaiNotificationFactory.success("Succesfully created new account"),d.resolve(result.data)},function(error){service.altaiNotificationFactory.error(error.data.message),d.reject(error.data)}),d.promise},authService.prototype.refreshToken=function(){var _this=this,service=this;if(this.refreshInProgress){var d=this.q.defer();return this.refreshSubscribers.push(d),d.promise}var d=this.q.defer(),service=this,refreshToken=this.altaiClientDataStore.get(service.refreshTokenStoreName);return refreshToken?(service.refreshInProgress=!0,service.http.post(config.backendUrl+"/oauth/token",{grant_type:"refresh_token",refresh_token:refreshToken}).success(function(result){service.altaiClientDataStore.set(service.accessTokenStoreName,result.access_token),service.altaiClientDataStore.set(service.refreshTokenStoreName,result.refresh_token),delete service.userInfo,service.getUserInfo().then(function(userInfo){service.rootScope.$broadcast("userInfoChanged",null),d.resolve(userInfo);for(var subscribers=angular.copy(service.refreshSubscribers),i=0;i<subscribers.length;i++)subscribers[i].resolve(userInfo),service.refreshSubscribers.splice(service.refreshSubscribers.indexOf(service.refreshSubscribers[i]),1);service.refreshInProgress=!1})}).error(function(error){_this.logout();for(var i=service.refreshSubscribers.length-1;i>=0;i--)service.refreshSubscribers[i].resolve(),service.refreshSubscribers.splice(i,1);d.reject(),service.refreshInProgress=!1})):d.reject(),d.promise},authService.prototype.emailConfirm=function(code,userId){var d=this.q.defer();return this.http.get(config.backendUrl+"/api/emailConfirm?code="+code+"&userId="+userId).then(function(result){d.resolve(result.data)},function(error){d.reject(error.data)}),d.promise},authService.prototype.setOauthAuthenticateRedirectUri=function(redirectUri){this.oauthAuthenticateRedirectUri=redirectUri},authService.prototype.changeEmail=function(newEmail){var d=this.q.defer();return this.http.put(config.backendUrl+"/api/user/email",{email:newEmail}).then(function(result){d.resolve(result.data)},function(error){d.reject(error.data)}),d.promise},authService.prototype.changePassword=function(oldPassword,newPassword){var d=this.q.defer();return this.http.put(config.backendUrl+"/api/user/password",{oldPassword:oldPassword,newPassword:newPassword}).then(function(result){d.resolve(result.data)},function(error){d.reject(error.data)}),d.promise},authService.prototype.logout=function(){this.resetTokens(),delete this.userInfo,this.rootScope.$broadcast("userInfoChanged",{event:"logout"});var d=this.q.defer();return d.resolve(),d.promise},authService.prototype.getAccessToken=function(){return this.altaiClientDataStore.get(this.accessTokenStoreName)},authService.prototype.getValidAccessToken=function(){var d=this.q.defer();return this.isAccessTokenExpired()?this.refreshToken().then(function(result){d.resolve(this.altaiClientDataStore.get(this.accessTokenStoreName))},function(){d.reject()}):d.resolve(this.altaiClientDataStore.get(this.accessTokenStoreName)),d.promise},authService.prototype.b64DecodeUnicode=function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))},authService.prototype.getUserInfo=function(){var d=this.q.defer(),service=this;if(service.userInfo)d.resolve(service.userInfo);else{var accessToken=service.getAccessToken();if(accessToken){var claimsDecoded,accessTokenParts=accessToken.split("."),claimsEncoded=accessTokenParts[1],validToken=!1;try{claimsDecoded=this.b64DecodeUnicode(claimsEncoded),validToken=!0}catch(error){service.resetTokens(),service.altaiNotificationFactory.error("Invalid login"),d.reject()}if(validToken){var parsedClaims=document.createElement("textarea");parsedClaims.innerHTML=claimsDecoded;var claims=JSON.parse(parsedClaims.value);this.accessTokenExp=claims.exp,claims.r&&"string"==typeof claims.r&&(claims.r=[claims.r]),claims.s&&"string"==typeof claims.s&&(claims.s=[claims.s]),service.userInfo=claims,d.resolve(claims)}}else d.reject()}return d.promise},authService.prototype.isAccessTokenExpired=function(){return this.getUserInfo(),this.accessTokenExp?this.accessTokenExp-30<Math.floor((new Date).getTime()/1e3):!0},authService.prototype.isAuthorized=function(securableName){var ctrl=this,d=ctrl.q.defer();return this.getUserInfo().then(function(userInfo){userInfo&&(userInfo.r&&-1!==userInfo.r.indexOf("Administrator")||userInfo.s&&-1!==userInfo.s.indexOf(securableName))&&d.resolve(!0),d.reject(!1)}),d.promise},authService.prototype.isAuthorizedSync=function(securableName){var s=this;return!(!s.userInfo||!(s.userInfo.r&&-1!==s.userInfo.r.indexOf("Administrator")||s.userInfo.s&&-1!==s.userInfo.s.indexOf(securableName)))},authService.prototype.passwordRecovery=function(email){var d=this.q.defer();return this.http.post(config.backendUrl+"/api/lostpassword",{email:email}).success(function(result){d.resolve(result)}),d.promise},authService.prototype.passwordReset=function(token,newPassword,userId){var d=this.q.defer();return this.http.post(config.backendUrl+"/api/password/reset",{newPassword:newPassword,token:token,userId:userId}).then(function(result){d.resolve(result)},function(error){d.reject()}),d.promise},authService.prototype.checkPasswordResetToken=function(token,userId){var d=this.q.defer();return this.http.post(config.backendUrl+"/api/password/resetvalidation",{code:token,userId:userId}).then(function(result){d.resolve(result)},function(error){d.reject()}),d.promise},authService}();AltaiIdentity.authService=authService}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var groupAdminFactory=function(){function groupAdminFactory($q,$http,altaiHttp,config,logService){this.altaiHttp=altaiHttp,this.apiUrl="/api/group",this.list=function(){var d=this.q.defer();return this.altaiHttp.get(this.config.backendUrl+this.apiUrl).then(function(result){d.resolve(result)},function(error){d.reject(error)}),d.promise},this.q=$q,this.http=$http,this.config=config,this.logService=logService}return groupAdminFactory.prototype.create=function(newGroup){var d=this.q.defer(),service=this;return this.http.post(config.backendUrl+this.apiUrl,newGroup).then(function(result){service.logService.log("success","Created the new group"),d.resolve(result.data)},function(error){service.logService.log("error",error.data.message),d.reject()}),d.promise},groupAdminFactory.prototype.read=function(groupId){var d=this.q.defer();return this.http.get(config.backendUrl+this.apiUrl+"/"+groupId).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},groupAdminFactory.prototype.listUser=function(userId){var d=this.q.defer();return this.http.get(this.config.backendUrl+"/api/user/"+userId+"/group").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},groupAdminFactory.prototype.updateUser=function(userId,groups){for(var d=this.q.defer(),dataInput=[],i=0;i<groups.length;i++)dataInput.push({id:groups[i].id,identityGroupRoles:groups[i].identityGroupRoles});return this.http.post(config.backendUrl+"/api/user/"+userId+"/group",dataInput).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},groupAdminFactory.prototype.createGroupRole=function(groupId,newGroupRole){var d=this.q.defer(),service=this;return this.http.post(config.backendUrl+this.apiUrl+"/"+groupId+"/role",newGroupRole).then(function(result){service.logService.log("success","Created the new groupRole"),d.resolve(result.data)},function(error){service.logService.log("error",error.data.message),d.reject()}),d.promise},groupAdminFactory}();AltaiIdentity.groupAdminFactory=groupAdminFactory}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var roleAdminService=function(){function roleAdminService($q,$http,config,logService){this.q=$q,this.http=$http,this.config=config,this.logService=logService}return roleAdminService.prototype.create=function(newRole){var d=this.q.defer(),service=this;return this.http.post(this.config.backendUrl+"/api/role",newRole).then(function(result){service.logService.log("success","Created the new role"),d.resolve(result.data)},function(error){service.logService.log("error",error.data.message),d.reject()}),d.promise},roleAdminService.prototype.list=function(){var d=this.q.defer();return this.http.get(config.backendUrl+"/api/role").then(function(result){d.resolve(result.data)}),d.promise},roleAdminService.prototype.rolePermissions=function(roleName){var d=this.q.defer();return this.http.get(config.backendUrl+"/api/rolePermission?RoleName="+roleName).success(function(rolePermissions){d.resolve(rolePermissions)}),d.promise},roleAdminService.prototype.updatePermissions=function(roleName,rolePermissions){var d=this.q.defer(),service=this;return this.http.put(this.config.backendUrl+"/api/rolePermission?RoleName="+roleName,rolePermissions).then(function(result){service.logService.log("success","Succesfully changed the rolePermissions"),d.resolve(result.data)}),d.promise},roleAdminService}();AltaiIdentity.roleAdminService=roleAdminService}(AltaiIdentity||(AltaiIdentity={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiIdentity;!function(AltaiIdentity){var UserAdminService=function(_super){function UserAdminService($q,altaiHttp,$http,altaiNotificationFactory){return _super.call(this,"/api/user","User",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(UserAdminService,_super),UserAdminService.prototype.userRoles=function(userId){var d=this.$q.defer();return this.$http.get(config.backendUrl+"/api/user/"+userId+"/roles").success(function(result){d.resolve(result)}),d.promise},UserAdminService.prototype.updateRoles=function(userId,userRoles){var d=this.$q.defer(),service=this;return this.$http.put(config.backendUrl+"/api/user/"+userId+"/roles",userRoles).then(function(result){service.notificationFactory.success("Succesfully changed the userpermissions"),d.resolve(result.data)}),d.promise},UserAdminService}(AltaiCore.AltaiDataService);AltaiIdentity.UserAdminService=UserAdminService}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var AuthorizationService=function(){function AuthorizationService($http,$q){this.$http=$http,this.$q=$q}return AuthorizationService.prototype.getRelatedSecurables=function(securableName){var s=this,d=s.$q.defer();return s.$http.get("api/securable/").success(function(securables){d.resolve(securables.filter(function(securable){return 0===securable.name.indexOf(securableName)}))}),d.promise},AuthorizationService.prototype.listSecurable=function(){var s=this,d=s.$q.defer();return s.$http.get("api/securable/").success(function(securables){d.resolve(securables)}),d.promise},AuthorizationService.prototype.updateSecurable=function(securables){var s=this,d=s.$q.defer();return s.$http.post("api/securable",securables).success(function(){d.resolve()}),d.promise},AuthorizationService.prototype.getSecurableAccesses=function(securable,securableKey){var s=this,d=s.$q.defer();return s.$http.get("api/securableaccess?securable="+securable+"&securableKey="+securableKey).success(function(data){d.resolve(data)}),d.promise},AuthorizationService.prototype.setSecurableAccesses=function(securable,securableKey,securableAccesses){var s=this,d=s.$q.defer();return s.$http.post("api/securableaccess?securable="+securable+"&securableKey="+securableKey,securableAccesses).success(function(){d.resolve()}),d.promise},AuthorizationService}();AltaiIdentity.AuthorizationService=AuthorizationService}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var UserInfoService=function(){function UserInfoService(authService,$q){this.authService=authService,this.$q=$q}return UserInfoService.prototype.getUserInfo=function(){var s=this;s.$q.defer();return this.authService.getUserInfo()},UserInfoService}();AltaiIdentity.UserInfoService=UserInfoService}(AltaiIdentity||(AltaiIdentity={}));var AltaiIdentity;!function(AltaiIdentity){var mod=angular.module("altai.identity",["ngCookies"]);config.redirectAdminState="admin.content.type",config.redirectUserState="Root.Home",mod.component("altaiSecurableAccesses",new AltaiIdentity.AltaiSecurableAccessesComponent),mod.component("securableUpdate",new AltaiIdentity.SecurableUpdateComponent),mod.service("authService",AltaiIdentity.authService),mod.service("authInterceptor",AltaiIdentity.authInterceptor),mod.service("groupAdminFactory",AltaiIdentity.groupAdminFactory),mod.service("roleAdminService",AltaiIdentity.roleAdminService),mod.service("userAdminService",AltaiIdentity.UserAdminService),mod.service("authorizationService",AltaiIdentity.AuthorizationService),mod.service("userInfoService",AltaiIdentity.UserInfoService),mod.directive("altaiUserList",AltaiIdentity.AltaiUserListDirective),mod.directive("altaiUserCreate",AltaiIdentity.AltaiUserCreateDirective),mod.directive("altaiUserGroups",AltaiIdentity.AltaiUserGroupDirective),mod.directive("altaiUserUpdate",AltaiIdentity.AltaiUserUpdateDirective),mod.directive("altaiUserRoles",AltaiIdentity.AltaiUserRolesDirective),mod.directive("altaiRoleList",AltaiIdentity.AltaiRoleListDirective),mod.directive("altaiRoleCreate",AltaiIdentity.AltaiRoleCreateDirective),mod.directive("altaiRolePermissions",AltaiIdentity.AltaiRolePermissionsDirective),mod.directive("altaiGroupList",AltaiIdentity.AltaiGroupListDirective),mod.directive("altaiGroupCreate",AltaiIdentity.AltaiGroupCreateDirective),mod.directive("altaiGroupProfile",AltaiIdentity.AltaiGroupProfileDirective),mod.directive("altaiGroupRoleCreate",AltaiIdentity.AltaiGroupRoleCreateDirective),config.modules.push("altai.identity"),mod.config(function($httpProvider,$stateProvider,altaiInstallerProvider,altaiAdminMenuProvider){$stateProvider.state("login",{url:"/login",system:!0,views:{bodyView:{altaiTemplate:"login",altaiTemplateType:"System",controller:AltaiIdentity.LoginController,controllerAs:"vm"}}}).state("logout",{url:"/logout",system:!0,views:{bodyView:{altaiTemplate:"logout",altaiTemplateType:"System",controllerAs:"vm"}},resolve:{logout:function(authService,$timeout,$location){authService.logout().then(function(){$timeout(function(){$location.url("/")},1500)})}}}).state("accessdenied",{url:"/accessdenied",system:!0,views:{bodyView:{template:"Access denied"}}}).state("createpassword",{url:"/createpassword",system:!0,views:{bodyView:{altaiTemplate:"createpassword",altaiTemplateType:"System",controller:AltaiIdentity.CreatePasswordController,controllerAs:"$ctrl",resolve:{validToken:function(authService,urlParameterService){return authService.checkPasswordResetToken(urlParameterService("code"),urlParameterService("userid"))}}}}}).state("lostpassword",{url:"/lostpassword",system:!0,views:{bodyView:{altaiTemplate:"lostpassword",altaiTemplateType:"System",controller:AltaiIdentity.LostPasswordController,controllerAs:"$ctrl"}}}).state("oauthauthenticate",{url:"/oauth/authenticate",system:!0,views:{bodyView:{controller:AltaiIdentity.OAuthAuthenticateController,controllerAs:"$ctrl"}}}),$stateProvider.state("admin.security",{url:"/security","abstract":!0}).state("admin.security.user",{url:"/user",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiIdentity.UserListController}}}).state("admin.security.role",{url:"/role",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiIdentity.RoleListController}}}).state("admin.security.updatesecurable",{url:"/securable",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiIdentity.SecurableUpdateController}}}).state("admin.security.debug",{url:"/debug",system:!0,views:{"bodyView@":{altaiTemplate:"identity:accessdebugconsole",altaiTemplateType:"Admin",controller:AltaiIdentity.AccessDebugConsoleController,controllerAs:"$ctrl"}}}).state("admin.security.group",{url:"/group",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiIdentity.GroupListController}}}),$httpProvider.interceptors.push("authInterceptor"),altaiAdminMenuProvider.add({name:"config.users",securable:"accessmanagement",parent:"config",label:"users",state:"admin.security.user",icon:"mdi mdi-account-multiple"}),altaiAdminMenuProvider.add({name:"config.roles",securable:"accessmanagement",parent:"config",label:"roles",state:"admin.security.role",icon:"mdi mdi-account-box-outline"}),altaiAdminMenuProvider.add({name:"config.groups",securable:"accessmanagement",parent:"config",label:"groups",state:"admin.security.group",icon:"mdi mdi-account-box-outline"}),altaiAdminMenuProvider.add({name:"config.debug",securable:"accessmanagement.debug",parent:"config",label:"debugsecurity",state:"admin.security.debug",icon:"mdi mdi-account-box-outline"}),altaiAdminMenuProvider.add({name:"config.securable",securable:"accessmanagement",parent:"config",label:"securable",state:"admin.security.updatesecurable",icon:"mdi mdi-account-box-outline"}),altaiAdminMenuProvider.add({parent:"config",name:"template.types",securable:"accessmanagement",label:"Theme editor filemanager",icon:"mdi mdi-file-xml",state:"admin.template.type"}),altaiInstallerProvider.register({templateUrl:"installerIdentity"})}),mod.run(function($rootScope,authService,logService){$rootScope.$on("$stateChangeStart",function(event,next){next.securable&&!authService.isAuthorizedSync(next.securable)&&event.preventDefault()})})}(AltaiIdentity||(AltaiIdentity={}));var AltaiTheming;!function(AltaiTheming){var Template=function(){function Template(){}return Template}();AltaiTheming.Template=Template}(AltaiTheming||(AltaiTheming={})),angular.module("altai.templates",["ui.router"]).config(function($stateProvider){$stateProvider.state("admin.theme",{"abstract":!0,url:"/theme"}).state("admin.theme.list",{url:"/list",system:!0,views:{"adminContentView@admin":{altaiTemplate:"themeList",controller:"themeListController",controllerAs:"vm"}},resolve:{themeListData:function(themeFactory){return themeFactory.list()}}}).state("admin.theme.read",{url:"/:id",system:!0,views:{"adminContentView@admin":{altaiTemplate:"themeRead",controller:"themeReadController",controllerAs:"vm"}},resolve:{themeData:function(themeFactory,$stateParams){return themeFactory.read($stateParams.id)}}}).state("admin.theme.template",{url:"/template/:id",system:!0,views:{"adminContentView@admin":{altaiTemplate:"themeTemplateUpdate",controller:"themeTemplateUpdateController",controllerAs:"vm"}},resolve:{templateContent:function($templateFactory,$stateParams){return $templateFactory.fromAltai($stateParams.id)}}})}),config.modules.push("altai.templates"),angular.module("altai.templates").controller("themeListController",function(themeListData){this.themes=themeListData}),angular.module("altai.templates").controller("themeReadController",function(themeData){this.theme=themeData}),angular.module("altai.templates").controller("themeTemplateUpdateController",function(templateContent){this.templateContent=templateContent}),angular.module("altai.templates").service("$templateFactory",function($q,$http,$templateCache,panelManager,$cacheFactory){this.fromConfig=function(config,params,locals){return config.template?config.template:config.altaiTemplate?this.fromAltai(config.altaiTemplate,config.altaiTemplateType,params):config.panelId?this.fromPanel(config.panelId):null},this.fromAltai=function(url,type,params){return $http.get(config.backendUrl+"/api/template/"+type+"/"+url,{cache:$templateCache}).then(function(response){return response.data})},this.fromPanel=function(panelId){return panelManager.getPanelContent(panelId)},this.listTemplateType=function(){var d=$q.defer();return 0!=_templateType.length?d.resolve(_templateType):$http.get(config.backendUrl+"/api/templateType").then(function(result){angular.copy(result.data,_templateType),d.resolve(_templateType)},function(error){d.reject()}),d.promise},this.listTemplateByTypeName=function(templateTypeName){var d=$q.defer();return $http.get(config.backendUrl+"/api/template?type="+templateTypeName).then(function(result){d.resolve(result.data)},function(error){logService.log("error",error.data),d.reject()}),d.promise},this.scanTemplates=function(){var d=$q.defer();return $http.get(config.backendUrl+"/api/template/scan").then(function(result){d.resolve(result.data)}),d.promise},this.deleteCache=function(){$cacheFactory.get("templates").removeAll()}}),angular.module("altai.templates").factory("themeFactory",function($http,$q){var exports={};return exports.list=function(){var d=$q.defer();return $http.get(config.backendUrl+"/api/theme").success(function(themes){d.resolve(themes)}),d.promise},exports.read=function(themeId){var d=$q.defer();return $http.get(config.backendUrl+"/api/theme/"+themeId).success(function(theme){d.resolve(theme)}),d.promise},exports});var AltaiLocalization;!function(AltaiLocalization){
function TranslatableFactory($rootScope,$uibModal,$q,$http,logService){var _translations={},_openTranslationsModal=function(translatableId){var modalInstance=$uibModal.open({templateUrl:"app/areas/admin/localization/views/translatableModal.html",resolve:{translatableId:function(){return translatableId}},controller:function($http,$rootScope,$scope,$modalInstance,translatableId){$http.get(config.backendUrl+"/api/translatable/"+translatableId).then(function(result){$scope.translatable=result.data}),$scope.save=function(){$http.put(config.backendUrl+"/api/translatable",$scope.translatable).then(function(result){$modalInstance.close($scope.translatable.translatableValues[0].value)})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}});return modalInstance.result},_listCodedTranslatable=function(languageId){var d=$q.defer();return $http.get(config.backendUrl+"/api/translatable?coded=true&languageId="+languageId).then(function(result){d.resolve(result.data)},function(error){logService.log(error.data.message),d.reject()}),d.promise},_createTranslatable=function(newTranslatable){var d=$q.defer();return $http.post(config.backendUrl+"/api/translatable",newTranslatable).then(function(result){logService.log("success","Succesfully created new translatable"),d.resolve(result.data)},function(error){logService.log("error",error.data.message),d.reject()}),d.promise},_deleteTranslatable=function(translatableId){var d=$q.defer();return $http["delete"](config.backendUrl+"/api/translatable"+translatableId).then(function(result){logService.log("success","Succesfully removed the translatable"),d.resolve(result.data)},function(error){logService.log("error",error.data.message),d.reject()}),d.promise},_updateTranslatableList=function(translatableList){var d=$q.defer();return $http.put(config.backendUrl+"/api/translatableList",translatableList).then(function(result){logService.log("success","Succesfully saved the translatables"),d.resolve(result.data)},function(error){logService.log("error",error.data.message),d.reject()}),d.promise},_inProgress=!1,_listTranslations=function(langCode){var d=$q.defer();return _translations||_inProgress?d.resolve(_translations):(_inProgress=!0,$http.get(config.backendUrl+"/api/translations?languageCode="+langCode).then(function(result){angular.copy(result.data,_translations),d.resolve(_translations)})),d.promise},_translate=function(key){return key=key.toLowerCase(),_translations&&key in _translations?_translations[key]:"("+key+")"};return{openTranslationsModal:_openTranslationsModal,listCodedTranslatable:_listCodedTranslatable,createTranslatable:_createTranslatable,deleteTranslatable:_deleteTranslatable,updateTranslatableList:_updateTranslatableList,translate:_translate,listTranslations:_listTranslations}}AltaiLocalization.TranslatableFactory=TranslatableFactory}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){function LanguageFactory($rootScope,altaiHttp,$http,$q,$translate){var _selectedLanguageIndex,_languages=[],_translations={},_createLanguage=function(newLanguage){var deferred=$q.defer();return $http.post(config.backendUrl+"/api/language",newLanguage).then(function(result){_languages.push(result.data),deferred.resolve(result.data)},function(error){deferred.reject(error)}),deferred.promise},_readLanguage=function(languageId){var deferred=$q.defer();return _listLanguage().then(function(result){var selectionLanguage=_languages.filter(function(element){return element.id==languageId})[0];_selectedLanguageIndex=_languages.indexOf(selectionLanguage),deferred.resolve(selectionLanguage)}),deferred.promise},_updateLanguage=function(updatedLanguage){var deferred=$q.defer();return $http.put(config.backendUrl+"/api/language/",updatedLanguage).then(function(result){deferred.resolve(result.data)},function(error){deferred.reject(error)}),deferred.promise},_deleteLanguage=function(languageId){var deferred=$q.defer();return $http["delete"](config.backendUrl+"/api/language/"+languageId).then(function(result){var selectionLanguage=_languages.filter(function(element){return element.id==languageId}),selectionLanguageIndex=_languages.indexOf(selectionLanguage[0]);_languages.splice(selectionLanguageIndex,1),deferred.resolve()},function(error){deferred.reject()}),deferred.promise},_listLanguage=function(){var deferred=$q.defer();return _languages.length?deferred.resolve(_languages):altaiHttp.get(config.backendUrl+"/api/language").then(function(result){angular.copy(result,_languages),deferred.resolve(_languages)},function(error){deferred.reject(error)}),deferred.promise},_listTranslations=function(langCode){var d=$q.defer();return _listTranslations?d.resolve(_translations):$http.get(config.backendUrl+"/api/translations?languageCode="+langCode).then(function(result){angular.copy(result.data,_translations),d.resolve(_translations)}),d.promise},_changeActiveLanguage=function(langCode){_listTranslations(langCode)},_getCurrentLangCode=function(){return $translate.use()};return{getCurrentLangCode:_getCurrentLangCode,createLanguage:_createLanguage,readLanguage:_readLanguage,updateLanguage:_updateLanguage,deleteLanguage:_deleteLanguage,listLanguage:_listLanguage,listTranslations:_listTranslations,changeActiveLanguage:_changeActiveLanguage}}AltaiLocalization.LanguageFactory=LanguageFactory}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){var AltaiLocalizationService=function(){function AltaiLocalizationService($translate,$q,$rootScope,altaiClientDataStore,$cookies,$timeout){this.$translate=$translate,this.$q=$q,this.$rootScope=$rootScope,this.altaiClientDataStore=altaiClientDataStore,this.$cookies=$cookies,this.$timeout=$timeout;var s=this,cookie=this.$cookies.get("langCode"),stored=this.altaiClientDataStore.get("langCode");cookie!=stored&&(s.altaiClientDataStore.set("langCode",cookie),stored=cookie),stored?s.$translate.use(stored).then(function(result){s.currentLangCode=stored}):(s.currentLangCode=s.$translate.use(),s.altaiClientDataStore.set("langCode",s.currentLangCode)),$rootScope.$watch(function(){return s.$cookies.get("langCode")},function(newVal,oldVal){oldVal!==newVal&&void 0!==newVal&&void 0!==oldVal&&(s.changeLang(newVal),window.location.reload(!0))})}return AltaiLocalizationService.prototype.changeLang=function(langCode){var d=this.$q.defer(),s=this;return s.altaiClientDataStore.set("langCode",langCode),this.$translate.use(langCode).then(function(){s.currentLangCode=langCode,s.$rootScope.$broadcast("languageChanged"),d.resolve()}),d.promise},AltaiLocalizationService.prototype.getCurrentLangCode=function(){var s=this,code=this.$cookies.get("langCode");return code||(code=s.$translate.use(),code?s.changeLang(code).then(function(result){code=result,window.location.reload(!0)}):s.changeLang("nl").then(function(result){code=result,window.location.reload(!0)})),"nl"==code||"fr"==code||"en"==code?code:"nl"},AltaiLocalizationService}();AltaiLocalization.AltaiLocalizationService=AltaiLocalizationService}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){function LanguageCodeInterceptor($injector){return{request:function(config){var altaiLocalizationService=$injector.get("altaiLocalizationService");return config.headers=config.headers||{},config.headers["Accept-Language"]||(altaiLocalizationService.getCurrentLangCode()?config.headers["Accept-Language"]=altaiLocalizationService.getCurrentLangCode():localStorage.getItem("langCode")&&(config.headers["Accept-Language"]=localStorage.getItem("langCode"))),config}}}AltaiLocalization.LanguageCodeInterceptor=LanguageCodeInterceptor}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){function AltaiTranslatableInputDirective(){return{scope:{languages:"=",translatable:"=altaiTranslatableInput",inputType:"@"},bindToController:!0,controllerAs:"vm",controller:AltaiTranslatableInputDirectiveController,template:"<div class='altai-translatable-input' ng-repeat='language in vm.languages | filter:{selected:true}'><div class='lang-container'><span class='lang'>{{language.code}}</span></div><div class='input-container'><input type='text' ng-if=\"vm.intInputType=='input'\" ng-model='vm.values[language.code]'><altai-text-editor template='complex' ng-if=\"vm.intInputType=='texteditor'\" ng-model='vm.values[language.code]'></altai-text-editor><altai-text-editor template='complexemail' ng-if=\"vm.intInputType=='email'\" ng-model='vm.values[language.code]'></altai-text-editor></div></div>"}}AltaiLocalization.AltaiTranslatableInputDirective=AltaiTranslatableInputDirective;var AltaiTranslatableInputDirectiveController=function(){function AltaiTranslatableInputDirectiveController(languageFactory,$scope){this.languageFactory=languageFactory,this.intInputType="input";var ctrl=this;ctrl.inputType&&(ctrl.intInputType=ctrl.inputType),$scope.$watch("vm.translatable",function(){if(ctrl.values||(ctrl.values={}),ctrl.translatable)for(var l=0;l<ctrl.translatable.translatableValues.length;l++)ctrl.values[ctrl.translatable.translatableValues[l].languageCode]=ctrl.translatable.translatableValues[l].value},!0),this.initTranslatable(),$scope.$watch("vm.values",function(){ctrl.translatable||ctrl.initTranslatable(),ctrl.mapTranslateValues()},!0)}return AltaiTranslatableInputDirectiveController.prototype.initTranslatable=function(){this.translatable||(this.translatable={translatableValues:[]})},AltaiTranslatableInputDirectiveController.prototype.mapTranslateValues=function(){var vm=this;if(this.values)for(var langs=Object.keys(this.values),l=0;l<langs.length;l++){var trv=this.translatable.translatableValues.filter(function(value){return value.languageCode==langs[l]})[0];trv?trv.value=this.values[langs[l]]:this.translatable.translatableValues.push({languageCode:langs[l],value:vm.values[langs[l]]})}},AltaiTranslatableInputDirectiveController}()}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){function AltaiLanguageBarDirective(){return{templateUrl:"/api/template/Admin/AltaiLanguageBar",controller:AltaiLanguageBarDirectiveDirectiveController,controllerAs:"vm",bindToController:!0,scope:{languages:"=",allowMultiple:"=",useDefaults:"="}}}AltaiLocalization.AltaiLanguageBarDirective=AltaiLanguageBarDirective;var AltaiLanguageBarDirectiveDirectiveController=function(){function AltaiLanguageBarDirectiveDirectiveController(languageFactory,$scope){var s=this;s.languageFactory=languageFactory,this.languageFactory.listLanguage().then(function(languages){if(s.languages=angular.copy(languages),languages)if(s.useDefaults)s.languages.filter(function(lang){return lang["default"]}).map(function(lang){return lang.selected=!0,lang});else{var defaultLang=s.languages.filter(function(lang){return lang.code===s.languageFactory.getCurrentLangCode()})[0];defaultLang.selected=!0,s.activeLang=defaultLang}})}return AltaiLanguageBarDirectiveDirectiveController.prototype.toggleLang=function(lang){if(this.allowMultiple){var otherSelectedLangsCount=this.languages.filter(function(lang){return lang.selected}).length;(otherSelectedLangsCount>1||!lang.selected)&&(lang.selected=!lang.selected)}else this.activeLang&&(this.activeLang.selected=!1),lang.selected=!0,this.activeLang=lang},AltaiLanguageBarDirectiveDirectiveController}()}(AltaiLocalization||(AltaiLocalization={}));var AltaiLocalization;!function(AltaiLocalization){var mod=angular.module("altai.localization",["pascalprecht.translate"]);mod.service("translatableFactory",AltaiLocalization.TranslatableFactory),mod.service("languageFactory",AltaiLocalization.LanguageFactory),mod.service("languageCodeInterceptor",AltaiLocalization.LanguageCodeInterceptor),mod.directive("altaiTranslatableInput",AltaiLocalization.AltaiTranslatableInputDirective),mod.directive("altaiLanguageBar",AltaiLocalization.AltaiLanguageBarDirective),mod.service("altaiLocalizationService",AltaiLocalization.AltaiLocalizationService),mod.config(function($translateProvider,$httpProvider){$httpProvider.interceptors.push("languageCodeInterceptor"),$translateProvider.useSanitizeValueStrategy(null),$translateProvider.registerAvailableLanguageKeys(["nl","fr"],{fr:"fr","fr_*":"fr",nl:"nl","nl_*":"nl"}),$translateProvider.fallbackLanguage("nl");var langCodeLocalStorage=localStorage.getItem("langCode");langCodeLocalStorage&&$translateProvider.preferredLanguage(langCodeLocalStorage)}),mod.run(function($rootScope,$location,altaiLocalizationService,$translate,urlParameterService,config){var langcode=urlParameterService("langcode");langcode&&langcode!=altaiLocalizationService.getCurrentLangCode()?(altaiLocalizationService.changeLang(langcode),$location.search("langcode",void 0),location.reload()):langcode&&$location.search("langcode",void 0),$rootScope.langCode=altaiLocalizationService.getCurrentLangCode(),$translate.use($rootScope.langCode)}),config.modules.push("altai.localization")}(AltaiLocalization||(AltaiLocalization={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function MenuListController($stateParams,menuManager,menuData){var vm=this;this.menus=menuData,this.createMenu=function(newMenu){menuManager.add(newMenu).then(function(result){vm.push(result)})},this.deleteMenu=function(menu){menuManager["delete"](menu)}}AltaiPageBuilder.MenuListController=MenuListController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function MenuUpdateController($scope,$rootScope,$http,$stateParams,menuManager,stateManager,translatableFactory,$templateFactory){$scope.newMenuItem={},$scope.newMenuItem.target="self",menuManager.getById($stateParams.id).then(function(result){$scope.menu=result}),$scope.updateMenu=function(){menuManager.update($scope.menu)},stateManager.list().then(function(result){$scope.states=result}),$scope.createMenuItem=function(){$scope.newMenuItem.menuId=$stateParams.id,menuManager.createMenuItem($scope.newMenuItem).then(function(result){$scope.newMenuItem={}})},$scope.deleteMenuItem=function(menuItem){menuManager.deleteMenuItem(menuItem)},$scope.moveMenuItem=function(menuItemId,position){menuManager.moveMenuItem(menuItemId,position).then(function(result){menuManager.getById($stateParams.id).then(function(result2){$scope.menu=result2})})},$scope.openTranslations=function(translatableId){translatableFactory.openTranslationsModal(translatableId)},$templateFactory.listTemplateByTypeName("menu").then(function(result){$scope.templates=result})}AltaiPageBuilder.MenuUpdateController=MenuUpdateController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function PanelUpdateController($rootScope,$scope,$http,$state,$stateParams,panelFactory,$templateFactory,buildingBlockFactory,panelData){function addBuildingBlockOrder(panelData){for(var b=0;b<panelData.buildingBlocks.length;b++)panelData.buildingBlocks[b].order=b;return panelData}$scope.panel=panelData,$templateFactory.listTemplateByTypeName("Panel").then(function(result){$scope.panelTemplates=result,console.log(result)}),$scope.deleteBlock=function(blockId){buildingBlockFactory.deleteBuildingBlock(blockId).then(function(){panelFactory.readPanel($stateParams.id).then(function(panel){$scope.panel=panel}),$templateFactory.deleteCache("/api/panel/"+$stateParams.id+"/content")})},$scope.savePanel=function(){panelFactory.updatePanel(addBuildingBlockOrder($scope.panel)).then(function(){$state.go($rootScope.previousState.name)})},$scope.moveBlock=function(buildingBlockId,movement){buildingBlockFactory.moveBuildingBlock(buildingBlockId,movement)},$scope.buildingBlockSortingOptions={stop:function(e,ui){buildingBlockFactory.moveBuildingBlock(ui.item.scope().buildingBlock.id,ui.item.scope().$index)}},$scope.saveBuildingBlock=function(data,id){buildingBlockFactory.updateBuildingBlock({id:id,name:data.name}).then(function(){panelFactory.readPanel($stateParams.id).then(function(panel){return $scope.panel=panel,!0})})},$scope.dragControlListeners={accept:function(){return!0}}}AltaiPageBuilder.PanelUpdateController=PanelUpdateController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateUpdateController($scope,$http,$rootScope,$stateParams,stateManager,translatableFactory,$state,$templateFactory,panelsList){stateManager.getById($stateParams.id).then(function(stateData){$scope.state=stateData}),$scope.panels=panelsList,stateManager.list().then(function(states){$scope.states=states}),$scope.updateState=function(){stateManager.update($scope.state).then(function(result){$state.go("admin.state.list")})},$templateFactory.listTemplateByTypeName("State").then(function(result){$scope.stateTemplates=result}),$scope.openTranslations=function(){translatableFactory.openTranslationsModal($scope.state.titleTranslatableId)},$scope.addUrl=function(){$scope.state.urls.push({name:$scope.newUrl.name,languageId:$scope.newUrl.languageId}),$scope.newUrl={}}}AltaiPageBuilder.StateUpdateController=StateUpdateController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateUpdateViewController($scope,$http,$rootScope,$state,$stateParams,stateViewService,panelService,config){""==$stateParams.rootPanelID&&($stateParams.rootPanelID=0),$http({method:"GET",url:config.backendUrl+"/api/stateview?url="+$stateParams.stateURL+"&rootPanelID="+$stateParams.rootPanelID}).then(function(result){$scope.stateView=result.data}),$scope.saveStateView=function(){stateViewService.updateStateView($scope.stateView),$state.go($scope.stateView.state.name)}}AltaiPageBuilder.StateUpdateViewController=StateUpdateViewController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateListController($scope,stateManager,wmContainerFactory){wmContainerFactory.createWindow(AltaiPageBuilder.PageBuilderWindows.stateList,"States","")}AltaiPageBuilder.StateListController=StateListController}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function AltaiBbDirective($compile){return{restrict:"A",link:altaiBbLink}}function altaiBbLink(scope,elm){}AltaiPageBuilder.AltaiBbDirective=AltaiBbDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function AltaiHtmlDirective(){return{scope:{content:"=altaiHtml"},controller:function($scope,$sce,$sanitize){$scope.output=$sce.trustAsHtml($scope.content)},template:"<div ng-bind-html='output'></div>",replace:!0}}AltaiPageBuilder.AltaiHtmlDirective=AltaiHtmlDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function AltaiPanelDirective($rootScope,$state,panelManager){return{scope:{panelId:"@",panelName:"@"},transclude:!0,replace:!0,template:'<div class="altai-panel" ng-class="{\'edit-mode\':$ctrl.modes.editMode,\'local-edit\':$ctrl.localEdit}"><div class="header"><div ng-if="!$ctrl.isBuildingBlock" ng-click="$ctrl.updatePanel()" class="button"><i class="mdi mdi-pencil" ></i></div><div class="header-inner"><b>Panel:</b>&nbsp;{{$ctrl.panelName}}</div></div></div>',controllerAs:"$ctrl",bindToController:!0,link:function(scope,element,attrs,ctrl,transclude){transclude(scope,function(content){content.addClass("altai-panel-zone"),element.append(content)})},controller:function($scope,$rootScope,$attrs,$element,altaiEditModeService){var ctrl=this;ctrl.localEdit=!0,ctrl.modes=altaiEditModeService.getModes(),ctrl.isBuildingBlock=$attrs.buildingBlockId,ctrl.updatePanel=function(){altaiEditModeService.activePanelId=$attrs.panelId,delete altaiEditModeService.activeBuildingBlockId,altaiEditModeService.activeBuildingBlockType="Panel",altaiEditModeService.modes.buildingBlockUpdate=!0,$rootScope.$broadcast("activeBuildingBlockChanged")}}}}AltaiPageBuilder.AltaiPanelDirective=AltaiPanelDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function CmsSidebarDirective(config){var directive={};return directive.scope=!0,directive.restrict="E",directive.templateUrl=config.backendUrl+"/api/template/cmsSidebar2",directive.controller=function($rootScope,$scope,$state,authService,stateManager,buildingBlockType,buildingBlockManager){function checkPermissions(){authService.getUserInfo().then(function(userInfo){userInfo&&userInfo.accesses.indexOf("admin.menu")>-1?($scope.hasAccess=!0,2!=$rootScope.adminMenu&&($rootScope.adminMenu=1),$rootScope.mode="manager",stateManager.list().then(function(states){$scope.states=states}),$scope.buildingBlockTypes=buildingBlockType.list(),buildingBlockManager.listInstance().then(function(instances){$scope.buildingBlockInstances=instances})):($scope.hasAccess=!1,$rootScope.adminMenu=0)})}$rootScope.startState="edit",$scope.changeMode=function(){"edit"==$rootScope.mode?$rootScope.mode="manager":$rootScope.mode="edit"},checkPermissions(),$rootScope.$on("userInfoChanged",checkPermissions),$scope.setActiveDrag=function(type,id,instance){$rootScope.activeDragId=id,$rootScope.activeDragType=type,$rootScope.activeDragInstance=instance}},directive}AltaiPageBuilder.CmsSidebarDirective=CmsSidebarDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function MenuDirective(menuManager,$http,$compile){return{restrict:"A",scope:{templateId:"@tplId",navigationId:"@navigationId"},controller:function($scope,$http,$attrs){menuManager.getById($scope.navigationId).then(function(result){$scope.menu=result})},link:function(scope,element,attrs){0!=scope.templateId?$http.get(config.backendUrl+"/api/template/"+scope.templateId).then(function(result){element.html(result.data).show(),$compile(element.contents())(scope)}):(element.html("<div style='background-color:#efefef;padding: 10px;margin-bottom:10px;text-algin:left;'><a href='#/admin/menu/"+scope.navigationId+"'><i class='fa fa-info'> Configure this menu first</a></div>").show(),$compile(element.contents())(scope))}}}AltaiPageBuilder.MenuDirective=MenuDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function PanelDropDirective($http,$compile,$rootScope,$state,$cacheFactory,buildingBlockManager,panelManager){return{restrict:"A",scope:{panelZone:"@",panelId:"@"},template:'<div data-ng-show="$root.mode==\'edit\'" altai-drop="drop()" class="buildingblock-dropzone"><i class="fa fa-plus"></i>&nbsp;Add new building block </div>',link:function($scope,$element){$element.bind("dragover",function(ev){ev.preventDefault()})},controller:function($scope,$element,$rootScope){$scope.panelZone||($scope.panelZone="main"),$scope.drop=function(){$rootScope.$broadcast("$buildingBlockCreated",{});var children=$element[0].children,dropZone=children[children.length-1];"newBuildingBlock"==$rootScope.activeDragType?buildingBlockManager.createBuildingBlock($scope.panelId,$rootScope.activeDragId,$scope.panelZone).then(function(buildingBlock){console.log($scope.panelZone),$http.get(config.backendUrl+"/api/buildingblock/"+buildingBlock.id).then(function(buildingBlockContent){angular.element(dropZone).before($compile(buildingBlockContent.data)($scope.$parent))})}):"exBuildingBlock"==$rootScope.activeDragType?buildingBlockManager.createBuildingBlockInstance($scope.panelId,$rootScope.activeDragId,$scope.panelZone).then(function(buildingBlock){$http({method:"GET",url:config.backendUrl+"/api/buildingblock/"+buildingBlock.id}).then(function(buildingBlockContent){angular.element(dropZone).before($compile(buildingBlockContent.data)($scope.$parent))})}):"newPanel"==$rootScope.activeDragType?panelManager.add({name:"Panel in panel",templateId:$rootScope.activeDragId}).then(function(panel){buildingBlockManager.createExBuildingBlock($scope.panelZoneInstanceId,1,panel.id).then(function(buildingBlock){var element=angular.element(dropZone);element.insertAdjacentHTML("beforebegin",$compile(buildingBlock.data)($scope))})}):"exPanel"==$rootScope.activeDragType?buildingBlockManager.createExBuildingBlock($scope.panelZoneInstanceId,1,$rootScope.activeDragId).then(function(buildingBlock){var element=angular.element(dropZone);element.insertAdjacentHTML("beforebegin",$compile(buildingBlock.content)($scope))}):"exContent"==$rootScope.activeDragType&&buildingBlockManager.createExBuildingBlock($scope.panelZoneInstanceId,3,$rootScope.activeDragId).then(function(buildingBlock){var element=angular.element(dropZone);element.insertAdjacentHTML("beforebegin",$compile("<div>"+buildingBlock.content+"</div>")($scope))})}}}}AltaiPageBuilder.PanelDropDirective=PanelDropDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateProfileDirective(){return{scope:{stateId:"="},bindToController:!0,controllerAs:"vm",controller:StateProfileDirectiveController,templateUrl:"/api/template/Admin/StateProfile"}}AltaiPageBuilder.StateProfileDirective=StateProfileDirective;var StateProfileDirectiveController=function(){function StateProfileDirectiveController($scope,$state,stateManager,panelManager,$templateFactory,wmContainerFactory){this.wmContainerFactory=wmContainerFactory;var vm=this;this.stateManager=stateManager,this.$templateFactory=$templateFactory,this.panelManager=panelManager,vm.panelManager.list().then(function(panels){vm.panels=panels}),this.stateManager.getById(this.stateId,!1).then(function(stateData){vm.state=stateData}),this.stateManager.list().then(function(states){vm.states=states}),this.$templateFactory.listTemplateByTypeName("State").then(function(result){vm.stateTemplates=result}),$scope.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){vm.updateState(vm.state,$state)},name:"save","class":"altai-button-go",separator:!0},{translatableTooltipId:"accesses",icon:"mdi-key",action:function(){vm.openStateAccessesWindow()},"class":"altai-button-primary",name:"accesses",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return StateProfileDirectiveController.prototype.updateState=function(updatedState,$state){var ctrl=this;ctrl.stateManager.update(this.state).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiPageBuilder.PageBuilderWindows.stateProfile,ctrl.state.id);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},StateProfileDirectiveController.prototype.openPanelAccessesWindow=function(panelId){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",panelId,{securableName:"panel.item"})},StateProfileDirectiveController.prototype.openStateAccessesWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",ctrl.stateId,{securableName:"state.open"})},StateProfileDirectiveController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateCreateDirective(){return{templateUrl:"/api/template/Admin/StateCreate",controller:StateCreateDirectiveController}}AltaiPageBuilder.StateCreateDirective=StateCreateDirective;var StateCreateDirectiveController=function(){function StateCreateDirectiveController($scope,$http,$state,stateManager,wmContainerFactory,$templateFactory){this.wmContainerFactory=wmContainerFactory;var ctrl=this;$scope.state={},$scope.state.urls=[],$scope.state.urls[0]={},$templateFactory.listTemplateByTypeName("State").then(function(result){$scope.stateTemplates=result}),$scope.createState=function(){if("root"==$scope.stateType)$scope.parentStateId="";else{var parentState=$scope.states.filter(function(elm){return elm.id==$scope.state.parentStateId})[0];$scope.state.name=parentState.name+"."+$scope.state.name}stateManager.createState($scope.state).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiPageBuilder.PageBuilderWindows.stateCreate);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},stateManager.list().then(function(states){$scope.states=states}),$scope.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){$scope.createState()},name:"save","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return StateCreateDirectiveController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function StateListDirective(){return{controllerAs:"vm",controller:StateListController,templateUrl:"/api/template/Admin/StateList"}}AltaiPageBuilder.StateListDirective=StateListDirective;var StateListController=function(){function StateListController(stateManager,$state,wmContainerFactory,altaiConfirmationService){this.stateManager=stateManager,this.$state=$state,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService;var vm=this;this.wmContainerFactory=wmContainerFactory,stateManager.list().then(function(states){vm.states=states})}return StateListController.prototype.openStateProfile=function(state){this.wmContainerFactory.createWindow(AltaiPageBuilder.PageBuilderWindows.stateProfile,state.name,state.id)},StateListController.prototype.deleteState=function(state){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.stateManager["delete"](state)})},StateListController.prototype.openState=function(state){this.$state.go(state.name)},StateListController.prototype.createState=function(){this.wmContainerFactory.createWindow(AltaiPageBuilder.PageBuilderWindows.stateCreate,"Create new state","")},StateListController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function AltaiUpdateBuildingBlockPopupDirective(){return{templateUrl:"/api/template/Admin/AltaiUpdateBuildingBlockPopup",controllerAs:"$ctrl",replace:!0,scope:!0,link:function(scope,element){function mouseUp(){window.removeEventListener("mousemove",popupMove,!0)}function mouseDown(e){offset.x=e.clientX-popupEl.offsetLeft,offset.y=e.clientY-popupEl.offsetTop,window.addEventListener("mousemove",popupMove,!0)}function popupMove(e){var top=e.clientY-offset.y,left=e.clientX-offset.x;popupEl.style.top=top+"px",popupEl.style.left=left+"px"}var popupEl=element[0],popupElHeader=element.find(".buildingblocks-grid-header")[0],offset={x:0,y:0};popupElHeader.addEventListener("mousedown",mouseDown,!1),window.addEventListener("mouseup",mouseUp,!1)},controller:function(altaiEditModeService,buildingBlockType,$compile,$scope,$element,buildingBlockManager){var ctrl=this;ctrl.modes=altaiEditModeService.modes,$scope.buildingBlockTypes=buildingBlockType.list(),$scope.inconfigurationmode=!0,ctrl.activeDropLocation=altaiEditModeService.activeDropLocation,$scope.$on("editModeChanged",function(){altaiEditModeService.modes.editMode||ctrl.closePopup()}),$scope.$on("$stateChangeStart",function(){ctrl.closePopup()}),$scope.$on("activeBuildingBlockChanged",function(){var types=buildingBlockType.list(),activePanelId=altaiEditModeService.activePanelId,activeBuildingBlockId=altaiEditModeService.activeBuildingBlockId,activeBbType=types.filter(function(type){return type.name==altaiEditModeService.activeBuildingBlockType})[0];if(activeBbType&&activeBbType.updateComponent){altaiEditModeService.modes.popupMainMenu=!0;var elementToAddTo=$element.find(".inline-component");$scope.activeBuildingBlockId=activeBuildingBlockId,activeBuildingBlockId?buildingBlockManager.getBuildingBlockProfile(activeBuildingBlockId).then(function(bbProfile){$scope.activeBuildingBlockInstanceId=bbProfile.instanceId,elementToAddTo.html($compile(activeBbType.updateComponent)($scope))},function(){elementToAddTo.html($compile(activeBbType.updateComponent)($scope))}):activePanelId&&($scope.activeBuildingBlockInstanceId=activePanelId,elementToAddTo.html($compile(activeBbType.updateComponent)($scope)))}}),this.closePopup=function(){altaiEditModeService.modes.buildingBlockUpdate=!1}}}}AltaiPageBuilder.AltaiUpdateBuildingBlockPopupDirective=AltaiUpdateBuildingBlockPopupDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){function AltaiCreateBuildingBlockPopupDirective(){
return{templateUrl:"/api/template/Admin/AltaiCreateBuildingBlockPopup",controllerAs:"$ctrl",replace:!0,scope:!0,link:function(scope,element){function mouseUp(){window.removeEventListener("mousemove",popupMove,!0)}function mouseDown(e){offset.x=e.clientX-popupEl.offsetLeft,offset.y=e.clientY-popupEl.offsetTop,window.addEventListener("mousemove",popupMove,!0)}function popupMove(e){var top=e.clientY-offset.y,left=e.clientX-offset.x;popupEl.style.top=top+"px",popupEl.style.left=left+"px"}var popupEl=element[0],offset={x:0,y:0};popupEl.addEventListener("mousedown",mouseDown,!1),window.addEventListener("mouseup",mouseUp,!1)},controller:function(altaiEditModeService,buildingBlockType,$compile,$scope,$element,buildingBlockManager){var vm=this;vm.modes=altaiEditModeService.modes,$scope.buildingBlockTypes=buildingBlockType.list(),$scope.inconfigurationmode=!0,vm.activeDropLocation=altaiEditModeService.activeDropLocation,$scope.$on("activePanelChanged",function(){$element[0].style.left=altaiEditModeService.activeDropLocation.offset().left+5+"px",$element[0].style.top=altaiEditModeService.activeDropLocation.offset().top+35+"px"}),$scope.$on("editModeChanged",function(){altaiEditModeService.modes.editMode||vm.closePopup()}),$scope.$on("$stateChangeStart",function(){vm.closePopup()}),this.closePopup=function(){altaiEditModeService.modes.popupOpened=!1},$scope.createBb=function(bbType,properties){if(properties||(properties={}),bbType.createComponent){altaiEditModeService.modes.popupMainMenu=!0;var elementToAddTo=$element.find(".inline-component");elementToAddTo.html($compile(bbType.createComponent)($scope))}else altaiEditModeService.createBuildingBlock(bbType.name,properties)}}}}AltaiPageBuilder.AltaiCreateBuildingBlockPopupDirective=AltaiCreateBuildingBlockPopupDirective}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiPanelBuildingBlockCreatorComponent=function(){function AltaiPanelBuildingBlockCreatorComponent(){this.template="<div class='altai-panel-building-block-creator' ng-click='$ctrl.toggleLocalCreateMode()'><div class='footer-inner'><i class='mdi mdi-plus'></i>&nbsp;{{'addbuildingblock'|translate}}</div></div>",this.controller=AltaiPanelBuildingBlockCreatorController,this.require={altaiPanel:"^altaiPanel"},this.bindings={zone:"@"}}return AltaiPanelBuildingBlockCreatorComponent}();AltaiPageBuilder.AltaiPanelBuildingBlockCreatorComponent=AltaiPanelBuildingBlockCreatorComponent;var AltaiPanelBuildingBlockCreatorController=function(){function AltaiPanelBuildingBlockCreatorController($element,$scope,altaiEditModeService){this.$element=$element,this.$scope=$scope,this.altaiEditModeService=altaiEditModeService,this.toggleLocalCreateMode=function(){var vm=this;vm.$element.parent().addClass("local-edit"),vm.altaiEditModeService.modes.popupOpened=!0,vm.altaiEditModeService.modes.popupMainMenu=!0,vm.altaiEditModeService.activeDropLocation&&vm.$element!=vm.altaiEditModeService.activeDropLocation&&vm.altaiEditModeService.activeDropLocation.parent().removeClass("local-edit"),vm.altaiEditModeService.activeDropLocation=vm.$element,vm.altaiEditModeService.activePanelId=this.altaiPanel.panelId,vm.altaiEditModeService.activeZone=this.zone,vm.$scope.$emit("activePanelChanged")};$scope.$on("editModeChanged",function(){altaiEditModeService.activeDropLocation&&altaiEditModeService.activeDropLocation.parent().removeClass("local-edit")})}return AltaiPanelBuildingBlockCreatorController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiBuildingBlockAdminComponent=function(){function AltaiBuildingBlockAdminComponent(){this.controller=AltaiBuildingBlockAdminComponentController,this.template="<div ng-click='$ctrl.updateBuildingBlock()'><i class='mdi mdi-pencil'></i></div><div ng-click='$ctrl.removeBuildingBlock()'><i class='mdi mdi-close'></i></div>",this.bindings={buildingBlockId:"@",buildingBlockType:"@"}}return AltaiBuildingBlockAdminComponent}();AltaiPageBuilder.AltaiBuildingBlockAdminComponent=AltaiBuildingBlockAdminComponent;var AltaiBuildingBlockAdminComponentController=function(){function AltaiBuildingBlockAdminComponentController(buildingBlockManager,altaiEditModeService,altaiConfirmationService,$element,$rootScope){this.altaiEditModeService=altaiEditModeService,this.$rootScope=$rootScope,this.buildingBlockManager=buildingBlockManager,this.altaiConfirmationService=altaiConfirmationService,this.element=$element[0]}return AltaiBuildingBlockAdminComponentController.prototype.updateBuildingBlock=function(){this.altaiEditModeService.modes.buildingBlockUpdate=!0,this.altaiEditModeService.activeBuildingBlockId=this.buildingBlockId,this.altaiEditModeService.activeBuildingBlockType=this.buildingBlockType,this.$rootScope.$broadcast("activeBuildingBlockChanged")},AltaiBuildingBlockAdminComponentController.prototype.removeBuildingBlock=function(){var c=this;c.altaiConfirmationService.confirm().then(function(){c.buildingBlockManager.deleteBuildingBlock(c.buildingBlockId).then(function(){c.element.parentNode.parentNode.removeChild(c.element.parentNode)})})},AltaiBuildingBlockAdminComponentController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiPanelCreateBuildingBlockComponent=function(){function AltaiPanelCreateBuildingBlockComponent(){this.controller=AltaiPanelCreateBuildingBlockComponentController,this.templateUrl="/api/template/Admin/AltaiPanelCreateBuildingBlockComponent"}return AltaiPanelCreateBuildingBlockComponent}();AltaiPageBuilder.AltaiPanelCreateBuildingBlockComponent=AltaiPanelCreateBuildingBlockComponent;var AltaiPanelCreateBuildingBlockComponentController=function(){function AltaiPanelCreateBuildingBlockComponentController($scope,$templateFactory,altaiEditModeService){var c=this;c.altaiEditModeService=altaiEditModeService,$templateFactory.listTemplateByTypeName("panel").then(function(templateList){c.panelTemplates=templateList})}return AltaiPanelCreateBuildingBlockComponentController.prototype.createBuildingBlock=function(){var vm=this;this.altaiEditModeService.createBuildingBlock("Panel",{templateId:vm.selectedPanelTemplate.id})},AltaiPanelCreateBuildingBlockComponentController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiPanelBuildingBlockUpdateComponent=function(){function AltaiPanelBuildingBlockUpdateComponent(){this.controller=AltaiPanelBuildingBlockUpdateComponentController,this.templateUrl="/api/template/Admin/AltaiPanelUpdateBuildingBlockComponent",this.bindings={panelId:"=",buildingBlockId:"="}}return AltaiPanelBuildingBlockUpdateComponent}();AltaiPageBuilder.AltaiPanelBuildingBlockUpdateComponent=AltaiPanelBuildingBlockUpdateComponent;var AltaiPanelBuildingBlockUpdateComponentController=function(){function AltaiPanelBuildingBlockUpdateComponentController($scope,$templateFactory,panelManager,altaiEditModeService,buildingBlockManager){this.panelManager=panelManager,this.buildingBlockManager=buildingBlockManager,this.zones=[];var ctrl=this;ctrl.altaiEditModeService=altaiEditModeService,ctrl.panelManager.getById(ctrl.panelId,!1).then(function(panelData){ctrl.panel=panelData,ctrl.panel.panelProperties&&ctrl.panel.panelProperties.length||(ctrl.panel.panelProperties=[{type:"class",value:""}]),ctrl.groupByZone(),$templateFactory.listTemplateByTypeName("panel").then(function(templateList){ctrl.panelTemplates=templateList,ctrl.selectedPanelTemplate=ctrl.panelTemplates.filter(function(tpl){return tpl.id==panelData.templateId})[0]})})}return AltaiPanelBuildingBlockUpdateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.updateBuildingBlock()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiPanelBuildingBlockUpdateComponentController.prototype.groupByZone=function(){for(var ctrl=this,i=0;i<ctrl.panel.buildingBlocks.length;i++){var block=ctrl.panel.buildingBlocks[i],zone=ctrl.zones.filter(function(zone){return zone.name==block.zone})[0];zone||(zone={name:block.zone,blocks:[]},ctrl.zones.push(zone)),zone.blocks.push(block)}},AltaiPanelBuildingBlockUpdateComponentController.prototype.deleteBuildingBlock=function(block){var ctrl=this,zone=ctrl.zones.filter(function(zone){return zone.name==block.zone})[0];ctrl.buildingBlockManager.deleteBuildingBlock(block.id).then(function(){ctrl.panel.buildingBlocks.splice(ctrl.panel.buildingBlocks.indexOf(block),1),zone.blocks.splice(zone.blocks.indexOf(block),1)})},AltaiPanelBuildingBlockUpdateComponentController.prototype.handleSorting=function(){for(var ctrl=this,i=0;i<ctrl.panel.buildingBlocks.length;i++){var zone=ctrl.zones.filter(function(zone){return zone.name==ctrl.panel.buildingBlocks[i].zone})[0];ctrl.panel.buildingBlocks[i].order=zone.blocks.indexOf(ctrl.panel.buildingBlocks[i])}},AltaiPanelBuildingBlockUpdateComponentController.prototype.updateBuildingBlock=function(){var c=this;c.selectedPanelTemplate?c.panel.templateId=c.selectedPanelTemplate.id:c.panel.templateId=0,c.setPanelPropertiesId(c.panel.id),c.handleSorting(),this.panelManager.update(c.panel).then(function(result){c.buildingBlockId?c.buildingBlockManager.reloadBuildingBlock(c.buildingBlockId):c.panelManager.reloadPanel(c.panelId),c.altaiEditModeService.modes.buildingBlockUpdate=!1})},AltaiPanelBuildingBlockUpdateComponentController.prototype.setPanelPropertiesId=function(panelId){for(var i=0;i<this.panel.panelProperties.length;i++)console.log(panelId),this.panel.panelProperties[i].panelId=panelId},AltaiPanelBuildingBlockUpdateComponentController}()}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiRouterProvider=function(){function AltaiRouterProvider($stateProvider,$urlRouterProvider){this.stateProvider=$stateProvider,this.urlRouterProvider=$urlRouterProvider}return AltaiRouterProvider.prototype.loadRoutes=function(){},AltaiRouterProvider.prototype.addState=function(newState){newState.url||(newState["abstract"]=!0),this.stateProvider.state(newState.name,newState)},AltaiRouterProvider.prototype.setDefaultState=function(defaultState){this.defaultState=defaultState,this.urlRouterProvider.otherwise(defaultState.url)},AltaiRouterProvider.prototype.getDefaultState=function(){return this.defaultState},AltaiRouterProvider.prototype.$get=function(){return{getDefaultState:this.getDefaultState}},AltaiRouterProvider}();AltaiPageBuilder.AltaiRouterProvider=AltaiRouterProvider}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiStateProvider=function(){function AltaiStateProvider($stateProvider){this.$stateProvider=$stateProvider}return AltaiStateProvider.prototype.$get=function($state){var provider=this;return{addState:function(name,state){provider.$stateProvider.state(name,state)}}},AltaiStateProvider}();AltaiPageBuilder.AltaiStateProvider=AltaiStateProvider}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var BuildingBlockManager=function(){function BuildingBlockManager($q,$http,$compile,altaiNotificationFactory){this.$compile=$compile,this.q=$q,this.http=$http,this.notificationFactory=altaiNotificationFactory}return BuildingBlockManager.prototype.listInstance=function(){var d=this.q.defer();return this.http.get("/api/buildingblock/instance").success(function(instances){d.resolve(instances)}),d.promise},BuildingBlockManager.prototype.createBuildingBlock=function(buildingBlock){var deferred=this.q.defer(),service=this;return this.http.post("/api/buildingBlock",buildingBlock).then(function(result){service.notificationFactory.success("Sucesfully created the building block"),deferred.resolve(result.data)},function(error){service.notificationFactory.error("Could not create the new building block"),deferred.reject(error)}),deferred.promise},BuildingBlockManager.prototype.listBuildingBlock=function(){var deferred=this.q.defer(),service=this;return this.http.get("/api/buildingblock").then(function(result){deferred.resolve(result.data)},function(error){service.notificationFactory.error("Could not load the list with buildingblocks"),deferred.reject(error)}),deferred.promise},BuildingBlockManager.prototype.updateBuildingBlock=function(buildingBlock){var deferred=this.q.defer(),service=this;return this.http.put("/api/buildingblock",buildingBlock).then(function(result){service.notificationFactory.success("Succesfully updated the building block"),deferred.resolve()},function(error){service.notificationFactory.error("Could not update the buildingblock"),deferred.reject()}),deferred.promise},BuildingBlockManager.prototype.deleteBuildingBlock=function(buildingBlockId){var deferred=this.q.defer(),service=this;return this.http["delete"]("/api/buildingblock/"+buildingBlockId).then(function(result){service.notificationFactory.success("Sucesfully deleted the buildingblock"),deferred.resolve()},function(error){service.notificationFactory.error("Could not delete the buildingblock"),deferred.reject()}),deferred.promise},BuildingBlockManager.prototype.getBuildingBlockProfile=function(buildingBlockId){var d=this.q.defer();return this.http.get("/api/buildingblock/"+buildingBlockId+"/profile").success(function(result){d.resolve(result)},function(error){d.reject()}),d.promise},BuildingBlockManager.prototype.moveBuildingBlock=function(buildingBlockId,position){var deferred=this.q.defer(),service=this;return this.http.put("/api/buildingblock/"+buildingBlockId+"?position="+position).then(function(result){service.notificationFactory.success("Succesfully moved the buildingblock"),deferred.resolve()},function(error){service.notificationFactory.error(error.data.message),deferred.reject()}),deferred.promise},BuildingBlockManager.prototype.loadBuildingBlock=function(buildingBlockId){var d=this.q.defer();return this.http.get("/api/buildingBlock/"+buildingBlockId).success(function(bbHtml){d.resolve(bbHtml)}),d.promise},BuildingBlockManager.prototype.reloadBuildingBlock=function(buildingBlockId){var s=this,element=s.findBuildingBlockDOMElement(buildingBlockId);if(element){var bbScope=angular.element(element).scope();s.loadBuildingBlock(buildingBlockId).then(function(bbHtml){$(element).replaceWith(s.$compile(bbHtml)(bbScope))})}},BuildingBlockManager.prototype.findBuildingBlockDOMElement=function(buildingBlockId){for(var bbElms=document.getElementsByTagName("altai-building-block"),i=0;i<bbElms.length;i++)if(bbElms[i].attributes["altai-bb"].value==buildingBlockId)return bbElms[i]},BuildingBlockManager}();AltaiPageBuilder.BuildingBlockManager=BuildingBlockManager}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var BuildingBlockTypeProvider=function(){function BuildingBlockTypeProvider(){this.buildingBlockTypes=[]}return BuildingBlockTypeProvider.prototype.add=function(buildingBlockType){this.buildingBlockTypes.push(buildingBlockType)},BuildingBlockTypeProvider.prototype.$get=function(){var provider=this;return{list:function(){return provider.buildingBlockTypes},get:function(typeName){return provider.buildingBlockTypes.filter(function(type){return type.name===typeName})[0]}}},BuildingBlockTypeProvider}();AltaiPageBuilder.BuildingBlockTypeProvider=BuildingBlockTypeProvider}(AltaiPageBuilder||(AltaiPageBuilder={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiPageBuilder;!function(AltaiPageBuilder){var MenuManager=function(_super){function MenuManager($q,$http,altaiHttp,altaiNotificationFactory){return _super.call(this,"api/menu","menu",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MenuManager,_super),MenuManager.prototype.createMenuItem=function(newMenuItem){var deferred=this.$q.defer(),service=this;return this.$http.post(config.backendUrl+"/api/menuitem/",newMenuItem).then(function(result){service.notificationFactory.success("Menu item created"),deferred.resolve()},function(error){service.notificationFactory.error(error.data.messages),deferred.reject()}),deferred.promise},MenuManager.prototype.deleteMenuItem=function(menuItem){var deferred=this.$q.defer(),service=this;return this.$http["delete"](config.backendUrl+"/api/menuitem/"+menuItem.id).then(function(result){var activeMenu=service.itemDataList.filter(function(element){return element.id==menuItem.menuId})[0];if(menuItem.parentMenuItemId){var parent=activeMenu.menuItems.filter(function(elm){return elm.id==menuItem.parentMenuItemId})[0],cachedMenuItem=parent.childMenuItems.filter(function(elm){return elm.id==menuItem.id})[0],removedMenuItemIndex=parent.childMenuItems.indexOf(cachedMenuItem);parent.childMenuItems.splice(removedMenuItemIndex,1)}else{var cachedMenuItem=activeMenu.menuItems.filter(function(element){return element.id==menuItem.Id})[0],removedMenuItemIndex=activeMenu.menuItems.indexOf(cachedMenuItem);activeMenu.menuItems.splice(removedMenuItemIndex,1)}service.notificationFactory.success("Item deleted succesfullt"),deferred.resolve()},function(error){service.notificationFactory.error(error.data.message),deferred.reject()}),deferred.promise},MenuManager.prototype.moveMenuItem=function(menuItemId,position){var deferred=this.$q.defer(),service=this;return this.$http.put("/api/menuitem/"+menuItemId+"?position="+position,{}).then(function(result){service.notificationFactory.success("Succesfully moved the menuitem"),deferred.resolve()},function(error){service.notificationFactory.error(error.data.message),deferred.reject()}),deferred.promise},MenuManager}(AltaiCore.AltaiDataService);AltaiPageBuilder.MenuManager=MenuManager}(AltaiPageBuilder||(AltaiPageBuilder={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiPageBuilder;!function(AltaiPageBuilder){var PanelManager=function(_super){function PanelManager($http,altaiHttp,$q,$compile,altaiNotificationFactory,altaiLocalizationService){var _this=_super.call(this,"api/panel","panel",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$compile=$compile,_this.altaiLocalizationService=altaiLocalizationService,_this}return __extends(PanelManager,_super),PanelManager.prototype.findPanelDOMElement=function(panelId){for(var panelElms=document.getElementsByClassName("altai-panel"),i=0;i<panelElms.length;i++)if(panelElms[i].attributes["panel-id"].value==panelId)return panelElms[i]},PanelManager.prototype.getPanelContent=function(panelId){var s=this,d=s.$q.defer();return s.$http.get("panel/"+panelId+"_"+s.altaiLocalizationService.getCurrentLangCode()+".html").success(function(panelContent){d.resolve(panelContent)}),d.promise},PanelManager.prototype.reloadPanel=function(panelId){var s=this,element=s.findPanelDOMElement(panelId);if(element){var panelScope=angular.element(element).scope();s.getPanelContent(panelId).then(function(panelHtml){$(element).replaceWith(s.$compile(panelHtml)(panelScope))})}},PanelManager}(AltaiCore.AltaiDataService);AltaiPageBuilder.PanelManager=PanelManager}(AltaiPageBuilder||(AltaiPageBuilder={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiPageBuilder;!function(AltaiPageBuilder){var StateManager=function(_super){function StateManager($http,altaiHttp,$q,altaiNotificationFactory,altaiState){var _this=_super.call(this,"api/state","state",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.createState=function(newState){var deferred=this.$q.defer(),factory=this;return this.$http.post(config.backendUrl+"/api/state/",newState).then(function(result){factory.dataList.push(result.data);var stateParms={};stateParms.url=result.data.url,stateParms.views={},stateParms.name=result.data.name;var rootName=result.data.name.split(".")[0];if(result.data.parentState||(stateParms.views.bodyView={altaiTemplate:result.data.template.name,altaiTemplateType:"State"}),result.data.stateViews)for(var v=0;v<result.data.stateViews.length;v++){var viewName=result.data.stateViews[v].viewName+"@"+rootName;result.data.stateViews[v].panelId?stateParms.views[viewName]={panelId:result.data.stateViews[v].panelId}:stateParms.views[viewName]={panelId:result.data.stateViews[v].id}}factory.altaiState.addState(stateParms.name,stateParms),factory.notificationFactory.success("Created new page!"),deferred.resolve()},function(error){factory.notificationFactory.error("Could not create the new state"),deferred.reject()}),deferred.promise},_this.altaiState=altaiState,_this}return __extends(StateManager,_super),StateManager}(AltaiCore.AltaiDataService);AltaiPageBuilder.StateManager=StateManager}(AltaiPageBuilder||(AltaiPageBuilder={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiPageBuilder;!function(AltaiPageBuilder){var StateViewManager=function(_super){function StateViewManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/stateView","stateView",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(StateViewManager,_super),StateViewManager}(AltaiCore.AltaiDataService);AltaiPageBuilder.StateViewManager=StateViewManager}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var AltaiEditModeService=function(){function AltaiEditModeService($rootScope,$compile,buildingBlockManager,buildingBlockType){this.modes={editMode:!1,popupOpened:!1,popupMainMenu:!0,buildingBlockUpdate:!1},this.$rootScope=$rootScope,this.$compile=$compile,this.buildingBlockManager=buildingBlockManager,this.buildingBlockType=buildingBlockType}return AltaiEditModeService.prototype.toggleEditMode=function(){this.modes.editMode=!this.modes.editMode,this.$rootScope.$broadcast("editModeChanged")},AltaiEditModeService.prototype.createBuildingBlock=function(bbTypeName,properties,instanceId){var s=this,$scope=angular.element(s.activeDropLocation.parent()).scope(),bbType=s.buildingBlockType.get(bbTypeName);s.buildingBlockManager.createBuildingBlock({panelId:s.activePanelId,zone:s.activeZone,buildingBlockType:{name:bbType.name,directive:bbType.directive},instanceId:instanceId,properties:properties}).then(function(resultBuildingBlock){s.buildingBlockManager.loadBuildingBlock(resultBuildingBlock.id).then(function(bbHtml){s.activeDropLocation.before(s.$compile(bbHtml)($scope)),s.modes.popupOpened=!0,s.modes.popupMainMenu=!0})})},AltaiEditModeService.prototype.getModes=function(){return this.modes},AltaiEditModeService}();AltaiPageBuilder.AltaiEditModeService=AltaiEditModeService}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var PageVisitLogger=function(){function PageVisitLogger($http,$location){this.$http=$http,this.$location=$location}return PageVisitLogger.prototype.logPageVisit=function(fromState,toState){var request={url:this.$location.path()};this.$http.post("api/pagevisit",request)},PageVisitLogger}();AltaiPageBuilder.PageVisitLogger=PageVisitLogger}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var PageBuilderWindows=function(){function PageBuilderWindows(){}return PageBuilderWindows}();PageBuilderWindows.stateList=new AltaiWindowManager.wmWindowType("stateList","<altai-state-list></altai-state-list>",600,900,1600),PageBuilderWindows.stateProfile=new AltaiWindowManager.wmWindowType("stateProfile","<altai-state-profile state-id='vm.window.entityId'></altai-state-profile>"),PageBuilderWindows.stateCreate=new AltaiWindowManager.wmWindowType("stateCreate","<altai-state-create></altai-state-create>"),AltaiPageBuilder.PageBuilderWindows=PageBuilderWindows}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var State=function(){function State(){}return State}();AltaiPageBuilder.State=State}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var StateView=function(){function StateView(){}return StateView}();AltaiPageBuilder.StateView=StateView}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var Panel=function(){function Panel(){}return Panel}();AltaiPageBuilder.Panel=Panel;var BuildingBlock=function(){function BuildingBlock(){}return BuildingBlock}();AltaiPageBuilder.BuildingBlock=BuildingBlock;var BuildingBlockType=function(){function BuildingBlockType(){}return BuildingBlockType}();AltaiPageBuilder.BuildingBlockType=BuildingBlockType}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiPageBuilder;!function(AltaiPageBuilder){var mod=angular.module("altai.pagebuilder",["altai.core","altai.identity","altai.templates"]);mod.service("buildingBlockManager",AltaiPageBuilder.BuildingBlockManager),mod.service("menuManager",AltaiPageBuilder.MenuManager),mod.service("panelManager",AltaiPageBuilder.PanelManager),mod.service("stateManager",AltaiPageBuilder.StateManager),mod.service("stateViewManager",AltaiPageBuilder.StateViewManager),mod.service("altaiEditModeService",AltaiPageBuilder.AltaiEditModeService),mod.service("pageVisitLogger",AltaiPageBuilder.PageVisitLogger),mod.provider("altaiRouter",AltaiPageBuilder.AltaiRouterProvider),mod.provider("buildingBlockType",AltaiPageBuilder.BuildingBlockTypeProvider),mod.provider("altaiState",AltaiPageBuilder.AltaiStateProvider),mod.directive("altaiBB",AltaiPageBuilder.AltaiBbDirective),mod.directive("altaiHtml",AltaiPageBuilder.AltaiHtmlDirective),mod.directive("altaiPanel",AltaiPageBuilder.AltaiPanelDirective),mod.directive("cmsSidebar",AltaiPageBuilder.CmsSidebarDirective),mod.directive("altaiMenu",AltaiPageBuilder.MenuDirective),mod.directive("altaiPanelDrop",AltaiPageBuilder.PanelDropDirective),mod.directive("altaiStateList",AltaiPageBuilder.StateListDirective),mod.directive("altaiStateProfile",AltaiPageBuilder.StateProfileDirective),mod.directive("altaiStateCreate",AltaiPageBuilder.StateCreateDirective),mod.directive("altaiCreateBuildingBlockPopup",AltaiPageBuilder.AltaiCreateBuildingBlockPopupDirective),mod.directive("altaiUpdateBuildingBlockPopup",AltaiPageBuilder.AltaiUpdateBuildingBlockPopupDirective),mod.component("altaiPanelBuildingBlockCreator",new AltaiPageBuilder.AltaiPanelBuildingBlockCreatorComponent),mod.component("altaiBuildingBlockAdmin",new AltaiPageBuilder.AltaiBuildingBlockAdminComponent),mod.component("altaiPanelCreateBuildingBlock",new AltaiPageBuilder.AltaiPanelCreateBuildingBlockComponent),mod.component("altaiPanelBuildingBlockUpdate",new AltaiPageBuilder.AltaiPanelBuildingBlockUpdateComponent),mod.config(function($stateProvider,$sceProvider,$urlRouterProvider,buildingBlockTypeProvider,altaiRouterProvider,$locationProvider,altaiAdminMenuProvider){altaiRouterProvider.loadRoutes(),$stateProvider.state("admin.state",{url:"/state",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiPageBuilder.StateListController}}}).state("admin.state.create",{url:"/create",secured:!0,system:!0,views:{"adminContentView@admin":{altaiTemplate:"stateCreate",altaiTemplateType:"Admin"}}}).state("admin.state.update",{url:"/:id",system:!0,resolve:{panelsList:function(panelManager){return panelManager.list()}},views:{"adminContentView@admin":{altaiTemplate:"stateUpdate",altaiTemplateType:"Admin",controller:AltaiPageBuilder.StateUpdateController}}}),$stateProvider.state("admin.panel",{url:"/panel",system:!0,"abstract":!0}).state("admin.panel.edit",{url:"/:id",system:!0,views:{"adminContentView@admin":{altaiTemplate:"panelUpdate",altaiTemplateType:"Admin",controller:AltaiPageBuilder.PanelUpdateController}},resolve:{panelData:function(panelManager,$stateParams){return panelManager.getById($stateParams.id)}}}),$stateProvider.state("admin.menu",{url:"/menu","abstract":!0}),$stateProvider.state("admin.menu.list",{url:"/list",views:{"adminContentView@admin":{altaiTemplate:"menuList",altaiTemplateType:"Admin",controller:AltaiPageBuilder.MenuListController,controllerAs:"vm"}},resolve:{menuData:function(menuManager){return menuManager.list()}}}),$stateProvider.state("admin.menu.detail",{url:"/:id",views:{"adminContentView@admin":{altaiTemplate:"menuUpdate",altaiTemplateType:"Admin",controller:AltaiPageBuilder.MenuUpdateController}}}),altaiAdminMenuProvider.add({name:"site",order:2,label:"site",icon:"mdi mdi-sitemap menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"site",name:"site.pages",securable:"config.pagemanagement",label:"pages",icon:"mdi mdi-menu menuicon",state:"admin.state"}),altaiAdminMenuProvider.add({parent:"site",name:"site.menus",securable:"menu.list",label:"menus",icon:"mdi mdi-sitemap menuicon",state:"admin.site.menus"}),buildingBlockTypeProvider.add({name:"Panel",directive:"altai-panel",label:"Panel",icon:"mdi-drawing-box",updateComponent:"<altai-panel-building-block-update building-block-id='activeBuildingBlockId' panel-id='activeBuildingBlockInstanceId'></altai-panel-building-block-update>",createComponent:"<altai-panel-create-building-block></altai-panel-create-building-block>"})}),mod.run(function($rootScope,$state,$stateParams,$location,pageVisitLogger,$document,authService,insightsservice){$rootScope.mode="view",$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){if(void 0!=$rootScope.previousState&&void 0!=$rootScope.previousParams&&($document[0].body.scrollTop=$document[0].documentElement.scrollTop=0),$rootScope.previousState=from,$rootScope.previousParams=fromParams,!to.system&&void 0!=to.name&&"admin"!=to.name.substring(0,5)){var log={};void 0!=$location.absUrl()&&(log.absurl=$location.absUrl()),void 0!=$location.url()&&(log.url=$location.url()),void 0!=$location.protocol()&&(log.protocol=$location.protocol()),void 0!=$location.host()&&(log.host=$location.host()),void 0!=$location.port()&&(log.port=$location.port()),void 0!=$location.path()&&(log.path=$location.path()),void 0!=$location.search()&&(log.search=JSON.stringify($location.search())),void 0!=$location.hash()&&(log.hash=$location.hash()),void 0!=from&&(log.fromname=from.name,log.fromtitle=from.title,log.fromurl=from.url),void 0!=fromParams&&(log.fromparams=JSON.stringify(fromParams)),insightsservice.registerEventTrack("pageview",log)}to.title&&(toParams.name?document.title=toParams.name.replace(/-/g," "):document.title=to.title),$rootScope.currentURLBase=location.origin,$rootScope.currentURLAbsoluteClean=$location.absUrl().split("?")[0],$rootScope.currentURLAbsoluteWithVariables=$location.absUrl(),$rootScope.currentURLRelativeClean=$location.url().split("?")[0],$rootScope.currentURLRelativeWithVariables=$location.url()})}),config.modules.push("altai.pagebuilder")}(AltaiPageBuilder||(AltaiPageBuilder={}));var AltaiContent;!function(AltaiContent){function GetlinkDirective(contentTypeService,$state){return{scope:{contentItemId:"@",contentTypeId:"@",theme:"@",name:"@"},link:function(scope,element){element.bind("click",function(){scope.name&&(scope.name=scope.name.substring(0,100).replace(/Â|À|Å|Ã/g,"A").replace(/â|à|å|ã/g,"a").replace(/Ä/g,"AE").replace(/ä/g,"ae").replace(/Ç/g,"C").replace(/ç/g,"c").replace(/É|Ê|È|Ë/g,"E").replace(/é|ê|è|ë/g,"e").replace(/Ó|Ô|Ò|Õ|Ø/g,"O").replace(/ó|ô|ò|õ/g,"o").replace(/Ö/g,"OE").replace(/ö/g,"oe").replace(/Š/g,"S").replace(/š/g,"s").replace(/ß/g,"ss").replace(/Ú|Û|Ù/g,"U").replace(/ú|û|ù/g,"u").replace(/Ü/g,"UE").replace(/ü/g,"ue").replace(/Ý|Ÿ/g,"Y").replace(/ý|ÿ/g,"y").replace(/Ž/g,"Z").replace(/ž/,"z").replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,"")),
contentTypeService.getLinkedState(scope.contentTypeId).then(function(stateName){stateName&&(void 0!=scope.theme?scope.name?$state.go(stateName,{id:scope.contentItemId,theme:scope.theme,name:scope.name},{reload:!0}):$state.go(stateName,{id:scope.contentItemId,theme:scope.theme},{reload:!0}):scope.name?$state.go(stateName,{id:scope.contentItemId,name:scope.name}):$state.go(stateName,{id:scope.contentItemId}))})})}}}AltaiContent.GetlinkDirective=GetlinkDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function clickOutside(){return{link:clickOutsideLink,scope:{clickOutsideToggle:"="}}}AltaiContent.clickOutside=clickOutside;var clickOutsideLink=function(){function clickOutsideLink(scope,element,attributes){this.firstClick=!0;var vm=this;angular.element(window.document).unbind("click").bind("click",function(r){vm.firstClick?vm.firstClick=!1:(console.log(1),element[0].contains(r.target)||("undefined"!=scope.clickOutsideToggle?(console.log(scope.clickOutsideToggle),scope.clickOutsideToggle=!scope.clickOutsideToggle,vm.firstClick=!0,scope.$apply()):element.css("display","none")))})}return clickOutsideLink}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function altaiLink(){return{restrict:"AE",scope:{text:"@",contentItemTarget:"@",contentTypeId:"@"},bindToController:!0,controllerAs:"$ctrl",controller:altaiLinkController,template:"<a ng-click='$ctrl.openState()' class='altai-link'>{{$ctrl.text}}</a> "}}AltaiContent.altaiLink=altaiLink;var altaiLinkController=function(){function altaiLinkController(contentTypeService,$state,wmContainerFactory){this.contentTypeService=contentTypeService,this.$state=$state,this.wmContainerFactory=wmContainerFactory;var s=this;contentTypeService.getLinkedState(s.contentTypeId).then(function(stateName){s.state=stateName})}return altaiLinkController.prototype.openState=function(){var ctrl=this;0===ctrl.$state.current.name.indexOf("admin")?ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,"Preview",ctrl.contentItemTarget):this.state&&this.$state.go(this.state,{id:this.contentItemTarget})},altaiLinkController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentCollectionUpdateRelation=function(){function AltaiContentCollectionUpdateRelation(){this.bindings={contentCollectionId:"<",outputModel:"=",isDisabled:"<",multiple:"<",required:"<",inputModel:"<",editMode:"<",createMode:"<"},this.controller=AltaiContentCollectionUpdateRelationController,this.template="<div ng-include='$ctrl.templateContentCollection'></div>"}return AltaiContentCollectionUpdateRelation}();AltaiContent.AltaiContentCollectionUpdateRelation=AltaiContentCollectionUpdateRelation;var AltaiContentCollectionUpdateRelationController=function(){function AltaiContentCollectionUpdateRelationController(contentCollectionManager,contentCollectionDataService,$scope){this.contentCollectionManager=contentCollectionManager,this.contentCollectionDataService=contentCollectionDataService,this.$scope=$scope,this.contentCollectionId&&this.loadContentCollectionData(this.contentCollectionId),void 0==this.noDefaultNotApplicableButton&&(this.noDefaultNotApplicableButton=!1);var s=this,stopWatch=this.$scope.$watchCollection("$ctrl.inputModel",function(newv){if(newv&&newv.length>0){var tempModel=[];newv.filter(function(val){return val.ticked}).map(function(val){tempModel.push(val)}),tempModel.length?(s.outputModel=angular.copy(tempModel),stopWatch(),s.preParsingDone=!0):s.inputModel.length&&0==tempModel.length&&(s.preParsingDone=!0)}})}return AltaiContentCollectionUpdateRelationController.prototype.loadContentCollectionData=function(contentCollectionId){var vm=this;this.contentCollectionManager.getById(contentCollectionId).then(function(collectionData){collectionData.templateId&&(vm.templateContentCollection="/api/template/"+collectionData.templateId)}),this.contentCollectionDataService.getData(contentCollectionId).then(function(data){vm.data=data})},AltaiContentCollectionUpdateRelationController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentCollectionCreateBuildingBlockComponent=function(){function AltaiContentCollectionCreateBuildingBlockComponent(){this.controller=AltaiContentCollectionCreateBuildingBlockComponentController,this.templateUrl="/api/template/Admin/altaicontentcollectioncreatebuildingblockcomponent"}return AltaiContentCollectionCreateBuildingBlockComponent}();AltaiContent.AltaiContentCollectionCreateBuildingBlockComponent=AltaiContentCollectionCreateBuildingBlockComponent;var AltaiContentCollectionCreateBuildingBlockComponentController=function(){function AltaiContentCollectionCreateBuildingBlockComponentController($scope,contentCollectionManager,$templateFactory,altaiEditModeService){var c=this;c.altaiEditModeService=altaiEditModeService,contentCollectionManager.list().then(function(collections){c.contentCollections=collections}),$templateFactory.listTemplateByTypeName("content").then(function(templateList){c.contentTemplates=templateList})}return AltaiContentCollectionCreateBuildingBlockComponentController.prototype.createBuildingBlock=function(){var vm=this;this.altaiEditModeService.createBuildingBlock("ContentCollection",{contentCollectionId:vm.selectedContentCollection.id,templateId:vm.selectedContentTemplate.id})},AltaiContentCollectionCreateBuildingBlockComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentCollectionComponent=function(){function AltaiContentCollectionComponent(){this.controller=AltaiContentCollectionComponentController,this.bindings={contentCollectionId:"@"},this.templateUrl=function($attrs){return"/api/template/"+$attrs.templateId}}return AltaiContentCollectionComponent}();AltaiContent.AltaiContentCollectionComponent=AltaiContentCollectionComponent;var AltaiContentCollectionComponentController=function(){function AltaiContentCollectionComponentController($stateParams,$scope,contentCollectionDataService,urlSerialization,altaiLocalizationService,$rootScope){this.altaiLocalizationService=altaiLocalizationService,this.loading=!0,this.filterValues={};var c=this;$scope.vm=this,this.contentCollectionDataService=contentCollectionDataService,this.urlSerialization=urlSerialization,$stateParams.id&&(this.filterValues.id=$stateParams.id),c.getData(),$scope.$watch("$ctrl.filterValues",function(newValue,oldValue){newValue!=oldValue&&c.getData()},!0),$rootScope.$on("languageChanged",function(){c.getData()})}return AltaiContentCollectionComponentController.prototype.getData=function(){var c=this,urlParams=c.urlSerialization(c.filterValues);c.activeLang={code:c.altaiLocalizationService.getCurrentLangCode()},c.contentCollectionDataService.getData(c.contentCollectionId,urlParams).then(function(data){c.data=data,1==c.data.totalCount&&(c.item=c.data.pageResults[0]),c.loading=!0},function(error){c.loading=!1})},AltaiContentCollectionComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentSearchCreateBuildingBlockComponent=function(){function AltaiContentSearchCreateBuildingBlockComponent(){this.controller=AltaiContentSearchCreateBuildingBlockComponentController,this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionBuildingBlockCreate"}return AltaiContentSearchCreateBuildingBlockComponent}();AltaiContent.AltaiContentSearchCreateBuildingBlockComponent=AltaiContentSearchCreateBuildingBlockComponent;var AltaiContentSearchCreateBuildingBlockComponentController=function(){function AltaiContentSearchCreateBuildingBlockComponentController(exposedContentCollectionManager,$templateFactory,altaiEditModeService){this.exposedContentCollectionManager=exposedContentCollectionManager,this.altaiEditModeService=altaiEditModeService;var c=this;exposedContentCollectionManager.list().then(function(exposedContentCollections){c.exposedContentCollections=exposedContentCollections}),$templateFactory.listTemplateByTypeName("exposedContentCollection").then(function(templateList){c.contentTemplates=templateList})}return AltaiContentSearchCreateBuildingBlockComponentController.prototype.createBuildingBlock=function(){var vm=this,properties={exposedContentCollectionId:vm.selectedExposedContentCollection.id};vm.selectedContentTemplate&&vm.selectedContentTemplate.id&&(properties.templateId=vm.selectedContentTemplate.id),this.altaiEditModeService.createBuildingBlock("ExposedContentCollection",properties)},AltaiContentSearchCreateBuildingBlockComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentSearchClientSideCreateBuildingBlockComponent=function(){function AltaiContentSearchClientSideCreateBuildingBlockComponent(){this.controller=AltaiContentSearchClientSideCreateBuildingBlockComponentController,this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionClientSideBuildingBlockCreate"}return AltaiContentSearchClientSideCreateBuildingBlockComponent}();AltaiContent.AltaiContentSearchClientSideCreateBuildingBlockComponent=AltaiContentSearchClientSideCreateBuildingBlockComponent;var AltaiContentSearchClientSideCreateBuildingBlockComponentController=function(){function AltaiContentSearchClientSideCreateBuildingBlockComponentController(exposedContentCollectionManager,$templateFactory,altaiEditModeService){this.exposedContentCollectionManager=exposedContentCollectionManager,this.altaiEditModeService=altaiEditModeService;var c=this;exposedContentCollectionManager.list().then(function(exposedContentCollections){c.exposedContentCollections=exposedContentCollections}),$templateFactory.listTemplateByTypeName("exposedContentCollection").then(function(templateList){c.contentTemplates=templateList})}return AltaiContentSearchClientSideCreateBuildingBlockComponentController.prototype.createBuildingBlock=function(){var vm=this,properties={exposedContentCollectionId:vm.selectedExposedContentCollection.id};vm.selectedContentTemplate&&vm.selectedContentTemplate.id&&(properties.templateId=vm.selectedContentTemplate.id),this.altaiEditModeService.createBuildingBlock("ExposedContentCollectionClientSide",properties)},AltaiContentSearchClientSideCreateBuildingBlockComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentSearchComponent=function(){function AltaiContentSearchComponent(){this.controller=AltaiContentSearchComponentController,this.templateUrl=function($attrs){return"/api/template/"+$attrs.templateId},this.controllerAs="vm",this.bindings={exposedContentCollectionId:"=",selection:"="}}return AltaiContentSearchComponent}();AltaiContent.AltaiContentSearchComponent=AltaiContentSearchComponent;var AltaiContentSearchComponentController=function(){function AltaiContentSearchComponentController($scope,$http,$timeout,moment,suTimeNeutralDateCompareFilter,exposedContentCollectionQueryManager,altaiLocalizationService,exposedContentCollectionManager,altaiJsonFormattingService){this.$scope=$scope,this.$http=$http,this.moment=moment,this.exposedContentCollectionQueryManager=exposedContentCollectionQueryManager,this.altaiLocalizationService=altaiLocalizationService,this.exposedContentCollectionManager=exposedContentCollectionManager,this.altaiJsonFormattingService=altaiJsonFormattingService,this.loading=!0,this.exposedContentCollectionId||(this.exposedContentCollectionId=-1),this.suTimeNeutralDateCompareFilter=suTimeNeutralDateCompareFilter;var timeout,c=this;c.today=new Date,c.potentialDate,this.init();for(var i=0;i<c.filters.length;i++)"range"==c.filters[i].FilterType&&("date"==c.filters[i].Values.name&&$scope.$watch("vm.filters["+i+"].Values.date",function(){timeout&&$timeout.cancel(timeout),timeout=$timeout(function(){c.fetch(c.page)},250)},!0),"term"==c.filters[i].Values.name&&$scope.$watch("vm.filters["+i+"].Values",function(){timeout&&$timeout.cancel(timeout),timeout=$timeout(function(){c.fetch(c.page)},250)},!0));$scope.$watchGroup(["vm.search","vm.pageSize","vm.page","vm.datePicker.date"],function(){timeout&&$timeout.cancel(timeout),timeout=$timeout(function(){c.fetch(c.page)},250)}),$scope.fetch=function(){c.fetch(1)}}return AltaiContentSearchComponentController.prototype.init=function(){var s=this;s.page=1,s.types=[],s.filters=[],s.fixedfilters=[],s.order=[];var fixedfiltersonly=!1,filters=s.exposedContentCollectionQueryManager.getFilters(s.exposedContentCollectionId),query=s.exposedContentCollectionQueryManager.getQuery(s.exposedContentCollectionId);null!=query&&(s.search=query),null!=filters&&(s.filters=filters,fixedfiltersonly=!0),s.exposedContentCollectionManager.getById(s.exposedContentCollectionId).then(function(exposedContentCollection){s.exposedContentCollection=exposedContentCollection;for(var i=0;i<s.exposedContentCollection.exposedContentCollectionTypes.length;i++)s.types.push({Name:s.exposedContentCollection.exposedContentCollectionTypes[i].contentType.label,Type:s.exposedContentCollection.exposedContentCollectionTypes[i].contentType.name,Value:s.exposedContentCollection.exposedContentCollectionTypes[i].contentTypeId,Field:"ContentTypeId",selected:!1});for(var i=0;i<s.exposedContentCollection.exposedContentCollectionFilters.length;i++)if("contenttype"!=s.exposedContentCollection.exposedContentCollectionFilters[i].filterType){for(var filter={Name:s.exposedContentCollection.exposedContentCollectionFilters[i].label,FilterType:s.exposedContentCollection.exposedContentCollectionFilters[i].filterType,Type:s.exposedContentCollection.exposedContentCollectionFilters[i].type,Field:s.exposedContentCollection.exposedContentCollectionFilters[i].field,Nested:s.exposedContentCollection.exposedContentCollectionFilters[i].nested,Values:[]},j=0;j<s.exposedContentCollection.exposedContentCollectionFilters[i].exposedContentCollectionFilterSelectedValues.length;j++)filter.Values.push({Value:s.exposedContentCollection.exposedContentCollectionFilters[i].exposedContentCollectionFilterSelectedValues[j].valueId,selected:!0});s.exposedContentCollection.exposedContentCollectionFilters[i].fixed?s.fixedfilters.push(filter):fixedfiltersonly||s.filters.push(filter)}else{for(var contentfilter={Name:s.exposedContentCollection.exposedContentCollectionFilters[i].label,FilterType:s.exposedContentCollection.exposedContentCollectionFilters[i].filterType,Type:"ContentType",Field:s.exposedContentCollection.exposedContentCollectionFilters[i].field,Nested:s.exposedContentCollection.exposedContentCollectionFilters[i].nested,Values:angular.copy(s.types)},j=0;j<s.exposedContentCollection.exposedContentCollectionFilters[i].exposedContentCollectionFilterSelectedValues.length;j++)contentfilter.Values.push({Value:s.exposedContentCollection.exposedContentCollectionFilters[i].exposedContentCollectionFilterSelectedValues[j].valueId,selected:!0});s.exposedContentCollection.exposedContentCollectionFilters[i].fixed?s.fixedfilters.push(contentfilter):fixedfiltersonly||s.filters.push(contentfilter)}for(var i=0;i<s.exposedContentCollection.exposedContentCollectionSorters.length;i++)s.order.push({Field:s.exposedContentCollection.exposedContentCollectionSorters[i].field,Asc:s.exposedContentCollection.exposedContentCollectionSorters[i].ascending});s.pageSize=s.exposedContentCollection.pageSize,s.$http.post("/api/elasticsearch/search",{searchCriteria:[],Types:s.filters.map(function(a){return a.Type}),SearchOptions:"",Take:1e3,Page:0,Languages:[s.altaiLocalizationService.getCurrentLangCode()],Range:[],Filters:[]}).then(function(response){response.data.results.sort(function(a,b){return a.Name<b.Name?-1:a.Name>b.Name?1:0});for(var i=0;i<response.data.results.length;i++)for(var j=0;j<s.filters.length;j++)if("ContentType"!=s.filters[j].Type&&"range"!=s.filters[j].Type){if(response.data.results[i].ContentType==s.filters[j].Type){var index=s.indexOf(response.data.results[i].Id,s.filters[j].Values);index>=0?(s.filters[j].Values[index].Name=response.data.results[i][s.filters[j].Field],s.filters[j].Values[index].Field=s.filters[j].Type+".Id",s.filters[j].Values[index].count=0,s.filters[j].Values[index].child=!1):s.filters[j].Values.push({Name:response.data.results[i][s.filters[j].Field],Field:s.filters[j].Type+".Id",Value:response.data.results[i].Id,count:0,child:!1,selected:!1})}if(s.filters[j].Type+"_"+s.filters[j].Type in response.data.results[i]){response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type].sort(function(a,b){return a.Name<b.Name?-1:a.Name>b.Name?1:0});for(var k=0;k<response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type].length;k++){var index=s.indexOf(response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type][k].Id,s.filters[j].Values);index>=0?(s.filters[j].Values[index].Name=response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type][k].Name,s.filters[j].Values[index].Field=s.filters[j].Type+".Id",s.filters[j].Values[index].count=0,s.filters[j].Values[index].child=!0):s.filters[j].Values.push({Name:response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type][k].Name,Field:s.filters[j].Type+".Id",Value:response.data.results[i][s.filters[j].Type+"_"+s.filters[j].Type][k].Id,count:0,child:!0,selected:!1})}}}})})},AltaiContentSearchComponentController.prototype.fetch=function(page){var c=this;if(null==page&&(page=1),!(c.types.length<1)){c.exposedContentCollectionQueryManager.setQuery(c.exposedContentCollectionId,c.search,c.filters,{field:"",asc:!0});for(var selectedFilters=new Array,selectedRanges=new Array,i=0;i<c.filters.length;i++){var k=selectedFilters.length;if(selectedFilters[k]=new Array,selectedFilters[k].nested=c.filters[i].Nested,"relation"==c.filters[i].FilterType||"contenttype"==c.filters[i].FilterType)for(var j=0;j<c.filters[i].Values.length;j++)c.filters[i].Values[j].selected&&selectedFilters[k].push({field:c.filters[i].Values[j].Field,value:c.filters[i].Values[j].Value});else"range"==c.filters[i].FilterType&&("date"==c.filters[i].Type&&void 0!=c.filters[i].Values.startValue&&(void 0==c.filters[i].Values.endValue&&(c.filters[i].Values.endValue=c.moment(c.filters[i].Values.startValue).endOf("day").toDate()),selectedRanges.push({selected:c.filters[i].Values.selected,startValue:c.filters[i].Values.startValue,endValue:c.filters[i].Values.endValue,type:c.filters[i].Type,field:c.filters[i].Field})),"term"==c.filters[i].Type&&selectedRanges.push({selected:c.filters[i].Values.selected,startValue:c.filters[i].Values.startValue,endValue:c.filters[i].Values.endValue,type:c.filters[i].Type,field:c.filters[i].Field}))}for(var i=0;i<c.fixedfilters.length;i++){var k=selectedFilters.length;if(selectedFilters[k]=new Array,"relation"==c.fixedfilters[i].FilterType||"contenttype"==c.fixedfilters[i].FilterType)for(var j=0;j<c.fixedfilters[i].Values.length;j++)c.fixedfilters[i].Values[j].selected&&(selectedFilters[k].push({field:c.fixedfilters[i].Type+".Id",value:c.fixedfilters[i].Values[j].Value}),selectedFilters[k].nested=c.fixedfilters[i].Nested)}for(var searchOptions=new Array,i=0;i<selectedFilters.length;i++)0!=selectedFilters[i].length&&searchOptions.push({searchOptions:selectedFilters[i],nested:selectedFilters[i].nested});for(var filteraggregations=new Array,i=0;i<c.filters.length;i++)switch(c.filters[i].FilterType){case"relation":filteraggregations.push(c.filters[i].Type);break;case"contenttype":for(var j=0;j<c.filters[i].Values.length;j++)filteraggregations.push(c.filters[i].Values[j].Value)}c.$http.post("/api/elasticsearch/search",{searchCriteria:[{Query:c.search}],Types:c.types.map(function(a){return a.Type}),SearchOptions:searchOptions,Take:c.pageSize,Page:page-1,Languages:[c.altaiLocalizationService.getCurrentLangCode()],Ranges:selectedRanges,Filters:filteraggregations,sort:c.order}).then(function(response){delete c.results,c.results=angular.copy(response.data.results),c.data=response.data;for(var j=0;j<c.filters.length;j++)if("relation"==c.filters[j].FilterType||"contenttype"==c.filters[j].FilterType){for(var i=0;i<c.filters[j].Values.length;i++)c.filters[j].Values[i].count=0;if("contenttype"==c.filters[j].FilterType)for(var k=0;k<response.data.aggregations[c.LowerFirstLetter(c.filters[j].Type)].aggregations.type.items.length;k++){var index=c.indexOf(response.data.aggregations[c.LowerFirstLetter(c.filters[j].Type)].aggregations.type.items[k].key,c.filters[j].Values);index>=0&&(c.filters[j].Values[index].count+=response.data.aggregations[c.LowerFirstLetter(c.filters[j].Type)].aggregations.type.items[k].docCount)}}for(var i=0;i<c.types.length;i++)for(var j=0;j<c.filters.length;j++)if("relation"==c.filters[j].FilterType&&response.data.aggregations[c.filters[j].Type].aggregations[c.types[i].Type+"_"+c.filters[j].Type])for(var k=0;k<response.data.aggregations[c.filters[j].Type].aggregations[c.types[i].Type+"_"+c.filters[j].Type].items.length;k++){var index=c.indexOf(response.data.aggregations[c.filters[j].Type].aggregations[c.types[i].Type+"_"+c.filters[j].Type].items[k].key,c.filters[j].Values);index>=0&&(c.filters[j].Values[index].count+=response.data.aggregations[c.filters[j].Type].aggregations[c.types[i].Type+"_"+c.filters[j].Type].items[k].docCount)}})}},AltaiContentSearchComponentController.prototype.indexOf=function(key,items){var i=0,len=items.length;for(i=0;len>i;i++)if(key==items[i].Value)return i;return-1},AltaiContentSearchComponentController.prototype.selectarray=function(array,value){for(var i=0;i<array.length;i++)(array[i].count>0||0==value)&&(array[i].selected=value);return array},AltaiContentSearchComponentController.prototype.removeallfilters=function(array){for(var i=0;i<array.length;i++)if("range"!=array[i].FilterType)for(var j=0;j<array[i].Values.length;j++)array[i].Values[j].selected=!1;else array[i].Values.selected=!1,array[i].Values.startValue=void 0,array[i].Values.endValue=void 0;return array},AltaiContentSearchComponentController.prototype.getSelected=function(array){for(var total=0,i=0;i<array.length;i++)if("range"!=array[i].FilterType)for(var j=0;j<array[i].Values.length;j++)array[i].Values[j].selected&&(total+=1);else array[i].Values.selected&&(total+=1);return total},AltaiContentSearchComponentController.prototype.LowerFirstLetter=function(string){return string.charAt(0).toLowerCase()+string.slice(1)},AltaiContentSearchComponentController.prototype.getTotalCount=function(array){for(var count=0,i=0;i<array.length;i++)count+=array[i].count;return count},AltaiContentSearchComponentController.prototype.toggledropdown=function(element){$(element.target).closest(".dropdown").toggleClass("open")},AltaiContentSearchComponentController.prototype.isDateDisabled=function(date){return!1},AltaiContentSearchComponentController.prototype.onDateSelect=function(date,filter){var c=this;if(angular.isDate(date))if(filter.startValue&&filter.endValue&&(filter.startValue=void 0,filter.endValue=void 0,filter.selected=!1),filter.startValue){var comparisonResult=c.suTimeNeutralDateCompareFilter(filter.startValue,date);0===comparisonResult?filter.endValue=c.moment(date).endOf("day").toDate():-1===comparisonResult?filter.endValue=c.moment(date).endOf("day").toDate():(filter.endValue=c.moment(filter.startValue).endOf("day").toDate(),filter.startValue=c.moment(date).startOf("day").toDate())}else filter.startValue=c.moment(date).startOf("day").toDate(),filter.selected=!1},AltaiContentSearchComponentController.prototype.setPotentialDate=function(date,filter){var c=this;angular.isDate(date)&&(filter.potentialDate=date,c.$scope.$apply())},AltaiContentSearchComponentController.prototype.clearPotentialDate=function(date,filter){var c=this;filter.potentialDate=void 0,c.$scope.$apply()},AltaiContentSearchComponentController.prototype.getDateClass=function(date,filter){var c=this,classes=[];if(date&&angular.isDefined(filter.startValue))if(0===c.suTimeNeutralDateCompareFilter(date,filter.startValue)&&classes.push("start-date"),angular.isDefined(filter.endValue))0===c.suTimeNeutralDateCompareFilter(date,filter.endValue)&&classes.push("end-date"),c.dateInRange(date,filter.startValue,filter.endValue)&&classes.push("selected-range");else if(angular.isDefined(filter.potentialDate)){var start=c.suTimeNeutralDateCompareFilter(filter.potentialDate,filter.startValue)<=0?filter.potentialDate:filter.startValue,end=c.suTimeNeutralDateCompareFilter(filter.potentialDate,filter.startValue)<=0?filter.startValue:filter.potentialDate;c.dateInRange(date,start,end)&&classes.push("potential-range")}return classes.join(" ")},AltaiContentSearchComponentController.prototype.disableNextMonth=function(currentDate){var c=this;if(angular.isDate(currentDate)){var nextYear=c.today.getFullYear()+1;if(currentDate.getFullYear()>nextYear)return!0;if(currentDate.getFullYear()===nextYear&&currentDate.getMonth()>=c.today.getMonth())return!0}return!1},AltaiContentSearchComponentController.prototype.setdate=function(startdate,enddate,filter){var c=this;void 0==startdate||void 0==enddate?(filter.startValue=void 0,filter.endValue=void 0,filter.calendarDate=c.moment().subtract(1,"months").toDate(),filter.selected=!1):(filter.calendarDate=c.moment(enddate).subtract(1,"months").toDate(),filter.startValue=startdate.toDate(),filter.endValue=enddate.toDate())},AltaiContentSearchComponentController.prototype.copyDateOnly=function(date){return angular.isDate(date)?new Date(date.getFullYear(),date.getMonth(),date.getDate()):void 0},AltaiContentSearchComponentController.prototype.dateInRange=function(date,start,end){var c=this;return c.suTimeNeutralDateCompareFilter(date,start)>=0&&c.suTimeNeutralDateCompareFilter(date,end)<=0},AltaiContentSearchComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentFormComponent=function(){function AltaiContentFormComponent(){this.controller=AltaiContentFormComponentController,this.transclude=!0,this.template="<div ng-transclude></div>"}return AltaiContentFormComponent}();AltaiContent.AltaiContentFormComponent=AltaiContentFormComponent;var AltaiContentFormComponentController=function(){function AltaiContentFormComponentController(contentFormManager,buildingBlockManager){this.contentFormManager=contentFormManager,this.buildingBlockManager=buildingBlockManager,this.loading=!1,this.loadForm()}return AltaiContentFormComponentController.prototype.submitForm=function(){alert("ok!");var ctrl=this;ctrl.loading=!0,ctrl.contentFormManager.submitContentForm(ctrl.formData).then(function(){ctrl.loading=!1},function(){ctrl.loading=!1})},AltaiContentFormComponentController.prototype.loadForm=function(){var vm=this;this.buildingBlockId&&this.contentFormManager.getById(this.altaiBbInstanceId).then(function(result){vm.form=result})},AltaiContentFormComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var altaiContentFormCreateBuildingBlock=function(){function altaiContentFormCreateBuildingBlock(){this.controller=altaiContentFormCreateBuildingBlockController,this.controllerAs="vm",this.templateUrl="/api/template/Admin/AltaiContentFormCreateBuildingBlock"}return altaiContentFormCreateBuildingBlock}();AltaiContent.altaiContentFormCreateBuildingBlock=altaiContentFormCreateBuildingBlock;var altaiContentFormCreateBuildingBlockController=function(){function altaiContentFormCreateBuildingBlockController(contentFormManager,altaiEditModeService){this.contentFormManager=contentFormManager,this.altaiEditModeService=altaiEditModeService,this.listContentForms()}return altaiContentFormCreateBuildingBlockController.prototype.listContentForms=function(){var vm=this;this.contentFormManager.list().then(function(result){vm.contentForms=result})},altaiContentFormCreateBuildingBlockController.prototype.createFormBuildingBlock=function(selectedFormId){this.altaiEditModeService.createBuildingBlock("Form",{contentFormId:selectedFormId},selectedFormId)},altaiContentFormCreateBuildingBlockController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiFileSelectButtonComponent=function(){function AltaiFileSelectButtonComponent(){this.controller=AltaiFileSelectButtonComponentController,this.template="<span ng-hide='!$ctrl.contentTypeRelationLink.allowMultiple && $ctrl.model.length' ng-click='$ctrl.openFileManager()'><button type='button' class='icon'><i class='mdi mdi-file'></i></button>&nbsp;{{'choosefile'|translate}}</span><table><tr ng-repeat='file in $ctrl.selection'><td width='1%'><img ng-src='{{$root.staticFileBase}}/{{file.name}}' style='height:30px;' ng-show='file.isImage'></td><td> {{::file.name}} <a ng-click='$ctrl.removeFromSelection(file)'><i class='mdi mdi-delete'></i></a></td></table>",this.bindings={model:"=",inputModel:"<",contentTypeRelationLink:"<"}}return AltaiFileSelectButtonComponent}();AltaiContent.AltaiFileSelectButtonComponent=AltaiFileSelectButtonComponent;var AltaiFileSelectButtonComponentController=function(){function AltaiFileSelectButtonComponentController(wmContainerFactory,altaiFileSelectionService,$scope,$rootScope){this.wmContainerFactory=wmContainerFactory,this.altaiFileSelectionService=altaiFileSelectionService;var ctrl=this;ctrl.fileManagerSelectionkey="rel"+ctrl.contentTypeRelationLink.id,ctrl.altaiFileSelectionService.clearSelection(ctrl.fileManagerSelectionkey),ctrl.selection=altaiFileSelectionService.getSelection(ctrl.fileManagerSelectionkey),altaiFileSelectionService.setMode(ctrl.fileManagerSelectionkey,ctrl.contentTypeRelationLink.allowMultiple),$scope.$watch("$ctrl.selection",function(){ctrl.updateModel()},!0);var updateModelParsed=$scope.$watch("$ctrl.inputModel",function(){ctrl.inputModel&&(ctrl.createInputModel(),updateModelParsed())},!0);$scope.$on(AltaiContent.ContentEvents.contentItemCreated,function(){var fileManagerWin=ctrl.wmContainerFactory.findWindow(AltaiFileManager.FileManagerWindows.selectableFilelist,ctrl.fileManagerSelectionkey);fileManagerWin&&ctrl.wmContainerFactory.destroyWindow(fileManagerWin.id),ctrl.altaiFileSelectionService.clearSelection(ctrl.fileManagerSelectionkey)})}return AltaiFileSelectButtonComponentController.prototype.createInputModel=function(){var ctrl=this;this.inputModel&&this.inputModel.filter(function(file){return file.ticked}).map(function(file){ctrl.selection.push(file)})},AltaiFileSelectButtonComponentController.prototype.openFileManager=function(){this.wmContainerFactory.createWindow(AltaiFileManager.FileManagerWindows.selectableFilelist,this.contentTypeRelationLink.label,"rel"+this.contentTypeRelationLink.id)},AltaiFileSelectButtonComponentController.prototype.removeFromSelection=function(file){this.altaiFileSelectionService.removeFromSelection("rel"+this.contentTypeRelationLink.id,file)},AltaiFileSelectButtonComponentController.prototype.updateModel=function(){if(this.model=[],this.selection)for(var s=0;s<this.selection.length;s++)this.model.push({id:this.selection[s].id})},AltaiFileSelectButtonComponentController}();AltaiContent.AltaiFileSelectButtonComponentController=AltaiFileSelectButtonComponentController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiTagSelector=function(){function AltaiTagSelector(){this.restrict="AE",this.bindings={inputModel:"<",ngModel:"=",multiple:"<",required:"<",editMode:"=",createMode:"<",defaultNotApplicable:"<",noDefaultNotApplicableButton:"<",subRelationName:"@"},this.templateUrl="/api/template/Admin/AltaiTagSelector",this.controller=AltaiTagSelectorComponent}return AltaiTagSelector}();AltaiContent.AltaiTagSelector=AltaiTagSelector;var AltaiTagSelectorComponent=function(){function AltaiTagSelectorComponent($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout,this.everythingIsSelected=!1,this.tagsAreSelected=!1;var s=this;!s.defaultNotApplicable&&!s.editMode||s.createMode?s.disabled=!1:s.disabled=!0,void 0==this.noDefaultNotApplicableButton?this.noDefaultNotApplicableButton=!1:1==this.noDefaultNotApplicableButton&&(s.disabled=!1);var stopwatch=$scope.$watch("$ctrl.inputModel",function(result){result&&result.length>0&&(s.initModels(),s.countSelectableItems(),stopwatch())}),stopmodelwatch=$scope.$watch("$ctrl.ngModel",function(result){
result&&result.length>0&&(s.isDisabled=!1,s.disabled=!1,s.inputModel&&(s.checkAllSelectedTags(),stopmodelwatch()))});this.showSelectAllToggle=this.isEnabled()}return AltaiTagSelectorComponent.prototype.isEnabled=function(){var vm=this;return vm.inputModel&&vm.inputModel.length>0},AltaiTagSelectorComponent.prototype.initModels=function(){!this.ngModel||this.ngModel.length<=0?(this.ngModel=[],this.syncTicked(this.inputModel)):this.ngModel&&this.checkAllSelectedTags(),this.defaultNotApplicable!==!0&&!this.editMode||this.createMode||this.ngModel&&0!=this.ngModel.length||this.noDefaultNotApplicableButton===!0&&(this.isDisabled=!1)},AltaiTagSelectorComponent.prototype.checkAllSelectedTags=function(){if(!this.tagsAreSelected){for(var i=0;i<this.ngModel.length;i++)this.selectExistingTag(this.ngModel[i],this.inputModel);this.tagsAreSelected=!0}},AltaiTagSelectorComponent.prototype.syncTicked=function(collection){var ctrl=this;if(collection)for(var i=0;i<collection.length;i++)collection[i].ticked&&this.ngModel.push(collection[i]),collection[i][ctrl.subRelationName]&&this.syncTicked(collection[i][ctrl.subRelationName])},AltaiTagSelectorComponent.prototype.countSelectableItems=function(){var ctrl=this,total=0;if(this.inputModel)for(var i=0;i<this.inputModel.length;i++)total++,this.inputModel[i][ctrl.subRelationName]&&(total+=this.inputModel[i][ctrl.subRelationName].length);this.totalSelectableItems=total},AltaiTagSelectorComponent.prototype.selectTag=function(tag,parent){void 0===parent&&(parent=null),this.multiple?this.addTagToSelectedCollection(tag,parent):this.ngModel&&this.ngModel.length>0&&this.ngModel[0].id==tag.id?(this.deSelectTag(this.ngModel[0],this.inputModel),this.ngModel=[],!parent&&tag.selectedChildren>0?tag.selectedChildren=[]:this.removeSelectedChildFromParent(tag,parent)):(this.deSelectTag(this.ngModel[0],this.inputModel),tag.selected=!0,this.ngModel=[tag],this.addSelectedChildToParent(tag,parent));var temp=angular.copy(this.ngModel);delete this.ngModel,this.ngModel=temp,this.everythingIsSelected=this.totalSelectableItems==this.ngModel.length},AltaiTagSelectorComponent.prototype.selectExistingTag=function(tag,collection){var col,parent,ctrl=this;if(collection[ctrl.subRelationName]?(col=collection[ctrl.subRelationName],parent=collection):angular.isArray(collection)&&(col=collection),tag)for(var i=0;i<col.length;i++)tag.id==col[i].id?(col[i].selected=!0,this.addSelectedChildToParent(col[i],parent)):col[i][ctrl.subRelationName]&&this.selectExistingTag(tag,col[i])},AltaiTagSelectorComponent.prototype.deSelectTag=function(tag,collection){var col,parent,ctrl=this;if(angular.isArray(collection)?col=collection:collection&&(col=collection[ctrl.subRelationName],parent=collection),tag)for(var j=0;j<col.length;j++)col[j].id==tag.id?(col[j].selected=!1,this.removeSelectedChildFromParent(col[j],parent)):col[j][ctrl.subRelationName]&&this.deSelectTag(tag,col[j])},AltaiTagSelectorComponent.prototype.addSelectedChildToParent=function(child,parent){if(parent)if(parent.selectedChildren)if(parent.selectedChildren.length){var found=parent.selectedChildren.filter(function(val){return val==child.id});found.length||parent.selectedChildren.push(child.id)}else parent.selectedChildren.push(child.id);else parent.selectedChildren=[],parent.selectedChildren.push(child.id)},AltaiTagSelectorComponent.prototype.removeSelectedChildFromParent=function(child,parent){if(parent&&parent.selectedChildren&&parent.selectedChildren.length)for(var i=0;i<parent.selectedChildren.length;i++)parent.selectedChildren[i]==child.id&&parent.selectedChildren.splice(i,1)},AltaiTagSelectorComponent.prototype.hideDropdown=function(tag){tag.expand&&(tag.expand=!1)},AltaiTagSelectorComponent.prototype.expand=function(tag){tag.expand=!tag.expand,tag.expand&&this.hideAllOtherDropdowns(tag)},AltaiTagSelectorComponent.prototype.hideAllOtherDropdowns=function(tag){for(var i=0;i<this.inputModel.length;i++)this.inputModel[i]!=tag&&this.inputModel[i].expand&&(this.inputModel[i].expand=!1)},AltaiTagSelectorComponent.prototype.isSelected=function(tag){return this.multiple?this.isTagInSelectedCollection(tag)>-1:this.ngModel&&this.ngModel.length>0?this.ngModel[0].id==tag.id:!1},AltaiTagSelectorComponent.prototype.selectAll=function(){this.everythingIsSelected?(this.updateSelectedOfAllTags(this.inputModel,!1),this.ngModel=[],this.everythingIsSelected=!1):(this.ngModel=[],this.updateSelectedOfAllTags(this.inputModel,!0),this.everythingIsSelected=!0)},AltaiTagSelectorComponent.prototype.updateSelectedOfAllTags=function(collection,selected,parent){void 0===parent&&(parent=null);for(var ctrl=this,i=0;i<collection.length;i++)collection[i].selected=selected,this.ngModel.push(collection[i]),collection[i][ctrl.subRelationName]&&this.updateSelectedOfAllTags(collection[i][ctrl.subRelationName],selected,collection[i]);parent&&(parent.selectedChildren=selected?collection.length:0)},AltaiTagSelectorComponent.prototype.isTagInSelectedCollection=function(tag){if(this.ngModel)for(var i=0;i<this.ngModel.length;i++)if(this.ngModel[i].id==tag.id)return i;return-1},AltaiTagSelectorComponent.prototype.addTagToSelectedCollection=function(tag,parent){var isAlreadyInCollectionIndex=this.isTagInSelectedCollection(tag);isAlreadyInCollectionIndex>-1?(this.removeTagFromCollection(tag),tag.selected=!1,this.removeSelectedChildFromParent(tag,parent)):(this.ngModel||(this.ngModel=[]),this.ngModel.push(tag),tag.selected=!0,this.addSelectedChildToParent(tag,parent))},AltaiTagSelectorComponent.prototype.removeTagFromCollection=function(tag){var index=this.isTagInSelectedCollection(tag);index>-1&&this.ngModel.splice(index,1)},AltaiTagSelectorComponent.prototype.disable=function(){this.disabled=!this.isDisabled,this.updateSelectedOfAllTags(this.inputModel,!1),this.ngModel=[]},AltaiTagSelectorComponent}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemBuildingBlockCreateComponent=function(){function AltaiContentItemBuildingBlockCreateComponent(){this.controller=AltaiContentItemBuildingBlockCreateComponentController,this.templateUrl="/api/template/Admin/ContentItemBuildingBlockCreateComponent"}return AltaiContentItemBuildingBlockCreateComponent}();AltaiContent.AltaiContentItemBuildingBlockCreateComponent=AltaiContentItemBuildingBlockCreateComponent;var AltaiContentItemBuildingBlockCreateComponentController=function(){function AltaiContentItemBuildingBlockCreateComponentController($templateFactory,altaiEditModeService){this.$templateFactory=$templateFactory,this.altaiEditModeService=altaiEditModeService;var ctrl=this;ctrl.loadTemplates()}return AltaiContentItemBuildingBlockCreateComponentController.prototype.loadTemplates=function(){var ctrl=this;ctrl.$templateFactory.listTemplateByTypeName("content").then(function(templateList){ctrl.templates=templateList})},AltaiContentItemBuildingBlockCreateComponentController.prototype.createBuildingBlock=function(newContentItemBb){this.altaiEditModeService.createBuildingBlock("ContentItem",{contentItemId:newContentItemBb.contentItemId,templateId:newContentItemBb.template.id})},AltaiContentItemBuildingBlockCreateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemBuildingBlockUpdateComponent=function(){function AltaiContentItemBuildingBlockUpdateComponent(){this.controller=AltaiContentItemBuildingBlockUpdateComponentController,this.templateUrl="/api/template/Admin/ContentItemBuildingBlockCreateComponent"}return AltaiContentItemBuildingBlockUpdateComponent}();AltaiContent.AltaiContentItemBuildingBlockUpdateComponent=AltaiContentItemBuildingBlockUpdateComponent;var AltaiContentItemBuildingBlockUpdateComponentController=function(){function AltaiContentItemBuildingBlockUpdateComponentController($templateFactory,altaiEditModeService,buildingBlockManager,contentItemBbManager){this.$templateFactory=$templateFactory,this.altaiEditModeService=altaiEditModeService,this.buildingBlockManager=buildingBlockManager,this.contentItemBbManager=contentItemBbManager;var ctrl=this;ctrl.buildingBlockId=altaiEditModeService.activeBuildingBlockId,buildingBlockManager.getBuildingBlockProfile(ctrl.buildingBlockId).then(function(bb){ctrl.contentItemBb={id:bb.instanceId},ctrl.loadTemplates(),ctrl.loadBbData()})}return AltaiContentItemBuildingBlockUpdateComponentController.prototype.loadTemplates=function(){var ctrl=this;ctrl.$templateFactory.listTemplateByTypeName("content").then(function(templateList){ctrl.templates=templateList,ctrl.contentItemBb.templateId&&(ctrl.contentItemBb.template=ctrl.templates.filter(function(tpl){return tpl.id===ctrl.contentItemBb.templateId})[0])})},AltaiContentItemBuildingBlockUpdateComponentController.prototype.loadBbData=function(){var ctrl=this;ctrl.contentItemBbManager.getById(ctrl.contentItemBb.id).then(function(contentItemBb){ctrl.contentItemBb=contentItemBb})},AltaiContentItemBuildingBlockUpdateComponentController.prototype.createBuildingBlock=function(newContentItemBb){var ctrl=this;newContentItemBb.templateId=newContentItemBb.template.id,ctrl.contentItemBbManager.update(newContentItemBb).then(function(){ctrl.buildingBlockManager.reloadBuildingBlock(ctrl.buildingBlockId)})},AltaiContentItemBuildingBlockUpdateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiMultiSelect=function(){function AltaiMultiSelect(){this.restrict="AE",this.bindings={model:"="},this.templateUrl="/api/template/Admin/AltaiMultiselect",this.controller=AltaiMultiSelectController}return AltaiMultiSelect}();AltaiContent.AltaiMultiSelect=AltaiMultiSelect;var AltaiMultiSelectController=function(){function AltaiMultiSelectController(contentItemService){this.contentItemService=contentItemService,this.pageSize=10,this.currentPage=0,this.pages=[],this.loadInputModel()}return AltaiMultiSelectController.prototype.loadInputModel=function(){var ctrl=this;this.contentItemService.getLinkCollectionData().then(function(r){ctrl.inputModel=r,ctrl.loadPages()})},AltaiMultiSelectController.prototype.loadPages=function(){for(var amountOfPages=Math.ceil(this.inputModel.length/this.pageSize),i=0;amountOfPages>i;i++)this.pages.push({pageNumber:i});this.pages[this.currentPage].active=!0},AltaiMultiSelectController.prototype.openPage=function(pageNumber){this.pages.map(function(value){value.active=!1});this.pages.filter(function(value){return value.pageNumber==pageNumber}).map(function(value){value.active=!0});this.currentPage=pageNumber},AltaiMultiSelectController.prototype.addItem=function(item){this.model||(this.model=[]),this.model.push(item),console.log(this.model),item.selected=!0},AltaiMultiSelectController.prototype.deselectItem=function(item){this.inputModel.filter(function(value){return value.id==item.id}).map(function(value){return value.selected&&(value.selected=!1),value})},AltaiMultiSelectController.prototype.removeItemFromModel=function(item){this.model=this.model.filter(function(value){return value.id!=item.id})},AltaiMultiSelectController.prototype.removeItem=function(item){this.model||(this.model=[]),this.deselectItem(item),this.removeItemFromModel(item)},AltaiMultiSelectController.prototype.isItemAlreadyInModel=function(item){return this.model||(this.model=[]),this.model.filter(function(value){return value.id==item.id}).length>0},AltaiMultiSelectController.prototype.select=function(item){this.isItemAlreadyInModel(item)?this.removeItem(item):this.addItem(item)},AltaiMultiSelectController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiTagSelector=function(){function AltaiTagSelector(){this.restrict="AE",this.bindings={inputModel:"<",ngModel:"=",multiple:"<",required:"<",editMode:"=",createMode:"<",defaultNotApplicable:"<",noDefaultNotApplicableButton:"<",subRelationName:"@"},this.templateUrl="/api/template/Admin/AltaiTagSelector",this.controller=AltaiTagSelectorComponent}return AltaiTagSelector}();AltaiContent.AltaiTagSelector=AltaiTagSelector;var AltaiTagSelectorComponent=function(){function AltaiTagSelectorComponent($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout,this.everythingIsSelected=!1,this.tagsAreSelected=!1;var s=this;!s.defaultNotApplicable&&!s.editMode||s.createMode?s.disabled=!1:s.disabled=!0,void 0==this.noDefaultNotApplicableButton?this.noDefaultNotApplicableButton=!1:1==this.noDefaultNotApplicableButton&&(s.disabled=!1);var stopwatch=$scope.$watch("$ctrl.inputModel",function(result){result&&result.length>0&&(s.initModels(),s.countSelectableItems(),stopwatch())}),stopmodelwatch=$scope.$watch("$ctrl.ngModel",function(result){result&&result.length>0&&(s.isDisabled=!1,s.disabled=!1,s.inputModel&&(s.checkAllSelectedTags(),stopmodelwatch()))});this.showSelectAllToggle=this.isEnabled()}return AltaiTagSelectorComponent.prototype.isEnabled=function(){var vm=this;return vm.inputModel&&vm.inputModel.length>0},AltaiTagSelectorComponent.prototype.initModels=function(){!this.ngModel||this.ngModel.length<=0?(this.ngModel=[],this.syncTicked(this.inputModel)):this.ngModel&&this.checkAllSelectedTags(),this.defaultNotApplicable!==!0&&!this.editMode||this.createMode||this.ngModel&&0!=this.ngModel.length||this.noDefaultNotApplicableButton===!0&&(this.isDisabled=!1)},AltaiTagSelectorComponent.prototype.checkAllSelectedTags=function(){if(!this.tagsAreSelected){for(var i=0;i<this.ngModel.length;i++)this.selectExistingTag(this.ngModel[i],this.inputModel);this.tagsAreSelected=!0}},AltaiTagSelectorComponent.prototype.syncTicked=function(collection){var ctrl=this;if(collection)for(var i=0;i<collection.length;i++)collection[i].ticked&&this.ngModel.push(collection[i]),collection[i][ctrl.subRelationName]&&this.syncTicked(collection[i][ctrl.subRelationName])},AltaiTagSelectorComponent.prototype.countSelectableItems=function(){var ctrl=this,total=0;if(this.inputModel)for(var i=0;i<this.inputModel.length;i++)total++,this.inputModel[i][ctrl.subRelationName]&&(total+=this.inputModel[i][ctrl.subRelationName].length);this.totalSelectableItems=total},AltaiTagSelectorComponent.prototype.selectTag=function(tag,parent){void 0===parent&&(parent=null),this.multiple?this.addTagToSelectedCollection(tag,parent):this.ngModel&&this.ngModel.length>0&&this.ngModel[0].id==tag.id?(this.deSelectTag(this.ngModel[0],this.inputModel),this.ngModel=[],!parent&&tag.selectedChildren>0?tag.selectedChildren=[]:this.removeSelectedChildFromParent(tag,parent)):(this.deSelectTag(this.ngModel[0],this.inputModel),tag.selected=!0,this.ngModel=[tag],this.addSelectedChildToParent(tag,parent));var temp=angular.copy(this.ngModel);delete this.ngModel,this.ngModel=temp,this.everythingIsSelected=this.totalSelectableItems==this.ngModel.length},AltaiTagSelectorComponent.prototype.selectExistingTag=function(tag,collection){var col,parent,ctrl=this;if(collection[ctrl.subRelationName]?(col=collection[ctrl.subRelationName],parent=collection):angular.isArray(collection)&&(col=collection),tag)for(var i=0;i<col.length;i++)tag.id==col[i].id?(col[i].selected=!0,this.addSelectedChildToParent(col[i],parent)):col[i][ctrl.subRelationName]&&this.selectExistingTag(tag,col[i])},AltaiTagSelectorComponent.prototype.deSelectTag=function(tag,collection){var col,parent,ctrl=this;if(angular.isArray(collection)?col=collection:collection&&(col=collection[ctrl.subRelationName],parent=collection),tag)for(var j=0;j<col.length;j++)col[j].id==tag.id?(col[j].selected=!1,this.removeSelectedChildFromParent(col[j],parent)):col[j][ctrl.subRelationName]&&this.deSelectTag(tag,col[j])},AltaiTagSelectorComponent.prototype.addSelectedChildToParent=function(child,parent){if(parent)if(parent.selectedChildren)if(parent.selectedChildren.length){var found=parent.selectedChildren.filter(function(val){return val==child.id});found.length||parent.selectedChildren.push(child.id)}else parent.selectedChildren.push(child.id);else parent.selectedChildren=[],parent.selectedChildren.push(child.id)},AltaiTagSelectorComponent.prototype.removeSelectedChildFromParent=function(child,parent){if(parent&&parent.selectedChildren&&parent.selectedChildren.length)for(var i=0;i<parent.selectedChildren.length;i++)parent.selectedChildren[i]==child.id&&parent.selectedChildren.splice(i,1)},AltaiTagSelectorComponent.prototype.hideDropdown=function(tag){tag.expand&&(tag.expand=!1)},AltaiTagSelectorComponent.prototype.expand=function(tag){tag.expand=!tag.expand,tag.expand&&this.hideAllOtherDropdowns(tag)},AltaiTagSelectorComponent.prototype.hideAllOtherDropdowns=function(tag){for(var i=0;i<this.inputModel.length;i++)this.inputModel[i]!=tag&&this.inputModel[i].expand&&(this.inputModel[i].expand=!1)},AltaiTagSelectorComponent.prototype.isSelected=function(tag){return this.multiple?this.isTagInSelectedCollection(tag)>-1:this.ngModel&&this.ngModel.length>0?this.ngModel[0].id==tag.id:!1},AltaiTagSelectorComponent.prototype.selectAll=function(){this.everythingIsSelected?(this.updateSelectedOfAllTags(this.inputModel,!1),this.ngModel=[],this.everythingIsSelected=!1):(this.ngModel=[],this.updateSelectedOfAllTags(this.inputModel,!0),this.everythingIsSelected=!0)},AltaiTagSelectorComponent.prototype.updateSelectedOfAllTags=function(collection,selected,parent){void 0===parent&&(parent=null);for(var ctrl=this,i=0;i<collection.length;i++)collection[i].selected=selected,this.ngModel.push(collection[i]),collection[i][ctrl.subRelationName]&&this.updateSelectedOfAllTags(collection[i][ctrl.subRelationName],selected,collection[i]);parent&&(parent.selectedChildren=selected?collection.length:0)},AltaiTagSelectorComponent.prototype.isTagInSelectedCollection=function(tag){if(this.ngModel)for(var i=0;i<this.ngModel.length;i++)if(this.ngModel[i].id==tag.id)return i;return-1},AltaiTagSelectorComponent.prototype.addTagToSelectedCollection=function(tag,parent){var isAlreadyInCollectionIndex=this.isTagInSelectedCollection(tag);isAlreadyInCollectionIndex>-1?(this.removeTagFromCollection(tag),tag.selected=!1,this.removeSelectedChildFromParent(tag,parent)):(this.ngModel||(this.ngModel=[]),this.ngModel.push(tag),tag.selected=!0,this.addSelectedChildToParent(tag,parent))},AltaiTagSelectorComponent.prototype.removeTagFromCollection=function(tag){var index=this.isTagInSelectedCollection(tag);index>-1&&this.ngModel.splice(index,1)},AltaiTagSelectorComponent.prototype.disable=function(){this.disabled=!this.isDisabled,this.updateSelectedOfAllTags(this.inputModel,!1),this.ngModel=[]},AltaiTagSelectorComponent}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemComponent=function(){function AltaiContentItemComponent(){this.controller=AltaiContentItemComponentController,this.templateUrl=function($attrs){return"/api/template/"+$attrs.templateId},this.bindings={contentItemId:"@",languageCode:"@"}}return AltaiContentItemComponent}();AltaiContent.AltaiContentItemComponent=AltaiContentItemComponent;var AltaiContentItemComponentController=function(){function AltaiContentItemComponentController(contentItemService,$scope,$timeout){this.contentItemService=contentItemService,this.$scope=$scope,this.$timeout=$timeout;var ctrl=this;$scope.vm=ctrl,ctrl.contentItemLoaded=!1,ctrl.languageCode?ctrl.contentItemService.getDataByIdInLang(ctrl.contentItemId,ctrl.languageCode).then(function(contentItemData){ctrl.item=contentItemData,ctrl.contentItemLoaded=!0}):ctrl.contentItemService.getDataById(ctrl.contentItemId).then(function(contentItemData){ctrl.item=contentItemData,ctrl.contentItemLoaded=!0})}return AltaiContentItemComponentController.prototype.$onInit=function(){var ctrl=this;if(ctrl.contentItemLoaded)ctrl.$scope.$emit("contentItemLoaded",{});else var watch=ctrl.$scope.$watch("vm.item",function(newValue,oldValue){void 0!=newValue&&ctrl.$timeout(function(){ctrl.$scope.$emit("contentItemLoaded",{}),watch()})})},AltaiContentItemComponentController.prototype.getName=function(name){return void 0!=name?name.substring(0,100).replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,""):""},AltaiContentItemComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemButtonsComponent=function(){function AltaiContentItemButtonsComponent(){this.template='<md-button ng-click="$ctrl.openContentItemProfile($ctrl.contentItem)" class="md-button-altai md-raised"><i class="mdi mdi-view-list"></i> {{::\'open_list_view\'|translate}} </md-button><md-button ng-click="$ctrl.previewContentItem($ctrl.contentItem)" class="md-button-altai md-raised" ng-if="$ctrl.allowPreview"><i class="mdi mdi-camera"></i> {{::\'open_preview\'|translate}} </md-button><md-button ng-click="$ctrl.updateContentItem($ctrl.contentItem)" class="md-button-altai md-raised"  ng-if="$ctrl.allowUpdate"><i class="mdi mdi-pencil"></i> {{::\'open_edit\'|translate}} </md-button><md-button ng-click="$ctrl.deleteContentItem($ctrl.contentItem)" class="md-button-altai md-raised" ng-if="$ctrl.allowUpdate"><i class="mdi mdi-delete"></i> {{::\'delete\'|translate}}</md-button>',this.controller=AltaiContentItemButtonsComponentController,this.bindings={contentItem:"="}}return AltaiContentItemButtonsComponent}();AltaiContent.AltaiContentItemButtonsComponent=AltaiContentItemButtonsComponent;var AltaiContentItemButtonsComponentController=function(){function AltaiContentItemButtonsComponentController(wmContainerFactory,altaiConfirmationService,contentItemService,contentTypeService){this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentItemService=contentItemService;var ctrl=this;contentTypeService.previewPossibleForType(ctrl.contentItem.contentTypeId).then(function(previewPossible){ctrl.allowPreview=previewPossible}),contentTypeService.editPossibleForType(ctrl.contentItem.contentTypeId).then(function(editPossible){ctrl.allowUpdate=editPossible})}return AltaiContentItemButtonsComponentController.prototype.openContentItemProfile=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.name,contentItem.id)},AltaiContentItemButtonsComponentController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.name,contentItem.id)},AltaiContentItemButtonsComponentController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemService["delete"](contentItem).then(function(){})})},AltaiContentItemButtonsComponentController.prototype.previewContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,contentItem.name,contentItem.id)},AltaiContentItemButtonsComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentSelectionCheckboxComponent=function(){function AltaiContentSelectionCheckboxComponent(){this.template="<input type='checkbox' ng-model='$ctrl.checkbox' />",this.controller=AltaiContentSelectionCheckboxComponentController,this.bindings={selectionKey:"=",contentItem:"="}}return AltaiContentSelectionCheckboxComponent}();AltaiContent.AltaiContentSelectionCheckboxComponent=AltaiContentSelectionCheckboxComponent;var AltaiContentSelectionCheckboxComponentController=function(){function AltaiContentSelectionCheckboxComponentController($scope,contentItemSelectionService){this.contentItemSelectionService=contentItemSelectionService,this.checkbox=!1;var ctrl=this;ctrl.checkCheckboxState(),$scope.$watch("$ctrl.checkbox",function(){ctrl.updateCheckbox()}),contentItemSelectionService.observeSelection(ctrl.selectionKey,function(){ctrl.checkCheckboxState()})}return AltaiContentSelectionCheckboxComponentController.prototype.checkCheckboxState=function(){var ctrl=this;ctrl.checkbox=ctrl.contentItemSelectionService.isItemSelected(ctrl.selectionKey,ctrl.contentItem)},AltaiContentSelectionCheckboxComponentController.prototype.updateCheckbox=function(){var ctrl=this;ctrl.checkbox?ctrl.contentItemSelectionService.addToSelection(ctrl.selectionKey,ctrl.contentItem):ctrl.contentItemSelectionService.removeFromSelection(ctrl.selectionKey,ctrl.contentItem)},AltaiContentSelectionCheckboxComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemInlineSecurityComponent=function(){function AltaiContentItemInlineSecurityComponent(){this.templateUrl="/api/template/Admin/Content:ContentItemInlineSecurity",this.bindings={contentItem:"="},this.controller=function($translate,$scope,roleAdminService,authorizationService,authService){var ctrl=this;authService.isAuthorized("contentitem.item.authorization").then(function(hasAccess){ctrl.hasAccess=hasAccess,roleAdminService.list().then(function(roles){ctrl.roles=roles;var contentItemIdWatcher=$scope.$watch("$ctrl.contentItem.id",function(){ctrl.contentItem&&ctrl.contentItem.id&&(contentItemIdWatcher(),authorizationService.getSecurableAccesses("contentitem.item.read",ctrl.contentItem.id).then(function(accesses){for(var r=0;r<ctrl.roles.length;r++){var role=ctrl.roles[r],access=accesses.filter(function(acc){return acc.roleName==role.name})[0];access&&access.allowAccess&&(role.ticked=!0)}}))})}),$scope.$watch("$ctrl.readRoles",function(){ctrl.contentItem&&ctrl.readRoles&&(ctrl.contentItem.publicRoles=ctrl.readRoles.filter(function(role){return role.ticked}).map(function(role){return role.name}))})})}}return AltaiContentItemInlineSecurityComponent}();AltaiContent.AltaiContentItemInlineSecurityComponent=AltaiContentItemInlineSecurityComponent}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiPrintDataComponent=function(){function AltaiPrintDataComponent(){this.template='<a class="comeos-button" ng-click="$ctrl.printFile()"  translate>print</a>',this.bindings={contentDivId:"="},this.controller=AltaiPrintDataComponentController}return AltaiPrintDataComponent}();AltaiContent.AltaiPrintDataComponent=AltaiPrintDataComponent;var AltaiPrintDataComponentController=function(){function AltaiPrintDataComponentController($scope,$uibModal){this.$scope=$scope;this.scope=$scope,this.modal=$uibModal}return AltaiPrintDataComponentController.prototype.printFile=function(){var vm=this,divToPrint=document.getElementById(vm.contentDivId),popupWin=window.open("","_blank","width=1800,height=900");popupWin.document.open(),popupWin.document.write('<html><head><link href="../style.css" rel="stylesheet" type="text/css"></head><body onload="window.print()">'+divToPrint.innerHTML+"</body></html>"),popupWin.document.close()},AltaiPrintDataComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiTreeSelectorComponent=function(){function AltaiTreeSelectorComponent(){this.templateUrl="/api/template/Component/AltaiTreeSelector",this.bindings={tree:"<",relationId:"<",depth:"<",relationName:"<",addAttribute:"&",includes:"=",firstLevel:"="},this.controller=AltaiTreeSelectorComponentController}return AltaiTreeSelectorComponent}();AltaiContent.AltaiTreeSelectorComponent=AltaiTreeSelectorComponent;var AltaiTreeSelectorComponentController=function(){function AltaiTreeSelectorComponentController($scope,wmContainerFactory,contentTypeService,contentRelationFactory,contentTypeAttributeManager){this.$scope=$scope,this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,this.contentRelationFactory=contentRelationFactory,this.contentTypeAttributeManager=contentTypeAttributeManager,this.attributes=[];var ctrl=this;ctrl.tree&&(ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes,ctrl.contentType=ctrl.contentTypes.filter(function(contentType){return contentType.id==ctrl.tree})[0]}),ctrl.contentRelationFactory.listWithLinks().then(function(relations){ctrl.relations=relations.filter(function(rel){return rel.contentTypeRelationLinks.some(function(element,index,array){return element.contentTypeId==ctrl.tree})&&rel.contentTypeRelationLinks.some(function(element,index,array){return element.contentTypeId!=ctrl.tree&&1==element.includeByDefault})||rel.contentTypeRelationLinks.every(function(element,index,array){return element.contentTypeId==ctrl.tree})&&rel.contentTypeRelationLinks.some(function(element,index,array){return 1==element.includeByDefault})})}),ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes.filter(function(attr){return attr.contentTypeId==ctrl.tree})}),ctrl.addTreeToDepth()),0==ctrl.childDepth.length&&$scope.$watchCollection("$ctrl.firstLevel",function(newValue,oldValue,scope){if(void 0!=newValue)if(void 0==oldValue)for(var x in newValue)scope.$ctrl.attributes[newValue[x]]=!0;else if(newValue.length>oldValue.length)for(var x in newValue)scope.$ctrl.attributes[newValue[x]]=!0;else{var changedValue=-1;for(var x in newValue)if(newValue[x]!=oldValue[x]){changedValue=oldValue[x];break}if(-1==changedValue&&(changedValue=oldValue[oldValue.length-1]),scope.$ctrl.attributes[changedValue]=!1,void 0!=scope.$ctrl.contentTypeAttributes){var cta=scope.$ctrl.contentTypeAttributes.filter(function(attr){return attr.attributeId==changedValue});if(cta.length>0){var includedindex=ctrl.includes.filter(function(includes){var found=!0;return found=found&&includes.expContCollFields[0].expContCollPaths.some(function(element,index,array){return element.contentTypeAttributeId==cta[0].id&&0==element.niveau})});if(includedindex.length>0&&void 0!=includedindex[0]){var indexof=ctrl.includes.findIndex(function(include){return include==includedindex[0]});indexof>=0&&ctrl.includes.splice(indexof,1)}}}}});var group=$scope.$watchGroup(["$ctrl.contentTypes","$ctrl.relations","$ctrl.contentTypeAttributes","$ctrl.includes"],function(newValue,oldValue,scope){var ctrl=scope.$ctrl;if(void 0!=newValue[0]&&void 0!=newValue[1]&&void 0!=newValue[2]&&void 0!=newValue[3]){for(var x in ctrl.includes){var found=!0;for(var y in ctrl.childDepth)found=found&&ctrl.includes[x].expContCollFields[0].expContCollPaths.some(function(element,index,array){return element.contentTypeRelationId==ctrl.childDepth[y]&&element.niveau==y});if(ctrl.includes[x].expContCollFields[0].expContCollPaths.length!=ctrl.childDepth.length+1&&(found=!1),found){var attributes=ctrl.includes[x].expContCollFields[0].expContCollPaths.filter(function(path){return path.niveau==ctrl.childDepth.length&&null!=path.contentTypeAttributeId});for(var y in attributes){var contentTypeAttributes=ctrl.contentTypeAttributes.filter(function(attr){return attr.id==attributes[y].contentTypeAttributeId});if(contentTypeAttributes.length>0)for(var z in contentTypeAttributes)if(ctrl.attributes[contentTypeAttributes[z].attributeId]=!0,0==ctrl.childDepth.length){void 0==ctrl.firstLevel&&(ctrl.firstLevel=[]);var index=ctrl.firstLevel.findIndex(function(attr){return attr==contentTypeAttributes[z].attributeId});-1==index&&(ctrl.firstLevel[ctrl.firstLevel.length]=contentTypeAttributes[z].attributeId)}}}}group()}})}return AltaiTreeSelectorComponentController.prototype.getTypeId=function(index){var ctrl=this,contentTypeId=void 0;return index>=0&&angular.forEach(ctrl.relations[index].contentTypeRelationLinks,function(value,key){value.contentTypeId!=ctrl.tree&&(contentTypeId=value.contentTypeId)}),void 0==contentTypeId&&(ctrl.relations[index].contentTypeRelationLinks.some(function(element,index,array){element.contentTypeId!=ctrl.tree})||(contentTypeId=ctrl.tree)),contentTypeId},AltaiTreeSelectorComponentController.prototype.addRelationToAttribute=function(index){var ctrl=this;ctrl.childDepth.length>0&&ctrl.includes[index].expContCollFields[0].expContCollPaths.push({niveau:ctrl.childDepth.length-1,contentTypeRelationId:ctrl.relationId}),ctrl.addAttribute({index:index})},AltaiTreeSelectorComponentController.prototype.removeRelationFromAttribute=function(index){var ctrl=this;ctrl.includes[index].expContCollFields[0].expContCollPaths.length==ctrl.childDepth.length&&ctrl.includes[index].expContCollFields[0].expContCollPaths.pop(),
ctrl.removeAttribute({index:index})},AltaiTreeSelectorComponentController.prototype.addAttr=function(index,value,attributeId,attributeTypeId){var ctrl=this;if(1==value)void 0==ctrl.includes[index]&&(ctrl.includes[index]={expContCollFields:[{expContCollPaths:[]}]}),void 0==ctrl.includes[index].expContCollFields&&(ctrl.includes[index].expContCollFields=[],ctrl.includes[index].expContCollFields[0].expContCollPaths=[]),ctrl.includes[index].expContCollFields[0].expContCollPaths.push({niveau:ctrl.childDepth.length,contentTypeAttributeId:attributeTypeId}),0==ctrl.childDepth.length?ctrl.addAttribute({index:index}):ctrl.addRelationToAttribute(index);else{var includedindex=ctrl.includes.filter(function(includes){var found=!0;for(var x in ctrl.childDepth)found=found&&includes.expContCollFields[0].expContCollPaths.some(function(element,index,array){return element.contentTypeRelationId==ctrl.childDepth[x]&&element.niveau==x});return found=found&&includes.expContCollFields[0].expContCollPaths.some(function(element,index,array){return element.contentTypeAttributeId==attributeTypeId&&element.niveau==ctrl.childDepth.length})});includedindex.length>0&&void 0!=includedindex[0]&&(index=ctrl.includes.findIndex(function(include){return include==includedindex[0]}),index>=0&&ctrl.includes.splice(index,1))}if(0==ctrl.childDepth.length)if(value)void 0==ctrl.firstLevel&&(ctrl.firstLevel=[]),ctrl.firstLevel[ctrl.firstLevel.length]=attributeId;else if(void 0!=ctrl.firstLevel&&ctrl.firstLevel.length>0){var index=ctrl.firstLevel.findIndex(function(attr){return attr==attributeId});index>=0&&ctrl.firstLevel.splice(index,1)}},AltaiTreeSelectorComponentController.prototype.addTreeToDepth=function(){var ctrl=this;ctrl.childDepth=angular.copy(ctrl.depth),void 0!=ctrl.relationId&&(ctrl.childDepth[ctrl.depth.length]=ctrl.relationId)},AltaiTreeSelectorComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentCheckboxComponent=function(){function AltaiContentCheckboxComponent(){this.template='<md-checkbox class="smallcheckbox" ng-model="$ctrl.model"></md-checkbox>',this.bindings={model:"="},this.controller=function($scope){var ctrl=this;$scope.$watch("$ctrl.model",function(){ctrl.model&&("true"===ctrl.model&&(ctrl.model=!0),"false"===ctrl.model&&(ctrl.model=!1))})}}return AltaiContentCheckboxComponent}();AltaiContent.AltaiContentCheckboxComponent=AltaiContentCheckboxComponent}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiSelectInputDirective(){return{scope:{attributeId:"=altaiSelectInput",model:"=model"},replace:!0,template:"<select data-ng-options='o.label for o in ::options' ng-model='internalModel'></select>",controller:function($scope,$element,$attrs,$http){$scope.usedModel=$attrs.ngModel,$http.get(config.backendUrl+"/api/attributeSelectOption?id="+$scope.attributeId).then(function(result){$scope.options=result.data,$scope.internalModel=$scope.options.filter(function(elm){return elm.value==$scope.model})[0]}),$scope.$watch("internalModel",function(){$scope.internalModel&&($scope.model=$scope.internalModel.value)})}}}AltaiContent.AltaiSelectInputDirective=AltaiSelectInputDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiTagSelectorValidator(){return{link:AltaiTagSelectorValidatorLink,restrict:"A",require:["altaiTagSelector","?ngModel"]}}AltaiContent.AltaiTagSelectorValidator=AltaiTagSelectorValidator;var AltaiTagSelectorValidatorLink=function(){function AltaiTagSelectorValidatorLink(scope,elm,attrs,ctrl){function validate(modelValue){return altaiTagSelectorController.required?0!==altaiTagSelectorController.ngModel.length||altaiTagSelectorController.isDisabled?ngModelController.$setValidity("altaitagselector",!0):ngModelController.$setValidity("altaitagselector",!1):ngModelController.$setValidity("altaitagselector",!0),modelValue}var altaiTagSelectorController=ctrl[0],ngModelController=ctrl[1];ngModelController.$parsers.push(validate),ngModelController.$formatters.push(validate)}return AltaiTagSelectorValidatorLink}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentCollectionListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentCollectionList,"Content Collections")}AltaiContent.ContentCollectionListController=ContentCollectionListController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ExposedContentCollectionListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionList,"Exposed Content Collections")}AltaiContent.ExposedContentCollectionListController=ExposedContentCollectionListController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentCreateController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,"Content item create")}AltaiContent.ContentCreateController=ContentCreateController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentFormListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentFormList,"Content Forms")}AltaiContent.ContentFormListController=ContentFormListController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemList,"Content Items")}AltaiContent.ContentItemListController=ContentItemListController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemListElasticController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemListElastic,"Content Items Elastic")}AltaiContent.ContentItemListElasticController=ContentItemListElasticController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemUpdateController(wmContainerFactory,$stateParams){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,"Update ContentItem",$stateParams.id)}AltaiContent.ContentItemUpdateController=ContentItemUpdateController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentTypeListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeList,"Content Types","")}AltaiContent.ContentTypeListController=ContentTypeListController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemProfileController(wmContainerFactory,$stateParams){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,"ContentItem",$stateParams.id)}AltaiContent.ContentItemProfileController=ContentItemProfileController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemPreviewController(wmContainerFactory,$stateParams){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,"Preview",$stateParams.id)}AltaiContent.ContentItemPreviewController=ContentItemPreviewController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentItemSearchElasticController(wmContainerFactory){wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemSearchElastic,"Content Items Elastic")}AltaiContent.ContentItemSearchElasticController=ContentItemSearchElasticController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function CompileHtmlDirective($compile,$sce){return function(scope,element,attrs){var watcher=scope.$watch(function(scope){return attrs.altaiCompileHtml},function(value){value&&(watcher(),element.html(value),element.removeAttr("altai-compile-html"),$compile(element.contents())(scope))})}}AltaiContent.CompileHtmlDirective=CompileHtmlDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function altaiLink(){return{restrict:"AE",scope:{text:"@",contentItemTarget:"@",contentTypeId:"@"},bindToController:!0,controllerAs:"$ctrl",controller:altaiLinkController,template:"<a ng-click='$ctrl.openState()' class='altai-link'>{{$ctrl.text}}</a> "}}AltaiContent.altaiLink=altaiLink;var altaiLinkController=function(){function altaiLinkController(contentTypeService,$state,wmContainerFactory){this.contentTypeService=contentTypeService,this.$state=$state,this.wmContainerFactory=wmContainerFactory;var s=this;contentTypeService.getLinkedState(s.contentTypeId).then(function(stateName){s.state=stateName})}return altaiLinkController.prototype.openState=function(){var ctrl=this;0===ctrl.$state.current.name.indexOf("admin")?ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,"Preview",ctrl.contentItemTarget):this.state&&this.$state.go(this.state,{id:this.contentItemTarget})},altaiLinkController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function altaiSetTitle(){return{restrict:"AE",scope:{titletext:"@"},bindToController:!0,controllerAs:"$ctrl",controller:altaiSetTitleController}}AltaiContent.altaiSetTitle=altaiSetTitle;var altaiSetTitleController=function(){function altaiSetTitleController($document,$scope){this.$document=$document,this.$scope=$scope;var s=this,titlewatcher=$scope.$watch("$ctrl.titletext",function(){s.titletext&&""!=s.titletext&&(document.title=s.titletext,titlewatcher())})}return altaiSetTitleController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeCreateDirective(){return{templateUrl:"/api/template/Admin/contentTypeCreate",controllerAs:"vm",controller:contentTypeCreateDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContentType(scope.newContentType)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.contentItemCreateForm,separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}}}AltaiContent.AltaiContentTypeCreateDirective=AltaiContentTypeCreateDirective;var contentTypeCreateDirectiveController=function(){function contentTypeCreateDirectiveController(contentTypeService,wmContainerFactory){this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory}return contentTypeCreateDirectiveController.prototype.createContentType=function(newContentType){var s=this;newContentType.directCreatePossible=!0,this.contentTypeService.add(newContentType).then(function(result){var createWin=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeCreate);s.wmContainerFactory.destroyWindow(createWin.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeUpdate,newContentType.name,result.id)})},contentTypeCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeListDirective(){return{templateUrl:"/api/template/Admin/ContentTypeList",controller:ContentTypeListDirectiveController,controllerAs:"vm"}}AltaiContent.AltaiContentTypeListDirective=AltaiContentTypeListDirective;var ContentTypeListDirectiveController=function(){function ContentTypeListDirectiveController(contentTypeService,wmContainerFactory,authService,altaiNotificationFactory){this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiNotificationFactory=altaiNotificationFactory;var ctrl=this;contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),authService.isAuthorized("contenttype.create").then(function(hasAccess){ctrl.allowContentTypeCreation=hasAccess})}return ContentTypeListDirectiveController.prototype.test=function(){this.altaiNotificationFactory.success("test")},ContentTypeListDirectiveController.prototype.openContentTypeProfile=function(contentType){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeUpdate,contentType.label,contentType.id)},ContentTypeListDirectiveController.prototype.createContentType=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeCreate,"Create new content type")},ContentTypeListDirectiveController.prototype.createContentItemForContentType=function(ct){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,ct.label,ct.id)},ContentTypeListDirectiveController.prototype.openContentTypeItems=function(contentType){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemList,contentType.label,contentType.id)},ContentTypeListDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeProfileDirective(){return{templateUrl:"/api/template/Admin/contenttypeprofile"}}AltaiContent.AltaiContentTypeProfileDirective=AltaiContentTypeProfileDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeUpdateDirective(){return{scope:{contentTypeId:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentTypeUpdate",controller:ContentTypeUpdateDirectiveController,controllerAs:"vm",link:AltaiContentTypeUpdateDirectiveLink}}AltaiContent.AltaiContentTypeUpdateDirective=AltaiContentTypeUpdateDirective;var AltaiContentTypeUpdateDirectiveLink=function(){function AltaiContentTypeUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.updateContentType()},"class":"altai-button-go",name:"save",separator:!0},{translatableTooltipId:"accesses",icon:"mdi-key",action:function(){scope.vm.openAccessesWindow()},"class":"altai-button-primary",name:"accesses",separator:!0},{icon:"mdi-delete",action:function(){scope.vm.deleteContentType()},"class":"altai-button-back",name:"delete",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return AltaiContentTypeUpdateDirectiveLink}(),ContentTypeUpdateDirectiveController=function(){function ContentTypeUpdateDirectiveController($scope,contentTypeService,$templateFactory,logService,altaiConfirmationService,wmContainerFactory,stateManager){this.$scope=$scope,this.contentTypeService=contentTypeService,this.stateManager=stateManager;var ctrl=this;this.altaiConfirmationService=altaiConfirmationService,this.wmContainerFactory=wmContainerFactory,this.ctaSortOptions=this.handleSorting(),this.ctrlSortOptions=this.handleSortingLinks(),this.loadData(),$templateFactory.listTemplateByTypeName("Content").then(function(result){ctrl.templates=result}),stateManager.list().then(function(states){ctrl.states=states}),$scope.deleteCta=function(cta){ctrl.altaiConfirmationService.confirm().then(function(){contentTypeService.deleteContentTypeAttribute(cta).then(function(){var index=$scope.contentType.contentTypeAttributes.indexOf(cta);$scope.contentType.contentTypeAttributes.splice(index,1)})})},$scope.deleteContentTypeRelation=function(ctr){ctrl.altaiConfirmationService.confirm().then(function(){contentTypeService.deleteContentTypeRelation(ctr).then(function(){ctrl.loadData()})})},$scope.updateContentType=function(){contentTypeService.update($scope.contentType).then(function(){ctrl.closeWindow()})},$scope.updateCtrl=function(ctrl){contentTypeService.updateContentTypeRelationLink(ctrl)}}return ContentTypeUpdateDirectiveController.prototype.closeWindow=function(){var window=this.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeUpdate,this.contentTypeId);this.wmContainerFactory.destroyWindow(window.id)},ContentTypeUpdateDirectiveController.prototype.openAccessesWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",ctrl.contentTypeId,{securableName:"contenttype.item"})},ContentTypeUpdateDirectiveController.prototype.deleteContentType=function(){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentTypeService["delete"](s.contentType).then(function(){var contentTypeWindow=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeUpdate,s.contentType.id);s.wmContainerFactory.destroyWindow(contentTypeWindow.id)})})},ContentTypeUpdateDirectiveController.prototype.openCreateContentTypeAttributeWindow=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeAttributeCreate,"contentattribute",this.contentType.id)},ContentTypeUpdateDirectiveController.prototype.openCreateContentTypeRelationWindow=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeRelationCreate,"createrelation",this.contentType.id)},ContentTypeUpdateDirectiveController.prototype.updateContentTypeRelation=function(contentTypeRelation){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeRelationUpdate,contentTypeRelation.name,contentTypeRelation.id)},ContentTypeUpdateDirectiveController.prototype.updateContentTypeAttribute=function(contentTypeAttribte){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeAttributeUpdate,"ContentTypeAttribute",contentTypeAttribte.id)},ContentTypeUpdateDirectiveController.prototype.loadData=function(){var s=this;s.contentTypeService.getById(s.contentTypeId).then(function(result){s.contentType=result,s.$scope.contentType=result})},ContentTypeUpdateDirectiveController.prototype.handleSorting=function(){var s=this;return{stop:function(e,ui){s.contentTypeService.updateContentTypeAttributeSorting(s.$scope.contentType.contentTypeAttributes)}}},ContentTypeUpdateDirectiveController.prototype.handleSortingLinks=function(){var s=this;return{stop:function(e,ui){s.contentTypeService.updateContentTypeRelationLinksSorting(s.$scope.contentType.contentTypeRelationLinks)}}},ContentTypeUpdateDirectiveController}();AltaiContent.ContentTypeUpdateDirectiveController=ContentTypeUpdateDirectiveController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeAttributeCreateDirective(){return{scope:{contentTypeId:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentTypeAttributeCreate",controller:ContentTypeAttributeCreateDirectiveController,controllerAs:"$ctrl"}}AltaiContent.AltaiContentTypeAttributeCreateDirective=AltaiContentTypeAttributeCreateDirective;var ContentTypeAttributeCreateDirectiveController=function(){function ContentTypeAttributeCreateDirectiveController(contentAttributeService,contentTypeService,wmContainerFactory){this.contentAttributeService=contentAttributeService;var s=this;s.wmContainerFactory=wmContainerFactory,s.contentTypeService=contentTypeService,contentAttributeService.listAttributeType().then(function(result){s.attributeTypes=result}),contentAttributeService.list().then(function(attributes){s.existingAttributes=attributes})}return ContentTypeAttributeCreateDirectiveController.prototype.createExCta=function(attributeId){var c=this;c.contentTypeService.createContentTypeAttribute({attributeId:attributeId,contentTypeId:this.contentTypeId}).then(function(result){c.closeWindow()})},ContentTypeAttributeCreateDirectiveController.prototype.createNewCta=function(newCta){var c=this;newCta.contentTypeId=this.contentTypeId,c.contentTypeService.createContentTypeAttribute(newCta).then(function(){c.closeWindow()})},ContentTypeAttributeCreateDirectiveController.prototype.closeWindow=function(){var window=this.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeAttributeCreate,this.contentTypeId);this.wmContainerFactory.destroyWindow(window.id)},ContentTypeAttributeCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeAttributeUpdateDirective(){return{scope:{contentTypeAttributeId:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentTypeAttributeUpdate",controller:ContentTypeAttributeUpdateDirectiveController,controllerAs:"vm"}}AltaiContent.AltaiContentTypeAttributeUpdateDirective=AltaiContentTypeAttributeUpdateDirective;var ContentTypeAttributeUpdateDirectiveController=function(){function ContentTypeAttributeUpdateDirectiveController(contentTypeService,contentAttributeSelectOptionsManager,contentAttributeService,wmContainerFactory){this.contentAttributeService=contentAttributeService;var s=this;this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,this.contentAttributeSelectOptionsManager=contentAttributeSelectOptionsManager,contentTypeService.readContentTypeAttribute(this.contentTypeAttributeId).then(function(contentTypeAttribute){s.contentTypeAttribute=contentTypeAttribute,"Select"===s.contentTypeAttribute.attribute.attributeType.name&&s.contentAttributeSelectOptionsManager.getOptions(s.contentTypeAttribute.attributeId).then(function(options){s.contentTypeAttribute.attribute.options=options})}),contentAttributeService.listAttributeType().then(function(result){s.attributeTypes=result})}return ContentTypeAttributeUpdateDirectiveController.prototype.update=function(){var c=this;c.contentTypeService.updateContentTypeAttribute(c.contentTypeAttribute).then(function(){"Select"==c.contentTypeAttribute.attribute.attributeType.name&&c.contentAttributeSelectOptionsManager.updateOptions(c.contentTypeAttribute.attribute);var window=c.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeAttributeUpdate,c.contentTypeAttributeId);c.wmContainerFactory.destroyWindow(window.id)})},ContentTypeAttributeUpdateDirectiveController.prototype.deleteOption=function(option){var vm=this;vm.contentTypeAttribute.attribute.options.splice(vm.contentTypeAttribute.attribute.options.indexOf(option),1)},ContentTypeAttributeUpdateDirectiveController.prototype.createOption=function(newOption){var vm=this;newOption.label=newOption.labelTranslatable.translatableValues[0].value,newOption.attributeSelectId=vm.contentTypeAttribute.attributeId,vm.contentTypeAttribute.attribute.options.push(newOption),vm.newOption=new AltaiContent.ContentTypeSelectOption},ContentTypeAttributeUpdateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeRelationUpdateDirective(){return{scope:{contentTypeRelationId:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentTypeRelationUpdate",controller:ContentTypeRelationUpdateDirectiveController,link:ContentTypeRelationUpdateDirectiveLink,controllerAs:"vm"}}AltaiContent.AltaiContentTypeRelationUpdateDirective=AltaiContentTypeRelationUpdateDirective;var ContentTypeRelationUpdateDirectiveLink=function(){function ContentTypeRelationUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateContentTypeRelation()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentTypeRelationUpdateDirectiveLink}(),ContentTypeRelationUpdateDirectiveController=function(){function ContentTypeRelationUpdateDirectiveController(contentTypeService,wmContainerFactory,$templateFactory,contentCollectionManager){this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.$templateFactory=$templateFactory,this.contentCollectionManager=contentCollectionManager;var ctrl=this;this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,contentTypeService.readContentTypeRelation(this.contentTypeRelationId).then(function(contentTypeRelation){ctrl.contentTypeRelation=contentTypeRelation}),$templateFactory.listTemplateByTypeName("ContentRelation").then(function(contentRelationTemplates){ctrl.contentRelationTemplates=contentRelationTemplates}),contentCollectionManager.list().then(function(contentCollections){ctrl.contentCollections=contentCollections})}return ContentTypeRelationUpdateDirectiveController.prototype.updateContentTypeRelation=function(){var ctrl=this;ctrl.contentTypeService.updateContentTypeRelation(this.contentTypeRelation).then(function(){var activeWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeRelationUpdate,ctrl.contentTypeRelationId);ctrl.wmContainerFactory.destroyWindow(activeWin.id)})},ContentTypeRelationUpdateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentTypeRelationCreateDirective(){return{scope:{contentTypeId:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentTypeRelationCreate",controller:ContentTypeRelationCreateDirectiveController,controllerAs:"vm",link:ContentTypeRelationCreateDirectiveLink}}AltaiContent.AltaiContentTypeRelationCreateDirective=AltaiContentTypeRelationCreateDirective;var ContentTypeRelationCreateDirectiveLink=function(){function ContentTypeRelationCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContentTypeRelation()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentTypeRelationCreateDirectiveLink}(),ContentTypeRelationCreateDirectiveController=function(){function ContentTypeRelationCreateDirectiveController(contentTypeService,wmContainerFactory,$scope,$templateFactory,contentCollectionManager){this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.$templateFactory=$templateFactory,this.contentCollectionManager=contentCollectionManager;var ctrl=this;ctrl.contentTypeService=contentTypeService,ctrl.wmContainerFactory=wmContainerFactory,ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),$templateFactory.listTemplateByTypeName("ContentRelation").then(function(contentRelationTemplates){ctrl.contentRelationTemplates=contentRelationTemplates}),$scope.$watch("vm.selectedContentTypeId",function(){if(ctrl.selectedContentTypeId){ctrl.newCtr=new AltaiContent.ContentTypeRelation;var linkedCt=ctrl.newCtr.contentTypeRelationLinks[0]=new AltaiContent.ContentTypeRelationLink,ownCt=ctrl.newCtr.contentTypeRelationLinks[1]=new AltaiContent.ContentTypeRelationLink;ownCt.hidden=!0,ownCt.allowCreateLink=!1,ownCt.includeByDefault=!1,linkedCt.contentTypeId=ctrl.selectedContentTypeId,linkedCt.contentType=ctrl.contentTypes.filter(function(ct){return ct.id==ctrl.selectedContentTypeId})[0],ownCt.contentTypeId=ctrl.contentTypeId,ownCt.contentType=ctrl.contentTypes.filter(function(ct){return ct.id==ctrl.contentTypeId})[0]}}),contentCollectionManager.list().then(function(contentCollections){ctrl.contentCollections=contentCollections})}return ContentTypeRelationCreateDirectiveController.prototype.createContentTypeRelation=function(){var s=this;s.contentTypeService.createContentTypeRelation(s.newCtr).then(function(){var window=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentTypeRelationCreate,s.newCtr.contentTypeRelationLinks[1].contentTypeId);s.wmContainerFactory.destroyWindow(window.id)})},ContentTypeRelationCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentIdFieldDirective(){return{scope:{model:"=altaiContentIdField",modelVisibility:"="},template:"<div class='form-group'><label style='flex:1' ng-bind-html='value'></label></div>",controller:function($scope,contentTypeService,contentUpdateModelManager,languageFactory,$filter){function updateFields(){$scope.model&&$scope.model.id?contentUpdateModelManager.getUpdateModel($scope.model.id).then(function(updateModel){updateIdValue(updateModel)}):$scope.model&&$scope.model.contentType&&$scope.model.attribute&&updateIdValue($scope.model)}function updateIdValue(updateModel){var idField=updateModel.contentType.contentTypeAttributes.filter(function(attr){return attr.identifying})[0];idField&&updateModel.attribute[idField.id][0]&&updateModel.attribute[idField.id][0].value?idField.attribute.translatable?$scope.value=$filter("altaicutoff")(updateModel.attribute[idField.id][0].value[currentLangCode],cutoffLength):$scope.value=$filter("altaicutoff")(updateModel.attribute[idField.id][0].value,cutoffLength):idField&&updateModel.attribute[idField.id].values&&updateModel.attribute[idField.id].values[0]&&updateModel.attribute[idField.id].values[0].value&&(idField.attribute.translatable?$scope.value=$filter("altaicutoff")(updateModel.attribute[idField.id].values[0].value[currentLangCode],cutoffLength):$scope.value=$filter("altaicutoff")(updateModel.attribute[idField.id].values[0].value,cutoffLength))}$scope.$on("dragstop",function(){updateFields()}),$scope.$watch("modelVisibility",function(){updateFields()});var cutoffLength=150,currentLangCode=languageFactory.getCurrentLangCode()}}}AltaiContent.AltaiContentIdFieldDirective=AltaiContentIdFieldDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentCollectionCreateDirective(){return{templateUrl:"/api/template/Admin/ContentCollectionCreate",controller:ContentCollectionCreateDirectiveController,controllerAs:"vm",link:ContentCollectionCreateDirectiveLink}}AltaiContent.AltaiContentCollectionCreateDirective=AltaiContentCollectionCreateDirective;var ContentCollectionCreateDirectiveLink=function(){function ContentCollectionCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContentCollection(scope.newContentCollection)},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}]}}return ContentCollectionCreateDirectiveLink}(),ContentCollectionCreateDirectiveController=function(){function ContentCollectionCreateDirectiveController(contentCollectionManager,wmContainerFactory){this.contentCollectionManager=contentCollectionManager,this.wmContainerFactory=wmContainerFactory}return ContentCollectionCreateDirectiveController.prototype.createContentCollection=function(newCollection){var s=this;this.contentCollectionManager.add(newCollection).then(function(result){var window=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentCollectionCreate);s.wmContainerFactory.destroyWindow(window.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentCollectionUpdate,newCollection.name,result.id)})},ContentCollectionCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentCollectionListDirective(){return{templateUrl:"/api/template/Admin/ContentCollectionList",controller:ContentCollectionListDirectiveController,controllerAs:"vm"}}AltaiContent.AltaiContentCollectionListDirective=AltaiContentCollectionListDirective;var ContentCollectionListDirectiveController=function(){function ContentCollectionListDirectiveController(contentCollectionManager,wmContainerFactory){var vm=this;this.wmContainerFactory=wmContainerFactory,contentCollectionManager.list().then(function(contentCollections){vm.contentCollections=contentCollections})}return ContentCollectionListDirectiveController.prototype.openContentCollectionProfile=function(contentCollection){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentCollectionUpdate,contentCollection.name,contentCollection.id)},ContentCollectionListDirectiveController.prototype.createContentCollection=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentCollectionCreate,"Create new content collection")},ContentCollectionListDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentCollectionUpdateDirective(){return{scope:{contentCollectionId:"="},templateUrl:"/api/template/Admin/ContentCollectionUpdate",controller:ContentCollectionUpdateDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentCollectionUpdateDirectiveLink}}AltaiContent.AltaiContentCollectionUpdateDirective=AltaiContentCollectionUpdateDirective;var ContentCollectionUpdateDirectiveLink=function(){function ContentCollectionUpdateDirectiveLink(scope){
scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateContentCollection()},"class":"altai-button-go",name:"save",separator:!0},{translatableTooltipId:"accesses",icon:"mdi-key",action:function(){scope.vm.openAccessesWindow()},"class":"altai-button-primary",name:"accesses",separator:!0},{icon:"mdi-camera",action:function(){scope.vm.openPreview()},"class":"altai-button-primary",name:"preview",separator:!0}],align:"left"}]}}return ContentCollectionUpdateDirectiveLink}(),ContentCollectionUpdateDirectiveController=function(){function ContentCollectionUpdateDirectiveController($rootScope,contentRelationFactory,contentAttributeService,$templateFactory,contentCollectionManager,wmContainerFactory){var vm=this;this.contentCollectionManager=contentCollectionManager,this.wmContainerFactory=wmContainerFactory,this.contentAttributeService=contentAttributeService,this.$rootScope=$rootScope,this.contentCollectionManager.getById(this.contentCollectionId).then(function(contentCollectionData){vm.contentCollection=contentCollectionData,contentRelationFactory.list().then(function(contentTypeRelations){vm.contentRelations=contentTypeRelations;for(var i=0;i<vm.contentRelations.length;i++)vm.contentRelations[i].selected=Boolean(vm.contentCollection.contentViewRelations.filter(function(rel){return rel.contentTypeRelationId==vm.contentRelations[i].id}).length)})}),$templateFactory.listTemplateByTypeName("content").then(function(templateList){vm.templates=templateList}),this.contentAttributeService.list().then(function(attributes){vm.contentAttributes=attributes})}return ContentCollectionUpdateDirectiveController.prototype.createContentCollectionFilter=function(newFilter){var s=this;newFilter.contentViewId=this.contentCollectionId,this.contentCollectionManager.createContentViewFilter(newFilter).then(function(){newFilter={},s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.deleteContentCollectionFilter=function(contentFilter){var s=this;this.contentCollectionManager.deleteContentViewFilter(this.contentCollectionId,contentFilter).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.createContentCollectionSorter=function(newContentViewSorter){var s=this;newContentViewSorter.contentViewId=this.contentCollectionId,this.contentCollectionManager.createContentViewSorter(newContentViewSorter).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.deleteContentCollectionSorter=function(selContentViewSorter){var s=this;this.contentCollectionManager.deleteContentViewSorter(selContentViewSorter).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.saveAttributes=function(attributes){var s=this;this.contentCollectionManager.updateAttributes(this.contentCollectionId,attributes).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.saveRelations=function(relations){var s=this;this.contentCollectionManager.updateRelations(this.contentCollectionId,relations).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.updateContentCollection=function(){var s=this;this.contentCollectionManager.update(this.contentCollection).then(function(){s.refreshPreview()})},ContentCollectionUpdateDirectiveController.prototype.openPreview=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentCollectionPreview,this.contentCollection.name+" preview",this.contentCollectionId)},ContentCollectionUpdateDirectiveController.prototype.refreshPreview=function(){this.$rootScope.$broadcast("ContentCollectionChanged")},ContentCollectionUpdateDirectiveController.prototype.openAccessesWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",ctrl.contentCollectionId,{securableName:"contentcollection.item"})},ContentCollectionUpdateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentCollectionPreviewDirective(){return{scope:{contentCollectionId:"="},template:"<div ng-include='$ctrl.templateUrl'></div><div ng-show='!$ctrl.templateUrl' style='padding:10px;'><i class='mdi mdi-information-outline'></i>&nbsp;{{'notemplateselected'|translate}}</div>",controller:ContentCollectionPreviewDirectiveController,controllerAs:"$ctrl",bindToController:!0}}AltaiContent.AltaiContentCollectionPreviewDirective=AltaiContentCollectionPreviewDirective;var ContentCollectionPreviewDirectiveController=function(){function ContentCollectionPreviewDirectiveController($rootScope,$scope,contentCollectionManager,contentCollectionDataService){function getData(){contentCollectionManager.getById(vm.contentCollectionId).then(function(collectionData){vm.contentCollection=collectionData,collectionData.templateId&&(vm.templateUrl="/api/template/"+collectionData.templateId)}),contentCollectionDataService.getData(vm.contentCollectionId).then(function(data){vm.data=data,vm.$scope.vm.data=data,0!=data.length&&(vm.properties=Object.keys(data.pageResults[0]))})}this.$scope=$scope;var vm=this;vm.$scope.vm={},$rootScope.$on("ContentCollectionChanged",getData),getData()}return ContentCollectionPreviewDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiExposedContentCollectionCreateDirective(){return{templateUrl:"/api/template/Admin/Search:ExposedContentCollectionCreate",controller:ExposedContentCollectionCreateDirectiveController,controllerAs:"$ctrl",link:ExposedContentCollectionCreateDirectiveLink}}AltaiContent.AltaiExposedContentCollectionCreateDirective=AltaiExposedContentCollectionCreateDirective;var ExposedContentCollectionCreateDirectiveLink=function(){function ExposedContentCollectionCreateDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.createExposedContentCollection(scope.newExposedContentCollection)},"class":"altai-button-go",name:"create",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ExposedContentCollectionCreateDirectiveLink}(),ExposedContentCollectionCreateDirectiveController=function(){function ExposedContentCollectionCreateDirectiveController(exposedContentCollectionManager,wmContainerFactory,$templateFactory){this.exposedContentCollectionManager=exposedContentCollectionManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;$templateFactory.listTemplateByTypeName("exposedcontentcollection").then(function(templateList){ctrl.templates=templateList})}return ExposedContentCollectionCreateDirectiveController.prototype.createExposedContentCollection=function(newExposedCollection){var s=this;this.exposedContentCollectionManager.add(newExposedCollection).then(function(result){var window=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionCreate);s.wmContainerFactory.destroyWindow(window.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionUpdate,newExposedCollection.name,result.id)})},ExposedContentCollectionCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiExposedContentCollectionListDirective(){return{templateUrl:"/api/template/Admin/Search:ExposedContentCollectionList",controller:ExposedContentCollectionListDirectiveController,controllerAs:"vm"}}AltaiContent.AltaiExposedContentCollectionListDirective=AltaiExposedContentCollectionListDirective;var ExposedContentCollectionListDirectiveController=function(){function ExposedContentCollectionListDirectiveController(exposedContentCollectionManager,wmContainerFactory){var vm=this;this.wmContainerFactory=wmContainerFactory,exposedContentCollectionManager.list().then(function(exposedContentCollection){vm.exposedContentCollections=exposedContentCollection})}return ExposedContentCollectionListDirectiveController.prototype.openExposedContentCollectionProfile=function(exposedContentCollection){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionUpdate,exposedContentCollection.name,exposedContentCollection.id)},ExposedContentCollectionListDirectiveController.prototype.createExposedContentCollection=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionCreate,"Create new exposed content collection")},ExposedContentCollectionListDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiExposedContentCollectionUpdateDirective(){return{scope:{exposedContentCollectionId:"="},templateUrl:"/api/template/Admin/Search:ExposedContentCollectionUpdate",controller:ExposedContentCollectionUpdateDirectiveController,controllerAs:"vm",bindToController:!0,link:ExposedContentCollectionUpdateDirectiveLink}}AltaiContent.AltaiExposedContentCollectionUpdateDirective=AltaiExposedContentCollectionUpdateDirective;var ExposedContentCollectionUpdateDirectiveLink=function(){function ExposedContentCollectionUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateExposedContentCollection()},"class":"altai-button-go",name:"save",separator:!0},{translatableTooltipId:"accesses",icon:"mdi-key",action:function(){scope.vm.openAccessesWindow()},"class":"altai-button-primary",name:"accesses",separator:!0},{icon:"mdi-camera",action:function(){scope.vm.openPreview()},"class":"altai-button-primary",name:"preview",separator:!0},{icon:"mdi-delete",action:function(){scope.vm.deleteExposedContentCollection()},"class":"altai-button-back",name:"delete",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ExposedContentCollectionUpdateDirectiveLink}(),ExposedContentCollectionUpdateDirectiveController=function(){function ExposedContentCollectionUpdateDirectiveController(exposedContentCollectionManager,exposedContentCollectionFilterManager,exposedContentCollectionAttributeManager,exposedContentCollectionSorterManager,exposedContentCollectionRangeManager,contentTypeService,$rootScope,$scope,contentRelationFactory,contentAttributeService,$templateFactory,contentCollectionManager,wmContainerFactory,altaiConfirmationService){this.exposedContentCollectionManager=exposedContentCollectionManager,this.exposedContentCollectionFilterManager=exposedContentCollectionFilterManager,this.exposedContentCollectionAttributeManager=exposedContentCollectionAttributeManager,this.exposedContentCollectionSorterManager=exposedContentCollectionSorterManager,this.exposedContentCollectionRangeManager=exposedContentCollectionRangeManager,this.contentTypeService=contentTypeService,this.altaiConfirmationService=altaiConfirmationService;var ctrl=this;this.ctaSortOptions=this.handleSorting(),this.wmContainerFactory=wmContainerFactory,this.contentAttributeService=contentAttributeService,this.$rootScope=$rootScope,this.scope=$scope,$rootScope.$on("exposedContentCollectionChanged",function(){console.log("exposedContentCollectionChanged"),ctrl.getData()}),ctrl.getData(),$templateFactory.listTemplateByTypeName("exposedcontentcollection").then(function(templateList){ctrl.templates=templateList})}return ExposedContentCollectionUpdateDirectiveController.prototype.getData=function(){var ctrl=this;console.log(ctrl.exposedContentCollectionId),ctrl.exposedContentCollectionManager.getById(ctrl.exposedContentCollectionId,!1).then(function(exposedContentCollectionData){ctrl.exposedContentCollection=exposedContentCollectionData,ctrl.exposedContentCollection["default"]=-1===exposedContentCollectionData.linkedContentTypeId,ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=angular.copy(contentTypes),ctrl.contentTypes.map(function(ct){return ct.ticked=1===ctrl.exposedContentCollection.exposedContentCollectionTypes.filter(function(filter){return filter.contentTypeId==ct.id}).length,ct})})})},ExposedContentCollectionUpdateDirectiveController.prototype.updateExposedContentCollection=function(){var ctrl=this;ctrl.exposedContentCollection["default"]&&(ctrl.exposedContentCollection.linkedContentTypeId=-1),ctrl.exposedContentCollection.exposedContentCollectionTypes=ctrl.contentTypesOutput.filter(function(ct){return ct.ticked}).map(function(ct){return{contentTypeId:ct.id}}),ctrl.exposedContentCollectionManager.update(ctrl.exposedContentCollection).then(function(result){})},ExposedContentCollectionUpdateDirectiveController.prototype.closeWindow=function(){var ctrl=this,win=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionUpdate,ctrl.exposedContentCollectionId);ctrl.wmContainerFactory.destroyWindow(win.id)},ExposedContentCollectionUpdateDirectiveController.prototype.openAccessesWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",ctrl.exposedContentCollectionId,{securableName:"exposedcontentcollection.item"})},ExposedContentCollectionUpdateDirectiveController.prototype.deleteExposedContentCollection=function(){var ctrl=this;ctrl.exposedContentCollectionManager["delete"](ctrl.exposedContentCollection).then(function(result){ctrl.closeWindow()})},ExposedContentCollectionUpdateDirectiveController.prototype.deleteExposedContentCollectionFilter=function(filter){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.exposedContentCollectionFilterManager["delete"](filter).then(function(result){ctrl.exposedContentCollection.exposedContentCollectionFilters.splice(ctrl.exposedContentCollection.exposedContentCollectionFilters.indexOf(filter),1)})})},ExposedContentCollectionUpdateDirectiveController.prototype.deleteExposedContentCollectionSorter=function(sorter){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.exposedContentCollectionSorterManager["delete"](sorter).then(function(result){if(sorter.order<ctrl.exposedContentCollection.exposedContentCollectionSorters.length-1){var sortersToUpdate=ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.order>sorter.order});for(var x in sortersToUpdate)ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.id==sortersToUpdate[x].id})[0].order-=1}ctrl.exposedContentCollection.exposedContentCollectionSorters.splice(ctrl.exposedContentCollection.exposedContentCollectionSorters.indexOf(sorter),1),ctrl.updateExposedContentCollection()})})},ExposedContentCollectionUpdateDirectiveController.prototype.sortPositionUp=function(sorter){var ctrl=this;sorter.order>0&&(sorter.order,ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.order==sorter.order-1})[0].order=sorter.order,ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.id==sorter.id})[0].order=sorter.order-1,ctrl.scope.$apply)},ExposedContentCollectionUpdateDirectiveController.prototype.sortPositionDown=function(sorter){var ctrl=this;sorter.order<ctrl.exposedContentCollection.exposedContentCollectionSorters.length-1&&(ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.order==sorter.order+1})[0].order=sorter.order,ctrl.exposedContentCollection.exposedContentCollectionSorters.filter(function(sort){return sort.id==sorter.id})[0].order=sorter.order+1,ctrl.scope.$apply)},ExposedContentCollectionUpdateDirectiveController.prototype.deleteExposedContentCollectionRange=function(range){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.exposedContentCollectionRangeManager["delete"](range).then(function(result){ctrl.exposedContentCollection.exposedContentCollectionRanges.splice(ctrl.exposedContentCollection.exposedContentCollectionRanges.indexOf(range),1)})})},ExposedContentCollectionUpdateDirectiveController.prototype.deleteExposedContentCollectionAttribute=function(attribute){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.exposedContentCollectionAttributeManager["delete"](attribute).then(function(result){ctrl.exposedContentCollection.exposedContentCollectionAttributes.splice(ctrl.exposedContentCollection.exposedContentCollectionAttributes.indexOf(attribute),1)})})},ExposedContentCollectionUpdateDirectiveController.prototype.openUpdateFilterWindow=function(filter){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionFilterUpdate,"Update filter",filter.id)},ExposedContentCollectionUpdateDirectiveController.prototype.openCreateFilterWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionFilterCreate,"Create filter",ctrl.exposedContentCollectionId)},ExposedContentCollectionUpdateDirectiveController.prototype.openCreateSorterWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionSorterCreate,"Create sorter",ctrl.exposedContentCollectionId)},ExposedContentCollectionUpdateDirectiveController.prototype.openUpdateSorterWindow=function(sorter){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionSorterUpdate,"Update sorter",sorter.id)},ExposedContentCollectionUpdateDirectiveController.prototype.openCreateRangeWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionRangeCreate,"Create range",ctrl.exposedContentCollectionId)},ExposedContentCollectionUpdateDirectiveController.prototype.openUpdateRangeWindow=function(range){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionRangeUpdate,"Update range",range.id)},ExposedContentCollectionUpdateDirectiveController.prototype.openUpdateAttributeWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionAttributeUpdate,"Update attributes",ctrl.exposedContentCollectionId)},ExposedContentCollectionUpdateDirectiveController.prototype.openPreview=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionPreview,"Preview exposedcontentcolleciton",ctrl.exposedContentCollectionId)},ExposedContentCollectionUpdateDirectiveController.prototype.handleSorting=function(){var s=this;return{stop:function(e,ui){s.exposedContentCollectionFilterManager.updateFilterSorting(s.exposedContentCollection.exposedContentCollectionFilters)}}},ExposedContentCollectionUpdateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiExposedContentCollectionPreviewDirective(){return{scope:{exposedContentCollectionId:"="},template:"{{$ctrl.template}}",controller:ExposedContentCollectionPreviewDirectiveController,controllerAs:"$ctrl",bindToController:!0}}AltaiContent.AltaiExposedContentCollectionPreviewDirective=AltaiExposedContentCollectionPreviewDirective;var ExposedContentCollectionPreviewDirectiveController=function(){function ExposedContentCollectionPreviewDirectiveController($rootScope,$scope,$compile,$element,exposedContentCollectionManager,contentCollectionDataService){this.$scope=$scope,this.loading=!0;var ctrl=this;exposedContentCollectionManager.getById(ctrl.exposedContentCollectionId).then(function(exposedContentCollection){ctrl.loading=!1,ctrl.exposedContentCollection=exposedContentCollection,$element.html($compile("<altai-exposed-content-collection exposed-content-collection-id='"+ctrl.exposedContentCollectionId+"' template-id='"+ctrl.exposedContentCollection.templateId+"'></altai-exposed-content-collection>")($scope))})}return ExposedContentCollectionPreviewDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionFilterCreateComponent=function(){function ExposedContentCollectionFilterCreateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionFilterCreate",this.controller=ExposedContentCollectionFilterCreateComponentController,this.bindings={exposedContentCollectionId:"="}}return ExposedContentCollectionFilterCreateComponent}();AltaiContent.ExposedContentCollectionFilterCreateComponent=ExposedContentCollectionFilterCreateComponent;var ExposedContentCollectionFilterCreateComponentController=function(){function ExposedContentCollectionFilterCreateComponentController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,exposedContentCollectionFilterManager,$rootScope,contentItemService,contentRelationFactory,$scope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionFilterManager=exposedContentCollectionFilterManager,this.$rootScope=$rootScope,this.contentItemService=contentItemService,this.contentRelationFactory=contentRelationFactory,this.filterTypes=[{value:"term",label:"Term"},{value:"relation",label:"Relatie"},{value:"range",label:"Range"},{value:"contenttype",label:"Content Type"},{value:"MoreLikeThis",label:"More Like This"}];var ctrl=this;ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes,ctrl.contentTypeAttributes.push({id:"0",attribute:{name:"id",label:"Id"},attributeId:"0",contentTypeId:null,options:null}),ctrl.contentTypeAttributes.push({id:"-1",attribute:{name:"published",label:"Published"},attributeId:"-1",contentTypeId:null,options:null})}),$scope.$watch("newFilter.type",function(){$scope.newFilter&&"relation"==$scope.newFilter.filterType&&$scope.newFilter.type.id&&ctrl.contentItemService.listContentByType($scope.newFilter.type.id).then(function(options){ctrl.valueOptions=options})}),$scope.$watch("newFilter.filterType",function(){$scope.newFilter&&"contenttype"==$scope.newFilter.filterType&&(ctrl.valueOptions=angular.copy(ctrl.contentTypes))})}return ExposedContentCollectionFilterCreateComponentController.prototype.createNewFilter=function(newFilter){var ctrl=this;if("relation"==newFilter.filterType&&(newFilter.typeId=newFilter.type.id,newFilter.type=newFilter.type.name),"contenttype"==newFilter.filterType&&(newFilter.typeId=null,newFilter.type=null,newFilter.field=null),"term"==newFilter.filterType&&(newFilter.typeId=null,newFilter.type=null),null!=ctrl.valueOptionsOutput&&ctrl.valueOptionsOutput.length>0){newFilter.exposedContentCollectionFilterSelectedValues=[];for(var x in ctrl.valueOptionsOutput)newFilter.exposedContentCollectionFilterSelectedValues.push({valueId:ctrl.valueOptionsOutput[x].id,valueParameter:void 0,value:void 0})}if(null!=ctrl.valueParameter&&ctrl.valueParameter.length>0&&(newFilter.exposedContentCollectionFilterSelectedValues=[],newFilter.exposedContentCollectionFilterSelectedValues.push({valueId:void 0,valueParameter:ctrl.valueParameter,value:void 0})),null!=ctrl.values&&ctrl.values.length>0){var values=ctrl.values.split(";");if(values.length>0){newFilter.exposedContentCollectionFilterSelectedValues=[];for(var x in values)void 0!=values[x]&&""!=values[x]&&newFilter.exposedContentCollectionFilterSelectedValues.push({valueId:void 0,valueParameter:void 0,value:values[x]})}}newFilter.exposedContentCollectionId=ctrl.exposedContentCollectionId,ctrl.exposedContentCollectionFilterManager.add(newFilter).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionFilterCreate,ctrl.exposedContentCollectionId);ctrl.wmContainerFactory.destroyWindow(currentWin.id),ctrl.$rootScope.$broadcast("exposedContentCollectionChanged")})},ExposedContentCollectionFilterCreateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionFilterUpdateComponent=function(){function ExposedContentCollectionFilterUpdateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionFilterUpdate",this.controller=ExposedContentCollectionFilterUpdateComponentController,this.bindings={exposedContentCollectionFilterId:"="}}return ExposedContentCollectionFilterUpdateComponent}();AltaiContent.ExposedContentCollectionFilterUpdateComponent=ExposedContentCollectionFilterUpdateComponent;var ExposedContentCollectionFilterUpdateComponentController=function(){function ExposedContentCollectionFilterUpdateComponentController(contentTypeService,contentTypeAttributeManager,contentItemService,wmContainerFactory,exposedContentCollectionFilterManager,exposedContentCollectionFilterMLTCriteriumManager,$rootScope,contentRelationFactory,$scope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.contentItemService=contentItemService,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionFilterManager=exposedContentCollectionFilterManager,this.exposedContentCollectionFilterMLTCriteriumManager=exposedContentCollectionFilterMLTCriteriumManager,this.$rootScope=$rootScope,this.contentRelationFactory=contentRelationFactory,this.$scope=$scope,this.values="",this.filterTypes=[{value:"term",label:"Term"},{value:"relation",label:"Relatie"},{value:"range",label:"Range"},{value:"contenttype",label:"Content Type"},{value:"MoreLikeThis",label:"More Like This"}];var ctrl=this;ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes,ctrl.contentTypeAttributes.push({attribute:{name:"id",label:"Id"}}),ctrl.contentTypeAttributes.push({attribute:{name:"published",label:"Published"}}),ctrl.exposedContentCollectionFilterManager.getById(ctrl.exposedContentCollectionFilterId,!1).then(function(result){ctrl.exposedContentCollectionFilter=result,ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes,ctrl.exposedContentCollectionFilter.type=contentTypes.filter(function(ct){return ct.name==ctrl.exposedContentCollectionFilter.type})[0],ctrl.exposedContentCollectionFilter.field=ctrl.contentTypeAttributes.filter(function(attr){return attr.attribute.name==ctrl.exposedContentCollectionFilter.field&&("relation"==ctrl.exposedContentCollectionFilter.filterType?attr.contentTypeId==ctrl.exposedContentCollectionFilter.type.id:!0)||attr.attribute.name==ctrl.exposedContentCollectionFilter.field.split(".raw")[0]})[0]})})}),$scope.$watch("$ctrl.exposedContentCollectionFilter.type",function(){ctrl.exposedContentCollectionFilter&&"relation"==ctrl.exposedContentCollectionFilter.filterType&&ctrl.exposedContentCollectionFilter.type.id&&ctrl.contentItemService.listContentByType(ctrl.exposedContentCollectionFilter.type.id).then(function(options){ctrl.valueOptions=options,ctrl.exposedContentCollectionFilter.valueOptionsOutput=[];for(var x in ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues)if(null==ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].valueParameter){var index=ctrl.valueOptions.indexOf(ctrl.valueOptions.filter(function(elm){return elm.id==ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].valueId})[0]);index>=0&&(ctrl.valueOptions[index].ticked=!0)}else ctrl.valueParameter=ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].valueParameter;ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues=[]})}),$scope.$watch("$ctrl.exposedContentCollectionFilter.field",function(){if(ctrl.exposedContentCollectionFilter&&"term"==ctrl.exposedContentCollectionFilter.filterType){ctrl.values="";for(var x in ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues)null==ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].valueParameter&&null!=ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].value&&""!=ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].value?(void 0!=ctrl.values&&ctrl.values.length>0&&(ctrl.values+=";"),ctrl.values+=ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].value):ctrl.valueParameter=ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues[x].valueParameter}}),$scope.$watch("$ctrl.exposedContentCollectionFilter.filterType",function(){ctrl.exposedContentCollectionFilter&&"contenttype"==ctrl.exposedContentCollectionFilter.filterType?ctrl.valueOptions=angular.copy(ctrl.contentTypes):ctrl.exposedContentCollectionFilter&&"MoreLikeThis"==ctrl.exposedContentCollectionFilter.filterType&&console.log("MLT")})}return ExposedContentCollectionFilterUpdateComponentController.prototype.updateFilter=function(){var ctrl=this;if("relation"==ctrl.exposedContentCollectionFilter.filterType&&(ctrl.exposedContentCollectionFilter.typeId=ctrl.exposedContentCollectionFilter.type.id,ctrl.exposedContentCollectionFilter.type=ctrl.exposedContentCollectionFilter.type.name,ctrl.exposedContentCollectionFilter.field=ctrl.exposedContentCollectionFilter.field.attribute.name),"contenttype"==ctrl.exposedContentCollectionFilter.filterType&&(ctrl.exposedContentCollectionFilter.typeId=null,ctrl.exposedContentCollectionFilter.type=null,ctrl.exposedContentCollectionFilter.field=null),"term"==ctrl.exposedContentCollectionFilter.filterType&&(ctrl.exposedContentCollectionFilter.typeId=null,ctrl.exposedContentCollectionFilter.type=null,ctrl.exposedContentCollectionFilter.field=ctrl.exposedContentCollectionFilter.field.attribute.name+(2==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId||4==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId||10==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId||14==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId||15==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId||16==ctrl.exposedContentCollectionFilter.field.attribute.attributeTypeId?".raw":""),null!=ctrl.values)){var values=ctrl.values.split(";");if(values.length>0){ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues=[];for(var x in values)void 0!=values[x]&&""!=values[x]&&ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues.push({exposedContentCollectionFilterId:ctrl.exposedContentCollectionFilter.id,value:values[x],valueId:void 0,valueParameter:void 0})}}if("MoreLikeThis"==ctrl.exposedContentCollectionFilter.filterType&&(ctrl.exposedContentCollectionFilter.typeId=ctrl.exposedContentCollectionFilter.type.id,ctrl.exposedContentCollectionFilter.type=ctrl.exposedContentCollectionFilter.type.name,ctrl.exposedContentCollectionFilter.field=null),null!=ctrl.valueOptionsOutput&&ctrl.valueOptionsOutput.length>0){ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues=[];for(var x in ctrl.valueOptionsOutput)ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues.push({exposedContentCollectionFilterId:ctrl.exposedContentCollectionFilter.id,valueId:ctrl.valueOptionsOutput[x].id,valueParameter:void 0,value:void 0})}null!=ctrl.valueParameter&&ctrl.valueParameter.length>0&&(ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues=[],ctrl.exposedContentCollectionFilter.exposedContentCollectionFilterSelectedValues.push({exposedContentCollectionFilterId:ctrl.exposedContentCollectionFilter.id,valueId:void 0,valueParameter:ctrl.valueParameter,value:void 0})),ctrl.exposedContentCollectionFilterManager.update(ctrl.exposedContentCollectionFilter).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionFilterUpdate,ctrl.exposedContentCollectionFilterId);ctrl.wmContainerFactory.destroyWindow(currentWin.id),
ctrl.$rootScope.$broadcast("exposedContentCollectionChanged")})},ExposedContentCollectionFilterUpdateComponentController.prototype.openCreateMLTCriteriumWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.exposedContentCollectionFilterMltCriteriumCreate,"Create MLT Criterium",ctrl.exposedContentCollectionFilterId)},ExposedContentCollectionFilterUpdateComponentController.prototype.deleteMLTCriteria=function(criteria){var ctrl=this;ctrl.exposedContentCollectionFilterMLTCriteriumManager["delete"](criteria).then(function(i){var index=ctrl.exposedContentCollectionFilter.expContCollFilMLTCriteria.indexOf(criteria);console.log(index),index>=0&&ctrl.exposedContentCollectionFilter.expContCollFilMLTCriteria.splice(index,1)})},ExposedContentCollectionFilterUpdateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionSorterUpdateComponent=function(){function ExposedContentCollectionSorterUpdateComponent(){this.templateUrl="/api/template/Admin/Search:exposedcontentcollectionsorterupdate",this.controller=ExposedContentCollectionSorterUpdateComponentController,this.bindings={exposedContentCollectionSorterId:"="}}return ExposedContentCollectionSorterUpdateComponent}();AltaiContent.ExposedContentCollectionSorterUpdateComponent=ExposedContentCollectionSorterUpdateComponent;var ExposedContentCollectionSorterUpdateComponentController=function(){function ExposedContentCollectionSorterUpdateComponentController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,exposedContentCollectionSorterManager,$rootScope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionSorterManager=exposedContentCollectionSorterManager,this.$rootScope=$rootScope;var ctrl=this;ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),ctrl.scoredQuery=[{label:"termOrder",value:0},{label:"Date",value:1}],ctrl.attributes=[{label:"Created",value:"created"},{label:"Updated",value:"lastUpdated"},{label:"Date",value:"date"}],ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes}),ctrl.exposedContentCollectionSorterManager.getById(ctrl.exposedContentCollectionSorterId).then(function(result){ctrl.exposedContentCollectionSorter=result,1==ctrl.exposedContentCollectionSorter.scoredQuery&&(ctrl.offset=parseInt(ctrl.exposedContentCollectionSorter.offset.split("d")[0]),ctrl.scale=parseInt(ctrl.exposedContentCollectionSorter.scale.split("d")[0])),void 0==ctrl.exposedContentCollectionSorter.decay&&(ctrl.exposedContentCollectionSorter.decay=.5),void 0==ctrl.exposedContentCollectionSorter.offset&&(ctrl.exposedContentCollectionSorter.offset=5),void 0==ctrl.exposedContentCollectionSorter.scale&&(ctrl.exposedContentCollectionSorter.scale=10)})}return ExposedContentCollectionSorterUpdateComponentController.prototype.updateSorter=function(newSorter){var ctrl=this;1==newSorter.scoredQuery?(newSorter.offset=ctrl.offset+"d",newSorter.scale=ctrl.scale+"d",newSorter.origin="now"):(newSorter.decay=void 0,newSorter.offset=void 0,newSorter.scale=void 0,newSorter.origin=void 0),0==newSorter.scoredQuery&&ctrl.relevance&&(newSorter.field="_score"),ctrl.exposedContentCollectionSorterManager.update(ctrl.exposedContentCollectionSorter).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionSorterUpdate,ctrl.exposedContentCollectionSorterId);ctrl.wmContainerFactory.destroyWindow(currentWin.id),ctrl.$rootScope.$broadcast("exposedContentCollectionChanged")})},ExposedContentCollectionSorterUpdateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionSorterCreateComponent=function(){function ExposedContentCollectionSorterCreateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionsortercreate",this.controller=ExposedContentCollectionSorterCreateComponentController,this.bindings={exposedContentCollectionId:"="}}return ExposedContentCollectionSorterCreateComponent}();AltaiContent.ExposedContentCollectionSorterCreateComponent=ExposedContentCollectionSorterCreateComponent;var ExposedContentCollectionSorterCreateComponentController=function(){function ExposedContentCollectionSorterCreateComponentController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,exposedContentCollectionSorterManager){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionSorterManager=exposedContentCollectionSorterManager;var ctrl=this;this.scoredQuery=[{label:"termOrder",value:0},{label:"Date",value:1}],ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes}),ctrl.attributes=[{label:"Created",value:"created"},{label:"Updated",value:"lastUpdated"}]}return ExposedContentCollectionSorterCreateComponentController.prototype.createNewSorter=function(newSorter){var ctrl=this;newSorter.exposedContentCollectionId=ctrl.exposedContentCollectionId,1==newSorter.scoredQuery&&(newSorter.offset=ctrl.offset+"d",newSorter.scale=ctrl.scale+"d",newSorter.origin="now"),0==newSorter.scoredQuery&&ctrl.relevance&&(newSorter.field="_score"),ctrl.exposedContentCollectionSorterManager.add(newSorter).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionSorterCreate,ctrl.exposedContentCollectionId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},ExposedContentCollectionSorterCreateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionRangeUpdateComponent=function(){function ExposedContentCollectionRangeUpdateComponent(){this.templateUrl="/api/template/Admin/Search:exposedcontentcollectionrangeupdate",this.controller=ExposedContentCollectionRangeUpdateComponentController,this.bindings={exposedContentCollectionRangeId:"="}}return ExposedContentCollectionRangeUpdateComponent}();AltaiContent.ExposedContentCollectionRangeUpdateComponent=ExposedContentCollectionRangeUpdateComponent;var ExposedContentCollectionRangeUpdateComponentController=function(){function ExposedContentCollectionRangeUpdateComponentController(wmContainerFactory,exposedContentCollectionRangeManager,$rootScope){this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionRangeManager=exposedContentCollectionRangeManager,this.$rootScope=$rootScope;var ctrl=this;ctrl.rangeTypes=[{label:"Date",value:"date"}],ctrl.exposedContentCollectionRangeManager.getById(ctrl.exposedContentCollectionRangeId).then(function(result){ctrl.exposedContentCollectionRange=result})}return ExposedContentCollectionRangeUpdateComponentController.prototype.updateRange=function(newRange){var ctrl=this;ctrl.exposedContentCollectionRangeManager.update(ctrl.exposedContentCollectionRange).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionSorterUpdate,ctrl.exposedContentCollectionRangeId);ctrl.wmContainerFactory.destroyWindow(currentWin.id),ctrl.$rootScope.$broadcast("exposedContentCollectionChanged")})},ExposedContentCollectionRangeUpdateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionRangeCreateComponent=function(){function ExposedContentCollectionRangeCreateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionrangecreate",this.controller=ExposedContentCollectionRangeCreateComponentController,this.bindings={exposedContentCollectionId:"="}}return ExposedContentCollectionRangeCreateComponent}();AltaiContent.ExposedContentCollectionRangeCreateComponent=ExposedContentCollectionRangeCreateComponent;var ExposedContentCollectionRangeCreateComponentController=function(){function ExposedContentCollectionRangeCreateComponentController(wmContainerFactory,exposedContentCollectionRangeManager){this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionRangeManager=exposedContentCollectionRangeManager;this.rangeTypes=[{label:"Date",value:"date"}]}return ExposedContentCollectionRangeCreateComponentController.prototype.createNewRange=function(newRange){var ctrl=this;newRange.exposedContentCollectionId=ctrl.exposedContentCollectionId,ctrl.exposedContentCollectionRangeManager.add(newRange).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.exposedContentCollectionRangeCreate,ctrl.exposedContentCollectionId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},ExposedContentCollectionRangeCreateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionAttributeUpdateComponent=function(){function ExposedContentCollectionAttributeUpdateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionAttributeUpdate",this.controller=ExposedContentCollectionAttributeUpdateComponentController,this.bindings={exposedContentCollectionId:"="}}return ExposedContentCollectionAttributeUpdateComponent}();AltaiContent.ExposedContentCollectionAttributeUpdateComponent=ExposedContentCollectionAttributeUpdateComponent;var ExposedContentCollectionAttributeUpdateComponentController=function(){function ExposedContentCollectionAttributeUpdateComponentController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,exposedContentCollectionManager,exposedContentCollectionFilterManager,exposedContentCollectionAttributeManager,$rootScope,contentItemService,contentRelationFactory,$scope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionManager=exposedContentCollectionManager,this.exposedContentCollectionFilterManager=exposedContentCollectionFilterManager,this.exposedContentCollectionAttributeManager=exposedContentCollectionAttributeManager,this.$rootScope=$rootScope,this.contentItemService=contentItemService,this.contentRelationFactory=contentRelationFactory,this.relation=[],this.fixed=!1,this.newAttribute={ExposedContentCollectionId:0,ExpContCollFields:[{ExpContCollPaths:[]}]},this.includes=[],this.depth=[],this.firstLevel=[];var ctrl=this;ctrl.exposedContentCollectionAttributeManager.getAttributes(ctrl.exposedContentCollectionId).then(function(result){ctrl.includes=result}),ctrl.exposedContentCollectionManager.getContentTypes(ctrl.exposedContentCollectionId).then(function(result){ctrl.contentTypeIds=result})}return ExposedContentCollectionAttributeUpdateComponentController.prototype.update=function(){var ctrl=this;ctrl.exposedContentCollectionAttributeManager.updateAttributes(ctrl.exposedContentCollectionId,ctrl.includes).then(function(result){})},ExposedContentCollectionAttributeUpdateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ExposedContentCollectionFilterMltCriteriumCreateComponent=function(){function ExposedContentCollectionFilterMltCriteriumCreateComponent(){this.templateUrl="/api/template/Admin/Search:ExposedContentCollectionFilterMLTCriteriumCreate",this.controller=ExposedContentCollectionFilterMltCriteriumCreateComponentController,this.bindings={exposedContentCollectionFilterId:"="}}return ExposedContentCollectionFilterMltCriteriumCreateComponent}();AltaiContent.ExposedContentCollectionFilterMltCriteriumCreateComponent=ExposedContentCollectionFilterMltCriteriumCreateComponent;var ExposedContentCollectionFilterMltCriteriumCreateComponentController=function(){function ExposedContentCollectionFilterMltCriteriumCreateComponentController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,exposedContentCollectionFilterManager,exposedContentCollectionFilterMLTCriteriumManager,$rootScope,contentItemService,contentRelationFactory,$scope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionFilterManager=exposedContentCollectionFilterManager,this.exposedContentCollectionFilterMLTCriteriumManager=exposedContentCollectionFilterMLTCriteriumManager,this.$rootScope=$rootScope,this.contentItemService=contentItemService,this.contentRelationFactory=contentRelationFactory,this.relation=[],this.includes=[],this.fixed=!1,this.newCriterium={Boost:1,MinTermFreq:2,MaxQueryTerms:5,Filter:!1,ExposedContentCollectionFilterId:0,ExpContCollFields:[{ExpContCollPaths:[]}]};var ctrl=this;ctrl.exposedContentCollectionFilterManager.getById(ctrl.exposedContentCollectionFilterId).then(function(filter){ctrl.filter=filter}),ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes}),ctrl.contentRelationFactory.listWithLinks().then(function(relations){ctrl.relations=relations,ctrl.relations.push({id:0,name:"None",contentTypeRelationLinks:[{contentTypeId:2,includeByDefault:!1},{contentTypeId:12,includeByDefault:!1},{contentTypeId:1,includeByDefault:!1}]})}),ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes}),$scope.$watch("$ctrl.relation",function(value){ctrl.updateField()},!0),$scope.$watch("$ctrl.field",function(value){ctrl.updateField()}),$scope.$watchCollection("$ctrl.includes",function(value){console.log(value)})}return ExposedContentCollectionFilterMltCriteriumCreateComponentController.prototype.updateField=function(){var ctrl=this;ctrl.resultField="";for(var x in ctrl.relation)ctrl.resultField+=ctrl.relation[x].name,ctrl.resultField.length>0&&void 0!=ctrl.relation[x].name&&(ctrl.resultField+=".");void 0!=ctrl.field&&(ctrl.resultField+=ctrl.field.attribute.name)},ExposedContentCollectionFilterMltCriteriumCreateComponentController.prototype.createNewCriterium=function(){var ctrl=this;ctrl.newCriterium.ExposedContentCollectionFilterId=ctrl.filter.id,ctrl.newCriterium.ExpContCollFields[0].ExpContCollPaths=ctrl.includes[0].expContCollFields[0].expContCollPaths,ctrl.exposedContentCollectionFilterMLTCriteriumManager.add(ctrl.newCriterium).then(function(result){console.log(result)})},ExposedContentCollectionFilterMltCriteriumCreateComponentController.prototype.getNumber=function(num){return new Array(num)},ExposedContentCollectionFilterMltCriteriumCreateComponentController.prototype.getTypeId=function(index){var ctrl=this,id=void 0;return angular.forEach(ctrl.relation[index].contentTypeRelationLinks,function(value,key){var contentTypeId=value.contentTypeId;index>0?angular.forEach(ctrl.relation[index-1].contentTypeRelationLinks,function(prevvalue,prevkey){contentTypeId.contentTypeId!=prevvalue.contentTypeId&&(id=contentTypeId)}):contentTypeId!=ctrl.filter.typeId&&(id=contentTypeId)}),id},ExposedContentCollectionFilterMltCriteriumCreateComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiSearchSelectComponent=function(){function AltaiSearchSelectComponent(){this.templateUrl="/api/template/Admin/Content:SearchSelect",this.controller=AltaiSearchSelectComponentController,this.bindings={contentTypeId:"=",model:"=",options:"=",allowMultiple:"="}}return AltaiSearchSelectComponent}();AltaiContent.AltaiSearchSelectComponent=AltaiSearchSelectComponent;var AltaiSearchSelectComponentController=function(){function AltaiSearchSelectComponentController($scope,wmContainerFactory,contentItemSelectionService,altaiConfirmationService){this.wmContainerFactory=wmContainerFactory,this.contentItemSelectionService=contentItemSelectionService,this.altaiConfirmationService=altaiConfirmationService;var ctrl=this;ctrl.selectionKey=ctrl.contentItemSelectionService.getAvailableSelectionKey();var modelWatcher=$scope.$watch("$ctrl.model",function(){if(ctrl.model&&ctrl.model.length){for(var i=0;i<ctrl.model.length;i++)ctrl.contentItemSelectionService.addToSelection(ctrl.selectionKey,ctrl.model[i],!1);var optionsWatcher=$scope.$watch("$ctrl.options",function(){if(ctrl.options){for(var i=0;i<ctrl.model.length;i++){var modelObj=ctrl.model[i],namedObj=ctrl.options.filter(function(item){return item.id==modelObj.id})[0];namedObj&&(modelObj.name=namedObj.name)}optionsWatcher()}});modelWatcher()}});ctrl.sortingOptions={handle:".drag-handle",stop:function(){ctrl.sortingExistingModelUpdate()}},ctrl.contentItemSelectionService.observeSelection(ctrl.selectionKey,function(){var i=0;modelWatcher(),ctrl.allowMultiple||ctrl.contentItemSelectionService.applySingleItemPolicy(ctrl.selectionKey);for(var selection=ctrl.contentItemSelectionService.getSelection(ctrl.selectionKey),removedItems=ctrl.model.filter(function(elm){return 0===selection.filter(function(sel){return sel.id==elm.id}).length}),i=0;i<removedItems.length;i++)ctrl.model.splice(ctrl.model.indexOf(removedItems[i]),1);for(var addedItems=selection.filter(function(sel){return 0===ctrl.model.filter(function(elm){return sel.id==elm.id}).length}),i=0;i<addedItems.length;i++)ctrl.model.push(addedItems[i])})}return AltaiSearchSelectComponentController.prototype.sortingExistingModelUpdate=function(){var i=0;this.model.map(function(model){model.order=i++})},AltaiSearchSelectComponentController.prototype.openSelectWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemSelect,"Select",ctrl.contentTypeId,{selectionKey:ctrl.selectionKey})},AltaiSearchSelectComponentController.prototype.deleteSelection=function(item){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(result){var index=ctrl.model.indexOf(item);ctrl.model.splice(index,1)})},AltaiSearchSelectComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentItemSelectComponent=function(){function AltaiContentItemSelectComponent(){this.template="<altai-content-item-list content-type-id='$ctrl.contentTypeId' selection='$ctrl.activeSelectionName' ng-if='::$ctrl.contentTypeId'></altai-content-item-list><altai-exposed-content-collection template-id='308' ng-if='::!$ctrl.contentTypeId' exposed-content-collection-id='17' selection='$ctrl.activeSelectionName'></altai-exposed-content-collection>",this.controller=AltaiContentItemSelectComponentController,this.bindings={contentTypeId:"=",selectionKey:"="}}return AltaiContentItemSelectComponent}();AltaiContent.AltaiContentItemSelectComponent=AltaiContentItemSelectComponent;var AltaiContentItemSelectComponentController=function(){function AltaiContentItemSelectComponentController(){this.activeSelectionName=this.selectionKey}return AltaiContentItemSelectComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var AltaiContentTableHeaderSorterComponent=function(){function AltaiContentTableHeaderSorterComponent(){this.transclude=!0,this.template='<a ng-click="$ctrl.changeSorting()" class="altai-content-table-header-sorter"><span ng-transclude></span><span ng-if="$ctrl.searchRequest.sort.field == $ctrl.fieldName"><span ng-if="$ctrl.searchRequest.sort.Asc"><i class="mdi mdi-menu-down"></i></span><span ng-if="!$ctrl.searchRequest.sort.Asc"><i class="mdi mdi-menu-up"></i></span></span></a>',this.bindings={searchRequest:"=",fieldName:"@"},this.controller=AltaiContentTableHeaderSorterComponentController}return AltaiContentTableHeaderSorterComponent}();AltaiContent.AltaiContentTableHeaderSorterComponent=AltaiContentTableHeaderSorterComponent;var AltaiContentTableHeaderSorterComponentController=function(){function AltaiContentTableHeaderSorterComponentController(){}return AltaiContentTableHeaderSorterComponentController.prototype.changeSorting=function(){var ctrl=this;ctrl.searchRequest.sort.field==ctrl.fieldName?ctrl.searchRequest.sort.Asc=!ctrl.searchRequest.sort.Asc:(ctrl.searchRequest.sort.field=ctrl.fieldName,ctrl.searchRequest.sort.Asc=!0)},AltaiContentTableHeaderSorterComponentController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemCreateDirective(){return{scope:{contentTypeId:"=",languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentItemCreate",controller:ContentItemCreateDirectiveController,controllerAs:"vm",link:ContentItemCreateDirectiveLink}}AltaiContent.AltaiContentItemCreateDirective=AltaiContentItemCreateDirective;var ContentItemCreateDirectiveLink=function(){function ContentItemCreateDirectiveLink(scope){scope.$watch("vm.creating",function(newval){scope.contentItemCreateForm.$setValidity("validation",!newval)})}return ContentItemCreateDirectiveLink}(),ContentItemCreateDirectiveController=function(){function ContentItemCreateDirectiveController($scope,$q,contentItemService,contentTypeService,wmContainerFactory,contentCreateItemProcessor){this.$scope=$scope,this.$q=$q,this.contentTypeService=contentTypeService,this.contentTypes=[],this.creating=!1,this.saveObservers=[];var s=this;this.contentItemService=contentItemService,this.wmContainerFactory=wmContainerFactory,this.contentCreateItemProcessor=contentCreateItemProcessor,this.contentTypeService.list().then(function(contentTypes){for(var i=0;i<contentTypes.length;i++)contentTypes[i].directCreatePossible&&s.contentTypes.push(contentTypes[i]);s.contentTypeId&&(s.selectedContentType=s.contentTypes.filter(function(ct){return ct.id==s.contentTypeId})[0])}),this.initNewContentArray(),$scope.$on("createContent",function(){s.createContent()}),$scope.$on("provideContent",function(){s.provideContent()}),$scope.$on("createContentAndKeepCreating",function(){s.createContentAndKeepCreating()}),$scope.$on("createContentAndEdit",function(){s.createContentAndEdit()}),$scope.$on("createContentAndPreview",function(){s.createContentAndPreview()})}return ContentItemCreateDirectiveController.prototype.observeSave=function(callback){-1===this.saveObservers.indexOf(callback)&&this.saveObservers.push(callback)},ContentItemCreateDirectiveController.prototype.broadcastSaveToObservers=function(){for(var i=0;i<this.saveObservers.length;i++)this.saveObservers[i]()},ContentItemCreateDirectiveController.prototype.initNewContentArray=function(){this.newContent||(this.newContent={}),this.newContent.attribute={},this.newContent.relation={}},ContentItemCreateDirectiveController.prototype.selectContentType=function(contentType){this.selectedContentType=contentType},ContentItemCreateDirectiveController.prototype.provideContent=function(){var s=this,d=this.$q.defer();return s.creating=!0,this.contentTypeService.getById(this.selectedContentType.id).then(function(contentType){var processedItem=s.contentCreateItemProcessor.processContentItem(s.newContent,contentType);s.$scope.$emit("contentProvided",processedItem),d.resolve(processedItem)}),d.promise},ContentItemCreateDirectiveController.prototype.createContent=function(){var s=this,d=this.$q.defer();return s.creating=!0,this.contentTypeService.getById(this.selectedContentType.id).then(function(contentType){var processedItem=s.contentCreateItemProcessor.processContentItem(s.newContent,contentType);s.contentItemService.add(processedItem).then(function(result){s.creating=!1,s.$scope.$emit("contentcreated",result),d.resolve(result)})}),this.broadcastSaveToObservers(),d.promise},ContentItemCreateDirectiveController.prototype.createContentAndKeepCreating=function(){var s=this;this.createContent().then(function(){var currentWin=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemCreate,s.contentTypeId);currentWin&&s.wmContainerFactory.destroyWindow(currentWin.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,s.selectedContentType.label,s.selectedContentType.id)})},ContentItemCreateDirectiveController.prototype.createContentAndEdit=function(){var s=this,createWindow=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemCreate,s.selectedContentType.id);createWindow&&s.wmContainerFactory.destroyWindow(createWindow.id),this.createContent().then(function(result){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,s.selectedContentType.label,result.id)})},ContentItemCreateDirectiveController.prototype.createContentAndPreview=function(){var s=this;this.createContent().then(function(contentItem){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.name,contentItem.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,contentItem.name,contentItem.id)})},ContentItemCreateDirectiveController}();AltaiContent.ContentItemCreateDirectiveController=ContentItemCreateDirectiveController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemCreateParentDirective(){return{scope:{contentTypeId:"=",languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentItemCreateParent",controller:ContentItemCreateParentDirectiveController,controllerAs:"vm",link:ContentItemCreateParentDirectiveLink}}AltaiContent.AltaiContentItemCreateParentDirective=AltaiContentItemCreateParentDirective;var ContentItemCreateParentDirectiveLink=function(){function ContentItemCreateParentDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContent()},name:"createclose","class":"altai-button-go",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.createContentAndEdit()},"class":"altai-button-go",name:"createdraft",separator:!0},{icon:"mdi-library-plus",action:function(){scope.vm.createContentAndKeepCreating()},"class":"altai-button-go",name:"createandrecreate",disableByFormValidity:scope.contentItemCreateForm,separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0},scope.vm.previewPossible&&scope.vm.toolbar.menuGroups[0].menuItems.push({icon:"mdi-plus-circle-multiple-outline",action:function(){scope.vm.createContentAndPreview()},"class":"altai-button-go",name:"createandpreview",disableByFormValidity:scope.contentItemCreateForm,separator:!0}),scope.vm.toolbar.menuGroups[0].menuItems.push({icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0})}return ContentItemCreateParentDirectiveLink}(),ContentItemCreateParentDirectiveController=function(){function ContentItemCreateParentDirectiveController($scope,contentTypeService,wmContainerFactory){this.$scope=$scope,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.contentTypes=[],this.creating=!1;var s=this;contentTypeService.previewPossibleForType(s.contentTypeId).then(function(previewPossible){s.previewPossible=previewPossible,s.maximizeWindow()})}return ContentItemCreateParentDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemCreate);s.wmContainerFactory.destroyWindow(currentWin.id)},ContentItemCreateParentDirectiveController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemCreate,this.contentTypeId);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},ContentItemCreateParentDirectiveController.prototype.minimizeWindow=function(){this.wmContainerFactory.removeFocusOnWindow()},ContentItemCreateParentDirectiveController.prototype.createContent=function($scope){var vm=this;vm.$scope.$broadcast("createContent"),vm.minimizeWindow();var currentWin=vm.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemCreate);vm.wmContainerFactory.destroyWindow(currentWin.id)},ContentItemCreateParentDirectiveController.prototype.createContentAndKeepCreating=function($scope){var vm=this;vm.$scope.$broadcast("createContentAndKeepCreating")},ContentItemCreateParentDirectiveController.prototype.createContentAndEdit=function(){var vm=this;vm.$scope.$broadcast("createContentAndEdit")},ContentItemCreateParentDirectiveController.prototype.createContentAndPreview=function(){var vm=this;vm.$scope.$broadcast("createContentAndPreview")},ContentItemCreateParentDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemListDirective(){return{scope:{contentTypeId:"=",windowId:"=",selection:"="},template:"<altai-content-item-list-inner content-type-id='vm.contentTypeId' selection='vm.selection' window-id='vm.windowId'>",controllerAs:"vm",bindToController:!0}}function AltaiContentItemListInnerDirective(){return{scope:{contentTypeId:"=",windowId:"=",selection:"="},templateUrl:"/api/template/Admin/ContentItemList",controller:ContentItemListDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemListDirective=AltaiContentItemListDirective,AltaiContent.AltaiContentItemListInnerDirective=AltaiContentItemListInnerDirective;var ContentItemListDirectiveController=function(){function ContentItemListDirectiveController($scope,contentCollectionManager,contentItemService,contentTypeService,wmContainerFactory,altaiConfirmationService){this.createOption=!0;var ctrl=this;this.contentItemService=contentItemService,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$watch("vm.searchModel",function(newVal,oldVal){if(ctrl.searchModel.windowId=ctrl.windowId,ctrl.searchModelHasChanged(newVal,oldVal)&&ctrl.getData(),1!=ctrl.searchModel.chosenContentTypeModel.length)ctrl.createOption=!1;else if(ctrl.contentTypes&&ctrl.searchModel.chosenContentTypeModel[0]){var selectedContentType=ctrl.contentTypes.filter(function(ct){return ct.id===ctrl.searchModel.chosenContentTypeModel[0].id})[0];ctrl.createOption=selectedContentType.directCreatePossible}},!0),$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){ctrl.getData()}),$scope.$on(AltaiContent.ContentEvents.contentItemCreated,function(){ctrl.getData()})}return ContentItemListDirectiveController.prototype.searchModelHasChanged=function(newVal,oldVal){return newVal.pageNr!=oldVal.pageNr||newVal.sorterAttr!=oldVal.sorterAttr||newVal.sorterDesc!=oldVal.sorterDesc||newVal.chosenContentTypeModel.length!=oldVal.chosenContentTypeModel.length||newVal.name!=oldVal.name},ContentItemListDirectiveController.prototype.init=function(){var s=this;s.searchModel=new AltaiContent.ContentItemSearchModel,s.searchModel.chosenContentTypeModel=[],this.contentTypeService.list().then(function(contentTypes){if(s.contentTypes=angular.copy(contentTypes),s.contentTypeId){var selectedContentType=s.contentTypes.filter(function(ct){return ct.id==s.contentTypeId})[0];selectedContentType&&s.embedContentTypeInSelection(selectedContentType)}else for(var i=0;i<s.contentTypes.length;i++)0==s.contentTypes[i].system&&s.embedContentTypeInSelection(s.contentTypes[i]);s.contentItems||s.getData()})},ContentItemListDirectiveController.prototype.embedContentTypeInSelection=function(contentType){contentType.ticked=!0,this.searchModel.chosenContentTypeModel.push(contentType)},ContentItemListDirectiveController.prototype.getData=function(){var s=this;this.contentItemService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},ContentItemListDirectiveController.prototype.setSorting=function(sortAttr){this.searchModel.pageNr=0,this.searchModel.sorterAttr==sortAttr?this.searchModel.sorterDesc=!this.searchModel.sorterDesc:this.searchModel.sorterDesc=!1,this.searchModel.sorterAttr=sortAttr,this.getData()},ContentItemListDirectiveController.prototype.openContentItemProfile=function(contentItem){
this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.name,contentItem.id)},ContentItemListDirectiveController.prototype.getSearchResults=function(){var s=this;this.contentItemService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},ContentItemListDirectiveController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.name,contentItem.id)},ContentItemListDirectiveController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemService["delete"](contentItem).then(function(){s.getData()})})},ContentItemListDirectiveController.prototype.likeContentItem=function(contentItem){var s=this;s.contentItemService.likeContentItem(contentItem).then(function(){s.getData()})},ContentItemListDirectiveController.prototype.previewContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,contentItem.name,contentItem.id)},ContentItemListDirectiveController.prototype.createContentItem=function(){var s=this;this.contentTypeId?s.contentTypeService.getById(s.contentTypeId).then(function(contentType){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,contentType.label,s.contentTypeId)}):this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeList,"contenttypes")},ContentItemListDirectiveController.prototype.openPage=function(pageIndex){this.searchModel.pageNr=pageIndex},ContentItemListDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemListElasticDirective(){return{scope:{contentTypeId:"=",windowId:"="},templateUrl:"/api/template/Admin/ContentItemListElastic",controller:ContentItemListElasticDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemListElasticDirective=AltaiContentItemListElasticDirective;var ContentItemListElasticDirectiveController=function(){function ContentItemListElasticDirectiveController($scope,contentCollectionManager,contentItemElasticService,contentTypeService,wmContainerFactory,altaiConfirmationService){this.createOption=!0;var vm=this;this.contentItemElasticService=contentItemElasticService,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$watch("vm.searchModel",function(newVal,oldVal){vm.searchModel.windowId=vm.windowId,vm.searchModelHasChanged(newVal,oldVal)&&vm.getData(),1!=vm.searchModel.chosenContentTypeModel.length?vm.createOption=!1:vm.contentTypeService.getById(vm.searchModel.chosenContentTypeModel[0].id).then(function(ct){vm.createOption=ct.directCreatePossible})},!0),$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){vm.getData()}),$scope.$on(AltaiContent.ContentEvents.contentItemCreated,function(){vm.getData()})}return ContentItemListElasticDirectiveController.prototype.searchModelHasChanged=function(newVal,oldVal){return newVal.pageNr!=oldVal.pageNr||newVal.sorterAttr!=oldVal.sorterAttr||newVal.sorterDesc!=oldVal.sorterDesc||newVal.chosenContentTypeModel.length!=oldVal.chosenContentTypeModel.length||newVal.name!=oldVal.name},ContentItemListElasticDirectiveController.prototype.init=function(){var s=this;s.searchModel=new AltaiContent.ContentItemSearchModel,s.searchModel.chosenContentTypeModel=[],this.contentTypeService.list().then(function(contentTypes){if(s.contentTypes=angular.copy(contentTypes),s.contentTypeId){var selectedContentType=s.contentTypes.filter(function(ct){return ct.id==s.contentTypeId})[0];selectedContentType&&s.embedContentTypeInSelection(selectedContentType)}else for(var i=0;i<s.contentTypes.length;i++)0==s.contentTypes[i].system&&s.embedContentTypeInSelection(s.contentTypes[i]);s.contentItems||s.getData()})},ContentItemListElasticDirectiveController.prototype.embedContentTypeInSelection=function(contentType){contentType.ticked=!0,this.searchModel.chosenContentTypeModel.push(contentType)},ContentItemListElasticDirectiveController.prototype.getData=function(){var s=this;this.contentItemElasticService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},ContentItemListElasticDirectiveController.prototype.setSorting=function(sortAttr){this.searchModel.pageNr=0,this.searchModel.sorterAttr==sortAttr?this.searchModel.sorterDesc=!this.searchModel.sorterDesc:this.searchModel.sorterDesc=!1,this.searchModel.sorterAttr=sortAttr,this.getData()},ContentItemListElasticDirectiveController.prototype.openContentItemProfile=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.Name,contentItem.Id)},ContentItemListElasticDirectiveController.prototype.getSearchResults=function(){var s=this;this.contentItemElasticService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},ContentItemListElasticDirectiveController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.Name,contentItem.Id)},ContentItemListElasticDirectiveController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemElasticService["delete"](contentItem).then(function(){s.getData()})})},ContentItemListElasticDirectiveController.prototype.previewContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,contentItem.Name,contentItem.Id)},ContentItemListElasticDirectiveController.prototype.createContentItem=function(){var s=this;this.contentTypeId?s.contentTypeService.getById(s.contentTypeId).then(function(contentType){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,contentType.label,s.contentTypeId)}):this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeList,"contenttypes")},ContentItemListElasticDirectiveController.prototype.openPage=function(pageIndex){this.searchModel.pageNr=pageIndex},ContentItemListElasticDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemPreviewDirective(){return{scope:{contentItemId:"=",languages:"="},templateUrl:"/api/template/Admin/Content:ContentItemPreview",controller:ContentItemPreviewDirectiveController,link:AltaiContentItemPreviewDirectiveLink,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemPreviewDirective=AltaiContentItemPreviewDirective;var AltaiContentItemPreviewDirectiveLink=function(){function AltaiContentItemPreviewDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-pencil",action:function(){scope.vm.openUpdateItemWindow()},name:"edit","class":"altai-button-primary"}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!1}}return AltaiContentItemPreviewDirectiveLink}(),ContentItemPreviewDirectiveController=function(){function ContentItemPreviewDirectiveController($rootScope,$scope,wmContainerFactory,contentItemService,altaiLocalizationService){this.wmContainerFactory=wmContainerFactory,this.altaiLocalizationService=altaiLocalizationService,this.loading=!0,this.enableRootCssContainer=!0;var vm=this;vm.contentItemService=contentItemService,$scope.$watch("vm.languages",function(){if(vm.languages){var activeLang=vm.languages.filter(function(lang){return lang.selected})[0];activeLang.code!=altaiLocalizationService.getCurrentLangCode()?vm.altaiLocalizationService.changeLang(activeLang.code).then(function(){}):vm.getData()}},!0)}return ContentItemPreviewDirectiveController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.contentItemService.getById(ctrl.contentItemId).then(function(contentItem){ctrl.languages&&(ctrl.activeLang=ctrl.languages.filter(function(lang){return lang.selected})[0],ctrl.contentItemService.getDataById(ctrl.contentItemId,ctrl.activeLang.code).then(function(contentItemData){ctrl.item=contentItemData,ctrl.enableRootCssContainer=!0,contentItem.templateId&&(ctrl.templateUrl="/api/template/"+contentItem.templateId),ctrl.loading=!1}))})},ContentItemPreviewDirectiveController.prototype.openUpdateItemWindow=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,"Update",this.contentItemId)},ContentItemPreviewDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemUpdateInnerDirective(){return{scope:{contentItemId:"=",languages:"=",updateModel:"=",contentItem:"=",contentType:"=",linkedContentTypes:"=",editMode:"<"},templateUrl:function(elem,attrs){return void 0!=attrs.template?attrs.template:"/api/template/Admin/ContentItemUpdateInner"},controller:ContentItemUpdateInnerDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemUpdateInnerDirective=AltaiContentItemUpdateInnerDirective;var ContentItemUpdateInnerDirectiveController=function(){function ContentItemUpdateInnerDirectiveController(contentItemService,contentRelationFactory,contentTypeService,$rootScope,wmContainerFactory,contentCreateItemProcessor,contentUpdateModelManager){this.listOtherContent=[];var s=this;void 0==this.editMode&&(this.editMode=!0),this.contentItemService=contentItemService,this.wmContainerFactory=wmContainerFactory,this.$rootScope=$rootScope,this.contentRelationFactory=contentRelationFactory,this.contentCreateItemProcessor=contentCreateItemProcessor,this.contentTypeService=contentTypeService,this.contentItemService.getById(s.contentItemId).then(function(contentItem){s.contentItem=angular.copy(contentItem),contentUpdateModelManager.getUpdateModel(s.contentItemId).then(function(result){s.updateModel=result,s.contentType=result.contentType})}),this.datetime=new Date}return ContentItemUpdateInnerDirectiveController.prototype.openContentItem=function(contentItem){var s=this;s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.name,contentItem.id)},ContentItemUpdateInnerDirectiveController.prototype.refreshPreview=function(){this.$rootScope.$broadcast("ContentChanged")},ContentItemUpdateInnerDirectiveController.prototype.getAttrById=function(attributelist,id){return void 0!=attributelist?attributelist.filter(function(attr){return attr.id==id}):void 0},ContentItemUpdateInnerDirectiveController.prototype.getAttrByName=function(attributelist,name){return void 0!=attributelist?attributelist.filter(function(attr){return attr.attribute.name==name}):void 0},ContentItemUpdateInnerDirectiveController.prototype.getRelById=function(rellist,id){return void 0!=rellist?rellist.filter(function(rel){return rel.id==id}):void 0},ContentItemUpdateInnerDirectiveController.prototype.getRelByName=function(rellist,name){return void 0!=rellist?rellist.filter(function(rel){return rel.contentTypeRelation.name==name}):void 0},ContentItemUpdateInnerDirectiveController.prototype.getRelModelIndexById=function(relModelList,id){if(void 0!=relModelList)for(var prop in relModelList)if(relModelList.hasOwnProperty(prop)&&relModelList[prop].contentTypeRelationId==id)return prop;return"0"},ContentItemUpdateInnerDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemUpdateDirective(){return{scope:{contentItemId:"=",languages:"="},templateUrl:function(elem,attrs){return void 0!=attrs.template?attrs.template:"/api/template/Admin/ContentItemUpdate"},controller:ContentItemUpdateDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemUpdateDirective=AltaiContentItemUpdateDirective;var ContentItemUpdateDirectiveController=function(){function ContentItemUpdateDirectiveController(contentItemService,$scope,$q,$rootScope,wmContainerFactory,contentCreateItemProcessor,contentUpdateModelManager,contentRelationFactory,Upload,$state){this.contentItemService=contentItemService,this.$scope=$scope,this.$q=$q,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.contentCreateItemProcessor=contentCreateItemProcessor,this.Upload=Upload,this.$state=$state,this.linkedContentTypes={},this.listOtherContent=[],this.saveObservers=[],contentUpdateModelManager.resetModels(),contentRelationFactory.resetOptions();var s=this;$scope.$on("updateContentItemModel",function(){s.updateContentItemModel(s.contentItem,s.updateModel,s.contentType)}),$scope.$on("updateContentData",function(){s.updateContentData()}),$scope.$on("provideContent",function(){s.provideContent()}),$scope.$on("updateContent",function(){s.updateContent()}),$scope.$on("publishContentItem",function(){s.contentItem.published=!0,s.updateContent()}),$scope.$on("unpublishContentItem",function(){s.contentItem.published=!1,s.updateContent()}),$scope.$on("updateContentDraft",function(){s.updateContentDraft()}),$scope.$on("openContentItem",function(){s.openContentItem(s.contentItem)})}return ContentItemUpdateDirectiveController.prototype.observeSave=function(callback){-1===this.saveObservers.indexOf(callback)&&this.saveObservers.push(callback)},ContentItemUpdateDirectiveController.prototype.broadcastSaveToObservers=function(){return this.$q.all(this.saveObservers)},ContentItemUpdateDirectiveController.prototype.updateContentItemModel=function(contentItem,updateModel,contentType){return this.contentItemService.updateContentItemModel(contentItem,updateModel,contentType,this.languages,this.linkedContentTypes)},ContentItemUpdateDirectiveController.prototype.provideContent=function(){var ctrl=this,updatedContentItemModel=ctrl.updateContentItemModel(ctrl.contentItem,ctrl.updateModel,ctrl.contentType);return ctrl.$scope.$emit("contentProvided",updatedContentItemModel),updatedContentItemModel},ContentItemUpdateDirectiveController.prototype.updateContentData=function(){var ctrl=this,d=ctrl.$q.defer(),updatedContentItemModel=ctrl.updateContentItemModel(ctrl.contentItem,ctrl.updateModel,ctrl.contentType);return ctrl.$q.all(ctrl.saveObservers.map(function(fn){return fn()})).then(function(result){ctrl.contentItemService.update(updatedContentItemModel).then(function(){ctrl.$rootScope.$broadcast(AltaiContent.ContentEvents.contentItemUpdated),d.resolve()})}),d.promise},ContentItemUpdateDirectiveController.prototype.updateContent=function(){var ctrl=this;ctrl.updateContentData().then(function(result){ctrl.$scope.$emit("contentupdated",result)})},ContentItemUpdateDirectiveController.prototype.cancelContent=function(){var ctrl=this;ctrl.$state.reload()},ContentItemUpdateDirectiveController.prototype.updateContentDraft=function(){var s=this;s.updateContentData().then(function(){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,s.contentItem.name,s.contentItem.id)})},ContentItemUpdateDirectiveController.prototype.openContentItem=function(contentItem){var s=this;s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.name,contentItem.id)},ContentItemUpdateDirectiveController}();AltaiContent.ContentItemUpdateDirectiveController=ContentItemUpdateDirectiveController}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemUpdateParentDirective(){return{scope:{contentItemId:"="},templateUrl:"/api/template/Admin/ContentItemUpdateParent",controller:ContentItemUpdateParentDirectiveController,link:ContentItemCreateParentDirectiveLink,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemUpdateParentDirective=AltaiContentItemUpdateParentDirective;var ContentItemCreateParentDirectiveLink=function(){function ContentItemCreateParentDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateContent()},name:"createclose","class":"altai-button-go",separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.updateContentDraft()},"class":"altai-button-go",name:"createdraft",separator:!0},{icon:"mdi-plus-circle-multiple-outline",action:function(){scope.vm.openPreviewWindow()},"class":"altai-button-go",name:"preview",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0};var contentItemLoadedWatcher=scope.$watch("vm.contentItem",function(){scope.vm.contentItem&&(contentItemLoadedWatcher(),scope.vm.allowPublishing&&(scope.vm.contentItem.published?scope.vm.toolbar.menuGroups[0].menuItems.push({icon:"mdi-package-down",action:function(){scope.vm.contentItem.published=!1,scope.vm.unpublish(),scope.$on("contentupdated",function(){scope.vm.closeWindow()})},name:"unpublish","class":"altai-button-back",separator:!0}):scope.vm.toolbar.menuGroups[0].menuItems.push({icon:"mdi-package-up",action:function(){return scope.vm.published=!0,scope.contentItemCreateForm.$valid?(scope.vm.publish(),void scope.$on("contentupdated",function(){scope.vm.closeWindow()})):void alert("Cannot publish, the form is not yet valid")},name:"publish","class":"altai-button-go",separator:!0})),scope.vm.toolbar.menuGroups[0].menuItems.push({icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}))},!0)}return ContentItemCreateParentDirectiveLink}(),ContentItemUpdateParentDirectiveController=function(){function ContentItemUpdateParentDirectiveController($scope,$rootScope,wmContainerFactory,contentTypeService,contentItemService){this.$scope=$scope,this.wmContainerFactory=wmContainerFactory,this.contentItemService=contentItemService,this.linkedContentTypes={},this.allowPublishing=!1;var ctrl=this;this.isPreviewWindowOpen()||this.maximizeWindow(),$rootScope.$on("fileUploadInProgress",function(){ctrl.uploadInprogress=!0}),$rootScope.$on("fileUploadDone",function(){ctrl.uploadInprogress=!1}),contentItemService.getById(ctrl.contentItemId).then(function(contentItem){ctrl.contentItem=contentItem,ctrl.published=contentItem.published,contentTypeService.previewPossibleForType(contentItem.contentTypeId).then(function(previewPossible){ctrl.previewPossible=previewPossible}),contentTypeService.publishPossibleForType(contentItem.contentTypeId).then(function(publishPossible){ctrl.allowPublishing=publishPossible})})}return ContentItemUpdateParentDirectiveController.prototype.isPreviewWindowOpen=function(){var previewWindow=this.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemPreview,this.contentItemId);return void 0!=previewWindow},ContentItemUpdateParentDirectiveController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemUpdate,this.contentItemId);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},ContentItemUpdateParentDirectiveController.prototype.closeWindow=function(){var ctrl=this;ctrl.wmContainerFactory.removeFocusOnWindow();var currentWin=ctrl.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemUpdate,ctrl.contentItemId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)},ContentItemUpdateParentDirectiveController.prototype.openPreviewWindow=function(){var ctrl=this;ctrl.previewPossible?ctrl.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,"Preview",ctrl.contentItemId):alert("Item has no preview")},ContentItemUpdateParentDirectiveController.prototype.updateContentItemModel=function(){var vm=this;return vm.uploadInprogress?void alert("upload still in progress, try again"):void vm.$scope.$broadcast("updateContentItemModel")},ContentItemUpdateParentDirectiveController.prototype.updateContentData=function(){var vm=this;return vm.uploadInprogress?void alert("upload still in progress, try again"):void vm.$scope.$broadcast("updateContentData")},ContentItemUpdateParentDirectiveController.prototype.updateContent=function(){var vm=this;return vm.uploadInprogress?void alert("upload still in progress, try again"):(vm.$scope.$broadcast("updateContent"),void vm.closeWindow())},ContentItemUpdateParentDirectiveController.prototype.updateContentDraft=function(){var vm=this;return vm.uploadInprogress?void alert("upload still in progress, try again"):void vm.$scope.$broadcast("updateContentDraft")},ContentItemUpdateParentDirectiveController.prototype.openContentItem=function(contentItem){var vm=this;vm.$scope.$broadcast("openContentItem")},ContentItemUpdateParentDirectiveController.prototype.publish=function(){var ctrl=this;ctrl.$scope.$broadcast("publishContentItem")},ContentItemUpdateParentDirectiveController.prototype.unpublish=function(){var ctrl=this;ctrl.$scope.$broadcast("unpublishContentItem")},ContentItemUpdateParentDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemProfileDirective(){return{scope:{contentItemId:"=",languages:"="},templateUrl:"/api/template/Admin/ContentItemProfile",controller:ContentItemProfileDirectiveController,link:ContentItemProfileDirectiveLink,controllerAs:"vm",bindToController:!0}}AltaiContent.AltaiContentItemProfileDirective=AltaiContentItemProfileDirective;var ContentItemProfileDirectiveLink=function(){function ContentItemProfileDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{translatableTooltipId:"preview",icon:"mdi-camera",action:function(){scope.vm.previewContentItem()},"class":"altai-button-primary",name:"preview",separator:!0},{translatableTooltipId:"edit",icon:"mdi-pencil",action:function(){scope.vm.updateContentItem()},"class":"altai-button-primary",name:"edit",separator:!0},{translatableTooltipId:"accesses",icon:"mdi-key",action:function(){scope.vm.openAccessesWindow()},"class":"altai-button-primary",name:"accesses",separator:!0},{translatableTooltipId:"delete",icon:"mdi-delete",action:function(){scope.vm.deleteContentItem()},"class":"altai-button-back",name:"delete",separator:!0}],align:"left"}],showLanguages:!0}}return ContentItemProfileDirectiveLink}(),ContentItemProfileDirectiveController=function(){function ContentItemProfileDirectiveController(contentItemService,wmContainerFactory,languageFactory,altaiConfirmationService,$scope){this.relations=[];var s=this;this.contentItemService=contentItemService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,$scope.$watch("vm.languages",function(){s.languages&&s.getData()},!0),$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){s.getData()})}return ContentItemProfileDirectiveController.prototype.getSelectedLang=function(){return this.languages.filter(function(lang){return lang.selected})[0]},ContentItemProfileDirectiveController.prototype.getData=function(){var s=this;s.contentItemService.getByIdInLang(s.contentItemId,s.getSelectedLang().code).then(function(contentItemData){s.contentItem=contentItemData,s.parseRelations()})},ContentItemProfileDirectiveController.prototype.parseRelations=function(){var s=this;s.relations=[];for(var r=0;r<s.contentItem.contentItemRelationLinks.length;r++){var exRelation=s.relations.filter(function(rel){return rel.contentTypeRelationId==s.contentItem.contentItemRelationLinks[r].contentRelation.contentTypeRelationId})[0];exRelation||(s.relations.push({contentTypeRelationId:s.contentItem.contentItemRelationLinks[r].contentRelation.contentTypeRelationId,name:s.contentItem.contentItemRelationLinks[r].contentRelation.contentTypeRelation.name,content:[]}),exRelation=s.relations[s.relations.length-1]),exRelation.content.push({id:s.contentItem.contentItemRelationLinks[r].contentRelation.contentRelationLinks[0].content.id,name:s.contentItem.contentItemRelationLinks[r].contentRelation.contentRelationLinks[0].content.name})}},ContentItemProfileDirectiveController.prototype.previewContentItem=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,this.contentItem.name,this.contentItem.id)},ContentItemProfileDirectiveController.prototype.updateContentItem=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,this.contentItem.name,this.contentItem.id)},ContentItemProfileDirectiveController.prototype.openContentItem=function(selectedContentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,selectedContentItem.name,selectedContentItem.id)},ContentItemProfileDirectiveController.prototype.deleteContentItem=function(){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemService["delete"](s.contentItem).then(function(){var window=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentItemProfile,s.contentItemId);s.wmContainerFactory.destroyWindow(window.id)})})},ContentItemProfileDirectiveController.prototype.openAccessesWindow=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",ctrl.contentItemId,{securableName:"contentitem.item"})},ContentItemProfileDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentItemTableDirective(){return{scope:{results:"=",selection:"="},controller:ContentItemTableDirectiveController,controllerAs:"vm",bindToController:!0,templateUrl:"/api/template/Admin/Content:ContentItemTable"}}AltaiContent.AltaiContentItemTableDirective=AltaiContentItemTableDirective;var ContentItemTableDirectiveController=function(){function ContentItemTableDirectiveController($scope,contentCollectionManager,contentItemService,contentTypeService,wmContainerFactory,altaiConfirmationService){this.createOption=!0;this.contentItemService=contentItemService,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService}return ContentItemTableDirectiveController.prototype.openContentItemProfile=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.Name,contentItem.Id)},ContentItemTableDirectiveController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.Name,contentItem.Id)},ContentItemTableDirectiveController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){})},ContentItemTableDirectiveController.prototype.previewContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemPreview,contentItem.Name,contentItem.Id)},ContentItemTableDirectiveController.prototype.createContentItem=function(){var s=this;this.contentTypeId?s.contentTypeService.getById(s.contentTypeId).then(function(contentType){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,contentType.label,s.contentTypeId)}):this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentTypeList,"contenttypes")},ContentItemTableDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentFormDirective($timeout,$stateParams){return{restrict:"E",controller:AltaiFormDirectiveController}}AltaiContent.AltaiContentFormDirective=AltaiContentFormDirective;var AltaiFormDirectiveController=function(){function AltaiFormDirectiveController($stateParams,$document,$scope,$timeout,$attrs,altaiLocalizationService,contentFormManager,userInfoService,exposedContentCollectionDataService,urlParameterService,$location){this.$stateParams=$stateParams,this.$document=$document,this.$scope=$scope,this.$timeout=$timeout,this.altaiLocalizationService=altaiLocalizationService,this.userInfoService=userInfoService,this.exposedContentCollectionDataService=exposedContentCollectionDataService,this.$location=$location,this.loading=!1,this.autoSubmit=!1,this.updateMode=!1;var ctrl=this;if($scope.autoSubmit=urlParameterService("submit"),void 0!=$stateParams.workshop){var searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{id:$stateParams.workshop},ranges:[]};ctrl.exposedContentCollectionDataService.getData(81,searchRequest).then(function(result){ctrl.data=result.pageResults.length>0?result.pageResults[0]:void 0})}if(void 0!=$stateParams.networkingevent){var searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{id:$stateParams.networkingevent},ranges:[]};ctrl.exposedContentCollectionDataService.getData(78,searchRequest).then(function(result){ctrl.data=result.pageResults.length>0?result.pageResults[0]:void 0})}if(void 0!=$stateParams.meetingid){var searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{id:$stateParams.meetingid},ranges:[]};ctrl.exposedContentCollectionDataService.getData(88,searchRequest).then(function(result){ctrl.data=result.pageResults.length>0?result.pageResults[0]:void 0})}ctrl.contentFormId=parseInt($attrs.contentFormId),$scope.$ctrl=this,ctrl.autoSubmit=$scope.autoSubmit,ctrl.formData={},ctrl.formData.content={},ctrl.formData.subForms={},ctrl.formData.contentFormId=ctrl.contentFormId,ctrl.contentFormManager=contentFormManager,ctrl.contentFormManager.getById(ctrl.contentFormId).then(function(contentForm){ctrl.userInfoService.getUserInfo().then(function(userInfo){ctrl.isUser=!0,ctrl.formData.content[9]=!0,$stateParams.contentid?($scope.$ctrl.formData.contentItemId=$stateParams.contentid,$scope.$ctrl.updateMode=!0,$scope.$ctrl.contentFormManager.loadUpdateFormData($scope.$ctrl.contentFormId,$scope.$ctrl.formData.contentItemId).then(function(formDataContent){$scope.$ctrl.formData.content=formDataContent,ctrl.manageFormSetup(contentForm,userInfo)})):ctrl.manageFormSetup(contentForm,userInfo)},function(){console.log("no user info"),$stateParams.contentid?($scope.$ctrl.formData.contentItemId=$stateParams.contentid,$scope.$ctrl.updateMode=!0,$scope.$ctrl.contentFormManager.loadUpdateFormData($scope.$ctrl.contentFormId,$scope.$ctrl.formData.contentItemId).then(function(formDataContent){$scope.$ctrl.formData.content=formDataContent,ctrl.manageFormSetup(contentForm)})):ctrl.manageFormSetup(contentForm)})})}return AltaiFormDirectiveController.prototype.manageFormSetup=function(contentForm,userInfo){for(var ctrl=this,r=0;r<contentForm.contentFormRows.length;r++)userInfo&&contentForm.contentFormRows[r].parameter&&-1!==contentForm.contentFormRows[r].parameter.indexOf("user.")&&!ctrl.updateMode?!function(r){var userInfoKey=contentForm.contentFormRows[r].parameter.substring(5);ctrl.formData.content[r]=userInfo[userInfoKey]}(r):contentForm.contentFormRows[r].parameter&&"langcode"==contentForm.contentFormRows[r].parameter&&!function(r){ctrl.formData.content[r]=ctrl.altaiLocalizationService.getCurrentLangCode()}(r);for(var r=0;r<contentForm.contentFormRows.length;r++)userInfo&&contentForm.contentFormRows[r].parameter&&-1!==contentForm.contentFormRows[r].parameter.indexOf("user.")&&!contentForm.contentFormRows[r].contentTypeAttribute&&!ctrl.updateMode?!function(r){var userInfoKey=contentForm.contentFormRows[r].parameter.substring(5);ctrl.formData.content[r]={id:userInfo[userInfoKey]}}(r):contentForm.contentFormRows[r].parameter in ctrl.$stateParams&&!function(r){contentForm.contentFormRows[r].contentTypeAttribute?ctrl.formData.content[r]=ctrl.$stateParams[contentForm.contentFormRows[r].parameter]:(ctrl.formData.content[r]={id:ctrl.$stateParams[contentForm.contentFormRows[r].parameter],name:""},ctrl.$scope.$broadcast("contentSelectChanged",{contentTypeId:contentForm.contentFormRows[r].contentTypeRelationLink.contentTypeId,parameter:contentForm.contentFormRows[r].parameter,id:ctrl.$stateParams[contentForm.contentFormRows[r].parameter]}))}(r),r==contentForm.contentFormRows.length-1&&ctrl.autoSubmit&&ctrl.$timeout(function(){ctrl.submitForm()})},AltaiFormDirectiveController.prototype.submitForm=function(form){var s=this;return form&&form.$invalid?void angular.forEach(form.$error,function(field){angular.forEach(field,function(errorField){
errorField.$setTouched()})}):(this.loading=!0,s.$location.search().userId&&(s.formData.userId=s.$location.search().userId),s.formData.autoSubmit="true"==s.autoSubmit,void this.contentFormManager.submitContentForm(s.formData).then(function(){s.loading=!1,s.succesMsg="Form submitted!",s.$document[0].body.scrollTop=s.$document[0].documentElement.scrollTop=0,s.removeURLParameter()},function(){s.loading=!1,s.errorMsg="Failed to submit form",s.$document[0].body.scrollTop=s.$document[0].documentElement.scrollTop=0,s.removeURLParameter()}))},AltaiFormDirectiveController.prototype.removeURLParameter=function(){var s=this;s.$location.search("userId",void 0)},AltaiFormDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentFormCreateDirective(){return{templateUrl:"/api/template/Admin/ContentFormCreate",controller:ContentFormCreateDirectiveController,controllerAs:"vm",link:AltaiContentFormCreateDirectiveLink}}AltaiContent.AltaiContentFormCreateDirective=AltaiContentFormCreateDirective;var AltaiContentFormCreateDirectiveLink=function(){function AltaiContentFormCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContentForm(scope.newContentForm)},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0}}return AltaiContentFormCreateDirectiveLink}(),ContentFormCreateDirectiveController=function(){function ContentFormCreateDirectiveController(contentFormManager,contentTypeService,wmContainerFactory){var s=this;this.contentFormManager=contentFormManager,this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,this.contentTypeService.list().then(function(contentTypes){s.contentTypes=contentTypes})}return ContentFormCreateDirectiveController.prototype.createContentForm=function(newContentForm){var s=this;this.contentFormManager.add(newContentForm).then(function(result){var window=s.wmContainerFactory.findWindow(AltaiContent.ContentWindows.contentFormCreate);s.wmContainerFactory.destroyWindow(window.id),s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentFormUpdate,result.name,result.id)})},ContentFormCreateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentFormListDirective(){return{templateUrl:"/api/template/Admin/ContentFormList",controller:ContentFormListDirectiveController,controllerAs:"vm"}}AltaiContent.AltaiContentFormListDirective=AltaiContentFormListDirective;var ContentFormListDirectiveController=function(){function ContentFormListDirectiveController(contentFormManager,wmContainerFactory){var vm=this;this.wmContainerFactory=wmContainerFactory,contentFormManager.list().then(function(contentForms){vm.contentForms=contentForms})}return ContentFormListDirectiveController.prototype.updateContentForm=function(contentForm){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentFormUpdate,contentForm.name,contentForm.id)},ContentFormListDirectiveController.prototype.createContentForm=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentFormCreate,"Create new contentform")},ContentFormListDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentFormPreviewDirective(contentFormManager,$compile){return{scope:{contentFormId:"="},templateUrl:"/api/template/Admin/contentFormPreview",controller:ContentFormPreviewDirectiveController,controllerAs:"vm",bindToController:!0,link:function(scope,element,attrs){contentFormManager.getContentFormTemplate(scope.vm.contentFormId).then(function(result){element.html($compile(result)(scope))})}}}AltaiContent.AltaiContentFormPreviewDirective=AltaiContentFormPreviewDirective;var ContentFormPreviewDirectiveController=function(){function ContentFormPreviewDirectiveController(contentFormManager){this.contentFormManager=contentFormManager;var vm=this;vm.contentFormManager.getById(vm.contentFormId).then(function(result){vm.form=result})}return ContentFormPreviewDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentFormUpdateDirective(){return{scope:{contentFormId:"="},templateUrl:"/api/template/Admin/Forms:ContentFormUpdate",controller:ContentFormUpdateDirectiveController,controllerAs:"vm",bindToController:!0,link:AltaiContentFormCreateDirectiveLink}}AltaiContent.AltaiContentFormUpdateDirective=AltaiContentFormUpdateDirective;var AltaiContentFormCreateDirectiveLink=function(){function AltaiContentFormCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateContentForm()},"class":"altai-button-go",name:"save",separator:!0},{icon:"mdi-magnify",action:function(){scope.vm.openPreview()},"class":"altai-button-primary",name:"preview",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return AltaiContentFormCreateDirectiveLink}(),ContentFormUpdateDirectiveController=function(){function ContentFormUpdateDirectiveController($templateFactory,$rootScope,$scope,contentFormManager,contentTypeService,wmContainerFactory,contentFormRowManager){this.$templateFactory=$templateFactory,this.$rootScope=$rootScope,this.$scope=$scope,this.contentFormManager=contentFormManager,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.contentFormRowManager=contentFormRowManager;var ctrl=this;ctrl.loadContentForm(),ctrl.loadTemplates(),contentFormManager.list().then(function(contentForms){ctrl.contentForms=contentForms}),this.ctaSortOptions=this.handleSorting()}return ContentFormUpdateDirectiveController.prototype.loadContentForm=function(){var s=this;s.contentFormManager.getById(this.contentFormId).then(function(result){s.contentForm=result,s.contentTypeService.getById(result.contentTypeId).then(function(contentType){s.contentType=contentType})})},ContentFormUpdateDirectiveController.prototype.loadTemplates=function(){var vm=this;this.$templateFactory.listTemplateByTypeName("Form").then(function(result){vm.templates=result})},ContentFormUpdateDirectiveController.prototype.createContentFormRow=function(newContentFormRow){var vm=this;newContentFormRow.contentFormId=this.contentFormId,this.contentFormRowManager.add(newContentFormRow).then(function(result){newContentFormRow={},vm.contentForm.contentFormRows.push(result)})},ContentFormUpdateDirectiveController.prototype.updateContentForm=function(){this.contentFormManager.update(this.contentForm)},ContentFormUpdateDirectiveController.prototype.openPreview=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentFormPreview,this.contentForm.name+" preview",this.contentFormId)},ContentFormUpdateDirectiveController.prototype.refreshPreview=function(){this.$rootScope.$broadcast("ContentFormChanged")},ContentFormUpdateDirectiveController.prototype.deleteContentFormRow=function(contentFormRow,index){var vm=this;this.contentFormRowManager["delete"](contentFormRow).then(function(){vm.contentForm.contentFormRows.splice(index,1)})},ContentFormUpdateDirectiveController.prototype.editContentFormRow=function(contentFormRow,index){var vm=this;vm.rowUpdate=angular.copy(contentFormRow),vm.rowUpdateIndex=index,void 0!=vm.rowUpdate.contentTypeAttributeId&&vm.rowUpdate.contentTypeAttributeId>=0?vm.rowUpdate.type="Attribute":vm.rowUpdate.type="Relation"},ContentFormUpdateDirectiveController.prototype.updateContentFormRow=function(){var vm=this;vm.contentForm.contentFormRows[vm.rowUpdateIndex]=angular.copy(vm.rowUpdate),vm.rowUpdate=void 0,vm.rowUpdateIndex=-1},ContentFormUpdateDirectiveController.prototype.handleSorting=function(){var s=this;return{stop:function(e,ui){console.log(s.contentForm.contentFormRows)}}},ContentFormUpdateDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentAttributeUpdateDirective(){return{scope:{model:"=",contentTypeAttribute:"=",languages:"="},template:"<div class='altai-content-attribute-update'><div ng-repeat='model in vm.model track by $index' class='altai-content-attribute-update-item-wrapper' ng-class='{\"multiple\":vm.contentTypeAttribute.attribute.multiple}'><altai-content-attribute-update-item model='vm.model[$index].value' ng-if='!vm.contentTypeAttribute.attribute.translatable' content-type-attribute='vm.contentTypeAttribute' class='altai-content-attribute-update-item'></altai-content-attribute-update-item><altai-content-attribute-update-item model='vm.model[$parent.$parent.$index].value[lang.code]' language='lang' ng-if='vm.contentTypeAttribute.attribute.translatable' ng-repeat='lang in vm.languages | filter: {selected:true}' content-type-attribute='vm.contentTypeAttribute' class='altai-content-attribute-update-item'></altai-content-attribute-update-item><button type= 'submit' class='icon' ng-if='vm.contentTypeAttribute.attribute.multiple' ng-click='vm.removeItem($index)' ><i class='mdi mdi-delete'></i> </button></div><button ng-show='vm.contentTypeAttribute.attribute.multiple' type='button' class='icon' ng-click='vm.addItem()'><i class='mdi mdi-plus'></i> </button></div>",controllerAs:"vm",bindToController:!0,controller:AltaiContentAttributeUpdateDirectiveController}}function AltaiContentAttributeUpdateItemDirective(){return{scope:{model:"=",contentTypeAttribute:"=",language:"="},replace:!0,template:"<div ng-class='vm.contentTypeAttribute.attribute.name'><span ng-show='vm.language' class='altai-content-attribute-update-lang'>{{vm.language.code}}</span><span class='altai-content-attribute-update-tpl' ng-include='vm.template'></span></div>",controllerAs:"vm",bindToController:!0,controller:AltaiContentAttributeUpdateItemDirectiveController}}AltaiContent.AltaiContentAttributeUpdateDirective=AltaiContentAttributeUpdateDirective,AltaiContent.AltaiContentAttributeUpdateItemDirective=AltaiContentAttributeUpdateItemDirective;var AltaiContentAttributeUpdateDirectiveController=function(){function AltaiContentAttributeUpdateDirectiveController(){this.model||(this.model=[null])}return AltaiContentAttributeUpdateDirectiveController.prototype.removeItem=function(itemIndex){this.model.attributeIds&&this.model.attributeIds.splice(itemIndex,1),this.model.splice(itemIndex,1)},AltaiContentAttributeUpdateDirectiveController.prototype.addItem=function(){this.model.push(null)},AltaiContentAttributeUpdateDirectiveController}(),AltaiContentAttributeUpdateItemDirectiveController=function(){function AltaiContentAttributeUpdateItemDirectiveController(){this.setDefaultValue(),this.template=this.getTemplateUrl()}return AltaiContentAttributeUpdateItemDirectiveController.prototype.setDefaultValue=function(){this.getDefaultValueInLang(),this.contentTypeAttribute.defaultValue&&!this.model&&(this.model=this.castDefaultValue())},AltaiContentAttributeUpdateItemDirectiveController.prototype.getDefaultValueInLang=function(){var c=this;if(this.contentTypeAttribute.defaultValueTranslatable&&this.language){var defaultValueInLang=this.contentTypeAttribute.defaultValueTranslatable.translatableValues.filter(function(value){return value.languageCode==c.language.code})[0];defaultValueInLang&&(this.contentTypeAttribute.defaultValue=defaultValueInLang.value)}},AltaiContentAttributeUpdateItemDirectiveController.prototype.castDefaultValue=function(){if(this.contentTypeAttribute.defaultValue)switch(this.contentTypeAttribute.attribute.attributeType.name){case"Boolean":return"True"==this.contentTypeAttribute.defaultValue;case"Integer":return parseInt(this.contentTypeAttribute.defaultValue);default:return this.contentTypeAttribute.defaultValue}},AltaiContentAttributeUpdateItemDirectiveController.prototype.getTemplateUrl=function(){var templateUrlBase="/api/template/Attribute/";return this.contentTypeAttribute.editTemplate?templateUrlBase+this.contentTypeAttribute.editTemplate:this.contentTypeAttribute.attribute.editTemplate?templateUrlBase+this.contentTypeAttribute.attribute.editTemplate:templateUrlBase+this.contentTypeAttribute.attribute.attributeType.editTemplate},AltaiContentAttributeUpdateItemDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiContentRelationUpdateDirective(){return{scope:{newModel:"=",existingModel:"=",existingInputModel:"=",contentTypeRelationLink:"=",languages:"=",relation:"=",editMode:"<",createMode:"<"},templateUrl:function(elem,attrs){return void 0!=attrs.template?attrs.template:"/api/template/Admin/Content:ContentRelationUpdate"},controllerAs:"vm",bindToController:!0,controller:AltaiContentRelationUpdateDirectiveController}}function AltaiContentRelationUpdateItemDirective(){return{scope:{model:"=",options:"=",contentTypeRelationLink:"=",languages:"=",existingMode:"=",editMode:"<"},replace:!0,templateUrl:"/api/template/Admin/AltaiContentRelationUpdateItem",controllerAs:"vm",bindToController:!0,controller:AltaiContentRelationUpdateItemDirectiveController}}AltaiContent.AltaiContentRelationUpdateDirective=AltaiContentRelationUpdateDirective;var AltaiContentRelationUpdateDirectiveController=function(){function AltaiContentRelationUpdateDirectiveController(altaiGuidService,contentRelationFactory,altaiConfirmationService,$scope){this.altaiGuidService=altaiGuidService,this.contentRelationFactory=contentRelationFactory,this.altaiConfirmationService=altaiConfirmationService,this.existingMode=!1,this.multiSelectOpened=!1;var ctrl=this;this.relation&&(this.relation.touched=!0),this.contentRelationFactory=contentRelationFactory,this.$scope=$scope;var unWatchExistingModelInput=$scope.$watch("vm.existingInputModel",function(){ctrl.contentTypeRelationLink.allowCreateLink&&ctrl.getOptions(),ctrl.sortingExistingModelUpdate(),unWatchExistingModelInput()},!0);ctrl.existingModel=angular.copy(ctrl.existingInputModel),this.existingModel||(this.existingModel=[]),this.existingInputModel&&this.existingInputModel.length>0&&(this.multiSelectOpened=!0),this.newModel||(this.newModel=[]),this.contentTypeRelationLink.allowCreateNew||!this.contentTypeRelationLink.allowCreateLink||this.contentTypeRelationLink.hidden||(this.multiSelectOpened=!0),this.contentTypeRelationLink.editTemplate&&(this.editTemplateLocation="/api/template/contentrelation/"+this.contentTypeRelationLink.editTemplate),this.existingSortingOptions={handle:".drag-handle",stop:function(){ctrl.sortingExistingModelUpdate(),$scope.$broadcast("dragstop")},start:function(){$scope.$broadcast("dragstart")}},this.newSortingOptions={handle:".drag-handle",stop:function(){$scope.$broadcast("dragstop")},start:function(){$scope.$broadcast("dragstart")}}}return AltaiContentRelationUpdateDirectiveController.prototype.sortingExistingModelUpdate=function(){var i=0;this.existingModel.map(function(model){model.order=i++})},AltaiContentRelationUpdateDirectiveController.prototype.getOptions=function(){var ctrl=this;this.contentRelationFactory.getOptions(this.contentTypeRelationLink.contentTypeId,this.contentTypeRelationLink.contentTypeRelationId).then(function(options){if(ctrl.options=angular.copy(options),ctrl.existingInputModel)for(var o=0;o<options.length;o++){ctrl.options[o].ticked=1===ctrl.existingInputModel.filter(function(elm){return elm.id==ctrl.options[o].id}).length}})},AltaiContentRelationUpdateDirectiveController.prototype.removeItem=function(modelRef){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.newModel.splice(ctrl.newModel.indexOf(modelRef),1)})},AltaiContentRelationUpdateDirectiveController.prototype.removeExistingItem=function(modelRef){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.existingModel.splice(ctrl.existingModel.indexOf(modelRef),1)})},AltaiContentRelationUpdateDirectiveController.prototype.addItem=function(){this.existingMode=!1,this.newModel||(this.newModel=[]),this.newModel.push({guid:this.altaiGuidService.generateGuid()})},AltaiContentRelationUpdateDirectiveController.prototype.closeLinker=function(){this.multiSelectOpened=!1,this.existingModel=[];for(var i=0;i<this.options.length;i++)this.options[i].ticked=!1},AltaiContentRelationUpdateDirectiveController.prototype.linkItem=function(){this.existingModel||(this.existingModel=[]),this.existingMode=!0,this.multiSelectOpened=!0},AltaiContentRelationUpdateDirectiveController.prototype.stopLinking=function(){this.existingModel=[],this.multiSelectOpened=!1},AltaiContentRelationUpdateDirectiveController.prototype.getState=function(item){var vm=this;return void 0!=vm.existingModel.filter(function(existing){return existing.id==item.id})[0]},AltaiContentRelationUpdateDirectiveController.prototype.changeItem=function(item){var vm=this,itemexists=vm.existingModel.filter(function(it){return it.id==item.id})[0],index=vm.existingModel.indexOf(itemexists);index>=0?vm.existingModel.splice(index,1):vm.existingModel.push({id:item.id})},AltaiContentRelationUpdateDirectiveController}();AltaiContent.AltaiContentRelationUpdateItemDirective=AltaiContentRelationUpdateItemDirective;var AltaiContentRelationUpdateItemDirectiveController=function(){function AltaiContentRelationUpdateItemDirectiveController($compile,$element,$scope,wmContainerFactory){this.$compile=$compile,this.$element=$element,this.$scope=$scope,this.wmContainerFactory=wmContainerFactory}return AltaiContentRelationUpdateItemDirectiveController.prototype.createNewForm=function(){this.contentTypeRelationLink.contentTypeId},AltaiContentRelationUpdateItemDirectiveController}()}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiSelectInputDirective(){return{scope:{attributeId:"=altaiSelectInput",model:"=model"},replace:!0,template:"<select data-ng-options='o.label for o in ::options' ng-model='internalModel'></select>",controller:function($scope,$element,$attrs,$http){$scope.usedModel=$attrs.ngModel,$http.get(config.backendUrl+"/api/attributeSelectOption?id="+$scope.attributeId).then(function(result){$scope.options=result.data,$scope.internalModel=$scope.options.filter(function(elm){return elm.value==$scope.model})[0]}),$scope.$watch("internalModel",function(){$scope.internalModel&&($scope.model=$scope.internalModel.value)})}}}AltaiContent.AltaiSelectInputDirective=AltaiSelectInputDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function AltaiHidePastDirective(){return{scope:{checkDate:"=altaiHidePast"},link:function(scope,element,attr){scope.checkDate=moment(scope.checkDate),moment().diff(scope.checkDate,"days")>0&&element.remove()}}}AltaiContent.AltaiHidePastDirective=AltaiHidePastDirective}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentCollectionDataService=function(){function ContentCollectionDataService($q,$http){this.q=$q,this.http=$http}return ContentCollectionDataService.prototype.getData=function(contentCollectionId,urlParams){var d=this.q.defer(),url="/api/contentCollection/"+contentCollectionId+"/data";return urlParams&&(url+="?"+urlParams),this.http.get(url,{cache:!1}).success(function(result){d.resolve(result)}),d.promise},ContentCollectionDataService.prototype.getDataByName=function(contentCollectionName,urlParams){var d=this.q.defer(),url="/api/contentCollection/name/"+contentCollectionName+"/data";return urlParams&&(url+="?"+urlParams),this.http.get(url,{cache:!1}).success(function(result){d.resolve(result)}),d.promise},ContentCollectionDataService}();AltaiContent.ContentCollectionDataService=ContentCollectionDataService}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentCollectionManager=function(_super){function ContentCollectionManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/contentCollection","ContentCollection",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentCollectionManager,_super),ContentCollectionManager.prototype.createContentViewFilter=function(newContentViewFilter){var d=this.$q.defer(),s=this;return this.$http({method:"POST",url:config.backendUrl+"/api/ContentCollectionFilter",data:newContentViewFilter}).then(function(result){var item=s.getCachedDataItem(result.data.contentViewId);item.contentViewFilters.push(result.data),d.resolve(),s.notificationFactory.success("Succesfully created new content view filter")},function(error){d.reject(error),s.notificationFactory.error(error.data.message)}),d.promise},ContentCollectionManager.prototype.deleteContentViewFilter=function(contentCollectionId,filter){var deferred=this.$q.defer(),s=this;return this.$http({method:"DELETE",url:config.backendUrl+"/api/ContentCollectionFilter/"+filter.id}).then(function(result){var item=s.getCachedDataItem(contentCollectionId);item.contentViewFilters.splice(item.contentViewFilters.indexOf(filter),1),deferred.resolve(),s.notificationFactory.success("Succesfully deleted the content view filter")},function(error){deferred.reject(error),s.notificationFactory.error("Could not delete the new content view filter")}),deferred.promise},ContentCollectionManager.prototype.createContentViewSorter=function(newContentViewSorter){var d=this.$q.defer(),s=this;return this.$http.post(config.backendUrl+"/api/contentcollectionsorter",newContentViewSorter).then(function(result){s.notificationFactory.success("Created new contentViewSorter"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentCollectionManager.prototype.deleteContentViewSorter=function(selContentViewSorter){var d=this.$q.defer(),s=this;return this.$http["delete"](config.backendUrl+"/api/contentcollectionsorter/"+selContentViewSorter.id).then(function(result){var item=s.getCachedDataItem(selContentViewSorter.contentViewId);item.contentViewFilters.splice(item.contentViewSorters.indexOf(selContentViewSorter),1),s.notificationFactory.success("Deleted contentViewSorter"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentCollectionManager.prototype.updateAttributes=function(contentCollectionId,attributes){var d=this.$q.defer();return this.$http.post(config.backendUrl+"/api/ContentCollection/"+contentCollectionId+"/updateAttributes",attributes).success(function(result){d.resolve(result)}),d.promise},ContentCollectionManager.prototype.updateRelations=function(contentCollectionId,relations){var d=this.$q.defer();return this.$http.post(config.backendUrl+"/api/ContentCollection/"+contentCollectionId+"/updateRelations",relations).success(function(result){d.resolve(result)}),d.promise},ContentCollectionManager}(AltaiCore.AltaiDataService);AltaiContent.ContentCollectionManager=ContentCollectionManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionManager=function(_super){function ExposedContentCollectionManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/exposedcontentCollection","ExposedContentCollection",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ExposedContentCollectionManager,_super),ExposedContentCollectionManager.prototype.createExposedContentViewFilter=function(newExposedContentViewFilter){var d=this.$q.defer(),s=this;return this.$http({method:"POST",url:config.backendUrl+"/api/ContentCollectionFilter",data:newExposedContentViewFilter}).then(function(result){var item=s.getCachedDataItem(result.data.contentViewId);item.contentViewFilters.push(result.data),d.resolve(),s.notificationFactory.success("Succesfully created new content view filter")},function(error){d.reject(error),s.notificationFactory.error(error.data.message)}),d.promise},ExposedContentCollectionManager.prototype.deleteExposedContentViewFilter=function(exposedContentCollectionId,filter){var deferred=this.$q.defer(),s=this;return this.$http({method:"DELETE",url:config.backendUrl+"/api/ContentCollectionFilter/"+filter.id}).then(function(result){var item=s.getCachedDataItem(exposedContentCollectionId);item.contentViewFilters.splice(item.contentViewFilters.indexOf(filter),1),deferred.resolve(),s.notificationFactory.success("Succesfully deleted the content view filter")},function(error){deferred.reject(error),s.notificationFactory.error("Could not delete the new content view filter")}),deferred.promise},ExposedContentCollectionManager.prototype.createExposedContentViewSorter=function(newExposedContentViewSorter){var d=this.$q.defer(),s=this;return this.$http.post(config.backendUrl+"/api/contentcollectionsorter",newExposedContentViewSorter).then(function(result){s.notificationFactory.success("Created new contentViewSorter"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ExposedContentCollectionManager.prototype.deleteExposedContentViewSorter=function(selExposedContentViewSorter){var d=this.$q.defer(),s=this;return this.$http["delete"](config.backendUrl+"/api/contentcollectionsorter/"+selExposedContentViewSorter.id).then(function(result){var item=s.getCachedDataItem(selExposedContentViewSorter.contentViewId);item.contentViewFilters.splice(item.contentViewSorters.indexOf(selExposedContentViewSorter),1),s.notificationFactory.success("Deleted contentViewSorter"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ExposedContentCollectionManager.prototype.getForContentType=function(contentTypeId){var s=this,d=s.$q.defer();return s.altaiHttp.get("/api/contentType/"+contentTypeId+"/exposedContentCollection").then(function(result){d.resolve(result)}),d.promise},ExposedContentCollectionManager.prototype.getContentTypes=function(exposedContentCollectionId){var d=this.$q.defer(),service=this;return service.altaiHttp.get(service.apiUrl+"/"+exposedContentCollectionId+"/contentTypes").then(function(result){d.resolve(result)}),d.promise},ExposedContentCollectionManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionManager=ExposedContentCollectionManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionFilterManager=function(_super){function ExposedContentCollectionFilterManager($http,altaiHttp,$q,altaiNotificationFactory,exposedContentCollectionManager){var _this=_super.call(this,"/api/exposedcontentCollectionFilter","ExposedContentCollectionFilter",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.exposedContentCollectionManager=exposedContentCollectionManager,_this}return __extends(ExposedContentCollectionFilterManager,_super),ExposedContentCollectionFilterManager.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result),service.exposedContentCollectionManager.getById(result.exposedContentCollectionId).then(function(currentCollection){currentCollection.exposedContentCollectionFilters.push(result)})}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionFilterManager.prototype.updateFilterSorting=function(filters){for(var service=this,i=0;i<filters.length;i++)filters[i].order=i;service.$http.put(service.apiUrl+"/sorting",filters)},ExposedContentCollectionFilterManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionFilterManager=ExposedContentCollectionFilterManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionFilterMLTCriteriumManager=function(_super){function ExposedContentCollectionFilterMLTCriteriumManager($http,altaiHttp,$q,altaiNotificationFactory,exposedContentCollectionManager){var _this=_super.call(this,"/api/exposedcontentCollectionFilterMLTCriterium","ExposedContentCollectionFilterMLTCriterium",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.exposedContentCollectionManager=exposedContentCollectionManager,_this}return __extends(ExposedContentCollectionFilterMLTCriteriumManager,_super),ExposedContentCollectionFilterMLTCriteriumManager.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result)}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionFilterMLTCriteriumManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionFilterMLTCriteriumManager=ExposedContentCollectionFilterMLTCriteriumManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionSorterManager=function(_super){function ExposedContentCollectionSorterManager($http,altaiHttp,$q,altaiNotificationFactory,exposedContentCollectionManager){var _this=_super.call(this,"/api/exposedContentCollectionSorter","ExposedContentCollectionSorter",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.exposedContentCollectionManager=exposedContentCollectionManager,_this}return __extends(ExposedContentCollectionSorterManager,_super),ExposedContentCollectionSorterManager.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result),service.exposedContentCollectionManager.getById(result.exposedContentCollectionId).then(function(currentCollection){currentCollection.exposedContentCollectionSorters.push(result)})}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionSorterManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionSorterManager=ExposedContentCollectionSorterManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){
this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionRangeManager=function(_super){function ExposedContentCollectionRangeManager($http,altaiHttp,$q,altaiNotificationFactory,exposedContentCollectionManager){var _this=_super.call(this,"/api/exposedContentCollectionRange","ExposedContentCollectionRange",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.exposedContentCollectionManager=exposedContentCollectionManager,_this}return __extends(ExposedContentCollectionRangeManager,_super),ExposedContentCollectionRangeManager.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result),service.exposedContentCollectionManager.getById(result.exposedContentCollectionId).then(function(currentCollection){currentCollection.exposedContentCollectionRanges.push(result)})}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionRangeManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionRangeManager=ExposedContentCollectionRangeManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ExposedContentCollectionAttributeManager=function(_super){function ExposedContentCollectionAttributeManager($http,altaiHttp,$q,altaiNotificationFactory,exposedContentCollectionManager){var _this=_super.call(this,"/api/exposedcontentCollectionAttribute","ExposedContentCollectionAttribute",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.exposedContentCollectionManager=exposedContentCollectionManager,_this}return __extends(ExposedContentCollectionAttributeManager,_super),ExposedContentCollectionAttributeManager.prototype.getAttributes=function(exposedContentCollectionId){var d=this.$q.defer(),service=this;return this.$http.get(service.apiUrl+"/"+exposedContentCollectionId).success(function(result){d.resolve(result)}).error(function(result){service.error("Could not Get "+service.apiUrl+"/"+exposedContentCollectionId)}),d.promise},ExposedContentCollectionAttributeManager.prototype.updateAttributes=function(exposedContentCollectionId,attributes){var d=this.$q.defer(),service=this;return this.$http.put(service.apiUrl+"/"+exposedContentCollectionId,attributes).success(function(result){service.success("Succesfully updated "+service.objectName),service.dataList=result,d.resolve(result),service.exposedContentCollectionManager.getById(exposedContentCollectionId).then(function(currentCollection){currentCollection.expContCollAttributes=result})}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionAttributeManager.prototype.add=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post(service.apiUrl,newItem).success(function(result){service.success("Succesfully created new "+service.objectName),service.dataList.push(result),d.resolve(result),service.exposedContentCollectionManager.getById(result.exposedContentCollectionId).then(function(currentCollection){currentCollection.expContCollAttributes.push(result)})}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ExposedContentCollectionAttributeManager}(AltaiCore.AltaiDataService);AltaiContent.ExposedContentCollectionAttributeManager=ExposedContentCollectionAttributeManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentAttributeService=function(_super){function ContentAttributeService($http,altaiHttp,$q,logService,altaiNotificationFactory){var _this=_super.call(this,"/api/contentAttribute","ContentAttribute",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.contentAttributeTypes=[],_this.enableCaching=!1,_this}return __extends(ContentAttributeService,_super),ContentAttributeService.prototype.listAttributeType=function(){var d=this.$q.defer(),s=this;return 0!=s.contentAttributeTypes.length?d.resolve(s.contentAttributeTypes):this.$http.get(config.backendUrl+"/api/contentAttributeType").then(function(result){angular.copy(result.data,s.contentAttributeTypes),d.resolve(s.contentAttributeTypes)},function(error){d.reject()}),d.promise},ContentAttributeService}(AltaiCore.AltaiDataService);AltaiContent.ContentAttributeService=ContentAttributeService}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentItemService=function(_super){function ContentItemService($filter,$http,$q,altaiHttp,$rootScope,altaiNotificationFactory,contentRelationFactory,altaiLocalizationService,contentCreateItemProcessor){var _this=_super.call(this,"/api/content","ContentItem",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$filter=$filter,_this.$rootScope=$rootScope,_this.contentRelationFactory=contentRelationFactory,_this.altaiLocalizationService=altaiLocalizationService,_this.contentCreateItemProcessor=contentCreateItemProcessor,_this.lastUsedContentItemSearchModel=[],_this.advDataList={},_this}return __extends(ContentItemService,_super),ContentItemService.prototype.getDataById=function(id,lang){var service=this;return lang||(lang=service.altaiLocalizationService.getCurrentLangCode()),this.getDataByIdInLang(id,lang)},ContentItemService.prototype.getContentTypeOfContentItem=function(contentItemId){var d=this.$q.defer();return this.altaiHttp.get("/api/content/"+contentItemId+"/contenttypeid").then(function(contenttypeid){d.resolve(contenttypeid)}),d.promise},ContentItemService.prototype.getDataByIdInLang=function(id,lang){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+id+"/data";return service.$http({method:"GET",url:requestUrl,headers:{"Accept-Language":lang,"Force-Language":lang}}).then(function(result){d.resolve(result.data)},function(){service.error("Could not GET "+requestUrl),d.reject()}),d.promise},ContentItemService.prototype.add=function(newItem){var d=this.$q.defer(),s=this;return this.$http.post(this.apiUrl,newItem).success(function(result){s.success("Successfully created new "+s.objectName);for(var i=0;i<s.lastUsedContentItemSearchModel.length;i++)s.listAdvanced(s.lastUsedContentItemSearchModel[i]);s.contentRelationFactory.resetOptions(),s.$rootScope.$broadcast(AltaiContent.ContentEvents.contentItemCreated,result),d.resolve(result)}).error(function(result){s.error("Could not POST "+this.apiUrl)}),d.promise},ContentItemService.prototype.likeContentItem=function(item){var d=this.$q.defer(),service=this,oldItem=new AltaiContent.ContentItem;oldItem.id=item.id,oldItem.name=item.title;var requestUrl=this.apiUrl+"/like";return this.$http.post(requestUrl,oldItem).success(function(result){service.success(service.$filter("translate")("TheItem")+' "'+oldItem.name+'" '+service.$filter("translate")("WasAddedToTheListOfFavorites")),d.resolve(result)}).error(function(){service.error("Kindly login to like this content"),d.reject()}),d.promise},ContentItemService.prototype.unlikeContentItem=function(item){var d=this.$q.defer(),service=this,oldItem=new AltaiContent.ContentItem;oldItem.id=item.id,oldItem.name=item.title;var requestUrl=this.apiUrl+"/unlike";return this.$http.post(requestUrl,oldItem).success(function(result){service.success(service.$filter("translate")("TheItem")+' "'+oldItem.name+'" '+service.$filter("translate")("WasRemovedFromTheListOfFavorites")),d.resolve(result)}).error(function(){service.error("Kindly login to dislike this content"),d.reject()}),d.promise},ContentItemService.prototype.listAdvanced=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/content/list/",searchModel).then(function(result){s.advDataList[searchModel.windowId]=angular.copy(result.data),s.saveLastUsedSearchModel(searchModel),d.resolve(s.advDataList[searchModel.windowId])},function(error){d.reject(error),s.notificationFactory.error("Could not load the content rows!")}),d.promise},ContentItemService.prototype.saveLastUsedSearchModel=function(searchModel){var memoryModel=this.lastUsedContentItemSearchModel.filter(function(memoryModel){return memoryModel.windowId==searchModel.windowId})[0];memoryModel?memoryModel=searchModel:this.lastUsedContentItemSearchModel.push(searchModel)},ContentItemService.prototype.getByIdInLang=function(id,lang){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+id;return this.$http({method:"GET",url:requestUrl,headers:{"Accept-Language":lang}}).then(function(result){d.resolve(result.data)},function(){service.error("Could not GET "+requestUrl),d.reject()}),d.promise},ContentItemService.prototype.getTemplateId=function(id){var s=this,d=this.$q.defer(),requestUrl=this.apiUrl+"/"+id+"/templateid";return this.$http({method:"GET",url:requestUrl}).then(function(result){d.resolve(result.data)},function(){s.error("Could not GET "+requestUrl),d.reject()}),d.promise},ContentItemService.prototype.publish=function(contentItemId){var s=this,d=s.$q.defer();return s.altaiHttp.get("/api/content/"+contentItemId+"/publish").then(function(result){d.resolve(result)}),d.promise},ContentItemService.prototype.unpublish=function(contentItemId){var s=this,d=s.$q.defer();return s.altaiHttp.get("/api/content/"+contentItemId+"/unpublish").then(function(result){d.resolve(result)}),d.promise},ContentItemService.prototype.getIsFavourite=function(id){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/isFavourite/"+id;return this.$http({method:"GET",url:requestUrl}).then(function(result){d.resolve(result.data)},function(){service.error("Server error"),d.reject()}),d.promise},ContentItemService.prototype.listContentByType=function(typeId){var s=this,d=s.$q.defer();return s.$http({method:"GET",url:config.backendUrl+"/api/contentFiltered?filter=ct&contentTypeId="+typeId}).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentItemService.prototype.getLinkCollectionData=function(){var s=this,d=s.$q.defer();return s.$http({method:"GET",url:config.backendUrl+"/api/contentCollection/CollectionLinkData"}).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentItemService.prototype.update=function(item){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.itemDataList=[],service.dataList=[],service.contentRelationFactory.clearOptionsCache(),service.success("Succesfully updated "+service.objectName),d.resolve(result)}).error(function(){service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},ContentItemService.prototype.updateContentItemModel=function(contentItem,updateModel,contentType,languages,linkedContentTypes){for(var s=this,a=0;a<contentItem.contentItemAttributes.length;a++){var attribute=contentItem.contentItemAttributes[a],updatedValue=updateModel.attribute[attribute.contentTypeAttributeId].values.filter(function(value){return value.id==attribute.id})[0];if(updatedValue)if(attribute.contentTypeAttribute.attribute.translatable){attribute.translatable||(attribute.translatable={translatableValues:[]}),attribute.translatable.translatableValues||(attribute.translatable.translatableValues=[]);for(var l=0;l<languages.length;l++){var langCode=languages[l].code;if(updatedValue&&updatedValue.value){if("string"==typeof updatedValue.value){var originalValue=updatedValue.value;updatedValue.value={};for(var zi=0;zi<languages.length;zi++)updatedValue.value[languages[zi].code]=originalValue}var valueInLang=updatedValue.value[languages[l].code];if(languages[l].code in updatedValue.value){var currentTranslatableValue=attribute.translatable.translatableValues.filter(function(tv){return tv.languageCode==languages[l].code})[0];currentTranslatableValue?currentTranslatableValue.value=valueInLang:attribute.translatable.translatableValues.push({languageCode:langCode,value:valueInLang})}}}}else attribute.value=updatedValue.value;else contentItem.contentItemAttributes[a].deleted=!0}for(var a=0;a<contentType.contentTypeAttributes.length;a++){var cta=contentType.contentTypeAttributes[a];if(void 0!=updateModel.attribute[cta.id]&&void 0!=updateModel.attribute[cta.id].values)for(var newAttributes=updateModel.attribute[cta.id].values.filter(function(value){return value&&!value.id}),i=0;i<newAttributes.length;i++){var newCia={ContentTypeAttributeId:cta.id,value:newAttributes[i].value};if(cta.attribute.translatable){newCia.value=null,newCia.translatable={translatableValues:[]};for(var l=0;l<languages.length;l++)newAttributes[i].value[languages[l].code]&&newCia.translatable.translatableValues.push({languageCode:languages[l].code,value:newAttributes[i].value[languages[l].code]})}contentItem.contentItemAttributes.push(newCia)}}contentItem.contentItemAttributes=contentItem.contentItemAttributes.filter(function(attr){return!attr.deleted});for(var r=0;r<contentType.contentTypeRelationLinks.length;r++){for(var currentLinks=contentItem.contentItemRelationLinks.filter(function(link){return link.contentRelation.contentTypeRelationId==updateModel.relation[r].contentTypeRelationId}),j=0;j<currentLinks.length;j++)currentLinks[j].deleted=updateModel.relation[r].touched===!1?!1:0===updateModel.relation[r].existing.filter(function(exItem){return exItem.id===currentLinks[j].contentRelation.contentRelationLinks[0].contentId}).length;for(var z=0;z<updateModel.relation[r]["new"].length;z++){var newParsedContentItem=s.contentCreateItemProcessor.processContentItem(updateModel.relation[r]["new"][z],linkedContentTypes[updateModel.relation[r].contentTypeId]);contentItem.contentItemRelationLinks.push({contentId:contentItem.id,contentTypeRelationLinkId:updateModel.relation[r].contentTypeRelationLinkId,contentRelation:{contentTypeRelationId:updateModel.relation[r].contentTypeRelationId,contentRelationLinks:[{content:newParsedContentItem}]}})}for(var m=0;m<updateModel.relation[r].existing.length;m++){var existing=currentLinks.filter(function(cl){return cl.contentRelation.contentRelationLinks[0].contentId==updateModel.relation[r].existing[m].id})[0];if(existing){if(updateModel.relation[r].existing[m].updateModel){var updatedContentModel=s.updateContentItemModel(updateModel.relation[r].existing[m].contentItem,updateModel.relation[r].existing[m].updateModel,updateModel.relation[r].existing[m].contentType,languages,linkedContentTypes);existing.content=updatedContentModel}}else contentItem.contentItemRelationLinks.push({contentId:contentItem.id,contentTypeRelationLinkId:updateModel.relation[r].contentTypeRelationLinkId,contentRelation:{contentTypeRelationId:updateModel.relation[r].contentTypeRelationId,contentRelationLinks:[{contentId:updateModel.relation[r].existing[m].id}]}})}}contentItem.contentItemRelationLinks=contentItem.contentItemRelationLinks.filter(function(rel){return!rel.deleted});for(var r=0;r<contentType.contentTypeRelationLinks.length;r++)for(var m=0;m<updateModel.relation[r].existing.length;m++){var currentRelation=contentItem.contentItemRelationLinks.filter(function(rel){return rel.contentTypeRelationLinkId==updateModel.relation[r].contentTypeRelationLinkId&&updateModel.relation[r].existing[m].id==rel.contentRelation.contentRelationLinks[0].contentId})[0];currentRelation&&(currentRelation.order=updateModel.relation[r].existing[m].order)}return contentItem},ContentItemService}(AltaiCore.AltaiDataService);AltaiContent.ContentItemService=ContentItemService}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentItemElasticService=function(_super){function ContentItemElasticService($http,altaiHttp,$q,$rootScope,altaiNotificationFactory,contentRelationFactory){var _this=_super.call(this,"/api/elasticsearch","ContentItemElastic",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$rootScope=$rootScope,_this.contentRelationFactory=contentRelationFactory,_this.lastUsedContentItemSearchModel=[],_this.advDataList={},_this}return __extends(ContentItemElasticService,_super),ContentItemElasticService.prototype.getDataById=function(id,lang){var d=this.$q.defer();return this.$http({method:"GET",url:this.apiUrl+"/"+id+"/data",headers:{"Accept-Language":lang}}).success(function(contentData){d.resolve(contentData)}),d.promise},ContentItemElasticService.prototype.add=function(newItem){var d=this.$q.defer(),s=this;return this.$http.post(this.apiUrl,newItem).success(function(result){s.success("Successfully created new "+s.objectName);for(var i=0;i<s.lastUsedContentItemSearchModel.length;i++)s.listAdvanced(s.lastUsedContentItemSearchModel[i]);s.contentRelationFactory.resetOptions(),s.$rootScope.$broadcast(AltaiContent.ContentEvents.contentItemCreated,result),d.resolve(result)}).error(function(result){s.error("Could not POST "+this.apiUrl)}),d.promise},ContentItemElasticService.prototype.listAdvanced=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"api/elasticsearch/list",searchModel).then(function(result){s.advDataList[searchModel.windowId]=angular.copy(result.data),s.saveLastUsedSearchModel(searchModel),d.resolve(s.advDataList[searchModel.windowId])},function(error){d.reject(error),s.notificationFactory.error("Could not load the content rows!")}),d.promise},ContentItemElasticService.prototype.saveLastUsedSearchModel=function(searchModel){var memoryModel=this.lastUsedContentItemSearchModel.filter(function(memoryModel){return memoryModel.windowId==searchModel.windowId})[0];memoryModel?memoryModel=searchModel:this.lastUsedContentItemSearchModel.push(searchModel)},ContentItemElasticService.prototype.getByIdInLang=function(id,lang){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+id;return this.$http({method:"GET",url:requestUrl,headers:{"Accept-Language":lang}}).then(function(result){service.itemDataList.push(result.data),d.resolve(result.data)},function(){service.error("Could not GET "+requestUrl),d.reject()}),d.promise},ContentItemElasticService.prototype.listContentByType=function(typeId){var s=this,d=s.$q.defer();return s.$http({method:"GET",url:config.backendUrl+"/api/contentFiltered?filter=ct&contentTypeId="+typeId}).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentItemElasticService.prototype.getLinkCollectionData=function(){var s=this,d=s.$q.defer();return s.$http({method:"GET",url:config.backendUrl+"/api/contentCollection/CollectionLinkData"}).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentItemElasticService.prototype.update=function(item){var d=this.$q.defer(),service=this,requestUrl=this.apiUrl+"/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.itemDataList=[],service.dataList=[],service.contentRelationFactory.clearOptionsCache(),service.success("Succesfully updated "+service.objectName),d.resolve()}).error(function(){service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},ContentItemElasticService}(AltaiCore.AltaiDataService);AltaiContent.ContentItemElasticService=ContentItemElasticService}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentFormManager=function(_super){function ContentFormManager($http,altaiHttp,$q,altaiNotificationFactory,$translate){var _this=_super.call(this,"/api/contentForm","ContentForm",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$translate=$translate,_this}return __extends(ContentFormManager,_super),ContentFormManager.prototype.getContentFormTemplate=function(id){var s=this,d=s.$q.defer();return s.$http.get("/api/contentForm/template/"+id).then(function(result){d.resolve(result.data)},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentFormManager.prototype.createContentFormRow=function(newContentFormRow){var s=this,d=s.$q.defer();return s.$http.post("/api/contentFormRow",newContentFormRow).then(function(result){s.notificationFactory.success("Sucesfully added the attribute"),d.resolve(result.data)},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentFormManager.prototype.deleteContentFormRow=function(){},ContentFormManager.prototype.submitContentForm=function(formData){var s=this,d=this.$q.defer();return this.$http.post(config.backendUrl+"/api/contentFormData",formData).then(function(result){d.resolve()},function(error){401==error.status?s.$translate("YouNeedToBeLoggedInToEnroll").then(function(translation){s.notificationFactory.error(translation)}):s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentFormManager.prototype.loadUpdateFormData=function(contentFormId,contentItemId){var s=this,d=this.$q.defer();return this.$http.get("api/contentForm/"+contentFormId+"/contentItemData/"+contentItemId).then(function(result){d.resolve(result.data)},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},ContentFormManager}(AltaiCore.AltaiDataService);AltaiContent.ContentFormManager=ContentFormManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentFormRowManager=function(_super){function ContentFormRowManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/contentFormRow","ContentFormRow",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFormRowManager,_super),ContentFormRowManager}(AltaiCore.AltaiDataService);AltaiContent.ContentFormRowManager=ContentFormRowManager}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentCreateItemProcessor=function(){function ContentCreateItemProcessor(contentTypeService,Upload,languageFactory){this.contentTypeService=contentTypeService;var s=this;this.contentTypeService=contentTypeService,this.upload=Upload,languageFactory.listLanguage().then(function(languages){s.languages=languages})}return ContentCreateItemProcessor.prototype.processContentItem=function(newContent,contentType){var s=this;return contentType=newContent.contentType,{publicRoles:newContent.publicRoles,contentTypeId:newContent.contentType.id,name:newContent.name,guid:newContent.guid,published:newContent.published,contentItemAttributes:s.processAttributes(newContent,contentType),contentItemRelationLinks:s.processRelations(newContent,contentType)}},ContentCreateItemProcessor.prototype.processAttributes=function(newContent,contentType){var s=this,attributeValues=[];if(contentType.contentTypeAttributes)for(var i=0;i<contentType.contentTypeAttributes.length;i++){var contentTypeAttribute=contentType.contentTypeAttributes[i],attr=newContent.attribute[contentTypeAttribute.id];if(attr)if("object"==typeof attr)for(var j=0;j<Object.keys(attr).length;j++)attributeValues.push(s.createAttributeObject(contentTypeAttribute,attr[j]));else attributeValues.push(s.createAttributeObject(contentTypeAttribute,attr))}return attributeValues},ContentCreateItemProcessor.prototype.createAttributeObject=function(contentTypeAttribute,value){var s=this,output={contentTypeAttributeId:contentTypeAttribute.id};if(value&&value.value&&value.value.size)output.value=value.value.name,s.upload.upload({url:"/api/upload/",file:value.value}).success(function(data,status,headers,config){"UNSUPPORTED_FILE_EXTENSION"==data&&alert("Unsupported file extension")}).error(function(){alert("upload failed")});else if(contentTypeAttribute.attribute.translatable&&value){output.translatable={translatableValues:[]};for(var i=0;i<this.languages.length;i++)value.value[this.languages[i].code]&&output.translatable.translatableValues.push({languageCode:this.languages[i].code,value:value.value[this.languages[i].code]})}else value&&(output.value=value.value);return output},ContentCreateItemProcessor.prototype.processRelations=function(newContent,contentType){var contentItemRelationLinks=[];if(contentType.contentTypeRelationLinks)for(var i=0;i<contentType.contentTypeRelationLinks.length;i++)if(newContent.relation&&newContent.relation[contentType.contentTypeRelationLinks[i].id]){var relArray=newContent.relation[contentType.contentTypeRelationLinks[i].id];if(relArray["new"])for(var j=0;j<relArray["new"].length;j++)contentItemRelationLinks.push({contentId:0,guid:relArray["new"][j].guid,contentTypeRelationLinkId:contentType.contentTypeRelationLinks[i].id,contentRelation:{contentTypeRelationId:contentType.contentTypeRelationLinks[i].contentTypeRelationId},content:this.processContentItem(relArray["new"][j],relArray["new"][j].contentType)});if(relArray.existing)for(var j=0;j<relArray.existing.length;j++)contentItemRelationLinks.push({contentId:relArray.existing[j].id,contentTypeRelationLinkId:contentType.contentTypeRelationLinks[i].id,contentRelation:{contentTypeRelationId:contentType.contentTypeRelationLinks[i].contentTypeRelationId}})}return contentItemRelationLinks},ContentCreateItemProcessor}();AltaiContent.ContentCreateItemProcessor=ContentCreateItemProcessor}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentRelationFactory=function(){function ContentRelationFactory(altaiHttp,$q,altaiNotificationFactory){this.altaiHttp=altaiHttp,this.$q=$q,this.altaiNotificationFactory=altaiNotificationFactory,this.optionsCache=[]}return ContentRelationFactory.prototype.list=function(){var d=this.$q.defer();return this.altaiHttp.get(config.backendUrl+"/api/contentTypeRelation").then(function(contentRelations){d.resolve(contentRelations)}),d.promise},ContentRelationFactory.prototype.listWithLinks=function(){var d=this.$q.defer();return this.altaiHttp.get(config.backendUrl+"/api/contentTypeRelationWithLinks").then(function(contentRelations){d.resolve(contentRelations)}),d.promise},ContentRelationFactory.prototype.resetOptions=function(){this.optionsCache=[]},ContentRelationFactory.prototype.getOptions=function(contentTypeId,relId){var s=this,d=this.$q.defer();return s.optionsCache[contentTypeId]||(s.optionsCache[contentTypeId]={}),s.optionsCache[contentTypeId][relId]?d.resolve(s.optionsCache[contentTypeId][relId]):s.altaiHttp.get(config.backendUrl+"/api/content?contentTypeId="+contentTypeId+"&contentTypeRelationId="+relId).then(function(contentItems){s.optionsCache[contentTypeId][relId]=angular.copy(contentItems),d.resolve(contentItems)}),d.promise},ContentRelationFactory.prototype.clearOptionsCache=function(){this.optionsCache=[]},ContentRelationFactory.prototype.deleteContentItemRelation=function(contentTypeRelationId,contentItem,relContentId){var s=this,d=s.$q.defer();return s.altaiHttp["delete"]("/api/contentRelation?contentTypeRelationId="+contentTypeRelationId+"&contentId="+contentItem.id+"&relatedContentId="+relContentId).then(function(result){var contentTypeRelation=contentItem.relations.filter(function(rel){return rel.contentTypeRelationId==contentTypeRelationId})[0];if(contentTypeRelation){var relation=contentTypeRelation.content.filter(function(rel){return rel.id==relContentId});contentTypeRelation.content.splice(contentTypeRelation.content.indexOf(relation),1)}s.altaiNotificationFactory.success("Succesfully deleted relation"),d.resolve()}),d.promise},ContentRelationFactory}();AltaiContent.ContentRelationFactory=ContentRelationFactory}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentAttributeSelectOptionsManager=function(_super){function ContentAttributeSelectOptionsManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/contentAttributeSelectOption","Select option",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentAttributeSelectOptionsManager,_super),ContentAttributeSelectOptionsManager.prototype.getOptions=function(attributeId){var s=this,d=s.$q.defer();return s.$http.get("/api/attributeSelectOption?id="+attributeId).success(function(attributeOptions){d.resolve(attributeOptions)}),d.promise},ContentAttributeSelectOptionsManager.prototype.updateOptions=function(selectAttribute){var s=this,d=s.$q.defer();return s.$http.put("/api/ContentAttributeSelect",selectAttribute).success(function(result){d.resolve(result)}),d.promise},ContentAttributeSelectOptionsManager}(AltaiCore.AltaiDataService);AltaiContent.ContentAttributeSelectOptionsManager=ContentAttributeSelectOptionsManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentTypeService=function(_super){function ContentTypeService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"/api/contenttype","ContentType",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.readContentTypeRelation=function(ctrId){var s=this,d=s.$q.defer();return s.$http.get("/api/contenttyperelation/"+ctrId).success(function(contentTypeRelation){d.resolve(contentTypeRelation)}),d.promise},_this.updateContentTypeRelation=function(ctr){var s=this,d=s.$q.defer();return s.$http.put(config.backendUrl+"/api/contenttyperelation/"+ctr.id,ctr).then(function(result){s.clearCache(),s.notificationFactory.success("Sucesfully updated the content type relation!"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),
d.reject()}),d.promise},_this.updateContentAttribute=function(ca){var s=this,d=s.$q.defer();return s.$http.put(config.backendUrl+"/api/contentattribute/"+ca.id,ca).then(function(result){s.clearCache(),s.notificationFactory.success("Sucesfully updated the content attribute!"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},_this.updateContentTypeAttribute=function(cta){var s=this,d=s.$q.defer();return s.$http.put(config.backendUrl+"/api/contenttypeattribute/"+cta.id,cta).then(function(result){s.clearCache(),s.notificationFactory.success("Sucesfully updated the content type attribute!"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},_this.updateContentTypeRelationLink=function(ctrl){var s=this,d=s.$q.defer();return s.$http.put(config.backendUrl+"/api/contenttyperelationlink/",ctrl).then(function(result){s.clearCache(),s.notificationFactory.success("Sucesfully updated the content type relation link!"),d.resolve()},function(error){s.notificationFactory.error(error.data.message),d.reject()}),d.promise},_this}return __extends(ContentTypeService,_super),ContentTypeService.prototype.createContentTypeAttribute=function(newContentTypeAttribute){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/ContentTypeAttribute/",newContentTypeAttribute).then(function(result){var cachedCT=s.itemDataList.filter(function(elm){return elm.id==newContentTypeAttribute.contentTypeId})[0];cachedCT&&(cachedCT.contentTypeAttributes||(cachedCT.contentTypeAttributes=[]),cachedCT.contentTypeAttributes.push(result.data)),s.notificationFactory.success("Succesfully created new content attribute"),d.resolve(result.data)},function(error){s.notificationFactory.error(error.data.message),d.reject(error)}),d.promise},ContentTypeService.prototype.deleteContentTypeAttribute=function(attr){var s=this,d=s.$q.defer();return s.$http({method:"DELETE",url:config.backendUrl+"/api/ContentTypeAttribute/"+attr.id}).then(function(result){s.notificationFactory.success("Succesfully removed new content attribute"),d.resolve(result.data)},function(error){s.notificationFactory.error(error.data.message),d.reject(error)}),d.promise},ContentTypeService.prototype.listContentAttributeType=function(){var s=this,deferred=s.$q.defer();return s.$http({method:"GET",url:config.backendUrl+"/api/contentattributetype"}).then(function(result){deferred.resolve(result.data)},function(error){deferred.reject(error),s.notificationFactory.error("Could not load the content attribute types")}),deferred.promise},ContentTypeService.prototype.readContentTypeAttribute=function(ctaId){var s=this,d=s.$q.defer();return s.$http.get("/api/contenttypeattribute/"+ctaId).success(function(contentTypeAttribute){d.resolve(contentTypeAttribute)}),d.promise},ContentTypeService.prototype.createContentTypeRelation=function(ctr){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/contenttyperelation",ctr).then(function(result){for(var i=0;2>i;i++){if(0==i)var cachedCT=s.itemDataList.filter(function(elm){return elm.id==result.data.contentTypeRelationLinks[1].contentTypeId})[0];else var cachedCT=s.itemDataList.filter(function(elm){return elm.id==result.data.contentTypeRelationLinks[0].contentTypeId})[0];cachedCT&&(cachedCT.contentTypeRelationLinks||(cachedCT.contentTypeRelationLinks=[]),result.data.contentTypeRelationLinks[i].contentTypeRelation={},result.data.contentTypeRelationLinks[i].contentTypeRelation.name=result.data.name,result.data.contentTypeRelationLinks[i].contentTypeRelation.id=result.data.id,cachedCT.contentTypeRelationLinks.push(result.data.contentTypeRelationLinks[i]))}s.notificationFactory.success("Successfully added the new relation"),d.resolve(result.data)},function(error){s.notificationFactory.error("Could not create the new relation"),d.reject()}),d.promise},ContentTypeService.prototype.deleteContentTypeRelation=function(ctrl){var s=this,d=s.$q.defer();return s.$http["delete"](config.backendUrl+"/api/contenttyperelation/"+ctrl.contentTypeRelation.id).then(function(result){for(var i=0;i<s.itemDataList.length;i++){var cachedCt=s.itemDataList[i],cachedCtr=cachedCt.contentTypeRelationLinks.filter(function(element){return element.contentTypeRelationId==ctrl.contentTypeRelationId})[0];cachedCtr&&cachedCt.contentTypeRelationLinks.splice(cachedCt.contentTypeRelationLinks.indexOf(cachedCtr),1)}s.notificationFactory.success("Sucesfully removed the content type relation"),d.resolve()},function(error){s.notificationFactory.error("Could not remove the content type relation"),d.reject()}),d.promise},ContentTypeService.prototype.updateContentTypeAttributeSorting=function(contentTypeAttributes){for(var s=this,i=0;i<contentTypeAttributes.length;i++)contentTypeAttributes[i].order=i;s.$http.put("api/contentTypeAttribute/sorting",contentTypeAttributes)},ContentTypeService.prototype.updateContentTypeRelationLinksSorting=function(contentTypeRelationLinks){for(var s=this,i=0;i<contentTypeRelationLinks.length;i++)contentTypeRelationLinks[i].order=i;s.$http.put("api/contentTypeRelationLink/sorting",contentTypeRelationLinks)},ContentTypeService.prototype.clearCache=function(){this.itemDataList=[]},ContentTypeService.prototype.getCachedListItem=function(ctId){return this.dataList.filter(function(elm){return elm.id===ctId})[0]},ContentTypeService.prototype.previewPossibleForType=function(ctId){var s=this,d=s.$q.defer();return s.list().then(function(cts){var ct=s.getCachedListItem(ctId);ct&&ct.templateId?d.resolve(!0):d.resolve(!1)}),d.promise},ContentTypeService.prototype.publishPossibleForType=function(ctId){var s=this,d=s.$q.defer();return s.list().then(function(cts){var ct=s.getCachedListItem(ctId);ct&&ct.allowPublish?d.resolve(!0):d.resolve(!1)}),d.promise},ContentTypeService.prototype.editPossibleForType=function(ctId){var s=this,d=s.$q.defer();return s.list().then(function(cts){var ct=s.getCachedListItem(ctId);ct&&ct.allowWriteItems?d.resolve(!0):d.resolve(!1)}),d.promise},ContentTypeService.prototype.getLinkedStateName=function(contentTypeId){var s=this,linkedStateName=s.linkedStates[contentTypeId];return linkedStateName?s.linkedStates[contentTypeId]:""},ContentTypeService.prototype.getLinkedState=function(contentTypeId){var s=this,d=s.$q.defer();return s.linkedStates?d.resolve(s.getLinkedStateName(contentTypeId)):s.altaiHttp.get("/api/contentType/states").then(function(states){s.linkedStates=angular.copy(states),d.resolve(s.getLinkedStateName(contentTypeId))}),d.promise},ContentTypeService}(AltaiCore.AltaiDataService);AltaiContent.ContentTypeService=ContentTypeService}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function ContentActionProvider(){var _contentActions=[];return{add:function(contentAction){_contentActions.push(contentAction)},$get:function(){return{list:function(){return _contentActions}}}}}AltaiContent.ContentActionProvider=ContentActionProvider}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentUpdateModelManager=function(){function ContentUpdateModelManager($q,contentItemService,contentTypeService){this.$q=$q,this.contentItemService=contentItemService,this.contentTypeService=contentTypeService,this.updateModels=[]}return ContentUpdateModelManager.prototype.getUpdateModel=function(contentItemId){var s=this,d=s.$q.defer();s.updateModels.filter(function(model){return model.id==contentItemId})[0];return s.updateModels[contentItemId]?d.resolve(s.updateModels[contentItemId]):s.contentItemService.getById(contentItemId).then(function(contentItem){s.contentTypeService.getById(contentItem.contentTypeId).then(function(contentType){s.updateModels[contentItemId]={attribute:{},relation:{},templateId:contentItem.templateId,contentType:contentType};for(var a=0;a<contentItem.contentItemAttributes.length;a++){var attr=contentItem.contentItemAttributes[a];s.updateModels[contentItemId].attribute[attr.contentTypeAttributeId];if(s.updateModels[contentItemId].attribute[attr.contentTypeAttributeId]||(s.updateModels[contentItemId].attribute[attr.contentTypeAttributeId]={values:[]}),attr.translatable){for(var localModel={},t=0;t<attr.translatable.translatableValues.length;t++)localModel[attr.translatable.translatableValues[t].languageCode]=attr.translatable.translatableValues[t].value;s.updateModels[contentItemId].attribute[attr.contentTypeAttributeId].values.push({id:attr.id,value:localModel})}else s.updateModels[contentItemId].attribute[attr.contentTypeAttributeId].values.push({id:attr.id,value:attr.value})}for(var l=0;l<contentType.contentTypeRelationLinks.length;l++){var ctId=contentType.contentTypeRelationLinks[l].contentTypeId;s.updateModels[contentItemId].relation[l]={contentTypeId:ctId,contentTypeRelationId:contentType.contentTypeRelationLinks[l].contentTypeRelationId,contentTypeRelationLinkId:contentType.contentTypeRelationLinks[l].id,existing:[],existingIn:[],"new":[],touched:!1};for(var existingLinks=contentItem.contentItemRelationLinks.filter(function(link){return link.contentRelation.contentTypeRelationId==contentType.contentTypeRelationLinks[l].contentTypeRelationId}),i=0;i<existingLinks.length;i++)s.updateModels[contentItemId].relation[l].existingIn.push({id:existingLinks[i].contentRelation.contentRelationLinks[0].contentId,order:existingLinks[i].order})}d.resolve(s.updateModels[contentItemId])})}),d.promise},ContentUpdateModelManager.prototype.resetModels=function(){this.updateModels=[]},ContentUpdateModelManager}();AltaiContent.ContentUpdateModelManager=ContentUpdateModelManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentItemBbManager=function(_super){function ContentItemBbManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/contentitembb","ContentItemBB",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentItemBbManager,_super),ContentItemBbManager}(AltaiCore.AltaiDataService);AltaiContent.ContentItemBbManager=ContentItemBbManager}(AltaiContent||(AltaiContent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiContent;!function(AltaiContent){var ContentTypeAttributeManager=function(_super){function ContentTypeAttributeManager(altaiHttp,$http,$q,altaiNotificationFactory){return _super.call(this,"/api/contentTypeAttribute","ContentTypeAttribute",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentTypeAttributeManager,_super),ContentTypeAttributeManager}(AltaiCore.AltaiDataService);AltaiContent.ContentTypeAttributeManager=ContentTypeAttributeManager}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentItemSelectionService=function(){function ContentItemSelectionService(){this.selections={},this.observers={},this.selectionKeyCounter=1}return ContentItemSelectionService.prototype.getAvailableSelectionKey=function(){return this.selectionKeyCounter++},ContentItemSelectionService.prototype.addToSelection=function(selectionKey,contentItem,notify){void 0===notify&&(notify=!0),this.isItemSelected(selectionKey,contentItem)||(this.selections[selectionKey]||(this.selections[selectionKey]=[]),this.selections[selectionKey].push({id:contentItem.id,contentTypeId:contentItem.contentTypeId,name:contentItem.name}),notify&&this.selectionChanged(selectionKey))},ContentItemSelectionService.prototype.getSelectedItemById=function(selectionKey,contentItemId){if(this.selections[selectionKey]){var item=this.selections[selectionKey].filter(function(item){return item.id==contentItemId})[0];if(item)return item}},ContentItemSelectionService.prototype.removeFromSelection=function(selectionKey,contentItem){var item=this.getSelectedItemById(selectionKey,contentItem.id);item&&(this.selections[selectionKey].splice(this.selections[selectionKey].indexOf(item),1),this.selectionChanged(selectionKey))},ContentItemSelectionService.prototype.getSelection=function(selectionKey){return this.selections[selectionKey]},ContentItemSelectionService.prototype.clearSelections=function(){this.selections=[],this.observers=[]},ContentItemSelectionService.prototype.isItemSelected=function(selectionKey,contentItem){var item=this.getSelectedItemById(selectionKey,contentItem.id);return this.selections[selectionKey]&&-1!==this.selections[selectionKey].indexOf(item)},ContentItemSelectionService.prototype.observeSelection=function(selectionKey,cb){this.observers[selectionKey]||(this.observers[selectionKey]=[]),this.observers[selectionKey].push(cb)},ContentItemSelectionService.prototype.selectionChanged=function(selectionKey){if(this.observers[selectionKey])for(var i=0;i<this.observers[selectionKey].length;i++)this.observers[selectionKey][i]()},ContentItemSelectionService.prototype.applySingleItemPolicy=function(selectionKey){this.selections[selectionKey].splice(0,this.selections[selectionKey].length-1)},ContentItemSelectionService}();AltaiContent.ContentItemSelectionService=ContentItemSelectionService}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentAttributeType=function(){function ContentAttributeType(){}return ContentAttributeType}();AltaiContent.ContentAttributeType=ContentAttributeType}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentCollection=function(){function ContentCollection(){}return ContentCollection}();AltaiContent.ContentCollection=ContentCollection}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentItem=function(){function ContentItem(){}return ContentItem}();AltaiContent.ContentItem=ContentItem}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentItemSearchModel=function(){function ContentItemSearchModel(){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0,this.chosenContentTypeModel=[]}return ContentItemSearchModel}();AltaiContent.ContentItemSearchModel=ContentItemSearchModel}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentType=function(){function ContentType(){}return ContentType}();AltaiContent.ContentType=ContentType}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentWindows=function(){function ContentWindows(){}return ContentWindows}();ContentWindows.contentTypeList=new AltaiWindowManager.wmWindowType("contentTypeList","<altai-content-type-list></altai-content-type-list>",300,600,1600),ContentWindows.contentTypeCreate=new AltaiWindowManager.wmWindowType("contentTypeCreate","<altai-content-type-create></altai-content-type-create>",250,960,1600),ContentWindows.contentTypeUpdate=new AltaiWindowManager.wmWindowType("contentTypeUpdate","<altai-content-type-update content-type-id='vm.window.entityId'></altai-content-type-update>",250,960,1600),ContentWindows.contentTypeProfile=new AltaiWindowManager.wmWindowType("contentTypeProfile","<altai-content-type-profile content-type-id='vm.window.entityId'></altai-content-type-profile>",250,960,1600),ContentWindows.contentTypeRelationUpdate=new AltaiWindowManager.wmWindowType("contentTypeRelationUpdate","<altai-content-type-relation-update content-type-relation-id='vm.window.entityId'></altai-content-type-relation-update>",250,600,1600),ContentWindows.contentTypeAttributeUpdate=new AltaiWindowManager.wmWindowType("contentTypeAttributeUpdate","<altai-content-type-attribute-update content-type-attribute-id='vm.window.entityId'></altai-content-type-attribute-update>",250,600,1600),ContentWindows.contentTypeRelationCreate=new AltaiWindowManager.wmWindowType("contentTypeRelationCreate","<altai-content-type-relation-create content-type-id='vm.window.entityId'></altai-content-type-relation-create>",250,600,1600),ContentWindows.contentTypeAttributeCreate=new AltaiWindowManager.wmWindowType("contentTypeAttributeCreate","<altai-content-type-attribute-create content-type-id='vm.window.entityId'></altai-content-type-attribute-create>",250,600,1600),ContentWindows.contentCollectionList=new AltaiWindowManager.wmWindowType("contentCollectionList","<altai-content-collection-list></altai-content-collection-list>",250,960,1600),ContentWindows.contentCollectionCreate=new AltaiWindowManager.wmWindowType("contentCollectionCreate","<altai-content-collection-create></altai-content-collection-create>",250,960,1600),ContentWindows.contentCollectionUpdate=new AltaiWindowManager.wmWindowType("contentCollectionUpdate","<altai-content-collection-update content-collection-id='vm.window.entityId'></altai-content-collection-update>",250,960,1600),ContentWindows.contentCollectionPreview=new AltaiWindowManager.wmWindowType("contentCollectionPreview","<altai-content-collection-preview content-collection-id='vm.window.entityId'></altai-content-collection-preview>",250,960,1600),ContentWindows.exposedContentCollectionList=new AltaiWindowManager.wmWindowType("exposedContentCollectionList","<altai-exposed-content-collection-list></altai-exposed-content-collection-list>",250,960,1600),ContentWindows.exposedContentCollectionCreate=new AltaiWindowManager.wmWindowType("exposedContentCollectionCreate","<altai-exposed-content-collection-create></altai-exposed-content-collection-create>",250,960,1600),ContentWindows.exposedContentCollectionUpdate=new AltaiWindowManager.wmWindowType("exposedContentCollectionUpdate","<altai-exposed-content-collection-update exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-update>",250,960,1600),ContentWindows.exposedContentCollectionPreview=new AltaiWindowManager.wmWindowType("exposedContentCollectionPreview","<altai-exposed-content-collection-preview exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-preview>",250,960,1600),ContentWindows.exposedContentCollectionFilterCreate=new AltaiWindowManager.wmWindowType("exposedContentCollectionFilterCreate","<altai-exposed-content-collection-filter-create exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-filter-create>",600,600,800),ContentWindows.exposedContentCollectionFilterUpdate=new AltaiWindowManager.wmWindowType("exposedContentCollectionFilterUpdate","<altai-exposed-content-collection-filter-update exposed-content-collection-filter-id='vm.window.entityId'></altai-exposed-content-collection-filter-update>",600,600,800),ContentWindows.exposedContentCollectionSorterCreate=new AltaiWindowManager.wmWindowType("exposedContentCollectionSorterCreate","<altai-exposed-content-collection-sorter-create exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-sorter-create>",600,600,800),ContentWindows.exposedContentCollectionSorterUpdate=new AltaiWindowManager.wmWindowType("exposedContentCollectionSorterUpdate","<altai-exposed-content-collection-sorter-update exposed-content-collection-sorter-id='vm.window.entityId'></altai-exposed-content-collection-sorter-update>",600,600,800),ContentWindows.exposedContentCollectionRangeCreate=new AltaiWindowManager.wmWindowType("exposedContentCollectionRangeCreate","<altai-exposed-content-collection-range-create exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-range-create>",600,600,800),ContentWindows.exposedContentCollectionRangeUpdate=new AltaiWindowManager.wmWindowType("exposedContentCollectionRangeUpdate","<altai-exposed-content-collection-range-update exposed-content-collection-range-id='vm.window.entityId'></altai-exposed-content-collection-range-update>",600,600,800),ContentWindows.exposedContentCollectionAttributeUpdate=new AltaiWindowManager.wmWindowType("exposedContentCollectionAttributeUpdate","<altai-exposed-content-collection-attribute-update exposed-content-collection-id='vm.window.entityId'></altai-exposed-content-collection-attribute-update>",600,600,800),ContentWindows.exposedContentCollectionFilterMltCriteriumCreate=new AltaiWindowManager.wmWindowType("exposedContentCollectionFilterMltCriteriumCreate","<altai-exposed-content-collection-filter-mlt-criterium-create exposed-content-collection-filter-id='vm.window.entityId'></altai-exposed-content-collection-filter-mlt-criterium-create>",600,600,800),ContentWindows.contentItemProfile=new AltaiWindowManager.wmWindowType("contentItemProfile","<altai-content-item-profile content-item-id='vm.window.entityId' languages='vm.languages'></altai-content-item-profile>",500,960,1600,!0,!1),ContentWindows.contentItemList=new AltaiWindowManager.wmWindowType("contentItemList","<altai-content-item-list content-type-id='vm.window.entityId' languages='vm.languages' window-id='::vm.window.id'></altai-content-item-list>",1e3,1200,1600,!0,!1),ContentWindows.contentItemCreate=new AltaiWindowManager.wmWindowType("contentItemCreate","<altai-content-item-create-parent content-type-id='vm.window.entityId' languages='vm.languages'></altai-content-item-create-parent>",500,960,1600,!0,!0),ContentWindows.contentItemUpdate=new AltaiWindowManager.wmWindowType("contentItemUpdate","<altai-content-item-update-parent content-item-id='vm.window.entityId'></altai-content-item-update-parent>",500,960,1600,!0,!0),ContentWindows.contentItemPreview=new AltaiWindowManager.wmWindowType("contentItemPreview","<altai-content-item-preview content-item-id='vm.window.entityId' languages='vm.languages'></altai-content-item-preview>",1200,1200,2500,!0,!1),ContentWindows.contentItemSelect=new AltaiWindowManager.wmWindowType("contentItemSelect","<altai-content-item-select content-type-id='vm.window.entityId' selection-key='vm.window.entityProperties.selectionKey'></altai-content-item-select>"),ContentWindows.contentItemProfileElastic=new AltaiWindowManager.wmWindowType("contentItemProfile","<altai-content-item-profile-elastic content-item-id='vm.window.entityId' languages='vm.languages'></altai-content-item-profile-elastic>",500,960,1600,!0,!1),ContentWindows.contentItemListElastic=new AltaiWindowManager.wmWindowType("contentItemListElastic","<altai-content-item-list-elastic content-type-id='vm.window.entityId' languages='vm.languages' window-id='::vm.window.id'></altai-content-item-list-elastic>",1e3,1200,1600,!0,!1),ContentWindows.contentItemCreateElastic=new AltaiWindowManager.wmWindowType("contentItemCreate","<altai-content-item-create-elastic content-type-id='vm.window.entityId' languages='vm.languages'></altai-content-item-create-elastic>",500,960,1600,!0,!0),ContentWindows.contentItemUpdateElastic=new AltaiWindowManager.wmWindowType("contentItemUpdate","<altai-content-item-update-elastic content-item-id='vm.window.entityId' languages='vm.languages'></altai-content-item-update-elastic>",500,960,1600,!0,!0),ContentWindows.contentItemPreviewElastic=new AltaiWindowManager.wmWindowType("contentItemPreviewElastic","<altai-content-item-preview-elastic content-item-preview='vm.window.entityId'></altai-content-item-preview-elastic>",1200,1200,2500,!0,!1),ContentWindows.contentItemSearchElastic=new AltaiWindowManager.wmWindowType("contentItemSearchElastic","<altai-exposed-content-collection template-id='308' exposed-content-collection-id='17'></altai-exposed-content-collection>",1200,1400,1600,!0,!1),ContentWindows.contentFormList=new AltaiWindowManager.wmWindowType("contentFormList","<altai-content-form-list></altai-content-form-list>",250,960,1600),ContentWindows.contentFormCreate=new AltaiWindowManager.wmWindowType("contentFormCreate","<altai-content-form-create></altai-content-form-create>",250,960,1600),ContentWindows.contentFormUpdate=new AltaiWindowManager.wmWindowType("contentFormUpdate","<altai-content-form-update content-form-id='vm.window.entityId'></altai-content-form-update>",250,960,1600),ContentWindows.contentFormPreview=new AltaiWindowManager.wmWindowType("contentFormPreview","<altai-content-form-preview content-form-id='vm.window.entityId'></altai-content-form-preview>",250,960,1600),AltaiContent.ContentWindows=ContentWindows}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentForm=function(){function ContentForm(){}return ContentForm}();AltaiContent.ContentForm=ContentForm}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentTypeAttribute=function(){function ContentTypeAttribute(){}return ContentTypeAttribute}();AltaiContent.ContentTypeAttribute=ContentTypeAttribute}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentTypeRelation=function(){function ContentTypeRelation(){this.contentTypeRelationLinks=[]}return ContentTypeRelation}();AltaiContent.ContentTypeRelation=ContentTypeRelation;var ContentTypeRelationLink=function(){function ContentTypeRelationLink(){this.includeByDefault=!0,this.allowCreateLink=!0,this.allowCreateNew=!1}return ContentTypeRelationLink}();AltaiContent.ContentTypeRelationLink=ContentTypeRelationLink}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentTypeSelectOption=function(){function ContentTypeSelectOption(){}return ContentTypeSelectOption}();AltaiContent.ContentTypeSelectOption=ContentTypeSelectOption}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var ContentEvents=function(){function ContentEvents(){}return ContentEvents}();ContentEvents.contentItemCreated="ContentItemCreated",ContentEvents.contentItemUpdated="ContentItemUpdated",AltaiContent.ContentEvents=ContentEvents}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function RemoveHtmlMarkupFilter(){return function(text){return text?String(text).replace(/<[^>]+>/gm,""):""}}AltaiContent.RemoveHtmlMarkupFilter=RemoveHtmlMarkupFilter}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){function crop(){return function(input,limit,respectWordBoundaries,suffix){if(null===input||void 0===input||null===limit||void 0===limit||""===limit)return input;if(angular.isUndefined(respectWordBoundaries)&&(respectWordBoundaries=!0),angular.isUndefined(suffix)&&(suffix="..."),input.length<=limit)return input;limit-=suffix.length;var trimmedString=input.substr(0,limit);return respectWordBoundaries?trimmedString.substr(0,Math.min(trimmedString.length,trimmedString.lastIndexOf(" ")))+suffix:trimmedString+suffix}}AltaiContent.crop=crop}(AltaiContent||(AltaiContent={}));var AltaiContent;!function(AltaiContent){var mod=angular.module("altai.content",["ui.router","ui.bootstrap","ngFileUpload","ngSanitize","datePicker","vcRecaptcha","altai.texteditor","isteven-multi-select","ui.sortable","ngMaterial","angular.filter","daterangepicker","angularMoment","su.datepicker","ngclipboard","720kb.socialshare","AngularPrint"]);mod.component("altaiContentCollectionCreateBuildingBlock",new AltaiContent.AltaiContentCollectionCreateBuildingBlockComponent),mod.component("altaiContentCollection",new AltaiContent.AltaiContentCollectionComponent),mod.component("altaiContentSearchCreateBuildingBlock",new AltaiContent.AltaiContentSearchCreateBuildingBlockComponent),mod.component("altaiContentSearchClientSideCreateBuildingBlock",new AltaiContent.AltaiContentSearchClientSideCreateBuildingBlockComponent),mod.component("altaiContentSearch",new AltaiContent.AltaiContentSearchComponent),mod.component("altaiContentFormCreateBuildingBlock",new AltaiContent.altaiContentFormCreateBuildingBlock),mod.component("altaiFileSelectButton",new AltaiContent.AltaiFileSelectButtonComponent),mod.component("altaiTagSelector",new AltaiContent.AltaiTagSelector),mod.component("altaiMultiSelect",new AltaiContent.AltaiMultiSelect),mod.component("altaiContentItemButtons",new AltaiContent.AltaiContentItemButtonsComponent),mod.component("altaiSearchSelect",new AltaiContent.AltaiSearchSelectComponent),mod.component("altaiContentItemSelect",new AltaiContent.AltaiContentItemSelectComponent),mod.component("altaiContentCollectionUpdateRelation",new AltaiContent.AltaiContentCollectionUpdateRelation),mod.component("altaiContentSelectionCheckbox",new AltaiContent.AltaiContentSelectionCheckboxComponent),mod.component("altaiContentItemBuildingBlockCreate",new AltaiContent.AltaiContentItemBuildingBlockCreateComponent),mod.component("altaiContentItemBuildingBlockUpdate",new AltaiContent.AltaiContentItemBuildingBlockUpdateComponent),mod.component("altaiContentItem",new AltaiContent.AltaiContentItemComponent),mod.component("altaiContentItemInlineSecurity",new AltaiContent.AltaiContentItemInlineSecurityComponent),mod.component("altaiContentItemSearchElastic",new AltaiContent.AltaiContentSearchComponent),mod.component("altaiContentTableHeaderSorter",new AltaiContent.AltaiContentTableHeaderSorterComponent),mod.component("altaiPrintData",new AltaiContent.AltaiPrintDataComponent),mod.component("altaiTreeSelector",new AltaiContent.AltaiTreeSelectorComponent),mod.component("altaiContentCheckbox",new AltaiContent.AltaiContentCheckboxComponent),mod.directive("altaiCompileHtml",AltaiContent.CompileHtmlDirective),mod.directive("altaiLink",AltaiContent.altaiLink),mod.directive("altaiSetTitle",AltaiContent.altaiSetTitle),mod.directive("clickOutsideHide",AltaiContent.clickOutside),mod.directive("altaiTagSelectorValidator",AltaiContent.AltaiTagSelectorValidator),mod.directive("altaiContentRelationUpdate",AltaiContent.AltaiContentRelationUpdateDirective),mod.directive("altaiContentRelationUpdateItem",AltaiContent.AltaiContentRelationUpdateItemDirective),mod.directive("altaiContentAttributeUpdate",AltaiContent.AltaiContentAttributeUpdateDirective),mod.directive("altaiContentAttributeUpdateItem",AltaiContent.AltaiContentAttributeUpdateItemDirective),mod.directive("altaiContentIdField",AltaiContent.AltaiContentIdFieldDirective),mod.directive("getlink",AltaiContent.GetlinkDirective),mod.directive("altaiHidePast",AltaiContent.AltaiHidePastDirective),mod.directive("altaiContentTypeList",AltaiContent.AltaiContentTypeListDirective),mod.directive("altaiContentTypeCreate",AltaiContent.AltaiContentTypeCreateDirective),mod.directive("altaiContentTypeUpdate",AltaiContent.AltaiContentTypeUpdateDirective),mod.directive("altaiContentTypeProfile",AltaiContent.AltaiContentTypeProfileDirective),mod.directive("altaiContentTypeAttributeCreate",AltaiContent.AltaiContentTypeAttributeCreateDirective),mod.directive("altaiContentTypeAttributeUpdate",AltaiContent.AltaiContentTypeAttributeUpdateDirective),mod.directive("altaiContentTypeRelationUpdate",AltaiContent.AltaiContentTypeRelationUpdateDirective),mod.directive("altaiContentTypeRelationCreate",AltaiContent.AltaiContentTypeRelationCreateDirective),mod.directive("altaiContentCollectionList",AltaiContent.AltaiContentCollectionListDirective),mod.directive("altaiContentCollectionCreate",AltaiContent.AltaiContentCollectionCreateDirective),mod.directive("altaiContentCollectionUpdate",AltaiContent.AltaiContentCollectionUpdateDirective),mod.directive("altaiContentCollectionPreview",AltaiContent.AltaiContentCollectionPreviewDirective),mod.directive("altaiExposedContentCollectionList",AltaiContent.AltaiExposedContentCollectionListDirective),mod.directive("altaiExposedContentCollectionCreate",AltaiContent.AltaiExposedContentCollectionCreateDirective),mod.directive("altaiExposedContentCollectionUpdate",AltaiContent.AltaiExposedContentCollectionUpdateDirective),mod.directive("altaiExposedContentCollectionPreview",AltaiContent.AltaiExposedContentCollectionPreviewDirective),mod.component("altaiExposedContentCollectionFilterCreate",new AltaiContent.ExposedContentCollectionFilterCreateComponent),mod.component("altaiExposedContentCollectionFilterUpdate",new AltaiContent.ExposedContentCollectionFilterUpdateComponent),
mod.component("altaiExposedContentCollectionSorterCreate",new AltaiContent.ExposedContentCollectionSorterCreateComponent),mod.component("altaiExposedContentCollectionSorterUpdate",new AltaiContent.ExposedContentCollectionSorterUpdateComponent),mod.component("altaiExposedContentCollectionRangeCreate",new AltaiContent.ExposedContentCollectionRangeCreateComponent),mod.component("altaiExposedContentCollectionRangeUpdate",new AltaiContent.ExposedContentCollectionRangeUpdateComponent),mod.component("altaiExposedContentCollectionAttributeUpdate",new AltaiContent.ExposedContentCollectionAttributeUpdateComponent),mod.component("altaiExposedContentCollectionFilterMltCriteriumCreate",new AltaiContent.ExposedContentCollectionFilterMltCriteriumCreateComponent),mod.directive("altaiContentItemList",AltaiContent.AltaiContentItemListDirective),mod.directive("altaiContentItemListInner",AltaiContent.AltaiContentItemListInnerDirective),mod.directive("altaiContentItemListElastic",AltaiContent.AltaiContentItemListElasticDirective),mod.directive("altaiContentItemCreate",AltaiContent.AltaiContentItemCreateDirective),mod.directive("altaiContentItemCreateParent",AltaiContent.AltaiContentItemCreateParentDirective),mod.directive("altaiContentItemUpdateInner",AltaiContent.AltaiContentItemUpdateInnerDirective),mod.directive("altaiContentItemUpdate",AltaiContent.AltaiContentItemUpdateDirective),mod.directive("altaiContentItemUpdateParent",AltaiContent.AltaiContentItemUpdateParentDirective),mod.directive("altaiContentItemPreview",AltaiContent.AltaiContentItemPreviewDirective),mod.directive("altaiContentItemProfile",AltaiContent.AltaiContentItemProfileDirective),mod.directive("altaiContentItemTable",AltaiContent.AltaiContentItemTableDirective),mod.directive("altaiSelectInput",AltaiContent.AltaiSelectInputDirective),mod.directive("altaiContentForm",AltaiContent.AltaiContentFormDirective),mod.directive("altaiContentFormList",AltaiContent.AltaiContentFormListDirective),mod.directive("altaiContentFormCreate",AltaiContent.AltaiContentFormCreateDirective),mod.directive("altaiContentFormUpdate",AltaiContent.AltaiContentFormUpdateDirective),mod.directive("altaiContentFormPreview",AltaiContent.AltaiContentFormPreviewDirective),mod.service("contentCollectionManager",AltaiContent.ContentCollectionManager),mod.service("exposedContentCollectionManager",AltaiContent.ExposedContentCollectionManager),mod.service("contentCollectionDataService",AltaiContent.ContentCollectionDataService),mod.service("contentAttributeService",AltaiContent.ContentAttributeService),mod.service("contentItemService",AltaiContent.ContentItemService),mod.service("contentItemElasticService",AltaiContent.ContentItemElasticService),mod.service("contentFormManager",AltaiContent.ContentFormManager),mod.service("contentCreateItemProcessor",AltaiContent.ContentCreateItemProcessor),mod.service("contentRelationFactory",AltaiContent.ContentRelationFactory),mod.service("contentAttributeSelectOptionsManager",AltaiContent.ContentAttributeSelectOptionsManager),mod.service("contentTypeService",AltaiContent.ContentTypeService),mod.service("contentFormRowManager",AltaiContent.ContentFormRowManager),mod.provider("contentActionProvider",AltaiContent.ContentActionProvider),mod.service("contentUpdateModelManager",AltaiContent.ContentUpdateModelManager),mod.service("contentItemBbManager",AltaiContent.ContentItemBbManager),mod.service("contentTypeAttributeManager",AltaiContent.ContentTypeAttributeManager),mod.service("exposedContentCollectionFilterManager",AltaiContent.ExposedContentCollectionFilterManager),mod.service("exposedContentCollectionFilterMLTCriteriumManager",AltaiContent.ExposedContentCollectionFilterMLTCriteriumManager),mod.service("exposedContentCollectionSorterManager",AltaiContent.ExposedContentCollectionSorterManager),mod.service("exposedContentCollectionRangeManager",AltaiContent.ExposedContentCollectionRangeManager),mod.service("exposedContentCollectionAttributeManager",AltaiContent.ExposedContentCollectionAttributeManager),mod.service("contentItemSelectionService",AltaiContent.ContentItemSelectionService),mod.filter("removeHtmlMarkupFilter",AltaiContent.RemoveHtmlMarkupFilter),mod.filter("crop",AltaiContent.crop),mod.config(function($stateProvider,buildingBlockTypeProvider,altaiAdminMenuProvider){$stateProvider.state("admin.content",{url:"/content","abstract":!0}).state("admin.content.type",{url:"/type",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentTypeListController}}}).state("admin.content.collection",{url:"/collection",securable:"contentcollection.list",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentCollectionListController}}}).state("admin.content.exposedcollection",{url:"/exposedcollection",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ExposedContentCollectionListController}}}).state("admin.content.form",{url:"/form",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentFormListController}}}).state("admin.content.item",{url:"/item",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentItemListController}}}).state("admin.content.elastic",{url:"/elastic",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentItemSearchElasticController}}}).state("admin.content.item.update",{url:"/:id/update",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentItemUpdateController}}}).state("admin.content.item.preview",{url:"/:id/preview",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentItemPreviewController}}}).state("admin.content.create",{url:"/create",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentCreateController}}}),$stateProvider.state("admin.content.import",{url:"/import",system:!0,views:{"adminContentView@admin":{altaiTemplate:"contentImport",altaiTemplateType:"Admin",controller:"contentImportController"}},resolve:{contentTypesData:function(contentTypeService){return contentTypeService.listContentType()}}}),$stateProvider.state("admin.content.read",{url:"/:id",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiContent.ContentItemProfileController}}}),$stateProvider.state("admin.content.edit",{url:"/:id/edit",system:!0,views:{"adminContentView@admin":{altaiTemplate:"contentUpdate",altaiTemplateType:"Admin",controller:"contentUpdateController"}}}),$stateProvider.state("admin.content.preview",{url:"/:id/preview",system:!0,views:{"adminContentView@admin":{template:'<content content-id="{{$root.$stateParams.id}}"></content>'}}}),altaiAdminMenuProvider.add({name:"content",order:0,label:"content",icon:"mdi mdi-google-circles-communities menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"content",name:"content.types",securable:"contenttype.list",label:"contenttypes",icon:"mdi mdi-google-circles-communities menuicon",state:"admin.content.type"}),altaiAdminMenuProvider.add({parent:"content",name:"content.items",securable:"contentitem.list.hideforall",label:"contentitems",icon:"mdi mdi-google-circles-extended menuicon",state:"admin.content.item"}),altaiAdminMenuProvider.add({parent:"content",name:"content.elastic",securable:"contentitem.search",label:"search",icon:"mdi mdi-google-circles-extended menuicon",state:"admin.content.elastic"}),altaiAdminMenuProvider.add({parent:"content",name:"content.collections",securable:"contentcollection.list",label:"contentcollections",icon:"mdi mdi-format-list-bulleted menuicon",state:"admin.content.collection"}),altaiAdminMenuProvider.add({parent:"content",name:"content.exposedcollections",securable:"contentCollection.read",label:"exposedcontentcollections",icon:"mdi mdi-format-list-bulleted menuicon",state:"admin.content.exposedcollection"}),altaiAdminMenuProvider.add({parent:"content",name:"content.forms",securable:"contentform.list",label:"contentforms",icon:"mdi mdi-content-paste menuicon",state:"admin.content.form"}),altaiAdminMenuProvider.add({parent:"content",name:"content.files",securable:"file.list",label:"files",icon:"mdi mdi-file menuicon",state:"admin.filemanager"}),buildingBlockTypeProvider.add({name:"ContentCollection",label:"Content Collection",directive:"altai-content-collection",icon:"mdi-format-list-bulleted",createComponent:"<altai-content-collection-create-building-block></altai-content-collection-create-building-block>"}),buildingBlockTypeProvider.add({name:"Form",label:"Form",directive:"altai-content-form",icon:"mdi-content-paste",createComponent:"<altai-content-form-create-building-block></altai-content-form-create-building-block>"}),buildingBlockTypeProvider.add({name:"ContentSearch",label:"Content Search",directive:"altai-content-search",icon:"mdi-magnify",createComponent:"<altai-content-search-create-building-block></altai-content-search-create-building-block>"}),buildingBlockTypeProvider.add({name:"ContentItem",label:"Content Item",directive:"altai-content-item",icon:"mdi-content-copy",createComponent:"<altai-content-item-building-block-create></altai-content-item-building-block-create>",updateComponent:"<altai-content-item-building-block-update></altai-content-item-building-block-update>"})}),mod.run(function(Upload,altaiFileManager,altaiNotificationFactory,authService){var selectedFile;CKEDITOR.dialog.add("altaiUploadDialog",function(editor){return{title:"Upload file",minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Basic Settings",elements:[{type:"file",id:"file",label:"file",onChange:function(){selectedFile=$(this.getInputElement()).first()[0],selectedFile=selectedFile.$.files[0]}}]}],onOk:function(){var dialog=this;dialog.getValueOf("tab-basic","file");$.ajaxSetup({processData:!1,contentType:!1});var data=new FormData;data.append("file",selectedFile),authService.getValidAccessToken().then(function(accessToken){$.ajax({type:"POST",url:"/api/upload",data:data,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+accessToken)}}).then(function(resultFileName){"UNSUPPORTED_FILE_EXTENSION"==resultFileName?altaiNotificationFactory.error("Unsupported file extension"):altaiFileManager.add({name:resultFileName,size:selectedFile.size,fileType:selectedFile.type}).then(function(result){var selection=editor.getSelection(),text=selection.getSelectedText();editor.insertHtml("<a href='https://static.comeos.be/Uploads/"+result.name+"' target='_blank'>"+text+"</a>")})})})}}}),CKEDITOR.plugins.add("altaiUpload",{init:function(editor){editor.addCommand("altaiUploadFile",new CKEDITOR.dialogCommand("altaiUploadDialog")),editor.ui.addButton("AltaiUpload",{label:"Insert altai file",command:"altaiUploadFile",toolbar:"insert",icon:"copy"}),editor.addCommand("altaiUploadImage",new CKEDITOR.dialogCommand("altaiUploadImageDialog")),editor.ui.addButton("AltaiUploadImage",{label:"Insert altai image",command:"altaiUploadImage",toolbar:"insert",icon:"image"})}}),CKEDITOR.dialog.add("altaiUploadImageDialog",function(editor){return{title:"Upload image",minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Basic Settings",elements:[{type:"file",id:"file",label:"file",onChange:function(){selectedFile=$(this.getInputElement()).first()[0],selectedFile=selectedFile.$.files[0]}}]}],onOk:function(){var dialog=this;dialog.getValueOf("tab-basic","file");$.ajaxSetup({processData:!1,contentType:!1});var data=new FormData;data.append("file",selectedFile),authService.getValidAccessToken().then(function(accessToken){$.ajax({type:"POST",url:"/api/upload",data:data,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+accessToken)}}).then(function(resultFileName){"UNSUPPORTED_FILE_EXTENSION"==resultFileName?altaiNotificationFactory.error("Unsupported file extension"):altaiFileManager.add({name:resultFileName,size:selectedFile.size,fileType:selectedFile.type}).then(function(result){editor.insertHtml("<img src='https://static.comeos.be/Uploads/"+result.name+"'>")})},function(response){altaiNotificationFactory.error("Uploading of attachment failed!")})})}}})})}(AltaiContent||(AltaiContent={})),config.modules.push("altai.content"),angular.module("altai.content").directive("altaiContentFormSelect",function(){var template="<div><input type='radio' value='test1'></div>";return{replace:!0,template:template}}),angular.module("altai.content").directive("altaiDatePicker",function(){return{scope:{model:"=altaiDatePicker",attr:"="},controllerAs:"vm",bindToController:!0,template:'<input date-time class=\'altai-date-input\' format="DD-MM-YYYY" ng-model="vm.model" ng-change="vm.toggle()" min-view=\'date\'>',controller:function(){this.model||(this.model=new Date,this.validDate=angular.isDate(this.model));var vm=this;this.toggle=function(){if(vm.validDate=angular.isDate(vm.model),!vm.validDate){var newDate=new Date(vm.model);"Invalid Date"==newDate?vm.validDate=!1:vm.validDate=!0}}}}}),angular.module("altai.content").directive("altaiFiledisplay",function(){return{restrict:"E",scope:{file:"="},template:"<i class='fa' ng-class='icon'></i>&nbsp;<a href='{{$root.staticFileBase}}/{{file}}' target='_blank'>{{fileDisplay}}</a>",controller:function($scope){var array=$scope.file.split("."),fileExt=array.pop();"pptx"!=fileExt&&"ppt"!=fileExt||($scope.icon="fa-file-powerpoint-o"),"pdf"==fileExt&&($scope.icon="fa-file-pdf-o"),"doc"==fileExt&&($scope.icon="fa-word-o"),"xls"==fileExt&&($scope.icon="fa-excel-o");var fileDisplay=$scope.file.split("_");fileDisplay.shift(),$scope.fileDisplay=fileDisplay.join("_")}}}),angular.module("altai.content").directive("contentCollectionRelation",function(){return{scope:{contentCollectionId:"=",relationArray:"="},controller:function($scope){$scope.relationArray||($scope.relationArray=[]),$scope.toggleItem=function(item){var exElm=$scope.relationArray.filter(function(elm){return elm.id===item.id})[0],index=$scope.relationArray.indexOf(exElm);index>-1?$scope.relationArray.splice(index,1):$scope.relationArray.push(item)}},template:'<div contentcollection content-collection-id="{{contentCollectionId}}"></div>'}}),angular.module("altai.content").directive("content",function($http,$compile){return{scope:{contentId:"@contentId"},restrict:"E",transclude:!0,template:"Content item",link:function($scope,$element){$http.get(config.backendUrl+"/api/contentData/"+$scope.contentId).success(function(result){$scope.item=result,$http.get(config.backendUrl+"/api/template/"+result.templateId).then(function(result){$element.html(result.data).show(),$compile($element.contents())($scope)})})}}});var AltaiContent;!function(AltaiContent){function AltaiContentCreateItemDirective(){return{scope:{contentTypeId:"=",contentItem:"=",languages:"=",originLink:"="},templateUrl:"/api/template/Admin/AltaiContentCreateItem",bindToController:!0,controllerAs:"vm",controller:AltaiContentCreateItemDirectiveController}}AltaiContent.AltaiContentCreateItemDirective=AltaiContentCreateItemDirective;var AltaiContentCreateItemDirectiveController=function(){function AltaiContentCreateItemDirectiveController(contentTypeService){var vm=this;this.contentTypeService=contentTypeService,this.contentTypeService.getById(this.contentTypeId).then(function(contentType){vm.contentType=contentType,vm.contentItem.contentTypeId=vm.contentTypeId,vm.contentItem.contentType=contentType})}return AltaiContentCreateItemDirectiveController}();angular.module("altai.content").directive("altaiContentCreateItem",AltaiContentCreateItemDirective)}(AltaiContent||(AltaiContent={})),angular.module("altai.content").directive("contentSelect",function(contentItemService){return{scope:{contentSelect:"@contentSelect",contentSelectModel:"=contentSelectModel",multipleInput:"@contentSelectMultiple"},template:"<div class=\"content-select\"><select data-ng-options='c as c.name for c in contentRows track by c.id' data-ng-model='internalModel'></select><button class='btn btn-success' ng-show='multiple' ng-click=\"addItem()\"><i class='fa fa-plus'></i></button></div>",replace:!0,controller:["$scope",function($scope){"False"==$scope.multipleInput?$scope.multiple=!1:$scope.multiple=!0,$scope.contentSelectModel||($scope.contentSelectModel=[]),contentItemService.listContentByType($scope.contentSelect).then(function(result){$scope.contentRows=result}),$scope.addItem=function(){-1==$scope.contentSelectModel.indexOf($scope.internalModel)&&$scope.contentSelectModel.push({id:$scope.internalModel.id,name:""})},$scope.removeItem=function($index){$scope.contentSelectModel.splice($index,1)},$scope.multiple||($scope.$watch("internalModel",function(){$scope.internalModel&&($scope.contentSelectModel={id:$scope.internalModel.id,name:""})}),$scope.$on("contentSelectChanged",function(event,content){content.contentTypeId==$scope.contentSelect&&contentItemService.listContentByType($scope.contentSelect).then(function(result){$scope.contentRows=result,$scope.contentRows&&($scope.internalModel=$scope.contentRows.filter(function(elm){return elm.id=content.id})[0])})}))}]}}),angular.module("altai.content").directive("locationDisplay",["$sce",function($sce){return{scope:{value:"=locationDisplay"},template:"<iframe frameborder='0' style='border:0'></iframe>",replace:!0,link:function(scope,element,attrs){element.attr("src","https://www.google.com/maps/embed/v1/place?key=AIzaSyAsX-2eEGA-rXT0xj7damJ5tmi9ZK3r3vM&q="+scope.value)}}}]),angular.module("altai.content").directive("locationInput",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){}}}),angular.module("altai.content").directive("contentMap",function($timeout){return{template:"<div class='altai-map' style='height:300px;' id='map-canvas'></div>",scope:{lat:"=",lng:"=",markerTitle:"@"},link:function($scope,$element){$scope.$watch("lat",function(){if($scope.lat){$scope.lat||($scope.lat=51.14113),$scope.lng||($scope.lng=4.43901),$scope.lat=parseFloat($scope.lat),$scope.lng=parseFloat($scope.lng);var mapOptions={center:{lat:$scope.lat,lng:$scope.lng},zoom:14},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);new google.maps.Marker({position:{lat:$scope.lat,lng:$scope.lng},map:map,title:$scope.markerTitle})}})}}});var AltaiWorkflow;!function(AltaiWorkflow){function WorkflowTriggerListController($scope,wmContainerFactory){wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.triggerList,"Triggers","")}AltaiWorkflow.WorkflowTriggerListController=WorkflowTriggerListController}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AltaiWorkflowTriggerViewDirective(){return{scope:{triggerId:"="},templateUrl:"/api/template/Admin/Workflow:AltaiWorkflowTriggerView",controller:AltaiWorkflowTriggerViewDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiWorkflow.AltaiWorkflowTriggerViewDirective=AltaiWorkflowTriggerViewDirective;var AltaiWorkflowTriggerViewDirectiveController=function(){function AltaiWorkflowTriggerViewDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory,altaiConfirmationService){this.$rootScope=$rootScope;var ctrl=this;ctrl.triggerId=$scope.vm.triggerId,this.workflowTriggerManager=workflowTriggerManager,ctrl.rootscope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$on("workflowConditionCreated",function(){ctrl.getConditionData()}),$scope.$on("workflowConditionUpdated",function(){ctrl.getConditionData()}),$scope.$on("workflowTaskCreated",function(){ctrl.getTaskData()}),$scope.$on("workflowTaskUpdated",function(){ctrl.getTaskData()})}return AltaiWorkflowTriggerViewDirectiveController.prototype.init=function(){var s=this;s.getConditionData(),s.getTaskData()},AltaiWorkflowTriggerViewDirectiveController.prototype.getConditionData=function(){var s=this;this.workflowTriggerManager.getActiveConditionsByTriggerId(s.triggerId).then(function(conditions){s.conditions=conditions})},AltaiWorkflowTriggerViewDirectiveController.prototype.getTaskData=function(){var s=this;this.workflowTriggerManager.getActiveTasksByTriggerId(s.triggerId).then(function(tasks){s.tasks=tasks})},AltaiWorkflowTriggerViewDirectiveController.prototype.deleteConditions=function(condition){var s=this;s.altaiConfirmationService.confirm().then(function(){s.workflowTriggerManager.deleteCondition(condition).then(function(){s.getConditionData(),s.$rootScope.$broadcast("workflowConditionDeleted")})})},AltaiWorkflowTriggerViewDirectiveController.prototype.deleteTasks=function(task){var s=this;s.altaiConfirmationService.confirm().then(function(){s.workflowTriggerManager.deleteTask(task).then(function(){s.getTaskData(),s.$rootScope.$broadcast("workflowTaskDeleted")})})},AltaiWorkflowTriggerViewDirectiveController.prototype.createCondition=function(){var s=this;this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.addCondition,"Add Condition",s.triggerId)},AltaiWorkflowTriggerViewDirectiveController.prototype.editCondition=function(condition){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.updateCondition,condition.name,condition.id,condition)},AltaiWorkflowTriggerViewDirectiveController.prototype.createTask=function(){var s=this;this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.addTask,"Add Task",s.triggerId)},AltaiWorkflowTriggerViewDirectiveController.prototype.editTask=function(task){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.updateTask,task.taskName,task.id,task)},AltaiWorkflowTriggerViewDirectiveController.prototype.viewTask=function(task){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.taskView,task.taskName,task.id)},AltaiWorkflowTriggerViewDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AddAltaiWorkflowTriggerDirective(){return{templateUrl:"/api/template/Admin/Workflow:AddAltaiWorkflowTrigger",controllerAs:"vm",controller:AddAltaiWorkflowTriggerDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createTrigger(scope.newTrigger)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.triggerCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.AddAltaiWorkflowTriggerDirective=AddAltaiWorkflowTriggerDirective;var AddAltaiWorkflowTriggerDirectiveController=function(){function AddAltaiWorkflowTriggerDirectiveController($rootScope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope}return AddAltaiWorkflowTriggerDirectiveController.prototype.createTrigger=function(newTrigger){var s=this;newTrigger.Id=0,this.workflowTriggerManager.add(newTrigger).then(function(result){s.$rootScope.$broadcast("triggerCreated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTrigger);s.wmContainerFactory.destroyWindow(createWin.id)})},AddAltaiWorkflowTriggerDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTrigger);s.wmContainerFactory.destroyWindow(currentWin.id)},AddAltaiWorkflowTriggerDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function UpdateAltaiWorkflowTriggerDirective(){return{scope:{trigger:"="},templateUrl:"/api/template/Admin/Workflow:UpdateAltaiWorkflowTrigger",controllerAs:"vm",controller:UpdateAltaiWorkflowTriggerDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.editTrigger(scope.oldTrigger)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.triggerUpdateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.UpdateAltaiWorkflowTriggerDirective=UpdateAltaiWorkflowTriggerDirective;var UpdateAltaiWorkflowTriggerDirectiveController=function(){function UpdateAltaiWorkflowTriggerDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.oldTrigger=$scope.trigger,this.workflowTriggerManager.getById($scope.trigger.id).then(function(result){ctrl.oldTrigger=result})}return UpdateAltaiWorkflowTriggerDirectiveController.prototype.editTrigger=function(){var s=this;this.workflowTriggerManager.update(s.oldTrigger).then(function(result){s.$rootScope.$broadcast("triggerUpdated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTrigger);s.wmContainerFactory.destroyWindow(createWin.id)})},UpdateAltaiWorkflowTriggerDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTrigger);s.wmContainerFactory.destroyWindow(currentWin.id)},UpdateAltaiWorkflowTriggerDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AddAltaiWorkFlowConditionDirective(){return{scope:{triggerId:"="},templateUrl:"/api/template/Admin/Workflow:AddAltaiWorkflowCondition",controllerAs:"vm",controller:AddAltaiWorkFlowConditionDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createCondition(scope.newCondition)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.conditionCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.AddAltaiWorkFlowConditionDirective=AddAltaiWorkFlowConditionDirective;var AddAltaiWorkFlowConditionDirectiveController=function(){function AddAltaiWorkFlowConditionDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.triggerId=$scope.triggerId}return AddAltaiWorkFlowConditionDirectiveController.prototype.createCondition=function(newCondition){var s=this;newCondition.WorkFlowTriggerId=s.triggerId,this.workflowTriggerManager.addCondition(newCondition).then(function(result){s.$rootScope.$broadcast("workflowConditionCreated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addCondition);s.wmContainerFactory.destroyWindow(createWin.id)})},AddAltaiWorkFlowConditionDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addCondition);s.wmContainerFactory.destroyWindow(currentWin.id)},AddAltaiWorkFlowConditionDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AddAltaiWorkFlowTaskDirective(){return{scope:{triggerId:"="},templateUrl:"/api/template/Admin/Workflow:AddAltaiWorkflowTask",controllerAs:"vm",controller:AddAltaiWorkFlowTaskDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createTask(scope.newTask)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.taskCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.AddAltaiWorkFlowTaskDirective=AddAltaiWorkFlowTaskDirective;var AddAltaiWorkFlowTaskDirectiveController=function(){function AddAltaiWorkFlowTaskDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.triggerId=$scope.triggerId}return AddAltaiWorkFlowTaskDirectiveController.prototype.createTask=function(newTask){var s=this;newTask.WorkFlowTriggerId=s.triggerId,this.workflowTriggerManager.addTask(newTask).then(function(result){s.$rootScope.$broadcast("workflowTaskCreated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTask);s.wmContainerFactory.destroyWindow(createWin.id)})},AddAltaiWorkFlowTaskDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTask);s.wmContainerFactory.destroyWindow(currentWin.id)},AddAltaiWorkFlowTaskDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AltaiWorkflowTaskViewDirective(){return{scope:{taskId:"="},templateUrl:"/api/template/Admin/Workflow:AltaiWorkflowTaskView",controller:AltaiWorkflowTaskViewDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiWorkflow.AltaiWorkflowTaskViewDirective=AltaiWorkflowTaskViewDirective;var AltaiWorkflowTaskViewDirectiveController=function(){function AltaiWorkflowTaskViewDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory,altaiConfirmationService){this.$rootScope=$rootScope;var ctrl=this;ctrl.taskId=$scope.vm.taskId,this.workflowTriggerManager=workflowTriggerManager,ctrl.rootscope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$on("workflowTaskArgCreated",function(){ctrl.getTaskArgData()}),$scope.$on("workflowTaskArgUpdated",function(){ctrl.getTaskArgData()})}return AltaiWorkflowTaskViewDirectiveController.prototype.init=function(){var s=this;s.getTaskArgData()},AltaiWorkflowTaskViewDirectiveController.prototype.getTaskArgData=function(){var s=this;this.workflowTriggerManager.getTaskArgsByTaskId(s.taskId).then(function(taskArgs){s.taskArgs=taskArgs})},AltaiWorkflowTaskViewDirectiveController.prototype.deleteTaskArgs=function(taskArg){var s=this;s.altaiConfirmationService.confirm().then(function(){s.workflowTriggerManager.deleteTaskArg(taskArg).then(function(){s.getTaskArgData(),s.$rootScope.$broadcast("workflowTaskArgDeleted")})})},AltaiWorkflowTaskViewDirectiveController.prototype.createTaskArg=function(){var s=this;this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.addTaskArg,"Add Task arg",s.taskId)},AltaiWorkflowTaskViewDirectiveController.prototype.editTaskArg=function(taskArg){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.updateTaskArg,taskArg.key,taskArg.id,taskArg)},AltaiWorkflowTaskViewDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function UpdateAltaiWorkflowConditionDirective(){return{scope:{condition:"="},templateUrl:"/api/template/Admin/Workflow:UpdateAltaiWorkflowCondition",controllerAs:"vm",controller:UpdateAltaiWorkflowConditionDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.editCondition(scope.oldCondition)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.conditionUpdateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.UpdateAltaiWorkflowConditionDirective=UpdateAltaiWorkflowConditionDirective;
var UpdateAltaiWorkflowConditionDirectiveController=function(){function UpdateAltaiWorkflowConditionDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.oldCondition=$scope.condition,this.workflowTriggerManager.getConditionById($scope.condition.id).then(function(result){ctrl.oldCondition=result})}return UpdateAltaiWorkflowConditionDirectiveController.prototype.editCondition=function(){var s=this;this.workflowTriggerManager.updateCondition(s.oldCondition).then(function(result){s.$rootScope.$broadcast("workflowConditionUpdated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateCondition);s.wmContainerFactory.destroyWindow(createWin.id)})},UpdateAltaiWorkflowConditionDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateCondition);s.wmContainerFactory.destroyWindow(currentWin.id)},UpdateAltaiWorkflowConditionDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function AddAltaiWorkFlowTaskArgDirective(){return{scope:{taskId:"="},templateUrl:"/api/template/Admin/Workflow:AddAltaiWorkflowTaskArg",controllerAs:"vm",controller:AddAltaiWorkFlowTaskArgDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createTaskArg(scope.newTaskArg)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.taskArgCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.AddAltaiWorkFlowTaskArgDirective=AddAltaiWorkFlowTaskArgDirective;var AddAltaiWorkFlowTaskArgDirectiveController=function(){function AddAltaiWorkFlowTaskArgDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.taskId=$scope.taskId}return AddAltaiWorkFlowTaskArgDirectiveController.prototype.createTaskArg=function(newTaskArg){var s=this;newTaskArg.WorkFlowTaskId=s.taskId,this.workflowTriggerManager.addTaskArg(newTaskArg).then(function(result){s.$rootScope.$broadcast("workflowTaskArgCreated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTaskArg);s.wmContainerFactory.destroyWindow(createWin.id)})},AddAltaiWorkFlowTaskArgDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.addTaskArg);s.wmContainerFactory.destroyWindow(currentWin.id)},AddAltaiWorkFlowTaskArgDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function UpdateAltaiWorkflowTaskDirective(){return{scope:{task:"="},templateUrl:"/api/template/Admin/Workflow:UpdateAltaiWorkflowTask",controllerAs:"vm",controller:UpdateAltaiWorkflowTaskDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.editTask(scope.oldTask)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.taskUpdateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.UpdateAltaiWorkflowTaskDirective=UpdateAltaiWorkflowTaskDirective;var UpdateAltaiWorkflowTaskDirectiveController=function(){function UpdateAltaiWorkflowTaskDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.oldTask=$scope.task,this.workflowTriggerManager.getTaskById($scope.task.id).then(function(result){ctrl.oldTask=result})}return UpdateAltaiWorkflowTaskDirectiveController.prototype.editTask=function(){var s=this;this.workflowTriggerManager.updateTask(s.oldTask).then(function(result){s.$rootScope.$broadcast("workflowTaskUpdated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTask);s.wmContainerFactory.destroyWindow(createWin.id)})},UpdateAltaiWorkflowTaskDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTask);s.wmContainerFactory.destroyWindow(currentWin.id)},UpdateAltaiWorkflowTaskDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){function UpdateAltaiWorkflowTaskArgDirective(){return{scope:{taskarg:"="},templateUrl:"/api/template/Admin/Workflow:UpdateAltaiWorkflowTaskArg",controllerAs:"vm",controller:UpdateAltaiWorkflowTaskArgDirectiveController,link:function(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.editTaskArg(scope.oldTaskArg)},"class":"altai-button-go",name:"save",disableByFormValidity:scope.taskArgUpdateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}}}AltaiWorkflow.UpdateAltaiWorkflowTaskArgDirective=UpdateAltaiWorkflowTaskArgDirective;var UpdateAltaiWorkflowTaskArgDirectiveController=function(){function UpdateAltaiWorkflowTaskArgDirectiveController($rootScope,$scope,workflowTriggerManager,wmContainerFactory){this.$rootScope=$rootScope,this.$scope=$scope,this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.rootscope=$rootScope,ctrl.oldTaskArg=$scope.taskarg,this.workflowTriggerManager.getTaskArgById($scope.taskarg.id).then(function(result){ctrl.oldTaskArg=result})}return UpdateAltaiWorkflowTaskArgDirectiveController.prototype.editTaskArg=function(){var s=this;this.workflowTriggerManager.updateTaskArg(s.oldTaskArg).then(function(result){s.$rootScope.$broadcast("workflowTaskArgUpdated");var createWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTaskArg);s.wmContainerFactory.destroyWindow(createWin.id)})},UpdateAltaiWorkflowTaskArgDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiWorkflow.WorkflowWindows.updateTaskArg);s.wmContainerFactory.destroyWindow(currentWin.id)},UpdateAltaiWorkflowTaskArgDirectiveController}()}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var AltaiWorkflowTriggerListComponent=function(){function AltaiWorkflowTriggerListComponent(){this.templateUrl="/api/template/Admin/Workflow:AltaiWorkflowTriggerList",this.controller=AltaiWorkflowTriggerListComponentController}return AltaiWorkflowTriggerListComponent}();AltaiWorkflow.AltaiWorkflowTriggerListComponent=AltaiWorkflowTriggerListComponent;var AltaiWorkflowTriggerListComponentController=function(){function AltaiWorkflowTriggerListComponentController($scope,workflowTriggerManager,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;var ctrl=this;this.workflowTriggerManager=workflowTriggerManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$watch("$ctrl.searchModel",function(newVal,oldVal){newVal&&oldVal&&ctrl.searchModelHasChanged(newVal,oldVal)&&ctrl.getData()},!0),$scope.$on("triggerCreated",function(){ctrl.getData()}),$scope.$on("triggerUpdated",function(){ctrl.getData()})}return AltaiWorkflowTriggerListComponentController.prototype.searchModelHasChanged=function(newVal,oldVal){return newVal.pageNr!=oldVal.pageNr||newVal.sorterAttr!=oldVal.sorterAttr||newVal.sorterDesc!=oldVal.sorterDesc||newVal.name!=oldVal.name},AltaiWorkflowTriggerListComponentController.prototype.init=function(){var s=this;s.searchModel=new AltaiWorkflow.TriggerSearchModel,s.getData()},AltaiWorkflowTriggerListComponentController.prototype.getData=function(){var s=this;this.workflowTriggerManager.listAdvanced(this.searchModel).then(function(triggers){s.triggers=triggers})},AltaiWorkflowTriggerListComponentController.prototype.setSorting=function(sortAttr){this.searchModel.pageNr=0,this.searchModel.sorterAttr==sortAttr?this.searchModel.sorterDesc=!this.searchModel.sorterDesc:this.searchModel.sorterDesc=!1,this.searchModel.sorterAttr=sortAttr,this.getData()},AltaiWorkflowTriggerListComponentController.prototype.getSearchResults=function(){var s=this;this.workflowTriggerManager.listAdvanced(this.searchModel).then(function(triggers){s.triggers=triggers})},AltaiWorkflowTriggerListComponentController.prototype.deleteTriggers=function(trigger){var s=this;s.altaiConfirmationService.confirm().then(function(){s.workflowTriggerManager["delete"](trigger).then(function(){s.getData()})})},AltaiWorkflowTriggerListComponentController.prototype.createTrigger=function(){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.addTrigger,"Add Trigger")},AltaiWorkflowTriggerListComponentController.prototype.updateTrigger=function(trigger){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.updateTrigger,trigger.name,trigger.id,trigger)},AltaiWorkflowTriggerListComponentController.prototype.viewTrigger=function(trigger){this.wmContainerFactory.createWindow(AltaiWorkflow.WorkflowWindows.triggerView,trigger.name,trigger.id)},AltaiWorkflowTriggerListComponentController.prototype.openPage=function(pageIndex){this.searchModel.pageNr=pageIndex},AltaiWorkflowTriggerListComponentController}()}(AltaiWorkflow||(AltaiWorkflow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiWorkflow;!function(AltaiWorkflow){var WorkflowTriggerManager=function(_super){function WorkflowTriggerManager($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/workflowtrigger","WorkflowTrigger",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.workflowTriggerDataList=[],_this.workflowConditionDataList=[],_this.workflowTaskDataList=[],_this.workflowTaskArgDataList=[],_this}return __extends(WorkflowTriggerManager,_super),WorkflowTriggerManager.prototype.listAdvanced=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/workflowtrigger/list/",searchModel).then(function(result){s.workflowTriggerDataList=angular.copy(result.data),d.resolve(s.workflowTriggerDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the triggers!")}),d.promise},WorkflowTriggerManager.prototype.getActiveConditionsByTriggerId=function(triggerId){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/workflowcondition/active/"+triggerId).then(function(result){s.workflowConditionDataList=angular.copy(result.data),d.resolve(s.workflowConditionDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the conditions!")}),d.promise},WorkflowTriggerManager.prototype.getActiveTasksByTriggerId=function(triggerId){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/workflowtask/withargs/"+triggerId).then(function(result){s.workflowTaskDataList=angular.copy(result.data),d.resolve(s.workflowTaskDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the tasks!")}),d.promise},WorkflowTriggerManager.prototype.deleteCondition=function(condition){var d=this.$q.defer(),service=this,requestUrl="api/workflowcondition/"+condition.id;return this.$http["delete"](requestUrl).success(function(result){service.success("Succesfully deleted "+condition.key),service.workflowConditionDataList.splice(service.workflowConditionDataList.indexOf(condition),1),d.resolve(result)}).error(function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not DELETE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.deleteTask=function(task){var d=this.$q.defer(),service=this,requestUrl="api/workflowtask/"+task.id;return this.$http["delete"](requestUrl).success(function(result){service.success("Succesfully deleted "+task.taskName),service.workflowTaskDataList.splice(service.workflowTaskDataList.indexOf(task),1),d.resolve(result)}).error(function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not DELETE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.addCondition=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post("api/workflowcondition/add",newItem).success(function(result){service.success("Succesfully created new "+newItem.Key),service.workflowConditionDataList.push(result),d.resolve(result)}).error(function(result,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not POST api/workflowcondition/"),d.reject()}),d.promise},WorkflowTriggerManager.prototype.addTask=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post("api/workflowtask/add",newItem).success(function(result){service.success("Succesfully created new "+newItem.TaskName),service.workflowTaskDataList.push(result),d.resolve(result)}).error(function(result,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not POST api/workflowtask/"),d.reject()}),d.promise},WorkflowTriggerManager.prototype.getConditionById=function(id,enableCache){void 0===enableCache&&(enableCache=!0);var d=this.$q.defer(),service=this,requestUrl="api/workflowcondition/"+id;return this.altaiHttp.get(requestUrl).then(function(result){d.resolve(result)},function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not GET "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.getTaskById=function(id,enableCache){void 0===enableCache&&(enableCache=!0);var d=this.$q.defer(),service=this,requestUrl="api/workflowtask/"+id;return this.altaiHttp.get(requestUrl).then(function(result){d.resolve(result)},function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not GET "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.updateCondition=function(item){var d=this.$q.defer(),service=this,requestUrl="api/workflowcondition/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.workflowConditionDataList.splice(service.workflowConditionDataList.indexOf(service.workflowConditionDataList.filter(function(cacheItem){return cacheItem.id==item.id})[0]),1),service.dataList=[],service.success("Succesfully updated Condition"),d.resolve()}).error(function(errorMessage,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.updateTask=function(item){var d=this.$q.defer(),service=this,requestUrl="api/workflowtask/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.workflowTaskDataList.splice(service.workflowTaskDataList.indexOf(service.workflowTaskDataList.filter(function(cacheItem){return cacheItem.id==item.id})[0]),1),service.dataList=[],service.success("Succesfully updated Task"),d.resolve()}).error(function(errorMessage,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.getTaskArgsByTaskId=function(taskId){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/workflowtaskArg/list/"+taskId).then(function(result){s.workflowTaskArgDataList=angular.copy(result.data),d.resolve(s.workflowTaskArgDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the task args!")}),d.promise},WorkflowTriggerManager.prototype.getTaskArgById=function(id,enableCache){void 0===enableCache&&(enableCache=!0);var d=this.$q.defer(),service=this,requestUrl="api/workflowtaskArg/"+id;return this.altaiHttp.get(requestUrl).then(function(result){d.resolve(result)},function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not GET "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.addTaskArg=function(newItem){var d=this.$q.defer(),service=this;return this.$http.post("api/workflowtaskArg/add",newItem).success(function(result){service.success("Succesfully created new task arg"),service.workflowTaskArgDataList.push(result),d.resolve(result)}).error(function(result,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not POST api/workflowtaskArg"),d.reject()}),d.promise},WorkflowTriggerManager.prototype.updateTaskArg=function(item){var d=this.$q.defer(),service=this,requestUrl="api/workflowtaskArg/"+item.id;return this.$http.put(requestUrl,item).success(function(result){service.workflowTaskArgDataList.splice(service.workflowTaskArgDataList.indexOf(service.workflowTaskArgDataList.filter(function(cacheItem){return cacheItem.id==item.id})[0]),1),service.dataList=[],service.success("Succesfully updated Task arg"),d.resolve()}).error(function(errorMessage,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not UPDATE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager.prototype.deleteTaskArg=function(taskArg){var d=this.$q.defer(),service=this,requestUrl="api/workflowtaskArg/"+taskArg.id;return this.$http["delete"](requestUrl).success(function(result){service.success("Succesfully deleted "+taskArg.key),service.workflowTaskArgDataList.splice(service.workflowTaskDataList.indexOf(taskArg),1),d.resolve(result)}).error(function(error,status){401==status?service.error("You are not authorized to perform this action."):service.error("Could not DELETE "+requestUrl),d.reject()}),d.promise},WorkflowTriggerManager}(AltaiCore.AltaiDataService);AltaiWorkflow.WorkflowTriggerManager=WorkflowTriggerManager}(AltaiWorkflow||(AltaiWorkflow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiWorkflow;!function(AltaiWorkflow){var ConditionService=function(_super){function ConditionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/workflowcondition","WorkflowCondition",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ConditionService,_super),ConditionService}(AltaiCore.AltaiDataService);AltaiWorkflow.ConditionService=ConditionService}(AltaiWorkflow||(AltaiWorkflow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiWorkflow;!function(AltaiWorkflow){var WorkflowConditionService=function(_super){function WorkflowConditionService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/workflowcondition","WorkflowCondition",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.workflowConditionDataList=[],_this}return __extends(WorkflowConditionService,_super),WorkflowConditionService.prototype.getActiveConditionsByTriggerId=function(triggerId){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/workflowcondition/active/"+triggerId).then(function(result){s.workflowConditionDataList=angular.copy(result.data),d.resolve(s.workflowConditionDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the conditions!")}),d.promise},WorkflowConditionService}(AltaiCore.AltaiDataService);AltaiWorkflow.WorkflowConditionService=WorkflowConditionService}(AltaiWorkflow||(AltaiWorkflow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiWorkflow;!function(AltaiWorkflow){var WorkflowTaskService=function(_super){function WorkflowTaskService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/workflowtask","workflowtask",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.workflowTaskDataList=[],_this}return __extends(WorkflowTaskService,_super),WorkflowTaskService.prototype.getActiveTasksByTriggerId=function(triggerId){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/workflowtask/withargs/"+triggerId).then(function(result){s.workflowTaskDataList=angular.copy(result.data),d.resolve(s.workflowTaskDataList)},function(error){d.reject(error),s.notificationFactory.error("Could not load the tasks!")}),d.promise},WorkflowTaskService}(AltaiCore.AltaiDataService);AltaiWorkflow.WorkflowTaskService=WorkflowTaskService}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var WorkflowWindows=function(){function WorkflowWindows(){}return WorkflowWindows}();WorkflowWindows.triggerList=new AltaiWindowManager.wmWindowType("triggerList","<altai-workflow-trigger-list></altai-workflow-trigger-list>",500,1100,1600),WorkflowWindows.triggerView=new AltaiWindowManager.wmWindowType("triggerView","<altai-workflow-trigger-view trigger-id='vm.window.entityId'></altai-workflow-trigger-view>",250,960,1600),WorkflowWindows.taskView=new AltaiWindowManager.wmWindowType("taskView","<altai-workflow-task-view task-id='vm.window.entityId'></altai-workflow-task-view>",250,960,1600),WorkflowWindows.addTrigger=new AltaiWindowManager.wmWindowType("addTrigger","<add-altai-workflow-trigger></add-altai-workflow-trigger>",250,960,1600),WorkflowWindows.addCondition=new AltaiWindowManager.wmWindowType("addCondition","<altai-workflow-add-condition trigger-id='vm.window.entityId'></altai-workflow-add-condition>",250,960,1600),WorkflowWindows.updateCondition=new AltaiWindowManager.wmWindowType("updateCondition","<altai-workflow-condition-update condition='vm.window.entityProperties'></altai-workflow-condition-update>",250,960,1600),WorkflowWindows.addTask=new AltaiWindowManager.wmWindowType("addTask","<altai-workflow-add-task trigger-id='vm.window.entityId'></altai-workflow-add-task>",250,960,1600),WorkflowWindows.updateTask=new AltaiWindowManager.wmWindowType("updateTask","<altai-workflow-task-update task='vm.window.entityProperties'></altai-workflow-task-update>",250,960,1600),WorkflowWindows.updateTrigger=new AltaiWindowManager.wmWindowType("updateTrigger","<update-altai-workflow-trigger trigger='vm.window.entityProperties'></update-altai-workflow-trigger>",250,960,1600),WorkflowWindows.addTaskArg=new AltaiWindowManager.wmWindowType("addTaskArg","<altai-workflow-add-taskarg task-id='vm.window.entityId'></altai-workflow-add-taskarg>",250,960,1600),WorkflowWindows.updateTaskArg=new AltaiWindowManager.wmWindowType("updateTaskarg","<altai-workflow-taskarg-update taskarg='vm.window.entityProperties'></altai-workflow-taskarg-update>",250,960,1600),AltaiWorkflow.WorkflowWindows=WorkflowWindows,config.windows.push(WorkflowWindows.triggerList),config.windows.push(WorkflowWindows.triggerView),config.windows.push(WorkflowWindows.addCondition),config.windows.push(WorkflowWindows.updateCondition),config.windows.push(WorkflowWindows.addTask),config.windows.push(WorkflowWindows.updateTask),config.windows.push(WorkflowWindows.taskView),config.windows.push(WorkflowWindows.addTaskArg),config.windows.push(WorkflowWindows.updateTaskArg)}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var TriggerSearchModel=function(){function TriggerSearchModel(){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0}return TriggerSearchModel}();AltaiWorkflow.TriggerSearchModel=TriggerSearchModel}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var Condition=function(){function Condition(){}return Condition}();AltaiWorkflow.Condition=Condition}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var TaskArg=function(){function TaskArg(){}return TaskArg}();AltaiWorkflow.TaskArg=TaskArg}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var Trigger=function(){function Trigger(){}return Trigger}();AltaiWorkflow.Trigger=Trigger}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var Task=function(){function Task(){}return Task}();AltaiWorkflow.Task=Task}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiWorkflow;!function(AltaiWorkflow){var mod=angular.module("altai.workflow",[]);mod.directive("altaiWorkflowTriggerView",AltaiWorkflow.AltaiWorkflowTriggerViewDirective),mod.directive("addAltaiWorkflowTrigger",AltaiWorkflow.AddAltaiWorkflowTriggerDirective),mod.directive("updateAltaiWorkflowTrigger",AltaiWorkflow.UpdateAltaiWorkflowTriggerDirective),mod.directive("altaiWorkflowAddCondition",AltaiWorkflow.AddAltaiWorkFlowConditionDirective),mod.directive("altaiWorkflowAddTask",AltaiWorkflow.AddAltaiWorkFlowTaskDirective),mod.directive("altaiWorkflowConditionUpdate",AltaiWorkflow.UpdateAltaiWorkflowConditionDirective),mod.directive("altaiWorkflowTaskUpdate",AltaiWorkflow.UpdateAltaiWorkflowTaskDirective),mod.directive("altaiWorkflowTaskView",AltaiWorkflow.AltaiWorkflowTaskViewDirective),mod.directive("altaiWorkflowAddTaskarg",AltaiWorkflow.AddAltaiWorkFlowTaskArgDirective),mod.directive("altaiWorkflowTaskargUpdate",AltaiWorkflow.UpdateAltaiWorkflowTaskArgDirective),mod.component("altaiWorkflowTriggerList",new AltaiWorkflow.AltaiWorkflowTriggerListComponent),mod.service("workflowTriggerManager",AltaiWorkflow.WorkflowTriggerManager),mod.service("ConditionService",AltaiWorkflow.ConditionService),mod.service("workflowConditionService",AltaiWorkflow.WorkflowConditionService),mod.service("workflowTaskService",AltaiWorkflow.WorkflowTaskService),mod.config(function(altaiAdminMenuProvider,$stateProvider){altaiAdminMenuProvider.add({name:"workflow",order:6,label:"workflow",securable:"workflow",icon:"fa fa-2 fa-caret-square-o-right"}),altaiAdminMenuProvider.add({parent:"workflow",name:"workflow.triggers",securable:"workflow",label:"triggers",icon:"mdi mdi-barley menuicon",state:"admin.workflowtrigger.list"}),$stateProvider.state("admin.workflowtrigger",{"abstract":!0}).state("admin.workflowtrigger.list",{url:"/workflow/trigger/list",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiWorkflow.WorkflowTriggerListController}}})}),config.modules.push(mod.name)}(AltaiWorkflow||(AltaiWorkflow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var BusinessProcessFlowWindows=function(){function BusinessProcessFlowWindows(){}return BusinessProcessFlowWindows}();BusinessProcessFlowWindows.businessProcessDefinitionList=new AltaiWindowManager.wmWindowType("businessProcessDefinitionList","<altai-business-process-definition-list languages='vm.languages'></altai-business-process-definition-list>",655,960,1600),BusinessProcessFlowWindows.businessProcessInstanceList=new AltaiWindowManager.wmWindowType("businessProcessInstanceList","<altai-business-process-instance-list languages='vm.languages'></altai-business-process-instance-list>",655,960,1600),BusinessProcessFlowWindows.businessProcessTaskList=new AltaiWindowManager.wmWindowType("businessProcessTaskList","<altai-business-process-task-list languages='vm.languages'></altai-business-process-task-list>",655,1440,1600),BusinessProcessFlowWindows.contentFlowConfigure=new AltaiWindowManager.wmWindowType("contentFlowConfigure","<altai-content-flow-configure languages='vm.languages'></altai-content-flow-configure>",655,960,1600),BusinessProcessFlowWindows.contentFlowContentItemUpdate=new AltaiWindowManager.wmWindowType("contentFlowContentItemUpdate","<altai-content-flow-content-item-update-parent content-flow-task='vm.window.entityId' languages='vm.languages'></altai-content-flow-content-item-update-parent>",655,960,1600),BusinessProcessFlowWindows.contentFlowContentItemCreate=new AltaiWindowManager.wmWindowType("contentFlowContentItemCreate","<altai-content-flow-content-item-create-parent content-type-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-content-item-create-parent>",655,960,1600),BusinessProcessFlowWindows.contentFlowProcessDefinition=new AltaiWindowManager.wmWindowType("contentFlowProcessDefinition","<altai-content-flow-process-definition languages='vm.languages'></altai-content-flow-process-definition>",655,960,1600),BusinessProcessFlowWindows.contentFlowSingleProcessDefinition=new AltaiWindowManager.wmWindowType("contentFlowSingleProcessDefinition","<altai-content-flow-single-process-definition content-flow-process-definition-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-single-process-definition>",655,1600,1600),BusinessProcessFlowWindows.contentFlowTaskDefinition=new AltaiWindowManager.wmWindowType("contentFlowTaskDefinition","<altai-content-flow-task-definition content-flow-task-definition-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-task-definition>",655,1600,1600),BusinessProcessFlowWindows.contentFlowProcessVariableDefinitionCreate=new AltaiWindowManager.wmWindowType("contentFlowProcessVariableDefinitionCreate","<altai-content-flow-process-variable-definition-create content-flow-task-definition-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-process-variable-definition-create>",655,960,1600),BusinessProcessFlowWindows.contentFlowProcessVariableDefinitionUpdate=new AltaiWindowManager.wmWindowType("contentFlowProcessVariableDefinitionUpdate","<altai-content-flow-process-variable-definition-update content-flow-process-variable-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-process-variable-definition-update>",655,960,1600),BusinessProcessFlowWindows.contentFlowProcessStartVariableDefinitionCreate=new AltaiWindowManager.wmWindowType("contentFlowProcessStartVariableDefinitionCreate","<altai-content-flow-process-start-variable-definition-create content-flow-process-definition-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-process-start-variable-definition-create>",655,960,1600),BusinessProcessFlowWindows.contentFlowProcessStartVariableDefinitionUpdate=new AltaiWindowManager.wmWindowType("contentFlowProcessStartVariableDefinitionUpdate","<altai-content-flow-process-start-variable-definition-update content-flow-process-start-variable-id='vm.window.entityId' languages='vm.languages'></altai-content-flow-process-start-variable-definition-update>",655,960,1600),BusinessProcessFlowWindows.contentFlowPublishCalendar=new AltaiWindowManager.wmWindowType("businessProcessTaskList","<altai-content-flow-publish-calendar languages='vm.languages'></altai-content-flow-publish-calendar>",655,1440,1600),
AltaiBusinessProcessFlow.BusinessProcessFlowWindows=BusinessProcessFlowWindows}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var BusinessProcessDefinitionService=function(_super){function BusinessProcessDefinitionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/businessprocessdefinition","BusinessProcessDefinition",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(BusinessProcessDefinitionService,_super),BusinessProcessDefinitionService.prototype.getHumanTasksForProcessDefinition=function(processDefinitionId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+processDefinitionId+"/humantasks").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessDefinitionService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.BusinessProcessDefinitionService=BusinessProcessDefinitionService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var BusinessProcessInstanceService=function(_super){function BusinessProcessInstanceService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/businessprocessinstance","BusinessProcessInstance",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(BusinessProcessInstanceService,_super),BusinessProcessInstanceService.prototype.updateVariables=function(processInstanceId,variables){var s=this,d=s.$q.defer();return s.$http.put(s.apiUrl+"/"+processInstanceId+"/variables",variables).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessInstanceService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.BusinessProcessInstanceService=BusinessProcessInstanceService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var BusinessProcessTaskService=function(_super){function BusinessProcessTaskService($http,altaiHttp,$q,altaiNotificationFactory,contentFlowActiveProcessInstanceService){var _this=_super.call(this,"api/contentflowactivetaskinstance","Content Flow Active Task Instance",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.dataListForActiveUser=[],_this.dataListForCandidateGroups=[],_this.dataListForProcessInstance=[],_this.contentFlowActiveProcessInstanceService=contentFlowActiveProcessInstanceService,_this}return __extends(BusinessProcessTaskService,_super),BusinessProcessTaskService.prototype.resetData=function(){var s=this;s.dataListForActiveUser.length=0,s.dataListForCandidateGroups.length=0,s.contentFlowActiveProcessInstanceService.resetData(),s.getActiveTasksForCurrentUserAsAssignee(),s.getClaimableTasksForCurrentUserAsPartOfCandidateGroups()},BusinessProcessTaskService.prototype.updateTask=function(updateModel){var s=this,d=s.$q.defer();return s.$http.put(s.apiUrl,updateModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.getActiveTasksForCurrentUserAsAssignee=function(){var s=this,d=s.$q.defer();return s.dataListForActiveUser.length>0&&s.enableCaching?d.resolve(s.dataListForActiveUser):d.resolve([]),d.promise},BusinessProcessTaskService.prototype.getClaimableTasksForCurrentUserAsPartOfCandidateGroups=function(){var s=this,d=s.$q.defer();return s.dataListForCandidateGroups.length>0&&s.enableCaching?d.resolve(s.dataListForCandidateGroups):s.altaiHttp.get(s.apiUrl+"/activeuseraspartofcandidategroups").then(function(result){angular.copy(result,s.dataListForCandidateGroups),d.resolve(s.dataListForCandidateGroups)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.getActiveTasksForProcessInstance=function(processInstanceId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+processInstanceId).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.executeTaskAction=function(contentFlowTask,businessProcessTaskActionModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/businessprocesstask/"+contentFlowTask.processTasksResponseData.id,businessProcessTaskActionModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.claimTaskForCurrentUser=function(contentFlowTask){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/businessprocesstask/"+contentFlowTask.processTasksResponseData.id+"/claim").then(function(result){s.resetData(),d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.unclaimTaskForCurrentUser=function(contentFlowTask){var s=this,d=s.$q.defer();return s.$http.get(config.backendUrl+"/api/businessprocesstask/"+contentFlowTask.processTasksResponseData.id+"/unclaim").then(function(result){s.resetData(),d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.DeleteTaskIdentityLink=function(taskId,family,identityId,type){var s=this,d=s.$q.defer();return s.$http["delete"](s.apiUrl+"/"+taskId+"/identitylinks/"+family+"/"+identityId+"/"+type).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.DeleteAllTaskIdentityLinks=function(taskId){var s=this,d=s.$q.defer();return s.$http["delete"](s.apiUrl+"/"+taskId+"/identitylinks").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService.prototype.CreateTaskIdentityLink=function(taskId,model){var s=this,d=s.$q.defer();return s.$http.post(s.apiUrl+"/"+taskId+"/identitylinks",model).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},BusinessProcessTaskService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.BusinessProcessTaskService=BusinessProcessTaskService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function BusinessProcessDefinitionListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.businessProcessDefinitionList,"Business Process Definitions","")}AltaiBusinessProcessFlow.BusinessProcessDefinitionListController=BusinessProcessDefinitionListController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function BusinessProcessInstanceListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.businessProcessInstanceList,"Business Process Instances","")}AltaiBusinessProcessFlow.BusinessProcessInstanceListController=BusinessProcessInstanceListController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function BusinessProcessTaskListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.businessProcessTaskList,"Business Process Tasks","")}AltaiBusinessProcessFlow.BusinessProcessTaskListController=BusinessProcessTaskListController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiBusinessProcessDefinitionListDirective(){return{templateUrl:"/api/template/Admin/businessprocessdefinitionList",controller:BusinessProcessDefinitionListDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiBusinessProcessDefinitionListDirective=AltaiBusinessProcessDefinitionListDirective;var BusinessProcessDefinitionListDirectiveController=function(){function BusinessProcessDefinitionListDirectiveController(businessProcessDefinitionService,businessProcessInstanceService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.getData()}return BusinessProcessDefinitionListDirectiveController.prototype.setSorting=function(sortAttr){this.pageNr=0,this.sorterAttr==sortAttr?this.sorterDesc=!this.sorterDesc:this.sorterDesc=!1,this.sorterAttr=sortAttr,this.getData()},BusinessProcessDefinitionListDirectiveController.prototype.getData=function(){var s=this;this.businessProcessDefinitionService.list().then(function(businessProcessDefinitions){s.definitions=businessProcessDefinitions.data})},BusinessProcessDefinitionListDirectiveController.prototype.createInstance=function(definition){var instanceCreation={processDefinitionId:definition.id};this.businessProcessInstanceService.add(instanceCreation).then(function(instance){console.log("created instance "+instance.id)})},BusinessProcessDefinitionListDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiBusinessProcessInstanceListDirective(){return{templateUrl:"/api/template/Admin/businessprocessinstanceList",controller:BusinessProcessInstanceListDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiBusinessProcessInstanceListDirective=AltaiBusinessProcessInstanceListDirective;var BusinessProcessInstanceListDirectiveController=function(){function BusinessProcessInstanceListDirectiveController(businessProcessInstanceService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.businessProcessInstanceService=businessProcessInstanceService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.getData()}return BusinessProcessInstanceListDirectiveController.prototype.setSorting=function(sortAttr){this.pageNr=0,this.sorterAttr==sortAttr?this.sorterDesc=!this.sorterDesc:this.sorterDesc=!1,this.sorterAttr=sortAttr,this.getData()},BusinessProcessInstanceListDirectiveController.prototype.getData=function(){var s=this;this.businessProcessInstanceService.list().then(function(businessProcessInstances){s.instances=businessProcessInstances.data})},BusinessProcessInstanceListDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiBusinessProcessTaskListDirective(){return{scope:{languages:"="},templateUrl:"/api/template/Admin/businessprocesstaskList",controller:BusinessProcessTaskListDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiBusinessProcessTaskListDirective=AltaiBusinessProcessTaskListDirective;var BusinessProcessTaskListDirectiveController=function(){function BusinessProcessTaskListDirectiveController(contentFlowActiveProcessInstanceService,groupAdminFactory,userAdminService,businessProcessInstanceService,businessProcessTaskService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.businessProcessTaskService=businessProcessTaskService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.userAdminService=userAdminService,this.groupAdminFactory=groupAdminFactory,this.businessProcessInstanceService=businessProcessInstanceService,this.contentFlowActiveProcessInstanceService=contentFlowActiveProcessInstanceService,this.getData()}return BusinessProcessTaskListDirectiveController.prototype.openTask=function(task){var vm=this;vm.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate,task.contentFlowTaskDefinition.label,task)},BusinessProcessTaskListDirectiveController.prototype.claimTask=function(task){var vm=this;vm.businessProcessTaskService.claimTaskForCurrentUser(task).then(function(result){})},BusinessProcessTaskListDirectiveController.prototype.unclaimTask=function(task){var vm=this;vm.businessProcessTaskService.unclaimTaskForCurrentUser(task).then(function(result){})},BusinessProcessTaskListDirectiveController.prototype.updateAssignee=function(task){var vm=this,variableList=[];variableList.push({name:vm.purifyProcessVarString(task.contentFlowTaskDefinition.assignee),value:task.processTasksResponseData.assignee}),vm.businessProcessInstanceService.updateVariables(task.processInstanceResponseData.id,variableList).then(function(result){});var updateModel={taskId:task.processTasksResponseData.id,data:{assignee:task.processTasksResponseData.assignee}};vm.businessProcessTaskService.updateTask(updateModel).then(function(result){})},BusinessProcessTaskListDirectiveController.prototype.updateCandidateGroups=function(task){var vm=this,variableList=[];variableList.push({name:vm.purifyProcessVarString(task.contentFlowTaskDefinition.candidateGroups),value:vm.createArrayStringFromArray(task.processTasksResponseData.candidateGroupsAsList)}),vm.businessProcessInstanceService.updateVariables(task.processInstanceResponseData.id,variableList).then(function(result){});for(var i=0;i<task.processTasksResponseData.candidateGroupsAsList.length;i++){task.processTasksResponseData.candidateGroupsAsList[i];vm.businessProcessTaskService.DeleteAllTaskIdentityLinks(task.processTasksResponseData.id).then(function(result){for(var i=0;i<task.processTasksResponseData.candidateGroupsAsListInternal.length;i++){var updateModel={group:task.processTasksResponseData.candidateGroupsAsListInternal[i],type:"candidate"};vm.businessProcessTaskService.CreateTaskIdentityLink(task.processTasksResponseData.id,updateModel).then(function(result){})}})}},BusinessProcessTaskListDirectiveController.prototype.createArrayStringFromArray=function(arrayToString){for(var arrayString='["',i=0;i<arrayToString.length;i++)arrayString+=arrayToString[i].group+'","';return""!=arrayString&&(arrayString=arrayString.substring(0,arrayString.length-2)),arrayString+="]"},BusinessProcessTaskListDirectiveController.prototype.purifyProcessVarString=function(processVarString){return processVarString=processVarString.substring(2,processVarString.length-1)},BusinessProcessTaskListDirectiveController.prototype.setSorting=function(sortAttr){this.pageNr=0,this.sorterAttr==sortAttr?this.sorterDesc=!this.sorterDesc:this.sorterDesc=!1,this.sorterAttr=sortAttr,this.getData()},BusinessProcessTaskListDirectiveController.prototype.updateAssigneeAsString=function(task){var vm=this;task.processTasksResponseData.assigneeAsString="";for(var userFound=!1,i=0;i<vm.users.length&&!userFound;i++)vm.users[i].id==task.processTasksResponseData.assignee&&(userFound=!0,task.processTasksResponseData.assigneeAsString=vm.users[i].fullName)},BusinessProcessTaskListDirectiveController.prototype.createCandidateGroupsAsListInternal=function(task){task.processTasksResponseData.candidateGroupsAsListInternal=[];for(var i=0;i<task.processTasksResponseData.candidateGroupsAsList.length;i++)task.processTasksResponseData.candidateGroupsAsListInternal.push(task.processTasksResponseData.candidateGroupsAsList[i].group)},BusinessProcessTaskListDirectiveController.prototype.updateCandidateGroupsAsString=function(task){var vm=this;task.processTasksResponseData.candidateGroupsAsString="";for(var j=0;j<task.processTasksResponseData.candidateGroupsAsList.length;j++)for(var group=task.processTasksResponseData.candidateGroupsAsList[j].group,groupFound=!1,i=0;i<vm.groups.length&&!groupFound;i++)vm.groups[i].id==group&&(groupFound=!0,task.processTasksResponseData.candidateGroupsAsString+=vm.groups[i].name+", ");""!=task.processTasksResponseData.candidateGroupsAsString&&(task.processTasksResponseData.candidateGroupsAsString=task.processTasksResponseData.candidateGroupsAsString.substring(0,task.processTasksResponseData.candidateGroupsAsString.length-2))},BusinessProcessTaskListDirectiveController.prototype.getData=function(){var s=this;s.contentFlowActiveProcessInstanceService.getActiveProcessesForCurrentUserAsInvolvedUser().then(function(result){s.processes=result}),s.businessProcessTaskService.getActiveTasksForCurrentUserAsAssignee().then(function(result){s.tasks=result;for(var i=0;i<s.tasks.length;i++)s.createCandidateGroupsAsListInternal(s.tasks[i]);s.userAdminService.list().then(function(users){s.users=users;for(var i=0;i<s.users.length;i++)s.users[i].fullName=s.users[i].firstName+" "+s.users[i].lastName;s.businessProcessTaskService.getClaimableTasksForCurrentUserAsPartOfCandidateGroups().then(function(result){s.claimabletasks=result,s.groupAdminFactory.list().then(function(groups){s.groups=groups;for(var i=0;i<s.tasks.length;i++)s.updateAssigneeAsString(s.tasks[i]);for(var i=0;i<s.tasks.length;i++)s.updateCandidateGroupsAsString(s.tasks[i]);for(var i=0;i<s.claimabletasks.length;i++)s.updateCandidateGroupsAsString(s.claimabletasks[i])})})})})},BusinessProcessTaskListDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiTaskCenterDirective(){return{scope:{languages:"="},templateUrl:"/api/template/Admin/taskCenter",controller:TaskCenterDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiTaskCenterDirective=AltaiTaskCenterDirective;var TaskCenterDirectiveController=function(){function TaskCenterDirectiveController(groupAdminFactory,userAdminService,businessProcessInstanceService,businessProcessTaskService,wmContainerFactory,altaiConfirmationService){this.showTaskCenterList=!1,this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.businessProcessTaskService=businessProcessTaskService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.userAdminService=userAdminService,this.groupAdminFactory=groupAdminFactory,this.businessProcessInstanceService=businessProcessInstanceService,this.getData()}return TaskCenterDirectiveController.prototype.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev)},TaskCenterDirectiveController.prototype.openTaskWindow=function(){var vm=this;vm.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.businessProcessTaskList,"Business Process Tasks","")},TaskCenterDirectiveController.prototype.toggleTaskCenterListView=function(){var vm=this;vm.showTaskCenterList=!vm.showTaskCenterList},TaskCenterDirectiveController.prototype.setTaskCenterListView=function(value){var vm=this;vm.showTaskCenterList=value},TaskCenterDirectiveController.prototype.openTask=function(task){var vm=this;vm.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate,task.contentFlowTaskDefinition.label,task)},TaskCenterDirectiveController.prototype.claimTask=function(task){var vm=this;vm.businessProcessTaskService.claimTaskForCurrentUser(task).then(function(result){})},TaskCenterDirectiveController.prototype.unclaimTask=function(task){var vm=this;vm.businessProcessTaskService.unclaimTaskForCurrentUser(task).then(function(result){})},TaskCenterDirectiveController.prototype.updateAssignee=function(task){var vm=this,variableList=[];variableList.push({name:vm.purifyProcessVarString(task.contentFlowTaskDefinition.assignee),value:task.processTasksResponseData.assignee}),vm.businessProcessInstanceService.updateVariables(task.processInstanceResponseData.id,variableList).then(function(result){});var updateModel={taskId:task.processTasksResponseData.id,data:{assignee:task.processTasksResponseData.assignee}};vm.businessProcessTaskService.updateTask(updateModel).then(function(result){})},TaskCenterDirectiveController.prototype.updateCandidateGroups=function(task){var vm=this,variableList=[];variableList.push({name:vm.purifyProcessVarString(task.contentFlowTaskDefinition.candidateGroups),value:vm.createArrayStringFromArray(task.processTasksResponseData.candidateGroupsAsList)}),vm.businessProcessInstanceService.updateVariables(task.processInstanceResponseData.id,variableList).then(function(result){});for(var i=0;i<task.processTasksResponseData.candidateGroupsAsList.length;i++){task.processTasksResponseData.candidateGroupsAsList[i];vm.businessProcessTaskService.DeleteAllTaskIdentityLinks(task.processTasksResponseData.id).then(function(result){for(var i=0;i<task.processTasksResponseData.candidateGroupsAsListInternal.length;i++){var updateModel={group:task.processTasksResponseData.candidateGroupsAsListInternal[i],type:"candidate"};vm.businessProcessTaskService.CreateTaskIdentityLink(task.processTasksResponseData.id,updateModel).then(function(result){})}})}},TaskCenterDirectiveController.prototype.createArrayStringFromArray=function(arrayToString){for(var arrayString='["',i=0;i<arrayToString.length;i++)arrayString+=arrayToString[i].group+'","';return""!=arrayString&&(arrayString=arrayString.substring(0,arrayString.length-2)),arrayString+="]"},TaskCenterDirectiveController.prototype.purifyProcessVarString=function(processVarString){return processVarString=processVarString.substring(2,processVarString.length-1)},TaskCenterDirectiveController.prototype.setSorting=function(sortAttr){this.pageNr=0,this.sorterAttr==sortAttr?this.sorterDesc=!this.sorterDesc:this.sorterDesc=!1,this.sorterAttr=sortAttr,this.getData()},TaskCenterDirectiveController.prototype.updateAssigneeAsString=function(task){var vm=this;task.processTasksResponseData.assigneeAsString="";for(var userFound=!1,i=0;i<vm.users.length&&!userFound;i++)vm.users[i].id==task.processTasksResponseData.assignee&&(userFound=!0,task.processTasksResponseData.assigneeAsString=vm.users[i].fullName)},TaskCenterDirectiveController.prototype.createCandidateGroupsAsListInternal=function(task){task.processTasksResponseData.candidateGroupsAsListInternal=[];for(var i=0;i<task.processTasksResponseData.candidateGroupsAsList.length;i++)task.processTasksResponseData.candidateGroupsAsListInternal.push(task.processTasksResponseData.candidateGroupsAsList[i].group)},TaskCenterDirectiveController.prototype.updateCandidateGroupsAsString=function(task){var vm=this;task.processTasksResponseData.candidateGroupsAsString="";for(var j=0;j<task.processTasksResponseData.candidateGroupsAsList.length;j++)for(var group=task.processTasksResponseData.candidateGroupsAsList[j].group,groupFound=!1,i=0;i<vm.groups.length&&!groupFound;i++)vm.groups[i].id==group&&(groupFound=!0,task.processTasksResponseData.candidateGroupsAsString+=vm.groups[i].name+", ");""!=task.processTasksResponseData.candidateGroupsAsString&&(task.processTasksResponseData.candidateGroupsAsString=task.processTasksResponseData.candidateGroupsAsString.substring(0,task.processTasksResponseData.candidateGroupsAsString.length-2))},TaskCenterDirectiveController.prototype.getData=function(){var s=this;s.businessProcessTaskService.getActiveTasksForCurrentUserAsAssignee().then(function(result){s.tasks=result})},TaskCenterDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function ContentFlowProcessDefinitionController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowProcessDefinition,"Content Flow Process Definitions","")}AltaiBusinessProcessFlow.ContentFlowProcessDefinitionController=ContentFlowProcessDefinitionController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function ContentFlowPublishCalendar(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowPublishCalendar,"Publication Calendar","")}AltaiBusinessProcessFlow.ContentFlowPublishCalendar=ContentFlowPublishCalendar}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function ContentFlowConfigureController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowConfigure,"Configure Content Flows","")}AltaiBusinessProcessFlow.ContentFlowConfigureController=ContentFlowConfigureController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function ContentFlowContentItemCreateController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemCreate,"Update Content Item","")}AltaiBusinessProcessFlow.ContentFlowContentItemCreateController=ContentFlowContentItemCreateController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function ContentFlowContentItemUpdateController(wmContainerFactory){wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate,"Update Content Item","")}AltaiBusinessProcessFlow.ContentFlowContentItemUpdateController=ContentFlowContentItemUpdateController}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowCommentComponent=function(){function AltaiContentFlowCommentComponent(){this.controller=ContentFlowCommentComponentController,this.bindings={contentFlowComment:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowComment"}return AltaiContentFlowCommentComponent}();AltaiBusinessProcessFlow.AltaiContentFlowCommentComponent=AltaiContentFlowCommentComponent;var ContentFlowCommentComponentController=function(){function ContentFlowCommentComponentController(businessProcessDefinitionService,businessProcessTaskService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.commentEdit=!1;var s=this;s.$scope=$scope,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.businessProcessTaskService=businessProcessTaskService,this.getData(),$scope.$on("commentUpdated",function(event,args){s.setEditComment(!1)}),$scope.$on("commentUpdateCancelled",function(event,args){s.setEditComment(!1)})}return ContentFlowCommentComponentController.prototype.toggleEditComment=function(){var vm=this;vm.commentEdit=!vm.commentEdit},ContentFlowCommentComponentController.prototype.setEditComment=function(value){var vm=this;vm.commentEdit=value},ContentFlowCommentComponentController.prototype.getData=function(){},ContentFlowCommentComponentController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowSidebarCreateComponent=function(){function AltaiContentFlowSidebarCreateComponent(){this.controller=ContentFlowSidebarCreateDirectiveController,this.bindings={contentTypeId:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowSidebarCreate"}return AltaiContentFlowSidebarCreateComponent}();AltaiBusinessProcessFlow.AltaiContentFlowSidebarCreateComponent=AltaiContentFlowSidebarCreateComponent;var ContentFlowSidebarCreateDirectiveController=function(){function ContentFlowSidebarCreateDirectiveController(amMoment,moment,businessProcessDefinitionService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$scope=$scope,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.publishImmediately=!1,this.doNotSpecifyUnpublishDate=!0,this.commentCreation=!1;var s=this;this.moment=moment,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.getData(),this.publishDate=moment().add(1,"days"),this.unpublishDate=moment().add(3,"days"),$scope.$on("provideProcessCreationModel",function(event){s.provideProcessCreationModel()})}return ContentFlowSidebarCreateDirectiveController.prototype.updateDate=function(){var vm=this;"string"==typeof vm.publishDate&&(vm.publishDate=vm.moment(vm.publishDate,"DD-MM-YYYY HH:mm")),"string"==typeof vm.unpublishDate&&(vm.unpublishDate=vm.moment(vm.unpublishDate,"DD-MM-YYYY HH:mm"))},ContentFlowSidebarCreateDirectiveController.prototype.toggleCommentCreation=function(){var vm=this;vm.commentCreation=!vm.commentCreation,vm.$scope.$emit("commentCreationChanged",vm.commentCreation)},ContentFlowSidebarCreateDirectiveController.prototype.setCommentCreation=function(value){var vm=this;vm.commentCreation=value,vm.$scope.$emit("commentCreationChanged",vm.commentCreation)},ContentFlowSidebarCreateDirectiveController.prototype.provideProcessCreationModel=function(){console.log("starting flow");for(var vm=this,variableList=[],i=0;i<vm.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++)variableList.push({name:vm.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i].key,value:vm.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i].value});"string"==typeof vm.publishDate&&(vm.publishDate=vm.moment(vm.publishDate,"DD-MM-YYYY HH:mm")),"string"==typeof vm.unpublishDate&&(vm.unpublishDate=vm.moment(vm.unpublishDate,"DD-MM-YYYY HH:mm"));var creationModel={processDefinitionId:vm.selectedBusinessProcessDefinition.activitiId,businessKey:"Altai",variables:variableList,publishDate:vm.publishDate.toISOString(),unpublishDate:vm.unpublishDate.toISOString(),publishImmediately:vm.publishImmediately};return vm.$scope.$emit("processCreationModelProvided",creationModel),creationModel},ContentFlowSidebarCreateDirectiveController.prototype.getData=function(){var s=this,searchModel={ContentTypeId:s.contentTypeId};this.contentTypeBusinessProcessLinkService.search(searchModel).then(function(contenttypebusinessprocessdefinitionlinks){s.contenttypebusinessprocessdefinitionlinks=contenttypebusinessprocessdefinitionlinks,void 0!=s.contenttypebusinessprocessdefinitionlinks&&(s.selectedBusinessProcessDefinition=s.contenttypebusinessprocessdefinitionlinks[0].contentFlowProcessDefinition,s.selectedVariables=s.contenttypebusinessprocessdefinitionlinks[0].contentFlowProcessDefinition.contentFlowProcessStartVariableDefinitions),
s.checkDefaultValue(),s.assignDefaultValueToValue(),s.checkVisibility(),s.$scope.$watch("$ctrl.selectedBusinessProcessDefinition",function(){s.checkVisibility(),s.checkRequiredNess()},!0)})},ContentFlowSidebarCreateDirectiveController.prototype.checkVisibility=function(){for(var s=this,i=0;i<s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++){var variable=s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessVar=s.checkCurrentTaskProcessVar,newScope.selectedBusinessProcessDefinition=s.selectedBusinessProcessDefinition,variable.visible=newScope.$eval(variable.variableVisibilityDependencyExpression),newScope.$destroy()}},ContentFlowSidebarCreateDirectiveController.prototype.checkRequiredNess=function(){for(var s=this,i=0;i<s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++){var variable=s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessVar=s.checkCurrentTaskProcessVar,newScope.selectedBusinessProcessDefinition=s.selectedBusinessProcessDefinition,variable.required=newScope.$eval(variable.variableRequirednessDependencyExpression),newScope.$destroy()}},ContentFlowSidebarCreateDirectiveController.prototype.checkDefaultValue=function(){for(var s=this,i=0;i<s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++){var variable=s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.selectedBusinessProcessDefinition=s.selectedBusinessProcessDefinition,void 0!=variable.defaultValue&&'"getValue'==variable.defaultValue.substring(0,9)&&(variable.defaultValue=newScope.$eval(variable.defaultValue)),newScope.$destroy()}},ContentFlowSidebarCreateDirectiveController.prototype.assignDefaultValueToValue=function(){for(var s=this,i=0;i<s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++){var variable=s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i];variable.value=variable.defaultValue}},ContentFlowSidebarCreateDirectiveController.prototype.checkCurrentTaskProcessVar=function(varToGet,propertyToGet,value){for(var s=this,i=0;i<s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++){var checkableProcessVar=s.selectedBusinessProcessDefinition.contentFlowProcessStartVariableDefinitions[i];if(checkableProcessVar.key===varToGet)return checkableProcessVar[propertyToGet].toString==value}},ContentFlowSidebarCreateDirectiveController.prototype.processUpdated=function(){},ContentFlowSidebarCreateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowSidebarUpdateComponent=function(){function AltaiContentFlowSidebarUpdateComponent(){this.controller=ContentFlowSidebarUpdateDirectiveController,this.bindings={contentFlowTask:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowSidebarUpdate"}return AltaiContentFlowSidebarUpdateComponent}();AltaiBusinessProcessFlow.AltaiContentFlowSidebarUpdateComponent=AltaiContentFlowSidebarUpdateComponent;var ContentFlowSidebarUpdateDirectiveController=function(){function ContentFlowSidebarUpdateDirectiveController(contentFlowHistoricTaskInstanceService,businessProcessTaskService,businessProcessDefinitionService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory;var s=this;s.$scope=$scope,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.businessProcessTaskService=businessProcessTaskService,this.contentFlowHistoricTaskInstanceService=contentFlowHistoricTaskInstanceService,this.getData()}return ContentFlowSidebarUpdateDirectiveController.prototype.getData=function(){var vm=this;vm.businessProcessTaskService.getActiveTasksForProcessInstance(vm.contentFlowTask.processTasksResponseData.processInstanceId).then(function(result){for(var otherActiveTasksTemp=result,i=0;i<otherActiveTasksTemp.length;i++)otherActiveTasksTemp[i].processTasksResponseData.id==vm.contentFlowTask.processTasksResponseData.id&&otherActiveTasksTemp.splice(i,1);vm.otherActiveTasks=otherActiveTasksTemp}),vm.contentFlowHistoricTaskInstanceService.getHistoricTasksForProcessInstance(vm.contentFlowTask.processTasksResponseData.processInstanceId).then(function(result){for(var historicTasks=result,i=0;i<historicTasks.length;i++)historicTasks[i].processTasksResponseData.id==vm.contentFlowTask.processTasksResponseData.id&&historicTasks.splice(i,1);vm.historicTasks=historicTasks})},ContentFlowSidebarUpdateDirectiveController.prototype.processUpdated=function(){var vm=this;console.log("selectedBusinessProcessDefinition "+vm.selectedBusinessProcessDefinition.id)},ContentFlowSidebarUpdateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowActiveTaskCardComponent=function(){function AltaiContentFlowActiveTaskCardComponent(){this.controller=ContentFlowActiveTaskCardComponentController,this.bindings={contentFlowTask:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowActiveTaskCard"}return AltaiContentFlowActiveTaskCardComponent}();AltaiBusinessProcessFlow.AltaiContentFlowActiveTaskCardComponent=AltaiContentFlowActiveTaskCardComponent;var ContentFlowActiveTaskCardComponentController=function(){function ContentFlowActiveTaskCardComponentController(businessProcessDefinitionService,businessProcessTaskService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.commentCreation=!1,this.commentView=!1;var s=this;s.$scope=$scope,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.businessProcessTaskService=businessProcessTaskService,this.getData(),this.checkDefaultValue(),this.assignDefaultValueToValue(),this.checkVisibility(),$scope.$on("finishtask",function(event){s.provideTaskFinishModel()}),$scope.$on("commentCreated",function(event,comment){s.contentFlowTask.comments.push(comment)}),$scope.$on("commentCreationCancelled",function(event){s.setCommentCreation(!1)}),$scope.$watch("$ctrl.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet",function(){s.checkVisibility(),s.checkRequiredNess()},!0)}return ContentFlowActiveTaskCardComponentController.prototype.toggleCommentCreation=function(){var vm=this;vm.commentCreation=!vm.commentCreation},ContentFlowActiveTaskCardComponentController.prototype.toggleCommentView=function(){var vm=this;vm.commentView=!vm.commentView},ContentFlowActiveTaskCardComponentController.prototype.setCommentCreation=function(value){var vm=this;vm.commentCreation=value},ContentFlowActiveTaskCardComponentController.prototype.setCommentView=function(value){var vm=this;vm.commentView=value},ContentFlowActiveTaskCardComponentController.prototype.provideTaskFinishModel=function(){console.log("providing task finish model");for(var vm=this,variableList=[],i=0;i<vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++)variableList.push({name:vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i].key,value:vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i].value});var businessProcessTaskActionModel={taskId:vm.contentFlowTask.processTasksResponseData.id,action:"complete",variables:variableList};vm.$scope.$emit("taskFinishModelProvided",businessProcessTaskActionModel)},ContentFlowActiveTaskCardComponentController.prototype.checkVisibility=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessInstanceProcessVar=s.checkProcessInstanceProcessVar,newScope.checkCurrentTaskProcessVar=s.checkCurrentTaskProcessVar,newScope.contentFlowTask=s.contentFlowTask,variable.visible=newScope.$eval(variable.variableVisibilityDependencyExpression),newScope.$destroy()}},ContentFlowActiveTaskCardComponentController.prototype.checkRequiredNess=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessInstanceProcessVar=s.checkProcessInstanceProcessVar,newScope.checkCurrentTaskProcessVar=s.checkCurrentTaskProcessVar,newScope.contentFlowTask=s.contentFlowTask,variable.required=newScope.$eval(variable.variableRequirednessDependencyExpression),newScope.$destroy()}},ContentFlowActiveTaskCardComponentController.prototype.checkDefaultValue=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.contentFlowTask=s.contentFlowTask,newScope.getValueFromProcessVariable=s.getValueFromProcessVariable,void 0!=variable.defaultValue&&'"getValue'==variable.defaultValue.substring(0,9)&&(variable.defaultValue=newScope.$eval(variable.defaultValue)),newScope.$destroy()}},ContentFlowActiveTaskCardComponentController.prototype.assignDefaultValueToValue=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i];variable.value=variable.defaultValue}},ContentFlowActiveTaskCardComponentController.prototype.getData=function(){},ContentFlowActiveTaskCardComponentController.prototype.getValueFromProcessVariable=function(varToGet){for(var vm=this,i=0;i<vm.contentFlowTask.processInstanceResponseData.variables.length;i++){var checkableProcessVar=vm.contentFlowTask.processInstanceResponseData.variables[i];if(checkableProcessVar.name===varToGet)return checkableProcessVar.value}},ContentFlowActiveTaskCardComponentController.prototype.checkProcessInstanceProcessVar=function(varToGet,value){for(var vm=this,i=0;i<vm.contentFlowTask.processInstanceResponseData.variables.length;i++){var checkableProcessVar=vm.contentFlowTask.processInstanceResponseData.variables[i];if(checkableProcessVar.name===varToGet)return checkableProcessVar.value==value}},ContentFlowActiveTaskCardComponentController.prototype.checkCurrentTaskProcessVar=function(varToGet,propertyToGet,value){for(var vm=this,i=0;i<vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var checkableProcessVar=vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i];if(checkableProcessVar.key===varToGet)return checkableProcessVar[propertyToGet].toString()==value}},ContentFlowActiveTaskCardComponentController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowActiveTaskCardDisabledComponent=function(){function AltaiContentFlowActiveTaskCardDisabledComponent(){this.controller=ContentFlowActiveTaskCardDisabledComponentController,this.bindings={contentFlowTask:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowActiveTaskCardDisabled"}return AltaiContentFlowActiveTaskCardDisabledComponent}();AltaiBusinessProcessFlow.AltaiContentFlowActiveTaskCardDisabledComponent=AltaiContentFlowActiveTaskCardDisabledComponent;var ContentFlowActiveTaskCardDisabledComponentController=function(){function ContentFlowActiveTaskCardDisabledComponentController(businessProcessDefinitionService,businessProcessTaskService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.commentCreation=!1,this.commentView=!1;var s=this;s.$scope=$scope,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.businessProcessTaskService=businessProcessTaskService,this.getData(),this.checkDefaultValue(),this.assignDefaultValueToValue(),this.checkVisibility(),$scope.$on("finishtask",function(event,args){s.finishtask(args)}),$scope.$on("commentCreated",function(event,comment){s.contentFlowTask.comments.push(comment)}),$scope.$on("commentCreationCancelled",function(event){s.setCommentCreation(!1)}),$scope.$watch("$ctrl.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet",function(){s.checkVisibility(),s.checkRequiredNess()},!0)}return ContentFlowActiveTaskCardDisabledComponentController.prototype.toggleCommentCreation=function(){var vm=this;vm.commentCreation=!vm.commentCreation},ContentFlowActiveTaskCardDisabledComponentController.prototype.toggleCommentView=function(){var vm=this;vm.commentView=!vm.commentView},ContentFlowActiveTaskCardDisabledComponentController.prototype.setCommentCreation=function(value){var vm=this;vm.commentCreation=value},ContentFlowActiveTaskCardDisabledComponentController.prototype.setCommentView=function(value){var vm=this;vm.commentView=value},ContentFlowActiveTaskCardDisabledComponentController.prototype.finishtask=function(contentitem){console.log("finishing task");for(var vm=this,variableList=[],i=0;i<vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++)variableList.push({name:vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i].key,value:vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i].value});for(var i=0;i<vm.contentFlowTask.contentItem.contentItemAttributes.length;i++){var attribute=vm.contentFlowTask.contentItem.contentItemAttributes[i];if(variableList.push({name:"itemvar_"+attribute.contentTypeAttribute.attribute.name,value:attribute.value}),void 0!=attribute.translatable&&void 0!=attribute.translatable.translatableValues)for(var j=0;j<attribute.translatable.translatableValues.length;j++)variableList.push({name:"itemvar_"+attribute.contentTypeAttribute.attribute.name+"."+attribute.translatable.translatableValues[j].languageCode,value:attribute.translatable.translatableValues[j].value})}var businessProcessTaskActionModel={action:"complete",variables:variableList};vm.businessProcessTaskService.executeTaskAction(vm.contentFlowTask,businessProcessTaskActionModel).then(function(result){vm.$scope.$emit("taskfinished",result)})},ContentFlowActiveTaskCardDisabledComponentController.prototype.checkVisibility=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessInstanceProcessVar=s.checkProcessInstanceProcessVar,newScope.checkCurrentTaskProcessVar=s.checkCurrentTaskProcessVar,newScope.contentFlowTask=s.contentFlowTask,variable.visible=newScope.$eval(variable.variableVisibilityDependencyExpression),newScope.$destroy()}},ContentFlowActiveTaskCardDisabledComponentController.prototype.checkRequiredNess=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.checkProcessInstanceProcessVar=s.checkProcessInstanceProcessVar,newScope.checkCurrentTaskProcessVar=s.checkCurrentTaskProcessVar,newScope.contentFlowTask=s.contentFlowTask,variable.required=newScope.$eval(variable.variableRequirednessDependencyExpression),newScope.$destroy()}},ContentFlowActiveTaskCardDisabledComponentController.prototype.checkDefaultValue=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i],newScope=s.$scope.$new();newScope.variable=variable,newScope.contentFlowTask=s.contentFlowTask,newScope.getValueFromProcessVariable=s.getValueFromProcessVariable,'"getValue'==variable.defaultValue.substring(0,9)&&(variable.defaultValue=newScope.$eval(variable.defaultValue)),newScope.$destroy()}},ContentFlowActiveTaskCardDisabledComponentController.prototype.assignDefaultValueToValue=function(){for(var s=this,i=0;i<s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var variable=s.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i];variable.value=variable.defaultValue}},ContentFlowActiveTaskCardDisabledComponentController.prototype.getData=function(){},ContentFlowActiveTaskCardDisabledComponentController.prototype.getValueFromProcessVariable=function(varToGet){for(var vm=this,i=0;i<vm.contentFlowTask.processInstanceResponseData.variables.length;i++){var checkableProcessVar=vm.contentFlowTask.processInstanceResponseData.variables[i];if(checkableProcessVar.name===varToGet)return checkableProcessVar.value}},ContentFlowActiveTaskCardDisabledComponentController.prototype.checkProcessInstanceProcessVar=function(varToGet,value){for(var vm=this,i=0;i<vm.contentFlowTask.processInstanceResponseData.variables.length;i++){var checkableProcessVar=vm.contentFlowTask.processInstanceResponseData.variables[i];if(checkableProcessVar.name===varToGet)return checkableProcessVar.value==value}},ContentFlowActiveTaskCardDisabledComponentController.prototype.checkCurrentTaskProcessVar=function(varToGet,propertyToGet,value){for(var vm=this,i=0;i<vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++){var checkableProcessVar=vm.contentFlowTask.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i];if(checkableProcessVar.key===varToGet)return checkableProcessVar[propertyToGet].toString()==value}},ContentFlowActiveTaskCardDisabledComponentController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var AltaiContentFlowHistoricTaskCardComponent=function(){function AltaiContentFlowHistoricTaskCardComponent(){this.controller=ContentFlowHistoricTaskCardComponentController,this.bindings={contentFlowTask:"=",languages:"="},this.templateUrl="/api/template/Admin/ContentFlowHistoricTaskCard"}return AltaiContentFlowHistoricTaskCardComponent}();AltaiBusinessProcessFlow.AltaiContentFlowHistoricTaskCardComponent=AltaiContentFlowHistoricTaskCardComponent;var ContentFlowHistoricTaskCardComponentController=function(){function ContentFlowHistoricTaskCardComponentController(businessProcessDefinitionService,businessProcessTaskService,businessProcessInstanceService,contentItemService,contentTypeBusinessProcessLinkService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.commentCreation=!1,this.commentView=!0;var s=this;s.$scope=$scope,this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.businessProcessDefinitionService=businessProcessDefinitionService,this.businessProcessInstanceService=businessProcessInstanceService,this.businessProcessTaskService=businessProcessTaskService,this.getData(),$scope.$on("commentCreated",function(event,comment){s.contentFlowTask.comments.push(comment)}),$scope.$on("commentCreationCancelled",function(event){s.setCommentCreation(!1)})}return ContentFlowHistoricTaskCardComponentController.prototype.toggleCommentCreation=function(){var vm=this;vm.commentCreation=!vm.commentCreation},ContentFlowHistoricTaskCardComponentController.prototype.toggleCommentView=function(){var vm=this;vm.commentView=!vm.commentView},ContentFlowHistoricTaskCardComponentController.prototype.setCommentCreation=function(value){var vm=this;vm.commentCreation=value},ContentFlowHistoricTaskCardComponentController.prototype.setCommentView=function(value){var vm=this;vm.commentView=value},ContentFlowHistoricTaskCardComponentController.prototype.getData=function(){},ContentFlowHistoricTaskCardComponentController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowTaskCommentCreateParentDirective(){return{scope:{contentTypeId:"=",taskInstanceId:"=",languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentFlowTaskCommentCreateParent",controller:ContentFlowTaskCommentCreateDirectiveController,controllerAs:"vm",link:ContentFlowTaskCommentCreateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowTaskCommentCreateParentDirective=AltaiContentFlowTaskCommentCreateParentDirective;var ContentFlowTaskCommentCreateDirectiveLink=function(){function ContentFlowTaskCommentCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContent()},name:"createclose","class":"altai-button-primary",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.cancelContentCreation()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!0}}return ContentFlowTaskCommentCreateDirectiveLink}(),ContentFlowTaskCommentCreateDirectiveController=function(){function ContentFlowTaskCommentCreateDirectiveController($scope,$q,contentItemService,contentFlowTaskInstanceCommentLinkService){this.$scope=$scope,this.$q=$q,this.creating=!1;var s=this;this.contentItemService=contentItemService,this.contentFlowTaskInstanceCommentLinkService=contentFlowTaskInstanceCommentLinkService,$scope.$on("contentcreated",function(event,contentItem){s.contentItem=contentItem,s.createContentFlowTaskInstanceCommentLink()})}return ContentFlowTaskCommentCreateDirectiveController.prototype.createContent=function($scope){var vm=this;vm.$scope.$broadcast("createContent")},ContentFlowTaskCommentCreateDirectiveController.prototype.cancelContentCreation=function($scope){var vm=this;vm.$scope.$emit("commentCreationCancelled")},ContentFlowTaskCommentCreateDirectiveController.prototype.createContentFlowTaskInstanceCommentLink=function(){var vm=this,createModel={TaskInstanceCommentId:vm.contentItem.id,TaskInstanceId:vm.taskInstanceId};vm.contentFlowTaskInstanceCommentLinkService.add(createModel).then(function(result){vm.$scope.$broadcast("commentCreated",result)})},ContentFlowTaskCommentCreateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessCommentCreateParentDirective(){return{scope:{contentTypeId:"=",languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentFlowProcessCommentCreateParent",controller:ContentFlowProcessCommentCreateDirectiveController,controllerAs:"vm",link:ContentFlowProcessCommentCreateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowProcessCommentCreateParentDirective=AltaiContentFlowProcessCommentCreateParentDirective;var ContentFlowProcessCommentCreateDirectiveLink=function(){function ContentFlowProcessCommentCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.createContent()},name:"createclose","class":"altai-button-primary",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.cancelContentCreation()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!0}}return ContentFlowProcessCommentCreateDirectiveLink}(),ContentFlowProcessCommentCreateDirectiveController=function(){function ContentFlowProcessCommentCreateDirectiveController($scope,$q,contentItemService,contentFlowProcessInstanceCommentLinkService){this.$scope=$scope,this.$q=$q,this.creating=!1;var s=this;this.contentItemService=contentItemService,this.contentFlowProcessInstanceCommentLinkService=contentFlowProcessInstanceCommentLinkService,$scope.$on("processinstancecreatedforcommentcreation",function(event,processInstance){s.processInstanceId=processInstance.id,void 0!=s.contentItem&&s.createContentFlowProcessInstanceCommentLink()}),$scope.$on("contentcreated",function(event,contentItem){23==contentItem.contentTypeId&&(s.contentItem=contentItem,void 0!=s.processInstanceId&&0!=s.processInstanceId&&s.createContentFlowProcessInstanceCommentLink())})}return ContentFlowProcessCommentCreateDirectiveController.prototype.createContent=function($scope){var vm=this;vm.$scope.$broadcast("createContent")},ContentFlowProcessCommentCreateDirectiveController.prototype.cancelContentCreation=function($scope){var vm=this;vm.$scope.$emit("commentCreationCancelled")},ContentFlowProcessCommentCreateDirectiveController.prototype.createContentFlowProcessInstanceCommentLink=function(){var vm=this,createModel={TaskInstanceCommentId:vm.contentItem.id,ProcessInstanceId:vm.processInstanceId};vm.contentFlowProcessInstanceCommentLinkService.add(createModel).then(function(result){vm.$scope.$broadcast("commentCreated",result)})},ContentFlowProcessCommentCreateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowUserSelectDirective(){return{scope:{model:"="},templateUrl:"/api/template/ContentFlowAttribute/UserSelectUpdateInner",controller:ContentFlowUserSelectDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowUserSelectDirective=AltaiContentFlowUserSelectDirective;var ContentFlowUserSelectDirectiveController=function(){function ContentFlowUserSelectDirectiveController(userAdminService){var s=this;userAdminService.list().then(function(users){s.users=users;for(var i=0;i<s.users.length;i++)s.users[i].fullName=s.users[i].firstName+" "+s.users[i].lastName})}return ContentFlowUserSelectDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowGroupSelectDirective(){return{scope:{model:"="},templateUrl:"/api/template/ContentFlowAttribute/GroupSelectUpdateInner",controller:ContentFlowGroupSelectDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowGroupSelectDirective=AltaiContentFlowGroupSelectDirective;var ContentFlowGroupSelectDirectiveController=function(){function ContentFlowGroupSelectDirectiveController(groupAdminFactory){var s=this;groupAdminFactory.list().then(function(groups){s.groups=groups})}return ContentFlowGroupSelectDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowConfigureDirective(){return{scope:{languages:"="},templateUrl:"/api/template/Admin/ContentFlowConfigure",controller:ContentFlowConfigureDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowConfigureDirective=AltaiContentFlowConfigureDirective;var ContentFlowConfigureDirectiveController=function(){function ContentFlowConfigureDirectiveController(contentTypeBusinessProcessLinkService,contentFlowProcessDefinitionService,contentTypeService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.contentTypeBusinessProcessLinkService=contentTypeBusinessProcessLinkService,this.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.getData()}return ContentFlowConfigureDirectiveController.prototype.getData=function(){var s=this;this.contentTypeBusinessProcessLinkService.list().then(function(contenttypebusinessprocessdefinitions){s.contenttypebusinessprocessdefinitions=contenttypebusinessprocessdefinitions}),this.contentFlowProcessDefinitionService.list().then(function(businessprocessdefinitions){s.businessprocessdefinitions=businessprocessdefinitions}),this.contentTypeService.list().then(function(contenttypes){s.contenttypes=contenttypes})},ContentFlowConfigureDirectiveController.prototype.createlink=function(link){this.contentTypeBusinessProcessLinkService.add(link).then(function(link){console.log("created link "+link.id)})},ContentFlowConfigureDirectiveController.prototype.updatelink=function(link){this.contentTypeBusinessProcessLinkService.update(link).then(function(link){console.log("updated link "+link.id)})},ContentFlowConfigureDirectiveController.prototype.deletelink=function(link){this.contentTypeBusinessProcessLinkService["delete"](link).then(function(link){console.log("deleted link "+link.id)})},ContentFlowConfigureDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowAttributeUpdateDirective(){return{scope:{model:"=",contentFlowAttribute:"="},replace:!0,templateUrl:"/api/template/Admin/ContentFlowAttributeUpdate",controllerAs:"vm",bindToController:!0,controller:AltaiContentFlowAttributeUpdateDirectiveController}}AltaiBusinessProcessFlow.AltaiContentFlowAttributeUpdateDirective=AltaiContentFlowAttributeUpdateDirective;var AltaiContentFlowAttributeUpdateDirectiveController=function(){function AltaiContentFlowAttributeUpdateDirectiveController(){this.setDefaultValue(),this.template=this.getTemplateUrl()}return AltaiContentFlowAttributeUpdateDirectiveController.prototype.setDefaultValue=function(){this.contentFlowAttribute.hasDefaultValue&&!this.model&&(this.model=this.castDefaultValue())},AltaiContentFlowAttributeUpdateDirectiveController.prototype.castDefaultValue=function(){if(this.contentFlowAttribute.defaultValue)switch(this.contentFlowAttribute.variableType){case"Boolean":return"true"==this.contentFlowAttribute.defaultValue.toLowerCase();case"Integer":return parseInt(this.contentFlowAttribute.defaultValue);default:return this.contentFlowAttribute.defaultValue}},AltaiContentFlowAttributeUpdateDirectiveController.prototype.getTemplateUrl=function(){
var templateUrlBase="/api/template/ContentFlowAttribute/";return this.contentFlowAttribute.editTemplate?templateUrlBase+this.contentFlowAttribute.editTemplate:void 0},AltaiContentFlowAttributeUpdateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessDefinitionDirective(){return{templateUrl:"/api/template/Admin/ContentFlowProcessDefinition",controller:ContentFlowProcessDefinitionDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowProcessDefinitionDirective=AltaiContentFlowProcessDefinitionDirective;var ContentFlowProcessDefinitionDirectiveController=function(){function ContentFlowProcessDefinitionDirectiveController(contentFlowProcessDefinitionService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.getData()}return ContentFlowProcessDefinitionDirectiveController.prototype.getData=function(){var s=this;this.contentFlowProcessDefinitionService.list().then(function(contentflowprocessdefinitions){s.instances=contentflowprocessdefinitions})},ContentFlowProcessDefinitionDirectiveController.prototype.deleteAllProcessDefinitions=function(){var vm=this;vm.contentFlowProcessDefinitionService.deleteAll().then(function(result){vm.instances=[]})},ContentFlowProcessDefinitionDirectiveController.prototype.importProcessDefinitions=function(){var vm=this;vm.contentFlowProcessDefinitionService["import"]().then(function(result){vm.instances=result})},ContentFlowProcessDefinitionDirectiveController.prototype.importTasksForContentFlowProcessDefinition=function(ContentFlowProcessDefinitionId){var vm=this;vm.contentFlowProcessDefinitionService.importTasksForContentFlowProcessDefinition(ContentFlowProcessDefinitionId).then(function(result){})},ContentFlowProcessDefinitionDirectiveController.prototype.openProcess=function(ContentFlowProcessDefinitionId){this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowSingleProcessDefinition,"Contentflow Process Definition",ContentFlowProcessDefinitionId)},ContentFlowProcessDefinitionDirectiveController.prototype.create=function(item){this.contentFlowProcessDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowProcessDefinitionDirectiveController.prototype.update=function(item){this.contentFlowProcessDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowProcessDefinitionDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowProcessDefinitionDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessStartVariableDefinitionCreateDirective(){return{scope:{contentFlowProcessDefinitionId:"="},templateUrl:"/api/template/Admin/ContentFlowProcessStartVariableDefinitionCreate",controller:ContentFlowProcessStartVariableDefinitionCreateDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowProcessStartVariableDefinitionCreateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowProcessStartVariableDefinitionCreateDirective=AltaiContentFlowProcessStartVariableDefinitionCreateDirective;var ContentFlowProcessStartVariableDefinitionCreateDirectiveLink=function(){function ContentFlowProcessStartVariableDefinitionCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.create(scope.vm.item)},name:"createclose","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowProcessStartVariableDefinitionCreateDirectiveLink}(),ContentFlowProcessStartVariableDefinitionCreateDirectiveController=function(){function ContentFlowProcessStartVariableDefinitionCreateDirectiveController(contentFlowProcessStartVariableDefinitionService,contentAttributeService,$templateFactory,contentCollectionManager,contentFlowProcessDefinitionService,wmContainerFactory,altaiConfirmationService){this.contentAttributeService=contentAttributeService,this.$templateFactory=$templateFactory,this.item={},this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;var vm=this;vm.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,vm.contentFlowProcessStartVariableDefinitionService=contentFlowProcessStartVariableDefinitionService,vm.contentCollectionService=contentCollectionManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,vm.item.contentFlowProcessDefinitionId=vm.contentFlowProcessDefinitionId,vm.templateFactory=$templateFactory,vm.getData()}return ContentFlowProcessStartVariableDefinitionCreateDirectiveController.prototype.getData=function(){var vm=this;vm.templateFactory.listTemplateByTypeName("ContentFlowAttribute").then(function(contentRelationTemplates){vm.contentRelationTemplates=contentRelationTemplates}),vm.contentCollectionService.list().then(function(contentCollections){vm.contentCollections=contentCollections}),vm.contentAttributeService.listAttributeType().then(function(result){vm.variableTypes=result})},ContentFlowProcessStartVariableDefinitionCreateDirectiveController.prototype.create=function(item){this.contentFlowProcessStartVariableDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowProcessStartVariableDefinitionCreateDirectiveController.prototype.update=function(item){this.contentFlowProcessStartVariableDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowProcessStartVariableDefinitionCreateDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessStartVariableDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowProcessStartVariableDefinitionCreateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessStartVariableDefinitionUpdateDirective(){return{scope:{contentFlowProcessStartVariableId:"="},templateUrl:"/api/template/Admin/ContentFlowProcessStartVariableDefinitionCreate",controller:ContentFlowProcessStartVariableDefinitionUpdateDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowProcessStartVariableDefinitionUpdateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowProcessStartVariableDefinitionUpdateDirective=AltaiContentFlowProcessStartVariableDefinitionUpdateDirective;var ContentFlowProcessStartVariableDefinitionUpdateDirectiveLink=function(){function ContentFlowProcessStartVariableDefinitionUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.update(scope.vm.item)},name:"createclose","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowProcessStartVariableDefinitionUpdateDirectiveLink}(),ContentFlowProcessStartVariableDefinitionUpdateDirectiveController=function(){function ContentFlowProcessStartVariableDefinitionUpdateDirectiveController(contentFlowProcessStartVariableDefinitionService,contentAttributeService,$templateFactory,contentCollectionManager,contentFlowProcessDefinitionService,wmContainerFactory,altaiConfirmationService){this.contentAttributeService=contentAttributeService,this.$templateFactory=$templateFactory,this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;var vm=this;vm.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,vm.contentFlowProcessStartVariableDefinitionService=contentFlowProcessStartVariableDefinitionService,vm.contentCollectionService=contentCollectionManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,vm.templateFactory=$templateFactory,vm.getData()}return ContentFlowProcessStartVariableDefinitionUpdateDirectiveController.prototype.getData=function(){var vm=this;vm.contentFlowProcessStartVariableDefinitionService.getById(vm.contentFlowProcessStartVariableId).then(function(result){vm.item=result}),vm.templateFactory.listTemplateByTypeName("ContentFlowAttribute").then(function(contentRelationTemplates){vm.contentRelationTemplates=contentRelationTemplates}),vm.contentCollectionService.list().then(function(contentCollections){vm.contentCollections=contentCollections}),vm.contentAttributeService.listAttributeType().then(function(result){vm.variableTypes=result})},ContentFlowProcessStartVariableDefinitionUpdateDirectiveController.prototype.create=function(item){this.contentFlowProcessStartVariableDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowProcessStartVariableDefinitionUpdateDirectiveController.prototype.update=function(item){this.contentFlowProcessStartVariableDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowProcessStartVariableDefinitionUpdateDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessStartVariableDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowProcessStartVariableDefinitionUpdateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessVariableDefinitionCreateDirective(){return{scope:{contentFlowTaskDefinitionId:"="},templateUrl:"/api/template/Admin/ContentFlowProcessStartVariableDefinitionCreate",controller:ContentFlowProcessVariableDefinitionCreateDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowProcessVariableDefinitionCreateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowProcessVariableDefinitionCreateDirective=AltaiContentFlowProcessVariableDefinitionCreateDirective;var ContentFlowProcessVariableDefinitionCreateDirectiveLink=function(){function ContentFlowProcessVariableDefinitionCreateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.create(scope.vm.item)},name:"createclose","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowProcessVariableDefinitionCreateDirectiveLink}(),ContentFlowProcessVariableDefinitionCreateDirectiveController=function(){function ContentFlowProcessVariableDefinitionCreateDirectiveController(contentFlowProcessVariableDefinitionService,contentFlowTaskDefinitionService,contentAttributeService,$templateFactory,contentCollectionManager,contentFlowProcessDefinitionService,wmContainerFactory,altaiConfirmationService){this.contentAttributeService=contentAttributeService,this.$templateFactory=$templateFactory,this.item={},this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;var vm=this;vm.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,vm.contentFlowTaskDefinitionService=contentFlowTaskDefinitionService,vm.contentFlowProcessVariableDefinitionService=contentFlowProcessVariableDefinitionService,vm.contentCollectionService=contentCollectionManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,vm.item.contentFlowTaskDefinitionId=vm.contentFlowTaskDefinitionId,vm.templateFactory=$templateFactory,vm.getData()}return ContentFlowProcessVariableDefinitionCreateDirectiveController.prototype.getData=function(){var vm=this;vm.templateFactory.listTemplateByTypeName("ContentFlowAttribute").then(function(contentRelationTemplates){vm.contentRelationTemplates=contentRelationTemplates}),vm.contentCollectionService.list().then(function(contentCollections){vm.contentCollections=contentCollections}),vm.contentAttributeService.listAttributeType().then(function(result){vm.variableTypes=result})},ContentFlowProcessVariableDefinitionCreateDirectiveController.prototype.create=function(item){this.contentFlowProcessVariableDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowProcessVariableDefinitionCreateDirectiveController.prototype.update=function(item){this.contentFlowProcessVariableDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowProcessVariableDefinitionCreateDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessVariableDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowProcessVariableDefinitionCreateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowProcessVariableDefinitionUpdateDirective(){return{scope:{contentFlowProcessVariableId:"="},templateUrl:"/api/template/Admin/ContentFlowProcessStartVariableDefinitionCreate",controller:ContentFlowProcessVariableDefinitionUpdateDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowProcessVariableDefinitionUpdateDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowProcessVariableDefinitionUpdateDirective=AltaiContentFlowProcessVariableDefinitionUpdateDirective;var ContentFlowProcessVariableDefinitionUpdateDirectiveLink=function(){function ContentFlowProcessVariableDefinitionUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.update(scope.vm.item)},name:"createclose","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowProcessVariableDefinitionUpdateDirectiveLink}(),ContentFlowProcessVariableDefinitionUpdateDirectiveController=function(){function ContentFlowProcessVariableDefinitionUpdateDirectiveController(contentFlowProcessVariableDefinitionService,contentAttributeService,$templateFactory,contentCollectionManager,contentFlowProcessDefinitionService,wmContainerFactory,altaiConfirmationService){this.contentAttributeService=contentAttributeService,this.$templateFactory=$templateFactory,this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;var vm=this;vm.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,vm.contentFlowProcessVariableDefinitionService=contentFlowProcessVariableDefinitionService,vm.contentCollectionService=contentCollectionManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,vm.templateFactory=$templateFactory,vm.getData()}return ContentFlowProcessVariableDefinitionUpdateDirectiveController.prototype.getData=function(){var vm=this;vm.contentFlowProcessVariableDefinitionService.getById(vm.contentFlowProcessVariableId).then(function(result){vm.item=result}),vm.templateFactory.listTemplateByTypeName("ContentFlowAttribute").then(function(contentRelationTemplates){vm.contentRelationTemplates=contentRelationTemplates}),vm.contentCollectionService.list().then(function(contentCollections){vm.contentCollections=contentCollections}),vm.contentAttributeService.listAttributeType().then(function(result){vm.variableTypes=result})},ContentFlowProcessVariableDefinitionUpdateDirectiveController.prototype.create=function(item){this.contentFlowProcessVariableDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowProcessVariableDefinitionUpdateDirectiveController.prototype.update=function(item){this.contentFlowProcessVariableDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowProcessVariableDefinitionUpdateDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessVariableDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowProcessVariableDefinitionUpdateDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowTaskDefinitionDirective(){return{scope:{contentFlowTaskDefinitionId:"="},templateUrl:"/api/template/Admin/ContentFlowTaskDefinition",controller:ContentFlowTaskDefinitionDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowTaskDefinitionDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowTaskDefinitionDirective=AltaiContentFlowTaskDefinitionDirective;var ContentFlowTaskDefinitionDirectiveLink=function(){function ContentFlowTaskDefinitionDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.update(scope.vm.contentFlowTaskDefinition)},name:"save","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowTaskDefinitionDirectiveLink}(),ContentFlowTaskDefinitionDirectiveController=function(){function ContentFlowTaskDefinitionDirectiveController(contentFlowProcessVariableDefinitionService,contentFlowTaskDefinitionService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.contentFlowTaskDefinitionService=contentFlowTaskDefinitionService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentFlowProcessVariableDefinitionService=contentFlowProcessVariableDefinitionService,this.getData()}return ContentFlowTaskDefinitionDirectiveController.prototype.createVariable=function(){var vm=this;this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowProcessVariableDefinitionCreate,"Create Process Variable",vm.contentFlowTaskDefinitionId)},ContentFlowTaskDefinitionDirectiveController.prototype.deleteVariable=function(variable){this.contentFlowProcessVariableDefinitionService["delete"](variable).then(function(result){})},ContentFlowTaskDefinitionDirectiveController.prototype.editVariable=function(contentFlowProcessVariableId){this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowProcessVariableDefinitionUpdate,"Edit Process Variable",contentFlowProcessVariableId)},ContentFlowTaskDefinitionDirectiveController.prototype.deleteAllVariables=function(){for(var vm=this,i=0;i<vm.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet.length;i++)vm.deleteVariable(vm.contentFlowTaskDefinition.contentFlowProcessVariableDefinitionsToSet[i])},ContentFlowTaskDefinitionDirectiveController.prototype.getData=function(){var s=this;this.contentFlowTaskDefinitionService.getById(s.contentFlowTaskDefinitionId).then(function(contentFlowTaskDefinition){s.contentFlowTaskDefinition=contentFlowTaskDefinition})},ContentFlowTaskDefinitionDirectiveController.prototype.create=function(item){this.contentFlowTaskDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowTaskDefinitionDirectiveController.prototype.update=function(item){this.contentFlowTaskDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowTaskDefinitionDirectiveController.prototype["delete"]=function(item){this.contentFlowTaskDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowTaskDefinitionDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowSingleProcessDefinitionDirective(){return{scope:{contentFlowProcessDefinitionId:"="},templateUrl:"/api/template/Admin/ContentFlowSingleProcessDefinition",controller:ContentFlowSingleProcessDefinitionDirectiveController,controllerAs:"vm",bindToController:!0,link:ContentFlowSingleProcessDefinitionDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowSingleProcessDefinitionDirective=AltaiContentFlowSingleProcessDefinitionDirective;var ContentFlowSingleProcessDefinitionDirectiveLink=function(){function ContentFlowSingleProcessDefinitionDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.update(scope.vm.contentFlowProcessDefinition)},name:"save","class":"altai-button-go",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowSingleProcessDefinitionDirectiveLink}(),ContentFlowSingleProcessDefinitionDirectiveController=function(){function ContentFlowSingleProcessDefinitionDirectiveController(contentFlowProcessStartVariableDefinitionService,contentFlowProcessDefinitionService,contentFlowTaskDefinitionService,wmContainerFactory,altaiConfirmationService){this.pageNr=0,this.sorterAttr="Id",this.sorterDesc=!0;this.contentFlowProcessDefinitionService=contentFlowProcessDefinitionService,this.contentFlowTaskDefinitionService=contentFlowTaskDefinitionService,this.contentFlowProcessStartVariableDefinitionService=contentFlowProcessStartVariableDefinitionService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.getData()}return ContentFlowSingleProcessDefinitionDirectiveController.prototype.getData=function(){var s=this;this.contentFlowProcessDefinitionService.getById(s.contentFlowProcessDefinitionId).then(function(contentFlowProcessDefinition){s.contentFlowProcessDefinition=contentFlowProcessDefinition})},ContentFlowSingleProcessDefinitionDirectiveController.prototype.openTask=function(ContentFlowTaskDefinitionId){this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowTaskDefinition,"Contentflow Task Definition",ContentFlowTaskDefinitionId)},ContentFlowSingleProcessDefinitionDirectiveController.prototype.deleteTask=function(contentFlowTaskDefinition){var vm=this;vm.contentFlowTaskDefinitionService["delete"](contentFlowTaskDefinition)},ContentFlowSingleProcessDefinitionDirectiveController.prototype.importTasksForContentFlowProcessDefinition=function(){var vm=this;vm.contentFlowProcessDefinitionService.importTasksForContentFlowProcessDefinition(vm.contentFlowProcessDefinitionId).then(function(result){vm.contentFlowProcessDefinition.contentFlowTaskDefinitions=result})},ContentFlowSingleProcessDefinitionDirectiveController.prototype.createVariable=function(){var vm=this;this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowProcessStartVariableDefinitionCreate,"Create Process Start Variable",vm.contentFlowProcessDefinitionId)},ContentFlowSingleProcessDefinitionDirectiveController.prototype.editVariable=function(contentFlowProcessStartVariableId){this.wmContainerFactory.createWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowProcessStartVariableDefinitionUpdate,"Edit Process Start Variable",contentFlowProcessStartVariableId)},ContentFlowSingleProcessDefinitionDirectiveController.prototype.deleteVariable=function(variable){this.contentFlowProcessStartVariableDefinitionService["delete"](variable).then(function(result){})},ContentFlowSingleProcessDefinitionDirectiveController.prototype.deleteTasksForContentFlowProcessDefinition=function(){for(var vm=this,i=0;i<vm.contentFlowProcessDefinition.contentFlowTaskDefinitions.length;i++)vm.contentFlowTaskDefinitionService["delete"](vm.contentFlowProcessDefinition.contentFlowTaskDefinitions[i])},ContentFlowSingleProcessDefinitionDirectiveController.prototype.deleteVariablesForContentFlowProcessDefinition=function(){for(var vm=this,i=0;i<vm.contentFlowProcessDefinition.contentFlowProcessStartVariableDefinitions.length;i++)vm.contentFlowProcessStartVariableDefinitionService["delete"](vm.contentFlowProcessDefinition.contentFlowProcessStartVariableDefinitions[i])},ContentFlowSingleProcessDefinitionDirectiveController.prototype.create=function(item){this.contentFlowProcessDefinitionService.add(item).then(function(item){console.log("created item "+item.id)})},ContentFlowSingleProcessDefinitionDirectiveController.prototype.update=function(item){this.contentFlowProcessDefinitionService.update(item).then(function(item){console.log("updated item "+item.id)})},ContentFlowSingleProcessDefinitionDirectiveController.prototype["delete"]=function(item){this.contentFlowProcessDefinitionService["delete"](item).then(function(link){console.log("deleted item "+item.id)})},ContentFlowSingleProcessDefinitionDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowContentItemUpdateParentDirective(){return{scope:{contentFlowTask:"=",languages:"="},templateUrl:"/api/template/Admin/ContentFlowContentItemUpdateParent",controller:ContentFlowContentItemUpdateParentDirectiveController,link:ContentFlowContentItemCreateParentDirectiveLink,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowContentItemUpdateParentDirective=AltaiContentFlowContentItemUpdateParentDirective;var ContentFlowContentItemCreateParentDirectiveLink=function(){function ContentFlowContentItemCreateParentDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-ray-start-arrow",action:function(){scope.vm.saveAndFinishTask()},name:"save_and_finish_task","class":"altai-button-go",disableByFormValidity:scope.contentItemUpdateForm,separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.updateContent()},name:"createclose","class":"altai-button-primary",disableByFormValidity:scope.contentItemUpdateForm,separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.updateContentDraft()},"class":"altai-button-primary",name:"createdraft",separator:!0},{icon:"mdi-plus-circle-multiple-outline",action:function(){scope.vm.openPreviewWindow()},"class":"altai-button-primary",name:"preview",separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowContentItemCreateParentDirectiveLink}(),ContentFlowContentItemUpdateParentDirectiveController=function(){function ContentFlowContentItemUpdateParentDirectiveController(contentFlowTaskInstanceFullCreationModelService,contentItemBusinessProcessInstanceLinkService,$scope,$q,contentItemService,wmContainerFactory){this.$scope=$scope,this.$q=$q,this.creating=!1;var s=this;this.contentFlowTask;s.wmContainerFactory=wmContainerFactory,s.contentItemService=contentItemService,s.contentFlowTaskInstanceFullCreationModelService=contentFlowTaskInstanceFullCreationModelService,s.maximizeWindow(),$scope.$on("contentProvided",function(event,updatedContentItemModel){23!=updatedContentItemModel.contentTypeId&&(s.updatedContentItemModel=updatedContentItemModel,s.tryFinishTask())}),$scope.$on("taskFinishModelProvided",function(result,taskFinishModel){s.taskFinishModel=taskFinishModel,s.tryFinishTask()})}return ContentFlowContentItemUpdateParentDirectiveController.prototype.tryFinishTask=function(){var vm=this;if(void 0!=vm.updatedContentItemModel&&void 0!=vm.taskFinishModel){var updateModel={taskId:vm.taskFinishModel.taskId,businessProcessTaskActionModel:vm.taskFinishModel,newContent:vm.updatedContentItemModel};vm.contentFlowTaskInstanceFullCreationModelService.add(updateModel).then(function(){console.log("all ok")})}},ContentFlowContentItemUpdateParentDirectiveController.prototype.getData=function(){},ContentFlowContentItemUpdateParentDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate);s.wmContainerFactory.destroyWindow(currentWin.id)},ContentFlowContentItemUpdateParentDirectiveController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},ContentFlowContentItemUpdateParentDirectiveController.prototype.minimizeWindow=function(){this.wmContainerFactory.removeFocusOnWindow()},ContentFlowContentItemUpdateParentDirectiveController.prototype.updateContentItemModel=function(){var vm=this;vm.$scope.$broadcast("updateContentItemModel")},ContentFlowContentItemUpdateParentDirectiveController.prototype.updateContentData=function(){var vm=this;vm.$scope.$broadcast("updateContentData")},ContentFlowContentItemUpdateParentDirectiveController.prototype.updateContent=function(){var vm=this;vm.$scope.$broadcast("updateContent"),vm.closeWindow()},ContentFlowContentItemUpdateParentDirectiveController.prototype.updateContentDraft=function(){var vm=this;vm.$scope.$broadcast("updateContentDraft")},ContentFlowContentItemUpdateParentDirectiveController.prototype.openContentItem=function(contentItem){var vm=this;vm.$scope.$broadcast("openContentItem")},ContentFlowContentItemUpdateParentDirectiveController.prototype.saveAndFinishTask=function(){var vm=this;vm.$scope.$broadcast("provideContent"),vm.$scope.$broadcast("finishtask");var currentWin=vm.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemUpdate);vm.wmContainerFactory.destroyWindow(currentWin.id)},ContentFlowContentItemUpdateParentDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowTaskCommentUpdateParentDirective(){return{scope:{contentFlowComment:"=",languages:"="},templateUrl:"/api/template/Admin/ContentflowTaskCommentUpdateParent",controller:ContentFlowTaskCommentUpdateParentDirectiveController,link:ContentFlowTaskCommentUpdateParentDirectiveLink,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowTaskCommentUpdateParentDirective=AltaiContentFlowTaskCommentUpdateParentDirective;var ContentFlowTaskCommentUpdateParentDirectiveLink=function(){function ContentFlowTaskCommentUpdateParentDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateContent()},name:"createclose","class":"altai-button-primary",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.cancelContentUpdate()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!0}}return ContentFlowTaskCommentUpdateParentDirectiveLink}(),ContentFlowTaskCommentUpdateParentDirectiveController=function(){function ContentFlowTaskCommentUpdateParentDirectiveController(contentItemBusinessProcessInstanceLinkService,$scope,$q,contentItemService,wmContainerFactory){this.$scope=$scope,this.$q=$q,this.creating=!1;var s=this;s.wmContainerFactory=wmContainerFactory,s.contentItemService=contentItemService,$scope.$on("contentupdated",function(event,args){s.$scope.$emit("commentUpdated",s.contentItemId)})}return ContentFlowTaskCommentUpdateParentDirectiveController.prototype.getData=function(){},ContentFlowTaskCommentUpdateParentDirectiveController.prototype.updateContent=function(){var vm=this;vm.$scope.$broadcast("updateContent")},ContentFlowTaskCommentUpdateParentDirectiveController.prototype.cancelContentUpdate=function(){var vm=this;vm.$scope.$emit("commentUpdateCancelled")},ContentFlowTaskCommentUpdateParentDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowContentItemCreateParentDirective(){return{scope:{contentTypeId:"=",languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ContentFlowContentItemCreateParent",
controller:ContentFlowContentItemCreateParentDirectiveController,controllerAs:"vm",link:ContentFlowContentItemCreateParentDirectiveLink}}AltaiBusinessProcessFlow.AltaiContentFlowContentItemCreateParentDirective=AltaiContentFlowContentItemCreateParentDirective;var ContentFlowContentItemCreateParentDirectiveLink=function(){function ContentFlowContentItemCreateParentDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-ray-start-arrow",action:function(){scope.vm.startFlow()},name:"saveandstartflow","class":"altai-button-go",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.createContent()},name:"createclose","class":"altai-button-primary",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-content-save",action:function(){scope.vm.createContentAndEdit()},"class":"altai-button-primary",name:"createdraft",separator:!0},{icon:"mdi-library-plus",action:function(){scope.vm.createContentAndKeepCreating()},"class":"altai-button-primary",name:"createandrecreate",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-plus-circle-multiple-outline",action:function(){scope.vm.createContentAndPreview()},"class":"altai-button-primary",name:"createandpreview",disableByFormValidity:scope.contentItemCreateForm,separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ContentFlowContentItemCreateParentDirectiveLink}(),ContentFlowContentItemCreateParentDirectiveController=function(){function ContentFlowContentItemCreateParentDirectiveController(contentFlowProcessInstanceFullCreationModelService,contentItemBusinessProcessInstanceLinkService,$scope,$q,contentItemService,contentTypeService,wmContainerFactory){this.$scope=$scope,this.$q=$q,this.contentTypeService=contentTypeService,this.contentTypes=[],this.creating=!1,this.commentCreation=!0,this.variableListEnriched=!1;var vm=this;vm.contentItemBusinessProcessInstanceLinkService=contentItemBusinessProcessInstanceLinkService,vm.wmContainerFactory=wmContainerFactory,vm.contentFlowProcessInstanceFullCreationModelService=contentFlowProcessInstanceFullCreationModelService,vm.contentTypeService=contentTypeService,vm.maximizeWindow(),$scope.$on("contentProvided",function(event,contentItem){23!=contentItem.contentTypeId?vm.contentItem=contentItem:vm.comment=contentItem,vm.tryFinishProcessCreation()}),$scope.$on("processCreationModelProvided",function(event,processCreationModel){vm.processCreationModel=processCreationModel,vm.tryFinishProcessCreation()}),$scope.$on("commentCreationChanged",function(event,value){vm.commentCreation=value})}return ContentFlowContentItemCreateParentDirectiveController.prototype.tryEnrichVariableList=function(){var vm=this;if(void 0!=vm.processCreationModel&&void 0!=vm.contentItem){for(var i=0;i<vm.contentItem.contentItemAttributes.length;i++){var attribute=vm.contentItem.contentItemAttributes[i];if(vm.processCreationModel.variables.push({name:"itemvar_"+attribute.contentTypeAttribute.attribute.name,value:attribute.value}),void 0!=attribute.translatable&&void 0!=attribute.translatable.translatableValues)for(var j=0;j<attribute.translatable.translatableValues.length;j++)vm.processCreationModel.variables.push({name:"itemvar_"+attribute.contentTypeAttribute.attribute.name+"."+attribute.translatable.translatableValues[j].languageCode,value:attribute.translatable.translatableValues[j].value})}vm.variableListEnriched=!0}},ContentFlowContentItemCreateParentDirectiveController.prototype.tryFinishProcessCreation=function(){var vm=this;if(void 0!=vm.processCreationModel&&void 0!=vm.contentItem&&void 0!=vm.comment){var creationModel;creationModel=vm.commentCreation?{newContent:vm.contentItem,newComment:vm.comment,processInstanceRequestData:vm.processCreationModel,publishDate:vm.processCreationModel.publishDate,unpublishDate:vm.processCreationModel.unpublishDate,publishImmediately:vm.processCreationModel.publishImmediately,doNotSpecifyUnpublishDate:vm.processCreationModel.doNotSpecifyUnpublishDate}:{newContent:vm.contentItem,processInstanceRequestData:vm.processCreationModel,publishDate:vm.processCreationModel.publishDate,unpublishDate:vm.processCreationModel.unpublishDate,publishImmediately:vm.processCreationModel.publishImmediately,doNotSpecifyUnpublishDate:vm.processCreationModel.doNotSpecifyUnpublishDate},vm.contentFlowProcessInstanceFullCreationModelService.add(creationModel).then(function(){console.log("all created")})}},ContentFlowContentItemCreateParentDirectiveController.prototype.setContentItemId=function(contentItem){var vm=this;vm.contentItemId=contentItem.id},ContentFlowContentItemCreateParentDirectiveController.prototype.setProcessInstanceId=function(processInstance){var vm=this;vm.processInstanceId=processInstance.id},ContentFlowContentItemCreateParentDirectiveController.prototype.createContentItemBusinessProcessInstanceLink=function(){var vm=this,linkToAdd={contentItemId:vm.contentItemId,businessProcessInstanceId:vm.processInstanceId};vm.contentItemBusinessProcessInstanceLinkService.add(linkToAdd).then(function(result){})},ContentFlowContentItemCreateParentDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemCreate);s.wmContainerFactory.destroyWindow(currentWin.id)},ContentFlowContentItemCreateParentDirectiveController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemCreate,this.contentTypeId);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},ContentFlowContentItemCreateParentDirectiveController.prototype.minimizeWindow=function(){this.wmContainerFactory.removeFocusOnWindow()},ContentFlowContentItemCreateParentDirectiveController.prototype.createContent=function($scope){var vm=this;vm.$scope.$broadcast("createContent"),vm.minimizeWindow(),vm.closeWindow()},ContentFlowContentItemCreateParentDirectiveController.prototype.createContentAndKeepCreating=function($scope){var vm=this;vm.$scope.$broadcast("createContentAndKeepCreating")},ContentFlowContentItemCreateParentDirectiveController.prototype.createContentAndEdit=function(){var vm=this;vm.$scope.$broadcast("createContentAndEdit")},ContentFlowContentItemCreateParentDirectiveController.prototype.createContentAndPreview=function(){var vm=this;vm.$scope.$broadcast("createContentAndPreview")},ContentFlowContentItemCreateParentDirectiveController.prototype.startFlow=function(){var vm=this;vm.$scope.$broadcast("provideContent"),vm.$scope.$broadcast("provideProcessCreationModel");var currentWin=vm.wmContainerFactory.findWindow(AltaiBusinessProcessFlow.BusinessProcessFlowWindows.contentFlowContentItemCreate);vm.wmContainerFactory.destroyWindow(currentWin.id)},ContentFlowContentItemCreateParentDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentflowPublishCalendarDirective(){return{scope:{languages:"="},templateUrl:"/api/template/Admin/ContentFlowPublishCalendar",controller:ContentFlowPublishCalendarDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentflowPublishCalendarDirective=AltaiContentflowPublishCalendarDirective;var ContentFlowPublishCalendarDirectiveController=function(){function ContentFlowPublishCalendarDirectiveController(contentFlowActiveProcessInstanceService){this.contentFlowActiveProcessInstanceService=contentFlowActiveProcessInstanceService,this.getData()}return ContentFlowPublishCalendarDirectiveController.prototype.getData=function(){var s=this;s.contentFlowActiveProcessInstanceService.getActiveProcessesForCurrentUserAsInvolvedUser().then(function(result){s.processes=result})},ContentFlowPublishCalendarDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){function AltaiContentFlowSingleProcessDirective(){return{scope:{process:"="},templateUrl:"/api/template/Admin/singlecontentflowprocess",controller:ContentFlowSingleProcessDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBusinessProcessFlow.AltaiContentFlowSingleProcessDirective=AltaiContentFlowSingleProcessDirective;var ContentFlowSingleProcessDirectiveController=function(){function ContentFlowSingleProcessDirectiveController(contentFlowActiveProcessInstanceService){var vm=this;vm.contentFlowActiveProcessInstanceService=contentFlowActiveProcessInstanceService}return ContentFlowSingleProcessDirectiveController.prototype.update=function(){var vm=this,updateModel=[];updateModel.push({name:"processvar_publishdate",value:vm.process.contentItemBusinessProcessLink.publishDate}),updateModel.push({name:"processvar_unpublishdate",value:vm.process.contentItemBusinessProcessLink.unpublishDate}),updateModel.push({name:"processvar_publishimmediately",value:vm.process.contentItemBusinessProcessLink.publishImmediately}),updateModel.push({name:"processvar_donotspecifyunpublishdate",value:vm.process.contentItemBusinessProcessLink.doNotSpecifyUnpublishDate}),this.contentFlowActiveProcessInstanceService.updateProcess(vm.process.processInstanceResponseData.id,updateModel).then(function(item){console.log("updated process instance "+item)})},ContentFlowSingleProcessDirectiveController}()}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowHistoricTaskInstanceService=function(_super){function ContentFlowHistoricTaskInstanceService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowhistorictaskinstance","Content Flow Historic Task Instance",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowHistoricTaskInstanceService,_super),ContentFlowHistoricTaskInstanceService.prototype.updateTask=function(updateModel){var s=this,d=s.$q.defer();return s.$http.put(s.apiUrl,updateModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowHistoricTaskInstanceService.prototype.getHistoricTasksForProcessInstance=function(processInstanceId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+processInstanceId).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowHistoricTaskInstanceService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowHistoricTaskInstanceService=ContentFlowHistoricTaskInstanceService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowTaskInstanceCommentLinkService=function(_super){function ContentFlowTaskInstanceCommentLinkService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowtaskinstancecommentlink","Content Flow Task Instance Comment Link",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowTaskInstanceCommentLinkService,_super),ContentFlowTaskInstanceCommentLinkService.prototype.search=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/contentitembusinessprocessinstancelink/search",searchModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowTaskInstanceCommentLinkService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowTaskInstanceCommentLinkService=ContentFlowTaskInstanceCommentLinkService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowProcessInstanceCommentLinkService=function(_super){function ContentFlowProcessInstanceCommentLinkService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowprocessinstancecommentlink","Content Flow Process Instance Comment Link",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowProcessInstanceCommentLinkService,_super),ContentFlowProcessInstanceCommentLinkService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowProcessInstanceCommentLinkService=ContentFlowProcessInstanceCommentLinkService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowProcessInstanceFullCreationModelService=function(_super){function ContentFlowProcessInstanceFullCreationModelService($http,altaiHttp,$q,altaiNotificationFactory,businessProcessTaskService){var _this=_super.call(this,"api/contentflowprocessinstancefullcreationmodel","Content Flow Process Instance Full Creation Model",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.businessProcessTaskService=businessProcessTaskService,_this}return __extends(ContentFlowProcessInstanceFullCreationModelService,_super),ContentFlowProcessInstanceFullCreationModelService.prototype.add=function(newItem){var s=this,d=this.$q.defer();return _super.prototype.add.call(this,newItem).then(function(result){s.businessProcessTaskService.resetData(),d.resolve(result)}),d.promise},ContentFlowProcessInstanceFullCreationModelService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowProcessInstanceFullCreationModelService=ContentFlowProcessInstanceFullCreationModelService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowTaskInstanceFullCreationModelService=function(_super){function ContentFlowTaskInstanceFullCreationModelService($http,altaiHttp,$q,altaiNotificationFactory,businessProcessTaskService){var _this=_super.call(this,"api/contentflowtaskinstancefullcreationmodel","Content Flow Task Instance Full Creation Model",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.businessProcessTaskService=businessProcessTaskService,_this}return __extends(ContentFlowTaskInstanceFullCreationModelService,_super),ContentFlowTaskInstanceFullCreationModelService.prototype.add=function(newItem){var s=this,d=this.$q.defer();return _super.prototype.add.call(this,newItem).then(function(result){s.businessProcessTaskService.resetData(),d.resolve(result)}),d.promise},ContentFlowTaskInstanceFullCreationModelService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowTaskInstanceFullCreationModelService=ContentFlowTaskInstanceFullCreationModelService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentTypeBusinessProcessLinkService=function(_super){function ContentTypeBusinessProcessLinkService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contenttypebusinessprocesslink","Content Type Business Process link",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentTypeBusinessProcessLinkService,_super),ContentTypeBusinessProcessLinkService.prototype.search=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/contenttypebusinessprocesslink/search",searchModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentTypeBusinessProcessLinkService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentTypeBusinessProcessLinkService=ContentTypeBusinessProcessLinkService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentItemBusinessProcessInstanceLinkService=function(_super){function ContentItemBusinessProcessInstanceLinkService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentitembusinessprocessinstancelink","Content Item Business Process Instance link",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentItemBusinessProcessInstanceLinkService,_super),ContentItemBusinessProcessInstanceLinkService.prototype.search=function(searchModel){var s=this,d=s.$q.defer();return s.$http.post(config.backendUrl+"/api/contentitembusinessprocessinstancelink/search",searchModel).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentItemBusinessProcessInstanceLinkService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentItemBusinessProcessInstanceLinkService=ContentItemBusinessProcessInstanceLinkService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowActivitiBusinessProcessDefinitionsService=function(_super){function ContentFlowActivitiBusinessProcessDefinitionsService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowactivitibusinessprocessdefinitions","Content Flow Business Process Definitions",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowActivitiBusinessProcessDefinitionsService,_super),ContentFlowActivitiBusinessProcessDefinitionsService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowActivitiBusinessProcessDefinitionsService=ContentFlowActivitiBusinessProcessDefinitionsService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowProcessDefinitionService=function(_super){function ContentFlowProcessDefinitionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowprocessdefinition","Content Flow Business Process Definitions",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowProcessDefinitionService,_super),ContentFlowProcessDefinitionService.prototype["import"]=function(){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/import").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowProcessDefinitionService.prototype.importTasksForContentFlowProcessDefinition=function(ContentFlowProcessDefinitionId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+ContentFlowProcessDefinitionId+"/tasks/import").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowProcessDefinitionService.prototype.deleteAll=function(){var s=this,d=s.$q.defer();return s.$http["delete"](s.apiUrl).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowProcessDefinitionService.prototype.listTasks=function(ContentFlowProcessDefinitionId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+ContentFlowProcessDefinitionId+"/tasks").then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowProcessDefinitionService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowProcessDefinitionService=ContentFlowProcessDefinitionService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowProcessVariableDefinitionService=function(_super){function ContentFlowProcessVariableDefinitionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowprocessvariabledefinition","Content Flow Process Variable Definitions",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowProcessVariableDefinitionService,_super),ContentFlowProcessVariableDefinitionService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowProcessVariableDefinitionService=ContentFlowProcessVariableDefinitionService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowProcessStartVariableDefinitionService=function(_super){function ContentFlowProcessStartVariableDefinitionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowprocessstartvariabledefinition","Content Flow Process Start Variable Definitions",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowProcessStartVariableDefinitionService,_super),ContentFlowProcessStartVariableDefinitionService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowProcessStartVariableDefinitionService=ContentFlowProcessStartVariableDefinitionService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowActiveProcessInstanceService=function(_super){function ContentFlowActiveProcessInstanceService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/contentflowactiveprocessinstance","Content Flow Active Process Instance",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.dataListForActiveUser=[],_this}return __extends(ContentFlowActiveProcessInstanceService,_super),ContentFlowActiveProcessInstanceService.prototype.resetData=function(){var s=this;s.dataListForActiveUser.length=0,s.getActiveProcessesForCurrentUserAsInvolvedUser()},ContentFlowActiveProcessInstanceService.prototype.updateProcess=function(processInstanceId,variables){var s=this,d=s.$q.defer();return s.$http.put(s.apiUrl+"/"+processInstanceId,variables).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowActiveProcessInstanceService.prototype.getActiveProcessesForCurrentUserAsInvolvedUser=function(){var s=this,d=s.$q.defer();return s.dataListForActiveUser.length>0&&s.enableCaching?d.resolve(s.dataListForActiveUser):s.altaiHttp.get(s.apiUrl+"/involveduser").then(function(result){angular.copy(result,s.dataListForActiveUser),d.resolve(s.dataListForActiveUser)},function(error){d.reject(error)}),d.promise},ContentFlowActiveProcessInstanceService.prototype.getActiveTasksForProcessInstance=function(processInstanceId){var s=this,d=s.$q.defer();return s.$http.get(s.apiUrl+"/"+processInstanceId).then(function(result){d.resolve(result.data)},function(error){d.reject(error)}),d.promise},ContentFlowActiveProcessInstanceService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowActiveProcessInstanceService=ContentFlowActiveProcessInstanceService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var ContentFlowTaskDefinitionService=function(_super){function ContentFlowTaskDefinitionService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/contentflowtaskdefinition","Content Flow Task Definitions",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ContentFlowTaskDefinitionService,_super),ContentFlowTaskDefinitionService}(AltaiCore.AltaiDataService);AltaiBusinessProcessFlow.ContentFlowTaskDefinitionService=ContentFlowTaskDefinitionService}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiBusinessProcessFlow;!function(AltaiBusinessProcessFlow){var mod=angular.module("altai.businessprocessflow",["altai.core","ui.router","altai.content","altai.identity","xeditable","ngMaterial","angularMoment"]);mod.directive("altaiBusinessProcessDefinitionList",AltaiBusinessProcessFlow.AltaiBusinessProcessDefinitionListDirective),mod.service("businessProcessDefinitionService",AltaiBusinessProcessFlow.BusinessProcessDefinitionService),mod.directive("altaiBusinessProcessInstanceList",AltaiBusinessProcessFlow.AltaiBusinessProcessInstanceListDirective),mod.service("businessProcessInstanceService",AltaiBusinessProcessFlow.BusinessProcessInstanceService),mod.directive("altaiBusinessProcessTaskList",AltaiBusinessProcessFlow.AltaiBusinessProcessTaskListDirective),mod.directive("altaiTaskCenter",AltaiBusinessProcessFlow.AltaiTaskCenterDirective),mod.service("businessProcessTaskService",AltaiBusinessProcessFlow.BusinessProcessTaskService),mod.directive("altaiContentFlowUserSelect",AltaiBusinessProcessFlow.AltaiContentFlowUserSelectDirective),mod.directive("altaiContentFlowGroupSelect",AltaiBusinessProcessFlow.AltaiContentFlowGroupSelectDirective),mod.directive("altaiContentFlowTaskCommentCreateParent",AltaiBusinessProcessFlow.AltaiContentFlowTaskCommentCreateParentDirective),mod.directive("altaiContentFlowPublishCalendar",AltaiBusinessProcessFlow.AltaiContentflowPublishCalendarDirective),mod.directive("altaiContentFlowProcessCommentCreateParent",AltaiBusinessProcessFlow.AltaiContentFlowProcessCommentCreateParentDirective),mod.directive("altaiContentFlowProcessVariableDefinitionCreate",AltaiBusinessProcessFlow.AltaiContentFlowProcessVariableDefinitionCreateDirective),mod.directive("altaiContentFlowProcessVariableDefinitionUpdate",AltaiBusinessProcessFlow.AltaiContentFlowProcessVariableDefinitionUpdateDirective),mod.directive("altaiContentFlowProcessStartVariableDefinitionCreate",AltaiBusinessProcessFlow.AltaiContentFlowProcessStartVariableDefinitionCreateDirective),mod.directive("altaiContentFlowProcessStartVariableDefinitionUpdate",AltaiBusinessProcessFlow.AltaiContentFlowProcessStartVariableDefinitionUpdateDirective),mod.directive("altaiContentFlowSingleProcess",AltaiBusinessProcessFlow.AltaiContentFlowSingleProcessDirective),mod.directive("altaiContentFlowSingleProcessDefinition",AltaiBusinessProcessFlow.AltaiContentFlowSingleProcessDefinitionDirective),mod.directive("altaiContentFlowTaskDefinition",AltaiBusinessProcessFlow.AltaiContentFlowTaskDefinitionDirective),mod.directive("altaiContentFlowProcessDefinition",AltaiBusinessProcessFlow.AltaiContentFlowProcessDefinitionDirective),mod.directive("altaiContentFlowConfigure",AltaiBusinessProcessFlow.AltaiContentFlowConfigureDirective),mod.service("contentFlowTaskInstanceCommentLinkService",AltaiBusinessProcessFlow.ContentFlowTaskInstanceCommentLinkService),mod.service("contentFlowProcessInstanceCommentLinkService",AltaiBusinessProcessFlow.ContentFlowProcessInstanceCommentLinkService),mod.service("contentTypeBusinessProcessLinkService",AltaiBusinessProcessFlow.ContentTypeBusinessProcessLinkService),mod.service("contentItemBusinessProcessInstanceLinkService",AltaiBusinessProcessFlow.ContentItemBusinessProcessInstanceLinkService),mod.service("contentFlowActivitiBusinessProcessDefinitionsService",AltaiBusinessProcessFlow.ContentFlowActivitiBusinessProcessDefinitionsService),mod.service("contentFlowProcessDefinitionService",AltaiBusinessProcessFlow.ContentFlowProcessDefinitionService),mod.service("contentFlowProcessVariableDefinitionService",AltaiBusinessProcessFlow.ContentFlowProcessVariableDefinitionService),mod.service("contentFlowProcessStartVariableDefinitionService",AltaiBusinessProcessFlow.ContentFlowProcessStartVariableDefinitionService),mod.service("contentFlowTaskDefinitionService",AltaiBusinessProcessFlow.ContentFlowTaskDefinitionService),mod.service("contentFlowHistoricTaskInstanceService",AltaiBusinessProcessFlow.ContentFlowHistoricTaskInstanceService),mod.service("contentFlowProcessInstanceFullCreationModelService",AltaiBusinessProcessFlow.ContentFlowProcessInstanceFullCreationModelService),mod.service("contentFlowTaskInstanceFullCreationModelService",AltaiBusinessProcessFlow.ContentFlowTaskInstanceFullCreationModelService),
mod.service("contentFlowActiveProcessInstanceService",AltaiBusinessProcessFlow.ContentFlowActiveProcessInstanceService),mod.directive("altaiContentFlowContentItemUpdateParent",AltaiBusinessProcessFlow.AltaiContentFlowContentItemUpdateParentDirective),mod.directive("altaiContentFlowTaskCommentUpdateParent",AltaiBusinessProcessFlow.AltaiContentFlowTaskCommentUpdateParentDirective),mod.directive("altaiContentFlowAttributeUpdate",AltaiBusinessProcessFlow.AltaiContentFlowAttributeUpdateDirective),mod.directive("altaiContentFlowContentItemCreateParent",AltaiBusinessProcessFlow.AltaiContentFlowContentItemCreateParentDirective),mod.component("altaiContentFlowSidebarCreate",new AltaiBusinessProcessFlow.AltaiContentFlowSidebarCreateComponent),mod.component("altaiContentFlowSidebarUpdate",new AltaiBusinessProcessFlow.AltaiContentFlowSidebarUpdateComponent),mod.component("altaiContentFlowActiveTaskCard",new AltaiBusinessProcessFlow.AltaiContentFlowActiveTaskCardComponent),mod.component("altaiContentFlowActiveTaskCardDisabled",new AltaiBusinessProcessFlow.AltaiContentFlowActiveTaskCardDisabledComponent),mod.component("altaiContentFlowHistoricTaskCard",new AltaiBusinessProcessFlow.AltaiContentFlowHistoricTaskCardComponent),mod.component("altaiContentFlowComment",new AltaiBusinessProcessFlow.AltaiContentFlowCommentComponent),mod.run(function(editableOptions){editableOptions.theme="bs3",editableOptions.icon_set="mdi"}),mod.config(function($stateProvider,altaiAdminMenuProvider){$stateProvider.state("admin.contentflow",{url:"/contentflow","abstract":!0}).state("admin.contentflow.task",{url:"/task",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.BusinessProcessTaskListController}}}).state("admin.contentflow.configure",{url:"/configure",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.ContentFlowConfigureController}}}).state("admin.contentflow.processdefinition",{url:"/contentflowprocessdefinition",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.ContentFlowProcessDefinitionController}}}).state("admin.contentflow.publishcalendar",{url:"/contentflowpublishcalendar",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.ContentFlowPublishCalendar}}}).state("admin.contentflow.content.item.create",{url:"/:id/contentflowcreate",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.ContentFlowContentItemCreateController}}}).state("admin.contentflow.content.item.update",{url:"/:id/contentflowupdate",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.ContentFlowContentItemUpdateController}}}).state("admin.contentflow.definition",{url:"/definition",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.BusinessProcessDefinitionListController}}}).state("admin.contentflow.instance",{url:"/instance",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiBusinessProcessFlow.BusinessProcessInstanceListController}}}),altaiAdminMenuProvider.add({name:"contentflow",order:3,label:"contentflow",icon:"mdi mdi-shuffle-variant menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.tasks",securable:"contentflow.task.read",label:"contentflowtasks",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.task"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.configure",securable:"contentflow.configure.read",label:"contentflowconfigure",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.configure"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.processdefinition",securable:"contentflow.processdefinition.read",label:"contentflowprocessdefinitions",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.processdefinition"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.publishcalendar",securable:"contentflow.calendar.read",label:"contentflowpublishcalendar",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.publishcalendar"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.definitions",securable:"contentflow.definition.read",label:"businessprocessdefinitions",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.definition"}),altaiAdminMenuProvider.add({parent:"contentflow",name:"contentflow.instances",securable:"contentflow.instance.read",label:"businessprocessinstances",icon:"mdi mdi-shuffle-variant",state:"admin.contentflow.instance"})}),config.modules.push("altai.businessprocessflow")}(AltaiBusinessProcessFlow||(AltaiBusinessProcessFlow={}));var AltaiEvent;!function(AltaiEvent){var EventWindows=function(){function EventWindows(){}return EventWindows}();EventWindows.eventCenter=new AltaiWindowManager.wmWindowType("eventCenter","<event-center languages='vm.languages'></event-center>",1200,1200,1600),EventWindows.eventConfigure=new AltaiWindowManager.wmWindowType("eventConfigure","<event-configure languages='vm.languages'></event-configure>",800,800,1200),EventWindows.eventProfile=new AltaiWindowManager.wmWindowType("eventProfile","<event-profile content-item-id='vm.window.entityId' languages='vm.languages'></event-profile>",1200,1200,1600),EventWindows.eventProfileDetails=new AltaiWindowManager.wmWindowType("eventProfileDetails","<event-profile-details content-item-id='vm.window.entityId' languages='vm.languages'></event-profile-details>",1200,1200,1600),EventWindows.eventProfilePreview=new AltaiWindowManager.wmWindowType("eventProfilePreview","<event-profile-preview content-item-id='vm.window.entityId' languages='vm.languages'></event-profile-preview>",1200,1200,1200),AltaiEvent.EventWindows=EventWindows}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){function EventCenterController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEvent.EventWindows.eventCenter,"Event Center","")}AltaiEvent.EventCenterController=EventCenterController}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){function EventConfigureController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEvent.EventWindows.eventConfigure,"Event Configuration","")}AltaiEvent.EventConfigureController=EventConfigureController}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){function PresenceRegistrationController($stateParams,contentItemService,altaiHttp,$timeout,$state,$location,contentTypeService){var ctrl=this;ctrl.present=$stateParams.present,altaiHttp.get("/event/registerpresence?code="+$stateParams.code+"&present="+$stateParams.present).then(function(resultEventData){ctrl.eventContentTypeId=resultEventData.contentTypeId,ctrl.eventContentItemId=resultEventData.contentItemEventId,$timeout(function(){ctrl.openEventState()},5e3)}),ctrl.openEventState=function(){contentTypeService.getLinkedState(ctrl.eventContentTypeId).then(function(eventState){$state.go(eventState,{id:ctrl.eventContentItemId})})}}AltaiEvent.PresenceRegistrationController=PresenceRegistrationController}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var EventCenterComponent=function(){function EventCenterComponent(){this.controller=EventCenterComponentController,this.bindings={contentTypeId:"=",languages:"="},this.templateUrl="/api/template/Admin/EventCenterComponent"}return EventCenterComponent}();AltaiEvent.EventCenterComponent=EventCenterComponent;var EventCenterComponentController=function(){function EventCenterComponentController(eventService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.$scope=$scope,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory;this.eventService=eventService}return EventCenterComponentController.prototype.createContentItemForContentType=function(ctlabel,ctid){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,ctlabel,ctid)},EventCenterComponentController}()}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var EventConfigureComponent=function(){function EventConfigureComponent(){this.controller=EventConfigureComponentController,this.bindings={contentTypeId:"=",languages:"="},this.templateUrl="/api/template/Admin/EventConfigureComponent"}return EventConfigureComponent}();AltaiEvent.EventConfigureComponent=EventConfigureComponent;var EventConfigureComponentController=function(){function EventConfigureComponentController(eventService,$scope,$q,altaiConfirmationService,$rootScope,wmContainerFactory){this.$scope=$scope,this.$q=$q,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory;this.eventService=eventService}return EventConfigureComponentController}()}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var AltaiEventButtonsComponent=function(){function AltaiEventButtonsComponent(){this.template='<md-button ng-click="$ctrl.openEventProfile($ctrl.contentItem)" class="md-button-altai md-raised"><i class="mdi mdi-view-list"></i> {{::\'open_event_profile\'|translate}} </md-button><md-button ng-click="$ctrl.updateContentItem($ctrl.contentItem)" class="md-button-altai md-raised"  ng-if="$ctrl.allowUpdate"><i class="mdi mdi-pencil"></i> {{::\'open_edit\'|translate}} </md-button><md-button ng-click="$ctrl.deleteContentItem($ctrl.contentItem)" class="md-button-altai md-raised" ng-if="$ctrl.allowUpdate"><i class="mdi mdi-delete"></i> {{::\'delete\'|translate}}</md-button>',this.controller=AltaiEventButtonsComponentController,this.bindings={contentItem:"="}}return AltaiEventButtonsComponent}();AltaiEvent.AltaiEventButtonsComponent=AltaiEventButtonsComponent;var AltaiEventButtonsComponentController=function(){function AltaiEventButtonsComponentController(wmContainerFactory,altaiConfirmationService,contentItemService,contentTypeService,eventService){this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentItemService=contentItemService,this.eventService=eventService;var ctrl=this;contentTypeService.previewPossibleForType(ctrl.contentItem.contentTypeId).then(function(previewPossible){ctrl.allowPreview=previewPossible}),contentTypeService.editPossibleForType(ctrl.contentItem.contentTypeId).then(function(editPossible){ctrl.allowUpdate=editPossible})}return AltaiEventButtonsComponentController.prototype.openEventProfile=function(contentItem){this.wmContainerFactory.createWindow(AltaiEvent.EventWindows.eventProfileDetails,contentItem.name+" details",contentItem.id)},AltaiEventButtonsComponentController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.name,contentItem.id)},AltaiEventButtonsComponentController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemService["delete"](contentItem).then(function(){})})},AltaiEventButtonsComponentController}()}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var EventProfileComponent=function(){function EventProfileComponent(){this.controller=EventProfileComponentController,this.bindings={contentItemId:"=",languages:"="},this.templateUrl="/api/template/Admin/EventProfileComponent"}return EventProfileComponent}();AltaiEvent.EventProfileComponent=EventProfileComponent;var EventProfileComponentController=function(){function EventProfileComponentController(contentItemService,eventService,$scope,$q,altaiLocalizationService,$rootScope,wmContainerFactory){this.contentItemService=contentItemService,this.eventService=eventService,this.$scope=$scope,this.$q=$q,this.altaiLocalizationService=altaiLocalizationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.loading=!0,this.enableRootCssContainer=!0;var $ctrl=this;$ctrl.toolbar={menuGroups:[{menuItems:[],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0},$scope.$watch("$ctrl.languages",function(newValue,oldValue){if($ctrl.languages&&newValue!=oldValue&&(void 0!=oldValue||void 0==oldValue&&void 0==$ctrl.itemdata)){var activeLang=$ctrl.languages.filter(function(lang){return lang.selected})[0];$ctrl.altaiLocalizationService.changeLang(activeLang.code).then(function(){$ctrl.getData()})}},!0),this.getData(),this.maximizeWindow()}return EventProfileComponentController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiEvent.EventWindows.eventProfile,this.contentItemId);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.setHalfSize(currentWindow))},EventProfileComponentController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.contentItemService.getById(ctrl.contentItemId).then(function(contentItem){ctrl.itemprofile=contentItem,ctrl.languages&&(ctrl.activeLang=ctrl.languages.filter(function(lang){return lang.selected})[0],ctrl.contentItemService.getDataById(ctrl.contentItemId,ctrl.activeLang.code).then(function(contentItemData){ctrl.itemdata=contentItemData,ctrl.enableRootCssContainer=39!=ctrl.itemdata.contentTypeId,ctrl.itemprofile.templateId&&(ctrl.templateurl="/api/template/"+ctrl.itemprofile.templateId),ctrl.loading=!1}))})},EventProfileComponentController}()}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var EventProfileDetailsComponent=function(){function EventProfileDetailsComponent(){this.controller=EventProfileDetailsComponentController,this.bindings={contentItemId:"=",languages:"="},this.templateUrl="/api/template/Admin/EventProfileDetailsComponent"}return EventProfileDetailsComponent}();AltaiEvent.EventProfileDetailsComponent=EventProfileDetailsComponent;var EventProfileDetailsComponentController=function(){function EventProfileDetailsComponentController(eventTypeManager,contentItemService,eventService,$scope,$q,altaiLocalizationService,altaiConfirmationService,$rootScope,wmContainerFactory,mailingCampaignManager,contentItemSelectionService,exposedContentCollectionQueryManager,$http,backgroundJobService){this.eventTypeManager=eventTypeManager,this.contentItemService=contentItemService,this.eventService=eventService,this.$scope=$scope,this.$q=$q,this.altaiLocalizationService=altaiLocalizationService,this.altaiConfirmationService=altaiConfirmationService,this.$rootScope=$rootScope,this.wmContainerFactory=wmContainerFactory,this.mailingCampaignManager=mailingCampaignManager,this.contentItemSelectionService=contentItemSelectionService,this.exposedContentCollectionQueryManager=exposedContentCollectionQueryManager,this.$http=$http,this.backgroundJobService=backgroundJobService,this.loading=!0,this.activeLang={code:void 0},this.creatingInvitations=!1;var ctrl=this;ctrl.selectionKey="eventreg"+ctrl.contentItemId,ctrl.contentItemSelectionService.clearSelections(),ctrl.toolbar={menuGroups:[{menuItems:[],align:"left"}],showLanguages:!0,allowMultipleLanguages:!1},$scope.$watch("$ctrl.languages",function(newValue,oldValue){if(ctrl.languages&&newValue!=oldValue&&(void 0!=oldValue||void 0==oldValue&&void 0==ctrl.itemdata)&&ctrl.languages){var temp=ctrl.activeLang.code;ctrl.activeLang=ctrl.languages.filter(function(lang){return lang.selected})[0],temp!=ctrl.activeLang.code&&ctrl.getData()}},!0),ctrl.getData()}return EventProfileDetailsComponentController.prototype.halveWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiEvent.EventWindows.eventProfileDetails,this.contentItemId);currentWindow&&(currentWindow.toggleHalf(),this.wmContainerFactory.setHalfSize(currentWindow))},EventProfileDetailsComponentController.prototype.createInvitations=function(typeId){var _this=this,ctrl=this;ctrl.creatingInvitations=!0,42==typeId?this.$http.get("/api/comeosacevent/"+this.contentItemId+"/registrations").success(function(jobId){_this.backgroundJobService.waitForJob(jobId).then(function(){_this.creatingInvitations=!1})}):55==typeId?this.$http.get("/api/comeosnetevent/"+this.contentItemId+"/registrations").success(function(jobId){_this.backgroundJobService.waitForJob(jobId).then(function(){_this.creatingInvitations=!1})}):62==typeId&&this.$http.get("/api/comeoscomevent/"+this.contentItemId+"/registrations").success(function(jobId){_this.backgroundJobService.waitForJob(jobId).then(function(){_this.creatingInvitations=!1})})},EventProfileDetailsComponentController.prototype.previewEventItem=function(){var ctrl=this;ctrl.wmContainerFactory.createWindow(AltaiEvent.EventWindows.eventProfilePreview,"Preview",ctrl.contentItemId)},EventProfileDetailsComponentController.prototype.send=function(selectedMailingCampaignType,exposedContentCollectionId){var ctrl=this,selectedRegistrationIds=[],query=ctrl.exposedContentCollectionQueryManager.getRequest(exposedContentCollectionId,{id:ctrl.contentItemId}),searchRequest=[];if(query)for(var i=0;i<query.length;i++){var filterId=query[i].filterId,valueId=query[i].value,exReqFilter=searchRequest.filter(function(elm){return elm.filterId==filterId})[0];exReqFilter?exReqFilter.values.push(valueId):searchRequest.push({filterId:filterId,values:[valueId]})}var selection=ctrl.contentItemSelectionService.getSelection(ctrl.selectionKey);selection&&(selectedRegistrationIds=selection.map(function(selection){return selection.id})),ctrl.altaiConfirmationService.confirm().then(function(){ctrl.mailingCampaignManager.generateHtmlForCampaign(ctrl.contentItemId,selectedMailingCampaignType.templateId).then(function(contentTranslatable){ctrl.eventService.startEventMailingCampaign(ctrl.contentItemId,selectedMailingCampaignType.id,selectedRegistrationIds,searchRequest,exposedContentCollectionId,contentTranslatable).then(function(newCampaign){ctrl.$scope.$broadcast("campaignStarted"),ctrl.closeDetailsWindow()})})})},EventProfileDetailsComponentController.prototype.closeDetailsWindow=function(){var ctrl=this,currentWin=ctrl.wmContainerFactory.findWindow(AltaiEvent.EventWindows.eventProfileDetails,ctrl.contentItemId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)},EventProfileDetailsComponentController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.languages&&(ctrl.activeLang=ctrl.languages.filter(function(lang){return lang.selected})[0],ctrl.contentItemService.getContentTypeOfContentItem(ctrl.contentItemId).then(function(contentTypeId){ctrl.itemdata={contentTypeId:contentTypeId},ctrl.loading=!1,ctrl.eventTypeManager.getByContentTypeId(contentTypeId).then(function(eventType){eventType&&(ctrl.mailingCampaignTypes=eventType.mailingCampaignTypes)})}))},EventProfileDetailsComponentController}()}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var EventProfilePreviewComponent=function(){function EventProfilePreviewComponent(){this.controller=EventProfilePreviewComponentController,this.controllerAs="vm",this.bindings={contentItemId:"=",languages:"="},this.templateUrl="/api/template/Admin/EventProfilePreviewComponent"}return EventProfilePreviewComponent}();AltaiEvent.EventProfilePreviewComponent=EventProfilePreviewComponent;var EventProfilePreviewComponentController=function(){function EventProfilePreviewComponentController($rootScope,$scope,wmContainerFactory,contentItemService,altaiLocalizationService){this.wmContainerFactory=wmContainerFactory,this.altaiLocalizationService=altaiLocalizationService,this.loading=!0,this.enableRootCssContainer=!0;var vm=this;vm.toolbar={menuGroups:[{menuItems:[],align:"left"}],showLanguages:!0,allowMultipleLanguages:!1},vm.contentItemService=contentItemService,$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){vm.getData()}),$scope.$watch("vm.languages",function(newValue,oldValue){vm.languages&&newValue!=oldValue&&(void 0!=oldValue||void 0==oldValue&&void 0==vm.item)&&vm.getData()},!0),vm.getData(),this.halveWindow()}return EventProfilePreviewComponentController.prototype.halveWindow=function(){var ctrl=this,currentWindow=ctrl.wmContainerFactory.findWindow(AltaiEvent.EventWindows.eventProfilePreview,ctrl.contentItemId);currentWindow&&(currentWindow.toggleHalf(),ctrl.wmContainerFactory.setHalfSize(currentWindow))},EventProfilePreviewComponentController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.contentItemService.getById(ctrl.contentItemId).then(function(contentItem){ctrl.languages&&(ctrl.activeLang=ctrl.languages.filter(function(lang){return lang.selected})[0],ctrl.contentItemService.getDataById(ctrl.contentItemId,ctrl.activeLang.code).then(function(contentItemData){ctrl.item=contentItemData,ctrl.enableRootCssContainer=39!=ctrl.item.contentTypeId,contentItem.templateId&&(ctrl.templateUrl="/api/template/"+contentItem.templateId),ctrl.loading=!1}))})},EventProfilePreviewComponentController.prototype.openUpdateItemWindow=function(){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,"Update",this.contentItemId)},EventProfilePreviewComponentController}()}(AltaiEvent||(AltaiEvent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiEvent;!function(AltaiEvent){var EventService=function(_super){function EventService($http,altaiHttp,$q,altaiNotificationFactory,mailingCampaignManager){var _this=_super.call(this,"api/event","Event",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.mailingCampaignManager=mailingCampaignManager,_this}return __extends(EventService,_super),EventService.prototype.startEventMailingCampaign=function(contentItemId,mailingCampaignTypeId,selectedIds,searchRequest,contentCollectionId,contentTranslatable){var s=this,d=s.$q.defer();return s.altaiHttp.post("/api/contentItem/"+contentItemId+"/startEventMailingCampaign",{contentItemId:contentItemId,exposedContentCollectionId:contentCollectionId,mailingCampaignTypeId:mailingCampaignTypeId,sendToAll:0===selectedIds.length,selectedRegistrationIds:selectedIds,searchRequest:searchRequest,contentTranslatable:contentTranslatable}).then(function(result){d.resolve(result.data)}),d.promise},EventService}(AltaiCore.AltaiDataService);AltaiEvent.EventService=EventService}(AltaiEvent||(AltaiEvent={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiEvent;!function(AltaiEvent){var EventTypeManager=function(_super){function EventTypeManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/eventType","EventType",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(EventTypeManager,_super),EventTypeManager.prototype.getByContentTypeId=function(contentTypeId){var s=this,d=s.$q.defer();return s.list().then(function(eventTypes){var eventType=eventTypes.filter(function(et){return et.contentTypeId===contentTypeId})[0];d.resolve(eventType)}),d.promise},EventTypeManager}(AltaiCore.AltaiDataService);AltaiEvent.EventTypeManager=EventTypeManager}(AltaiEvent||(AltaiEvent={}));var AltaiEvent;!function(AltaiEvent){var mod=angular.module("altai.event",["altai.core","ui.router","altai.content","altai.identity","xeditable","ngMaterial","angularMoment"]);mod.service("eventService",AltaiEvent.EventService),mod.service("eventTypeManager",AltaiEvent.EventTypeManager),mod.component("eventCenter",new AltaiEvent.EventCenterComponent),mod.component("altaiEventButtons",new AltaiEvent.AltaiEventButtonsComponent),mod.component("eventProfile",new AltaiEvent.EventProfileComponent),mod.component("eventProfileDetails",new AltaiEvent.EventProfileDetailsComponent),mod.component("eventProfilePreview",new AltaiEvent.EventProfilePreviewComponent),mod.run(function(editableOptions){editableOptions.theme="bs3",editableOptions.icon_set="mdi"}),mod.config(function($stateProvider,altaiAdminMenuProvider){$stateProvider.state("admin.event",{url:"/event","abstract":!0}).state("admin.event.center",{url:"/center",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEvent.EventCenterController}}}).state("admin.event.configure",{url:"/configure",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEvent.EventConfigureController}}}),$stateProvider.state("presenceregistration",{url:"/presenceregistration/:code/:present",system:!0,views:{bodyView:{altaiTemplate:"presenceregistration",altaiTemplateType:"admin",controllerAs:"$ctrl",controller:AltaiEvent.PresenceRegistrationController}}}),altaiAdminMenuProvider.add({name:"event",order:3,label:"event",icon:"mdi mdi-calendar menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"event",name:"event.center",securable:"eventcenter",label:"eventcenter",icon:"mdi mdi-calendar",state:"admin.event.center"}),altaiAdminMenuProvider.add({parent:"event",name:"event.configure",securable:"config.eventcenter",label:"eventconfigure",icon:"mdi mdi-calendar",state:"admin.event.configure"})}),config.modules.push("altai.event")}(AltaiEvent||(AltaiEvent={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenusList(){return{templateUrl:"/api/template/Admin/altaiMenusList",controller:AltaiMenusListController,controllerAs:"vm"}}AltaiMenus.AltaiMenusList=AltaiMenusList;var AltaiMenusListController=function(){function AltaiMenusListController(wmContainerFactory,menusDataService){this.wmContainerFactory=wmContainerFactory,this.menusDataService=menusDataService,this.listMenus()}return AltaiMenusListController.prototype.listMenus=function(){var vm=this;this.menusDataService.list().then(function(result){vm.menus=result})},AltaiMenusListController.prototype.createMenu=function(){this.wmContainerFactory.createWindow(AltaiMenus.MenuWindows.menusAdd,"Add new menu")},AltaiMenusListController.prototype.updateMenu=function(id){this.wmContainerFactory.createWindow(AltaiMenus.MenuWindows.menusUpdate,"Update menu",id)},AltaiMenusListController.prototype.openMenuPreview=function(id){this.wmContainerFactory.createWindow(AltaiMenus.MenuWindows.menusPreview,"Menu preview",id)},AltaiMenusListController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenusAdd(){return{templateUrl:"/api/template/Admin/altaiMenusAdd",controller:AltaiMenusAddController,controllerAs:"vm",link:AltaiMenusAddLink}}AltaiMenus.AltaiMenusAdd=AltaiMenusAdd;var AltaiMenusAddLink=function(){function AltaiMenusAddLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.saveMenu()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return AltaiMenusAddLink}(),AltaiMenusAddController=function(){function AltaiMenusAddController($rootScope,$templateFactory,$scope,menusDataService){this.$rootScope=$rootScope,this.$templateFactory=$templateFactory,this.$scope=$scope,this.menusDataService=menusDataService;var m=this;this.menu={childMenuItems:[],watchCounter:0},$templateFactory.listTemplateByTypeName("menu").then(function(result){m.templates=result})}return AltaiMenusAddController.prototype.saveMenu=function(){var menu=angular.copy(this.menu);menu.menuItems=menu.childMenuItems,delete menu.childMenuItems,this.menusDataService.add(menu)},AltaiMenusAddController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenuTreeList(){return{template:"<tree-list tree-model='vm.treeData' ></tree-list>",controller:AltaiMenuTreeListController,controllerAs:"vm",scope:{menuItems:"="}}}AltaiMenus.AltaiMenuTreeList=AltaiMenuTreeList;var AltaiMenuTreeListController=function(){function AltaiMenuTreeListController($scope,$rootScope){this.$scope=$scope,this.$rootScope=$rootScope;var vm=this;this.$scope.$watch("menuItems",function(newv){vm.$scope.menuItems&&(vm.treeData=vm.parseMenuItemsDataToTreeData(vm.$scope.menuItems))},!0),this.$scope.$on("treeExpandChange",function(newv){vm.$scope.vm.treeData&&vm.saveExpandedMenuChanges(vm.treeData)},!0),this.$rootScope.$on("treeOrderUpdate",function(){vm.treeData&&(vm.tempMenuItems=angular.copy(vm.$scope.menuItems),vm.reverseMapOrder(vm.treeData),vm.sortMenuItems(vm.tempMenuItems),vm.$scope.menuItems=vm.tempMenuItems)}),this.$rootScope.$on("updateTreeOrder",function(){console.log("rearrange"),vm.treeData&&(vm.tempMenuItems=angular.copy(vm.$scope.menuItems),vm.recalculateOrder(vm.tempMenuItems),vm.$scope.menuItems=vm.tempMenuItems)})}return AltaiMenuTreeListController.prototype.saveExpandedMenuChanges=function(items){for(var vm=this,i=0;i<items.length;i++){var menuItem=vm.recursiveSearch(vm.$scope.menuItems,items[i].hash);menuItem.expanded=items[i].expanded,items[i].childMenuItems&&vm.saveExpandedMenuChanges(items[i].childMenuItems)}},AltaiMenuTreeListController.prototype.sortMenuItems=function(menuItems){menuItems.sort(function(a,b){return a.order<b.order?-1:a.order>b.order?1:0});for(var i=0;i<menuItems.length;i++)menuItems[i].childMenuItems&&this.sortMenuItems(menuItems[i].childMenuItems)},AltaiMenuTreeListController.prototype.reverseMapOrder=function(tree){for(var i=0;i<tree.length;i++)this.updateOrder(tree[i].hash,tree[i].order),tree[i].items&&this.reverseMapOrder(tree[i].items)},AltaiMenuTreeListController.prototype.recalculateOrder=function(tree){for(var i=0;i<tree.length;i++)tree[i].order=i,tree[i].items&&this.reverseMapOrder(tree[i].items)},AltaiMenuTreeListController.prototype.updateOrder=function(hash,order){var itemFound=this.recursiveSearch(this.tempMenuItems,hash);itemFound.order=order},AltaiMenuTreeListController.prototype.recursiveSearch=function(items,hash){for(var i=0;i<items.length;i++){if(items[i].hash==hash)return items[i];if(items[i].childMenuItems){var childFoundItem=this.recursiveSearch(items[i].childMenuItems,hash);if(childFoundItem)return childFoundItem}}},AltaiMenuTreeListController.prototype.parseMenuItemsDataToTreeData=function(items){for(var parsedTree=[],i=0;i<items.length;i++){var item={};this.setMenuItemHash(items[i]),item.hash=items[i].hash,item.title=this.parseTranslatableName(items[i].labelTranslatable.translatableValues),item.published=items[i].published,item.order=items[i].order||i,item.expanded=items[i].expanded,items[i].childMenuItems&&(item.items=this.parseMenuItemsDataToTreeData(items[i].childMenuItems)),parsedTree.push(item)}return parsedTree},AltaiMenuTreeListController.prototype.setMenuItemHash=function(menuItem){menuItem.hash||(menuItem.hash=this.generateHash())},AltaiMenuTreeListController.prototype.generateHash=function(){for(var alpha="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_",hash="",i=0;10>i;i++){var random=Math.round(Math.random()*alpha.length);hash+=alpha.substr(random,1)}return hash},AltaiMenuTreeListController.prototype.parseTranslatableName=function(translatable){for(var i=0;i<translatable.length;i++)if("nl"==translatable[i].languageCode)return translatable[i].value},AltaiMenuTreeListController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenuItemManager(){return{templateUrl:"/api/template/Admin/altaiMenuItemManager",controller:AltaiMenuItemManagerController,controllerAs:"vm",bindToController:!0,scope:{menuItems:"=",languages:"="}}}AltaiMenus.AltaiMenuItemManager=AltaiMenuItemManager;var AltaiMenuItemManagerController=function(){function AltaiMenuItemManagerController($rootScope,stateManager,menuItemDataService,wmContainerFactory){this.$rootScope=$rootScope,
this.stateManager=stateManager,this.menuItemDataService=menuItemDataService,this.wmContainerFactory=wmContainerFactory,this.editMenuItem=!1,this.initMenuTreeListListeners(),this.loadStates()}return AltaiMenuItemManagerController.prototype.initMenuTreeListListeners=function(){var vm=this;this.$rootScope.$on("editTreeItem",function(event,hash){vm.expandMenuItemForm=!0,vm.editMenuItem=!0,vm.selectMenuItem(hash)}),this.$rootScope.$on("addTreeItem",function(event,parentId){if(delete vm.menuItem,parentId){var parentItem=vm.findMenuItemInTree(vm.menuItems,parentId);parentItem&&parentItem.childMenuItems?vm.addItemParent=parentItem.childMenuItems:parentItem&&!parentItem.childMenuItems&&(parentItem.childMenuItems=[])}else delete vm.addItemParent;vm.expandMenuItemForm=!0,vm.editMenuItem=!1}),this.$rootScope.$on("addChildTreeItem",function(event,hash){delete vm.menuItem;var parentItem=vm.findMenuItemInTree(vm.menuItems,hash);parentItem.childMenuItems||(parentItem.childMenuItems=[]),vm.addItemParent=parentItem.childMenuItems,vm.expandMenuItemForm=!0,vm.editMenuItem=!1}),this.$rootScope.$on("setSecurityTreeItem",function(event,hash){vm.menuItem=vm.findMenuItemInTree(vm.menuItems,hash),vm.setSecurityMenuItem()})},AltaiMenuItemManagerController.prototype.loadStates=function(){var vm=this;this.stateManager.list().then(function(result){vm.states=result})},AltaiMenuItemManagerController.prototype.deleteMenuItem=function(){var vm=this,parentMenuItem=this.findMenuItemInTree(this.menuItems,this.menuItem.hash,!0);parentMenuItem.childMenuItems&&(parentMenuItem=parentMenuItem.childMenuItems);var index=this.getMenuItemIndexInParent(parentMenuItem,this.menuItem.hash);this.menuItemDataService["delete"](parentMenuItem[index]).then(function(r){parentMenuItem.splice(index,1),vm.expandMenuItemForm=!1})},AltaiMenuItemManagerController.prototype.saveMenuItem=function(){this.menuItems[0].watchCounter++,this.editMenuItem=!1,delete this.menuItem,this.expandMenuItemForm=!1},AltaiMenuItemManagerController.prototype.addMenuItem=function(){this.menuItem.id=-1,this.addItemParent?(this.addItemParent.push(this.menuItem),this.menuItems[0].watchCounter++):(this.menuItem.watchCounter=0,this.menuItems.push(this.menuItem)),this.expandMenuItemForm=!1,delete this.menuItem,this.$rootScope.$broadcast("updateTreeOrder")},AltaiMenuItemManagerController.prototype.setSecurityMenuItem=function(){var vm=this;vm.menuItem.id?vm.wmContainerFactory.createWindow(AltaiIdentity.IdentityWindows.setSecurableAccesses,"Accesses",vm.menuItem.id,{securableName:"menuitem"}):console.log("Save first")},AltaiMenuItemManagerController.prototype.getMenuItemIndexInParent=function(parent,hash){for(var i=0;i<parent.length;i++)if(parent[i].hash==hash)return i},AltaiMenuItemManagerController.prototype.selectMenuItem=function(hash){this.menuItem=this.findMenuItemInTree(this.menuItems,hash)},AltaiMenuItemManagerController.prototype.findMenuItemInTree=function(menuItems,hash,returnParent){for(var foundMenuItem,i=0;i<menuItems.length;i++){if(menuItems[i].hash==hash){foundMenuItem=returnParent?menuItems:menuItems[i];break}var menuItemFoundInChildren=this.loopTroughChildMenuItems(menuItems[i],hash,returnParent);if(menuItemFoundInChildren){foundMenuItem=menuItemFoundInChildren;break}}return foundMenuItem},AltaiMenuItemManagerController.prototype.loopTroughChildMenuItems=function(parent,hash,returnParent){var foundMenuItem;return parent.childMenuItems&&(foundMenuItem=this.findMenuItemInTree(parent.childMenuItems,hash,returnParent)),foundMenuItem},AltaiMenuItemManagerController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var MenusController=function(){function MenusController(wmContainerFactory){this.wmContainerFactory=wmContainerFactory,this.wmContainerFactory.createWindow(AltaiMenus.MenuWindows.menusList,"Menus")}return MenusController}();AltaiMenus.MenusController=MenusController}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var MenuWindows=function(){function MenuWindows(){}return MenuWindows}();MenuWindows.menusList=new AltaiWindowManager.wmWindowType("menusList","<altai-menus-list></altai-menus-list>",500,960,1600),MenuWindows.menusAdd=new AltaiWindowManager.wmWindowType("menusAdd","<altai-menus-add></altai-menus-add>",750,960,1600),MenuWindows.menusUpdate=new AltaiWindowManager.wmWindowType("menusUpdate","<altai-menus-update state-id='vm.window.entityId'></altai-menus-update>",750,960,1600),MenuWindows.menusPreview=new AltaiWindowManager.wmWindowType("menusPreview","<altai-menu-preview state-id='vm.window.entityId'></altai-menu-preview>",750,960,1600),AltaiMenus.MenuWindows=MenuWindows}(AltaiMenus||(AltaiMenus={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMenus;!function(AltaiMenus){var MenuBbManager=function(_super){function MenuBbManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/menubb","Menu BuildingBlock",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MenuBbManager,_super),MenuBbManager}(AltaiCore.AltaiDataService);AltaiMenus.MenuBbManager=MenuBbManager}(AltaiMenus||(AltaiMenus={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMenus;!function(AltaiMenus){var MenusDataService=function(_super){function MenusDataService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/menu","Menu",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MenusDataService,_super),MenusDataService}(AltaiCore.AltaiDataService);AltaiMenus.MenusDataService=MenusDataService}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenusUpdate(){return{templateUrl:"/api/template/Admin/altaiMenusUpdate",controller:AltaiMenusUpdateController,controllerAs:"vm",bindToController:!0,scope:{stateId:"="},link:AltaiMenusUpdateLink}}AltaiMenus.AltaiMenusUpdate=AltaiMenusUpdate;var AltaiMenusUpdateLink=function(){function AltaiMenusUpdateLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateMenu()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return AltaiMenusUpdateLink}(),AltaiMenusUpdateController=function(){function AltaiMenusUpdateController(menusDataService,$templateFactory){this.menusDataService=menusDataService,this.$templateFactory=$templateFactory,this.loadTemplates(),this.loadMenu()}return AltaiMenusUpdateController.prototype.loadMenu=function(){var vm=this;this.menusDataService.getById(this.stateId).then(function(result){vm.menu=result})},AltaiMenusUpdateController.prototype.loadTemplates=function(){var vm=this;this.$templateFactory.listTemplateByTypeName("menu").then(function(result){vm.templates=result})},AltaiMenusUpdateController.prototype.updateMenu=function(){this.menusDataService.update(this.menu).then(function(result){})},AltaiMenusUpdateController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){function AltaiMenuPreview(){return{templateUrl:"/api/template/Admin/altaiMenuPreview",controller:AltaiMenuPreviewController,controllerAs:"vm",bindToController:!0,scope:{stateId:"="}}}AltaiMenus.AltaiMenuPreview=AltaiMenuPreview;var AltaiMenuPreviewController=function(){function AltaiMenuPreviewController(menusDataService){this.menusDataService=menusDataService,this.loadMenu()}return AltaiMenuPreviewController.prototype.loadMenu=function(){var vm=this;this.menusDataService.getById(this.stateId).then(function(result){vm.menu=result,vm.templateUrl="/api/template/"+result.templateId})},AltaiMenuPreviewController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var altaiMenuCreateBuildingBlock=function(){function altaiMenuCreateBuildingBlock(){this.controller=altaiMenuCreateBuildingBlockController,this.controllerAs="vm",this.templateUrl="/api/template/Admin/altaiMenuCreateBuildingBlock"}return altaiMenuCreateBuildingBlock}();AltaiMenus.altaiMenuCreateBuildingBlock=altaiMenuCreateBuildingBlock;var altaiMenuCreateBuildingBlockController=function(){function altaiMenuCreateBuildingBlockController(menusDataService,altaiEditModeService,$templateFactory){this.menusDataService=menusDataService,this.altaiEditModeService=altaiEditModeService,this.$templateFactory=$templateFactory,this.listMenus(),this.listMenuTemplates()}return altaiMenuCreateBuildingBlockController.prototype.listMenus=function(){var ctrl=this;ctrl.menusDataService.list().then(function(result){ctrl.menus=result})},altaiMenuCreateBuildingBlockController.prototype.listMenuTemplates=function(){var ctrl=this;ctrl.$templateFactory.listTemplateByTypeName("menu").then(function(templateList){ctrl.templates=templateList})},altaiMenuCreateBuildingBlockController.prototype.saveMenuBuildingBlock=function(newMenuBb){this.altaiEditModeService.createBuildingBlock("Menu",{menuId:newMenuBb.menuId,templateId:newMenuBb.templateId})},altaiMenuCreateBuildingBlockController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var AltaiMenuBuildingBlockUpdateComponent=function(){function AltaiMenuBuildingBlockUpdateComponent(){this.controller=AltaiMenuBuildingBlockUpdateComponentController,this.controllerAs="vm",this.templateUrl="/api/template/Admin/altaiMenuCreateBuildingBlock",this.bindings={menuBbId:"=",buildingBlockId:"="}}return AltaiMenuBuildingBlockUpdateComponent}();AltaiMenus.AltaiMenuBuildingBlockUpdateComponent=AltaiMenuBuildingBlockUpdateComponent;var AltaiMenuBuildingBlockUpdateComponentController=function(){function AltaiMenuBuildingBlockUpdateComponentController(menusDataService,buildingBlockManager,$q,menuBbManager,altaiEditModeService,$templateFactory){this.menusDataService=menusDataService,this.buildingBlockManager=buildingBlockManager,this.$q=$q,this.menuBbManager=menuBbManager,this.altaiEditModeService=altaiEditModeService,this.$templateFactory=$templateFactory;var ctrl=this;ctrl.loadMenuBbData(),ctrl.listMenus(),ctrl.listMenuTemplates()}return AltaiMenuBuildingBlockUpdateComponentController.prototype.loadMenuBbData=function(){var ctrl=this;ctrl.menuBbManager.getById(ctrl.menuBbId).then(function(menuBb){ctrl.menuBb=menuBb})},AltaiMenuBuildingBlockUpdateComponentController.prototype.listMenus=function(){var ctrl=this;ctrl.menusDataService.list().then(function(result){ctrl.menus=result})},AltaiMenuBuildingBlockUpdateComponentController.prototype.listMenuTemplates=function(){var ctrl=this;ctrl.$templateFactory.listTemplateByTypeName("menu").then(function(templateList){ctrl.templates=templateList})},AltaiMenuBuildingBlockUpdateComponentController.prototype.saveMenuBuildingBlock=function(updatedMenuBb){var ctrl=this;ctrl.menuBbManager.update(updatedMenuBb).then(function(){ctrl.buildingBlockManager.reloadBuildingBlock(ctrl.buildingBlockId)})},AltaiMenuBuildingBlockUpdateComponentController}()}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var altaiMenu=function(){function altaiMenu(){this.controller=altaiMenuController,this.controllerAs="vm",this.templateUrl=function($attrs){return"/api/template/"+$attrs.templateId},this.bindToController=!0,this.bindings={buildingBlockId:"=buildingBlockId",menuId:"="}}return altaiMenu}();AltaiMenus.altaiMenu=altaiMenu;var altaiMenuController=function(){function altaiMenuController(stateManager,$rootScope,menusDataService){this.stateManager=stateManager,this.menusDataService=menusDataService;var ctrl=this;ctrl.loadMenu(!0),$rootScope.$on("languageChanged",function(){ctrl.loadMenu(!0)})}return altaiMenuController.prototype.loadMenu=function(force){void 0===force&&(force=!1);var ctrl=this;this.buildingBlockId?this.menusDataService.getById(ctrl.menuId,!force).then(function(result){ctrl.menu=result,ctrl.purgeUnpublished(ctrl.menu.menuItems)}):this.menusDataService.getById(ctrl.menuId,!force).then(function(result){ctrl.menu=result,ctrl.purgeUnpublished(ctrl.menu),ctrl.purgeUnpublished(ctrl.menu.menuItems)})},altaiMenuController.prototype.purgeUnpublished=function(menuItems){for(var vm=this,i=0;i<menuItems.length;i++)void 0!=menuItems[i].childMenuItems&&vm.purgeUnpublished(menuItems[i].childMenuItems),menuItems[i].published||menuItems.splice(i,1)},altaiMenuController.prototype.assignURLs=function(menu){for(var vm=this,i=0;i<menu.menuItems.length;i++)!function(i){if(menu.menuItems[i].stateId){vm.stateManager.getById(menu.menuItems[i].stateId).then(function(state){menu.menuItems[i].url=state.url})}null!=menu.menuItems[i].childMenuItems&&void 0!=menu.menuItems[i].childMenuItems&&vm.assignURLsToChildren(menu.menuItems[i].childMenuItems)}(i)},altaiMenuController.prototype.assignURLsToChildren=function(menu){for(var vm=this,i=0;i<menu.length;i++)!function(i){var menuItem=menu[i];vm.stateManager.getById(menu[i].stateId).then(function(state){menuItem.url=state.url});null!=menu[i].childMenuItems&&void 0!=menu[i].childMenuItems&&vm.assignURLsToChildren(menu[i].childMenuItems)}(i)},altaiMenuController}()}(AltaiMenus||(AltaiMenus={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMenus;!function(AltaiMenus){var MenuItemDataService=function(_super){function MenuItemDataService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/menuItem","MenuItem",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MenuItemDataService,_super),MenuItemDataService}(AltaiCore.AltaiDataService);AltaiMenus.MenuItemDataService=MenuItemDataService}(AltaiMenus||(AltaiMenus={}));var AltaiMenus;!function(AltaiMenus){var mod=angular.module("altai.menus",["altai.core","altai.identity","altai.pagebuilder","ui.sortable"]);mod.component("altaiMenuCreateBuildingBlock",new AltaiMenus.altaiMenuCreateBuildingBlock),mod.component("altaiMenuBuildingBlockUpdate",new AltaiMenus.AltaiMenuBuildingBlockUpdateComponent),mod.component("altaiMenu",new AltaiMenus.altaiMenu),mod.directive("altaiMenusList",AltaiMenus.AltaiMenusList),mod.directive("altaiMenusAdd",AltaiMenus.AltaiMenusAdd),mod.directive("menuTreeList",AltaiMenus.AltaiMenuTreeList),mod.directive("altaiMenuItemManager",AltaiMenus.AltaiMenuItemManager),mod.directive("altaiMenusUpdate",AltaiMenus.AltaiMenusUpdate),mod.directive("altaiMenuPreview",AltaiMenus.AltaiMenuPreview),mod.service("menuItemDataService",AltaiMenus.MenuItemDataService),mod.service("menusDataService",AltaiMenus.MenusDataService),mod.service("menuBbManager",AltaiMenus.MenuBbManager),mod.config(function($stateProvider,$sceProvider,$urlRouterProvider,buildingBlockTypeProvider){$stateProvider.state("admin.site",{url:"/site","abstract":!0,system:!0}).state("admin.site.menus",{url:"/menus",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiMenus.MenusController}}}),buildingBlockTypeProvider.add({name:"Menu",label:"Menu",directive:"altai-menu",icon:"mdi-menu",updateComponent:"<altai-menu-building-block-update menu-bb-id='activeBuildingBlockInstanceId' building-block-id='activeBuildingBlockId'></altai-menu-building-block-update>",createComponent:"<altai-menu-create-building-block></altai-menu-create-building-block>"})}),mod.run(function($rootScope,$state,$stateParams,$urlRouter){$rootScope.mode="view",$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){$rootScope.previousState=from})}),config.modules.push("altai.menus")}(AltaiMenus||(AltaiMenus={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiFileListInnerComponent=function(){function AltaiFileListInnerComponent(){this.controller=AltaiFileListInnerComponentController,this.templateUrl="/api/template/Admin/FileManager:FileListInner",this.bindings={results:"=",displayMode:"=",selection:"="}}return AltaiFileListInnerComponent}();AltaiFileManager.AltaiFileListInnerComponent=AltaiFileListInnerComponent;var AltaiFileListInnerComponentController=function(){function AltaiFileListInnerComponentController(altaiFileManager,altaiFileSelectionService,wmContainerFactory,altaiConfirmationService,contentItemService){this.altaiFileManager=altaiFileManager,this.altaiFileSelectionService=altaiFileSelectionService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentItemService=contentItemService,this.displayMode="grid",this.documentExtensions=[".docx",".pdf",".pptx",".xlsx"];var ctrl=this;ctrl.selectedItems=altaiFileSelectionService.getSelection(ctrl.selection)}return AltaiFileListInnerComponentController.prototype.openCreateFileWindow=function(){this.wmContainerFactory.createWindow(AltaiFileManager.FileManagerWindows.fileCreate,"CreateFile")},AltaiFileListInnerComponentController.prototype.selectFile=function(file){var ctrl=this;this.selectable?ctrl.altaiFileSelectionService.selectSelectableFile(ctrl.selection,file):ctrl.altaiFileSelectionService.selectFile(ctrl.selection,file)},AltaiFileListInnerComponentController.prototype.isSelected=function(id){if(this.selectable)for(var ctrl=this,i=0;i<ctrl.selectedItems.length;i++)if(ctrl.selectedItems[i].id==id)return!0;return!1},AltaiFileListInnerComponentController.prototype.updateFile=function(file){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,"Update file",file.id)},AltaiFileListInnerComponentController.prototype.deleteFile=function(file){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.contentItemService["delete"](file).then(function(){})})},AltaiFileListInnerComponentController}()}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){function FileListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiFileManager.FileManagerWindows.fileList,"Files")}AltaiFileManager.FileListController=FileListController}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiFileCreateComponent=function(){function AltaiFileCreateComponent(){this.templateUrl="/api/template/Admin/FileCreate",this.controller=AltaiFileCreateComponentController,this.bindings={languages:"<",selectionKey:"<",embedded:"@",instantUpload:"@"}}return AltaiFileCreateComponent}();AltaiFileManager.AltaiFileCreateComponent=AltaiFileCreateComponent;var AltaiFileCreateComponentController=function(){function AltaiFileCreateComponentController(altaiFileManager,altaiFileSelectionService,wmContainerFactory,Upload,$q,altaiNotificationFactory,$rootScope){this.altaiFileManager=altaiFileManager,this.altaiFileSelectionService=altaiFileSelectionService,this.wmContainerFactory=wmContainerFactory,this.Upload=Upload,this.$q=$q,this.altaiNotificationFactory=altaiNotificationFactory,this.$rootScope=$rootScope,this.files=[],this.invalidExtension=!1}return AltaiFileCreateComponentController.prototype.$onInit=function(){this.embedded||this.initToolbar()},AltaiFileCreateComponentController.prototype.initToolbar=function(){var vm=this;vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-upload",translatableLabelId:"Upload",action:function(){vm.uploadFiles(vm.files)},"class":"altai-button-primary",name:"upload",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiFileCreateComponentController.prototype.selectFiles=function(files){this.instantUpload?this.uploadFiles(files):this.addFilesToModel(files)},AltaiFileCreateComponentController.prototype.addFilesToModel=function(files){for(var f=0;f<files.length;f++)this.files.push(files[f])},AltaiFileCreateComponentController.prototype.uploadFiles=function(files){for(var ctrl=this,uploadPromisses=[],f=0;f<files.length;f++)!function(newFile){100!=newFile.progress&&uploadPromisses.push(ctrl.Upload.upload({url:"/api/upload/",file:newFile}).then(function(resultFileName){if(resultFileName&&"UNSUPPORTED_FILE_EXTENSION"==resultFileName.data)ctrl.invalidExtension=!0;else{if(!newFile.labelTranslatable){newFile.labelTranslatable={translatableValues:[]};for(var l=0;l<ctrl.languages.length;l++)newFile.labelTranslatable.translatableValues.push({languageCode:ctrl.languages[l].code,value:newFile.name})}ctrl.$rootScope.$broadcast("fileUploadInProgress"),ctrl.altaiFileManager.add({name:resultFileName.data,labelTranslatable:newFile.labelTranslatable,size:newFile.size,fileType:newFile.type}).then(function(result){ctrl.altaiFileSelectionService.selectFile(ctrl.selectionKey,result),ctrl.$rootScope.$broadcast("fileUploadDone")})}},function(response){response.status>0&&alert(response.data)},function(evt){newFile.progress=Math.min(100,100*evt.loaded/evt.total)}))}(files[f]);uploadPromisses.length>0&&this.$q.all(uploadPromisses).then(function(){ctrl.files=[],ctrl.invalidExtension?ctrl.altaiNotificationFactory.error("Unsupported file extension"):ctrl.altaiNotificationFactory.success("Upload succeeded"),ctrl.invalidExtension=!1})},AltaiFileCreateComponentController}()}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiFileListComponent=function(){function AltaiFileListComponent(){this.controller=AltaiFileListComponentController,this.templateUrl="/api/template/Admin/FileList",this.bindings={selection:"=",selectable:"="}}return AltaiFileListComponent}();AltaiFileManager.AltaiFileListComponent=AltaiFileListComponent;var AltaiFileListComponentController=function(){function AltaiFileListComponentController(altaiFileManager,altaiFileSelectionService,wmContainerFactory,altaiConfirmationService,contentItemService,$scope,$filter){this.altaiFileManager=altaiFileManager,this.altaiFileSelectionService=altaiFileSelectionService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentItemService=contentItemService,this.$filter=$filter,this.mode="grid",this.fileSearchModel={page:0},this.documentExtensions=[".docx",".pdf",".pptx",".xlsx"];var ctrl=this;ctrl.getData(),ctrl.selectedItems=altaiFileSelectionService.getSelection(ctrl.selection),$scope.$watch("$ctrl.fileSearchModel",function(){ctrl.getData()},!0),$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){ctrl.getData()}),this.initFilters()}return AltaiFileListComponentController.prototype.getData=function(){var ctrl=this;ctrl.altaiFileManager.listAdvanced(ctrl.fileSearchModel).then(function(files){ctrl.files=files})},AltaiFileListComponentController.prototype.initFilters=function(){var vm=this;this.docFilter={name:vm.$filter("translate")("documents"),childItems:[]},this.imageFilter={name:vm.$filter("translate")("images")};for(var i=0;i<this.documentExtensions.length;i++)this.docFilter.childItems.push({name:this.documentExtensions[i]});this.filterSettings={doc:this.docFilter.name,image:this.imageFilter.name},this.activeDocFilters=[],this.activeImageFilters=[]},AltaiFileListComponentController.prototype.openCreateFileWindow=function(){this.wmContainerFactory.createWindow(AltaiFileManager.FileManagerWindows.fileCreate,"CreateFile")},AltaiFileListComponentController.prototype.changeViewMode=function(newMode){this.mode=newMode},AltaiFileListComponentController.prototype.openPage=function(pageIndex){this.fileSearchModel.page=pageIndex},AltaiFileListComponentController.prototype.selectFile=function(file){var ctrl=this;this.selectable?ctrl.altaiFileSelectionService.selectSelectableFile(ctrl.selection,file):ctrl.altaiFileSelectionService.selectFile(ctrl.selection,file)},AltaiFileListComponentController.prototype.isSelected=function(id){if(this.selectable)for(var ctrl=this,i=0;i<ctrl.selectedItems.length;i++)if(ctrl.selectedItems[i].id==id)return!0;return!1},AltaiFileListComponentController.prototype.updateFile=function(file){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,"Update file",file.id)},AltaiFileListComponentController.prototype.deleteFile=function(file){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.contentItemService["delete"](file).then(function(){ctrl.getData()})})},AltaiFileListComponentController}()}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var FileManagerWindows=function(){function FileManagerWindows(){}return FileManagerWindows}();FileManagerWindows.fileList=new AltaiWindowManager.wmWindowType("fileList","<altai-file-list selection='vm.window.entityId'></altai-file-list>",600,960,1600),FileManagerWindows.selectableFilelist=new AltaiWindowManager.wmWindowType("fileList","<altai-file-list selection='vm.window.entityId' selectable='true'></altai-file-list>",600,960,1600),FileManagerWindows.fileCreate=new AltaiWindowManager.wmWindowType("fileCreate","<altai-file-create languages='vm.languages'></altai-file-create>",800,960,1600,!0,!0),AltaiFileManager.FileManagerWindows=FileManagerWindows,config.windows.push(FileManagerWindows.fileList),config.windows.push(FileManagerWindows.selectableFilelist),config.windows.push(FileManagerWindows.fileCreate)}(AltaiFileManager||(AltaiFileManager={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiFileManager;!function(AltaiFileManager_1){var AltaiFileManager=function(_super){function AltaiFileManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/file","File",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(AltaiFileManager,_super),AltaiFileManager.prototype.add=function(newItem){var d=this.$q.defer(),s=this;return this.$http.post(this.apiUrl,newItem).success(function(result){s.listAdvanced(s.lastUsedSearchModel),d.resolve(result)}).error(function(result){s.error("Could not POST "+this.apiUrl)}),d.promise},AltaiFileManager.prototype.listAdvanced=function(searchModel){var d=this.$q.defer(),service=this;return searchModel&&(service.lastUsedSearchModel=searchModel,this.dataList.length?d.resolve(this.dataList):this.$http.post(this.apiUrl+"/list",searchModel).success(function(result){angular.copy(result,service.dataList),d.resolve(service.dataList)}).error(function(){service.error("Could not GET "+this.apiUrl),d.reject()})),d.promise},AltaiFileManager}(AltaiCore.AltaiDataService);AltaiFileManager_1.AltaiFileManager=AltaiFileManager}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiFileSelectionService=function(){function AltaiFileSelectionService(){this.selectionMode={},this.selection={}}return AltaiFileSelectionService.prototype.selectFile=function(selection,file){this.selection[selection]||(this.selection[selection]=[]),!this.isFileSelected(selection,file)&&this.hasRoomLeft(selection)&&this.selection[selection].push(file)},AltaiFileSelectionService.prototype.selectSelectableFile=function(selection,file){this.selection[selection]||(this.selection[selection]=[]),this.isFileSelected(selection,file)?this.selection[selection].splice(this.getFileSelectedId(selection,file),1):!this.isFileSelected(selection,file)&&this.hasRoomLeft(selection)&&this.selection[selection].push(file)},AltaiFileSelectionService.prototype.isFileSelected=function(selection,file){return this.getFileSelectedId(selection,file)>=0},AltaiFileSelectionService.prototype.getFileSelectedId=function(selection,file){return this.selection[selection].indexOf(file)},AltaiFileSelectionService.prototype.hasRoomLeft=function(selection){return this.selection[selection]||(this.selection[selection]=[]),this.selectionMode[selection]?!0:0===this.selection[selection].length},AltaiFileSelectionService.prototype.getSelection=function(selection){return this.selection[selection]||(this.selection[selection]=[]),this.selection[selection]},AltaiFileSelectionService.prototype.removeFromSelection=function(selection,file){var index=this.selection[selection].indexOf(file);this.selection[selection].splice(index,1)},AltaiFileSelectionService.prototype.clearSelection=function(selection){this.selection[selection]=[]},AltaiFileSelectionService.prototype.setMode=function(selection,allowMultiple){this.selectionMode[selection]=allowMultiple},AltaiFileSelectionService}();AltaiFileManager.AltaiFileSelectionService=AltaiFileSelectionService}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiFileFilterComponent=function(){function AltaiFileFilterComponent(){this.controller=AltaiFileFilterComponentController,this.templateUrl="/api/template/Admin/fileFilter",this.bindings={inputModel:"=",outputModel:"="}}return AltaiFileFilterComponent}();AltaiFileManager.AltaiFileFilterComponent=AltaiFileFilterComponent;var AltaiFileFilterComponentController=function(){function AltaiFileFilterComponentController(){(!this.outputModel||this.outputModel.length<=0)&&(this.outputModel=[])}return AltaiFileFilterComponentController.prototype.selectTag=function(tag){var newvalue=!tag.checked;if(tag.checked=newvalue,this.updateTagInOutput(tag,newvalue),tag.childItems)for(var i=0;i<tag.childItems.length;i++)tag.childItems[i].checked=newvalue,this.updateTagInOutput(tag.childItems[i],newvalue)},AltaiFileFilterComponentController.prototype.updateTagInOutput=function(tag,ischecked){var index=this.getIndexOfTagInOuput(tag);ischecked?-1==index&&this.outputModel.push(tag.name):index>-1&&this.outputModel.splice(index,1)},AltaiFileFilterComponentController.prototype.getIndexOfTagInOuput=function(tag){for(var i=0;i<this.outputModel.length;i++)if(tag.name==this.outputModel[i])return i;return-1},AltaiFileFilterComponentController.prototype.isSelected=function(tag){return tag.checked},AltaiFileFilterComponentController}()}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){function altaiFileFilter(){return function(input,documentFilters,imageFilters,filterSettings){return input}}AltaiFileManager.altaiFileFilter=altaiFileFilter}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var FileEvents=function(){function FileEvents(){}return FileEvents}();FileEvents.fileUploadedEvent="fileUploadedEvent",AltaiFileManager.FileEvents=FileEvents}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var AltaiContentRelationFileListComponent=function(){function AltaiContentRelationFileListComponent(){this.controller=AltaiFileListComponentController,this.templateUrl="/api/template/Admin/FileManager:ContentRelationFilelist",this.bindings={model:"=",contentTypeRelationLink:"<",inputModel:"=",languages:"="},this.require={altaiContentItemCreate:"?^altaiContentItemCreate",altaiContentItemUpdate:"?^altaiContentItemUpdate"}}return AltaiContentRelationFileListComponent}();AltaiFileManager.AltaiContentRelationFileListComponent=AltaiContentRelationFileListComponent;var AltaiFileListComponentController=function(){function AltaiFileListComponentController(altaiFileSelectionService,$scope,contentItemService,$q,wmContainerFactory){this.altaiFileSelectionService=altaiFileSelectionService,this.contentItemService=contentItemService,this.$q=$q,this.wmContainerFactory=wmContainerFactory;var ctrl=this;
ctrl.fileManagerSelectionkey="rel"+ctrl.contentTypeRelationLink.id,ctrl.altaiFileSelectionService.clearSelection(ctrl.fileManagerSelectionkey),ctrl.selectedFiles=altaiFileSelectionService.getSelection(ctrl.fileManagerSelectionkey),altaiFileSelectionService.setMode(ctrl.fileManagerSelectionkey,ctrl.contentTypeRelationLink.allowMultiple),this.sortableOptions={handle:".file-sort-handle"},$scope.$watch("$ctrl.selectedFiles",function(val){val&&val.length>0&&(ctrl.updateModel(),updateModelParsed())},!0);var updateModelParsed=$scope.$watch("$ctrl.model",function(){ctrl.model&&ctrl.model.length&&(ctrl.buildInitialModel(),updateModelParsed())},!0)}return AltaiFileListComponentController.prototype.buildInitialModel=function(){function addFileToServiceModel(file){var defer=ctrl.$q.defer();return ctrl.loadFile(file).then(function(formattedFile){ctrl.selectedFiles.push(formattedFile),ctrl.addSaveObserver(formattedFile),defer.resolve()}),defer.promise}var ctrl=this;this.model&&this.model.reduce(function(p,val){return void 0===p.then&&(p.resolve(),p=p.promise),p.then(function(){return addFileToServiceModel(val)})},ctrl.$q.defer())},AltaiFileListComponentController.prototype.openFileManager=function(){this.wmContainerFactory.createWindow(AltaiFileManager.FileManagerWindows.selectableFilelist,this.contentTypeRelationLink.label,"rel"+this.contentTypeRelationLink.id)},AltaiFileListComponentController.prototype.loadFile=function(file){var ctrl=this,defer=this.$q.defer();return this.contentItemService.getById(file.id,!1).then(function(fileItemData){var labelTranslatable=fileItemData.contentItemAttributes.filter(ctrl.filterTranslatableLabel),fileInfo=fileItemData.contentItemAttributes.filter(ctrl.filterFile);if(file.imagePath=fileInfo[0].value,file.contentItemAttributes=fileItemData.contentItemAttributes,file.contentItemRelationLinks=fileItemData.contentItemRelationLinks,file.contentType=fileItemData.contentType,file.contentTypeId=fileItemData.contentTypeId,labelTranslatable&&labelTranslatable.length>0&&(file.labelTranslatable=labelTranslatable[0].translatable,file.labelTranslatableId=labelTranslatable[0].translatable.id),file.name=fileItemData.name,file.editable=!0,!file.isImage&&file.imagePath)var imageIndex=file.imagePath.toLowerCase().indexOf(".png")&&file.imagePath.toLowerCase().indexOf(".jpg");-1==imageIndex?file.isImage=!1:file.isImage=!0,defer.resolve(file)}),defer.promise},AltaiFileListComponentController.prototype.filterTranslatableLabel=function(value){return!!(value&&value.contentTypeAttribute&&value.contentTypeAttribute.attribute&&value.contentTypeAttribute.attribute.name&&"label"==value.contentTypeAttribute.attribute.name)},AltaiFileListComponentController.prototype.filterFile=function(value){return!!(value&&value.contentTypeAttribute&&value.contentTypeAttribute.attribute&&value.contentTypeAttribute.attribute.name.indexOf("file")>-1)},AltaiFileListComponentController.prototype.deleteFile=function(id){var ctrl=this;this.selectedFiles.map(function(value,index){value.id==id&&ctrl.selectedFiles.splice(index,1)}),this.model.map(function(value,index){value.id==id&&ctrl.model.splice(index,1)})},AltaiFileListComponentController.prototype.updateModel=function(){var ctrl=this;if(ctrl.selectedFiles){var newFiles=ctrl.getNewlyAddedFiles();if(newFiles.length){for(var i=0;i<newFiles.length;i++)!function(i){ctrl.addSaveObserver(newFiles[i])}(i);ctrl.addNewlyAddedFilesToModel(newFiles)}else ctrl.selectedFiles.length==ctrl.model.length&&ctrl.syncOrderBetweenModels()}},AltaiFileListComponentController.prototype.addSaveObserver=function(file){function updateFile(){var d=ctrl.$q.defer();return ctrl.contentItemService.update(file).then(function(result){d.resolve(result)}),d.promise}var ctrl=this,parentController=ctrl.altaiContentItemCreate?ctrl.altaiContentItemCreate:ctrl.altaiContentItemUpdate;parentController&&parentController.observeSave(updateFile)},AltaiFileListComponentController.prototype.getNewlyAddedFiles=function(){var ctrl=this;return ctrl.selectedFiles.filter(function(value,index){return value.index=index,0==ctrl.model.filter(function(val2){return value.id==val2.id}).length})},AltaiFileListComponentController.prototype.addNewlyAddedFilesToModel=function(newFiles){for(var ctrl=this,i=0;i<newFiles.length;i++)newFiles[i].contentItemAttributes||(ctrl.model.push({id:newFiles[i].id,order:ctrl.model.length}),function(file){ctrl.loadFile(file).then(function(r){ctrl.selectedFiles[file.index]=r})}(newFiles[i]))},AltaiFileListComponentController.prototype.syncOrderBetweenModels=function(){for(var sortedModel=[],ctrl=this,i=0;i<ctrl.selectedFiles.length;i++){var items=this.model.filter(function(value){return value.id==ctrl.selectedFiles[i].id});items.length&&sortedModel.push({id:items[0].id})}this.model=sortedModel,this.updateModelOrder()},AltaiFileListComponentController.prototype.updateModelOrder=function(){var i=0;this.model.map(function(value){value.order=i++})},AltaiFileListComponentController}()}(AltaiFileManager||(AltaiFileManager={}));var AltaiFileManager;!function(AltaiFileManager){var mod=angular.module("altai.filemanager",["altai.content"]);mod.component("altaiFileList",new AltaiFileManager.AltaiFileListComponent),mod.component("altaiFileCreate",new AltaiFileManager.AltaiFileCreateComponent),mod.component("altaiFileFilter",new AltaiFileManager.AltaiFileFilterComponent),mod.component("altaiContentRelationFileList",new AltaiFileManager.AltaiContentRelationFileListComponent),mod.component("altaiFileListInner",new AltaiFileManager.AltaiFileListInnerComponent),mod.service("altaiFileManager",AltaiFileManager.AltaiFileManager),mod.service("altaiFileSelectionService",AltaiFileManager.AltaiFileSelectionService),mod.filter("altaiFileFilter",AltaiFileManager.altaiFileFilter),mod.config(function($stateProvider){$stateProvider.state("admin.filemanager",{url:"/file",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiFileManager.FileListController}}})}),config.modules.push(mod.name)}(AltaiFileManager||(AltaiFileManager={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiTextBlockModule;!function(AltaiTextBlockModule){var TextBlockManager=function(_super){function TextBlockManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/textblock","textblock",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(TextBlockManager,_super),TextBlockManager}(AltaiCore.AltaiDataService);AltaiTextBlockModule.TextBlockManager=TextBlockManager}(AltaiTextBlockModule||(AltaiTextBlockModule={}));var AltaiTextBlockModule;!function(AltaiTextBlockModule){var AltaiTextBlockComponent=function(){function AltaiTextBlockComponent(){this.controller=AltaiTextBlockController,this.template="<div ng-transclude></div>",this.transclude=!0,this.bindings={textBlockId:"=altaiBbInstanceId"}}return AltaiTextBlockComponent}();AltaiTextBlockModule.AltaiTextBlockComponent=AltaiTextBlockComponent;var AltaiTextBlockController=function(){function AltaiTextBlockController(){}return AltaiTextBlockController}()}(AltaiTextBlockModule||(AltaiTextBlockModule={}));var AltaiTextBlockModule;!function(AltaiTextBlockModule){var AltaiTextBlockBuildingBlockUpdateComponent=function(){function AltaiTextBlockBuildingBlockUpdateComponent(){this.templateUrl="/api/template/Admin/AltaiTextBlockBuildingBlockUpdateComponent",this.controller=AltaiTextBlockBuildingBlockUpdateComponentController,this.bindings={textBlockId:"=",buildingBlockId:"="}}return AltaiTextBlockBuildingBlockUpdateComponent}();AltaiTextBlockModule.AltaiTextBlockBuildingBlockUpdateComponent=AltaiTextBlockBuildingBlockUpdateComponent;var AltaiTextBlockBuildingBlockUpdateComponentController=function(){function AltaiTextBlockBuildingBlockUpdateComponentController(languageFactory,buildingBlockManager,textBlockManager){this.languageFactory=languageFactory,this.buildingBlockManager=buildingBlockManager,this.textBlockManager=textBlockManager;var ctrl=this;textBlockManager.getById(ctrl.textBlockId).then(function(textBlock){ctrl.textBlock=textBlock})}return AltaiTextBlockBuildingBlockUpdateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.saveTextBlock()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiTextBlockBuildingBlockUpdateComponentController.prototype.saveTextBlock=function(){var ctrl=this;ctrl.textBlockManager.update(ctrl.textBlock).then(function(result){ctrl.buildingBlockManager.reloadBuildingBlock(ctrl.buildingBlockId)})},AltaiTextBlockBuildingBlockUpdateComponentController}()}(AltaiTextBlockModule||(AltaiTextBlockModule={}));var AltaiTextBlockModule;!function(AltaiTextBlockModule){var mod=angular.module("altai.textblock",[]);mod.component("altaiTextBlock",new AltaiTextBlockModule.AltaiTextBlockComponent),mod.component("altaiTextBlockBuildingBlockUpdate",new AltaiTextBlockModule.AltaiTextBlockBuildingBlockUpdateComponent),mod.service("textBlockManager",AltaiTextBlockModule.TextBlockManager),mod.config(function(buildingBlockTypeProvider){buildingBlockTypeProvider.add({name:"TextBlock",icon:"mdi-format-align-center",label:"TextBlock",directive:"altai-text-block",updateComponent:"<altai-text-block-building-block-update text-block-id='activeBuildingBlockInstanceId' building-block-id='activeBuildingBlockId'></altai-text-block-building-block-update>"})})}(AltaiTextBlockModule||(AltaiTextBlockModule={})),config.modules.push("altai.textblock");var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMyFavouriteModule;!function(AltaiMyFavouriteModule){var MyFavouriteManager=function(_super){function MyFavouriteManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"api/elasticsearch/favourites","myFavourites",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MyFavouriteManager,_super),MyFavouriteManager.prototype.getMyFavourites=function(lang){var d=this.$q.defer();return this.$http({method:"GET",url:this.apiUrl+"/",headers:{"Accept-Language":lang}}).success(function(contentData){d.resolve(contentData)}),d.promise},MyFavouriteManager}(AltaiCore.AltaiDataService);AltaiMyFavouriteModule.MyFavouriteManager=MyFavouriteManager}(AltaiMyFavouriteModule||(AltaiMyFavouriteModule={}));var AltaiMyFavouriteModule;!function(AltaiMyFavouriteModule){var AltaiMyFavouriteComponent=function(){function AltaiMyFavouriteComponent(){this.controller=AltaiMyFavouriteController,this.templateUrl="/api/template/Admin/FavouriteContentItemComponent"}return AltaiMyFavouriteComponent}();AltaiMyFavouriteModule.AltaiMyFavouriteComponent=AltaiMyFavouriteComponent;var AltaiMyFavouriteController=function(){function AltaiMyFavouriteController($scope,myFavouriteManager){this.myFavouriteManager=myFavouriteManager,this.contentItems=[];var ctrl=this;myFavouriteManager.getMyFavourites().then(function(contentItemData){ctrl.contentItems=contentItemData})}return AltaiMyFavouriteController}()}(AltaiMyFavouriteModule||(AltaiMyFavouriteModule={}));var AltaiMyFavouriteModule;!function(AltaiMyFavouriteModule){var mod=angular.module("altai.myfavourite",[]);mod.component("altaiMyFavourite",new AltaiMyFavouriteModule.AltaiMyFavouriteComponent),mod.service("myFavouriteManager",AltaiMyFavouriteModule.MyFavouriteManager),mod.config(function(buildingBlockTypeProvider){buildingBlockTypeProvider.add({name:"MyFavourite",icon:"mdi mdi-heart",label:"My Favourites",directive:"altai-my-favourite"})})}(AltaiMyFavouriteModule||(AltaiMyFavouriteModule={})),config.modules.push("altai.myfavourite");var AltaiTextEditor;!function(AltaiTextEditor){var angularRoot;CKEDITOR.plugins.add("altaiLink",{init:function(editor){editor.addCommand("insertAltaiLink",{exec:function(){angularRoot.$broadcast("altaiLinkOpened",{editor:editor})}}),editor.ui.addButton("AltaiLink",{label:"Insert altai link",command:"insertAltaiLink",toolbar:"insert",icon:"anchor"});var pluginDirectory=this.path;editor.addContentsCss(pluginDirectory+"styles/altaiLink.css")}});var contentSubItemList;CKEDITOR.dialog.add("altaiLinkDialog",function(editor){return{title:"Create altai link",minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Basic Settings",elements:[{type:"select",id:"contentItemId",label:"Content item",items:[[editor.lang.common.notSet,""]],onChange:function(){contentSubItemList.clear();var value=this.getValue();contentSubItemList.add(editor.lang.common.notSet,"");var accessToken=localStorage.getItem("accessToken");$.ajax({url:"/api/content/"+value+"/linkedItems",type:"GET",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+accessToken)},success:function(data){$.each(data,function(key,val){contentSubItemList.add(val.contentTypeName+" | "+val.name,val.id)})}})},onLoad:function(widget){var selectList=this;alert("load"),angularRoot.$broadcast("test");var accessToken=localStorage.getItem("accessToken");$.ajax({url:"/api/content/list",type:"GET",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+accessToken)},success:function(data){$.each(data,function(key,val){selectList.add(val.contentTypeName+" | "+val.name,val.id)})}})}},{type:"select",id:"contentItemSubItemId",label:"Content subitem",items:[[editor.lang.common.notSet,""]],onLoad:function(widget){contentSubItemList=this}}]}],onOk:function(){var dialog=this,contentItemId=dialog.getValueOf("tab-basic","contentItemId"),contentItemSubItemId=dialog.getValueOf("tab-basic","contentItemSubItemId"),selection=editor.getSelection();if(contentItemId){var output='<span altai-link content-item-target="'+contentItemId+'"';contentItemSubItemId&&(output+='content-sub-item-target="'+contentItemSubItemId+'"');var text=encodeURI(selection.getSelectedText());output+=' text="'+text+'">'+text+"</span>",console.log(output),editor.insertHtml(output)}}}});var AltaiTextEditorComponent=function(){function AltaiTextEditorComponent(){this.controller=AltaiTextEditorController,this.restrict="E",this.template="<div></div>",this.require={ngModel:"?ngModel"},this.bindings={template:"@"}}return AltaiTextEditorComponent}();AltaiTextEditor.AltaiTextEditorComponent=AltaiTextEditorComponent;var AltaiTextEditorController=function(){function AltaiTextEditorController($scope,contentItemSelectionService,$rootScope,$element,$timeout,wmContainerFactory){this.$scope=$scope,this.contentItemSelectionService=contentItemSelectionService,this.$rootScope=$rootScope,this.$element=$element,this.$timeout=$timeout;var ctrl=this;angularRoot=$scope,$scope.$on("dragstart",function(){CKEDITOR.instances[ctrl.ck.name].destroy()}),$scope.$on("dragstop",function(){ctrl.startEditor()}),angularRoot.$on("altaiLinkOpened",function(event,args){var selectionWin,selectionKey="altaiLink"+Math.floor(1e3*Math.random()+1);$scope.$apply(function(){selectionWin=wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemSelect,"Select",null,{selectionKey:selectionKey})}),contentItemSelectionService.observeSelection(selectionKey,function(){var contentItem=contentItemSelectionService.getSelection(selectionKey)[0],selection=args.editor.getSelection();if(contentItem){var output='<span altai-link content-item-target="'+contentItem.id+'" content-type-id="'+contentItem.contentTypeId+'"',text=selection.getSelectedText();0==text.length&&(text="altai-link"),output+=' text="'+text+'">'+text+"</span>",args.editor.insertHtml(output),contentItemSelectionService.removeFromSelection(selectionKey,contentItem)}selectionWin&&wmContainerFactory.destroyWindow(selectionWin.id)})})}return AltaiTextEditorController.prototype.startEditor=function(){var ctrl=this,replaceElm=ctrl.$element[0].children[0];"complex"==ctrl.template&&(ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",allowedContent:!0,skin:"moono-lisa",extraAllowedContent:"a(*){*}[*]",height:"500",width:"100%",format_tags:"p;h2;h3",extraPlugins:"altaiLink,altaiUpload,justify,find,tableresize,iframe",imageBrowser_listUrl:"/api/image",toolbar:[{name:"basicstyles",items:["Bold","Subscript","Superscript","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"links",items:["Link","Unlink","AltaiLink"]},{name:"insert",items:["AltaiUpload","AltaiUploadImage","Table","Iframe"]},{name:"clipboard",items:["-","Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"styles",items:["Format"]},{name:"document",items:["Source"]},{name:"tools",items:["Maximize","ShowBlocks"]}]})),"complexsmall"==ctrl.template&&(ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",allowedContent:!0,skin:"moono-lisa",extraAllowedContent:"a(*){*}[*]",height:"100",width:"100%",format_tags:"p;h2;h3",extraPlugins:"altaiLink,altaiUpload,justify,find,tableresize,iframe",imageBrowser_listUrl:"/api/image",toolbar:[{name:"basicstyles",items:["Bold","Subscript","Superscript","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"links",items:["Link","Unlink","AltaiLink"]},{name:"insert",items:["AltaiUpload","AltaiUploadImage","Table","Iframe"]},{name:"clipboard",items:["-","Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"styles",items:["Format"]},{name:"document",items:["Source"]},{name:"tools",items:["Maximize","ShowBlocks"]}]})),"complexmiddle"==ctrl.template?ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",allowedContent:!0,skin:"moono-lisa",extraAllowedContent:"a(*){*}[*]",height:"200",width:"100%",format_tags:"p;h2;h3",extraPlugins:"altaiLink,altaiUpload,justify,find,tableresize,iframe",imageBrowser_listUrl:"/api/image",toolbar:[{name:"basicstyles",items:["Bold","Subscript","Superscript","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"links",items:["Link","Unlink","AltaiLink"]},{name:"insert",items:["AltaiUpload","AltaiUploadImage","Table","Iframe"]},{name:"clipboard",items:["-","Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"styles",items:["Format"]},{name:"document",items:["Source"]},{name:"tools",items:["Maximize","ShowBlocks"]}]}):"complexpageeditor"==ctrl.template?ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",allowedContent:!0,skin:"moono-lisa",extraAllowedContent:"a(*){*}[*]",height:"500",width:"100%",format_tags:"p;h1;h2;h3;h4",extraPlugins:"altaiLink,altaiUpload,justify,find,tableresize,iframe",imageBrowser_listUrl:"/api/image",toolbar:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"links",items:["Link","Unlink","AltaiLink"]},{name:"insert",items:["AltaiUpload","AltaiUploadImage","Table","Iframe"]},{name:"clipboard",items:["-","Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"styles",items:["Format"]},{name:"document",items:["Source"]},{name:"tools",items:["Maximize","ShowBlocks"]}]}):"minimal"==ctrl.template?ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",width:"100%",height:100,skin:"moono-lisa",imageBrowser_listUrl:"/api/image",removeButtons:"Source,Save,NewPage,DocProps,Preview,Print,Templates,document,Cut,Copy,Paste,PasteText,PasteFromWord,Undo,Redo,Find,Replace,SelectAll,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Bold,Italic,Underline,Strike,Subscript,Superscript,RemoveFormat,NumberedList,BulletedList,Outdent,Indent,Blockquote,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,BidiLtr,BidiRtl,Link,Unlink,Anchor,CreatePlaceholder,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,InsertPre,Styles,Format,Font,FontSize,TextColor,BGColor,UIColor,Maximize,ShowBlocks,button1,button2,button3,oembed,MediaEmbed,About",toolbarGroups:[]}):"minimalsmall"==ctrl.template&&(ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",width:"100%",height:100,skin:"moono-lisa",imageBrowser_listUrl:"/api/image",removeButtons:"Source,Save,NewPage,DocProps,Preview,Print,Templates,document,Cut,Copy,Paste,PasteText,PasteFromWord,Undo,Redo,Find,Replace,SelectAll,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Bold,Italic,Underline,Strike,Subscript,Superscript,RemoveFormat,NumberedList,BulletedList,Outdent,Indent,Blockquote,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,BidiLtr,BidiRtl,Link,Unlink,Anchor,CreatePlaceholder,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,InsertPre,Styles,Format,Font,FontSize,TextColor,BGColor,UIColor,Maximize,ShowBlocks,button1,button2,button3,oembed,MediaEmbed,About",toolbarGroups:[]})),"complexemail"==ctrl.template&&(ctrl.ck=CKEDITOR.replace(replaceElm,{customConfig:"",fullPage:!0,allowedContent:{$1:{elements:CKEDITOR.dtd,attributes:!0,styles:!0,classes:!0}},skin:"moono-lisa",disallowedContent:"iframe",extraAllowedContent:"a(*){*}[*]",height:"500",width:"100%",format_tags:"p;h2;h3",extraPlugins:"altaiLink,altaiUpload,justify,find,tableresize",imageBrowser_listUrl:"/api/image",toolbar:[{name:"basicstyles",items:["Bold","Subscript","Superscript","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"links",items:["Link","Unlink","AltaiLink"]},{name:"insert",items:["AltaiUpload","AltaiUploadImage","Table","Iframe"]},{name:"clipboard",items:["-","Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"styles",items:["Format"]},{name:"document",items:["Source"]},{name:"tools",items:["Maximize","ShowBlocks"]}],removeButtons:"Iframe"}))},AltaiTextEditorController.prototype.dataFiltered=function(){var ctrl=this;ctrl.$timeout(function(){ctrl.ngModel.$setViewValue(ctrl.ck.getData())})},AltaiTextEditorController.prototype.$onInit=function(){var ctrl=this;ctrl.startEditor(),ctrl.ck.on("change",function(){ctrl.$timeout(function(){ctrl.ngModel.$setViewValue(ctrl.ck.getData())})}),ctrl.ck.on("dataReady",function(event){ctrl.$timeout(function(){ctrl.ngModel.$setViewValue(ctrl.ck.getData())})}),ctrl.ngModel.$render=function(value){ctrl.ck.setData(ctrl.ngModel.$viewValue)}},AltaiTextEditorController}()}(AltaiTextEditor||(AltaiTextEditor={}));var AltaiTextEditor;!function(AltaiTextEditor){var mod=angular.module("altai.texteditor",["ngSanitize"]);mod.component("altaiTextEditor",new AltaiTextEditor.AltaiTextEditorComponent),config.modules.push(mod.name)}(AltaiTextEditor||(AltaiTextEditor={}));var ComeosModule;!function(ComeosModule){var UnsubscribeActuController=function(){function UnsubscribeActuController($scope,$http,urlParameterService,$state){this.$http=$http,this.urlParameterService=urlParameterService,this.$state=$state,this.loading=!1,this.unsubscribed=!1,this.error=!1}return UnsubscribeActuController.prototype.unsubscribe=function(){var vm=this;vm.loading=!0,vm.$http.get("api/comeos/unsubscribeactu?userToken="+vm.urlParameterService("userToken")).then(function(result){result?(vm.loading=!1,vm.error=!1,vm.unsubscribed=!0,setTimeout(function(){vm.$state.go("Root.Home")},5e3)):(vm.loading=!1,vm.error=!0,vm.unsubscribed=!1)})},UnsubscribeActuController.prototype.cancel=function(){var vm=this;vm.$state.go("Root.Home")},UnsubscribeActuController}();ComeosModule.UnsubscribeActuController=UnsubscribeActuController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var UnsubscribeController=function(){function UnsubscribeController($scope,$http,urlParameterService,$state){this.$http=$http,this.urlParameterService=urlParameterService,this.$state=$state,this.loading=!1,this.unsubscribed=!1,this.error=!1}return UnsubscribeController.prototype.unsubscribe=function(){var vm=this;vm.loading=!0,vm.$http.get("api/comeos/unsubscribe?userToken="+vm.urlParameterService("userToken")).then(function(result){result?(vm.loading=!1,vm.error=!1,vm.unsubscribed=!0,setTimeout(function(){vm.$state.go("Root.Home")},5e3)):(vm.loading=!1,vm.error=!0,vm.unsubscribed=!1)})},UnsubscribeController.prototype.cancel=function(){var vm=this;vm.$state.go("Root.Home")},UnsubscribeController}();ComeosModule.UnsubscribeController=UnsubscribeController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SummarySheetComponent=function(){function SummarySheetComponent(){this.restrict="E",this.bindings={summarysheetmodel:"="},this.templateUrl="/api/template/Component/SummarySheetComponent",this.controller=SummarySheetComponentController}return SummarySheetComponent}();ComeosModule.SummarySheetComponent=SummarySheetComponent;var SummarySheetComponentController=function(){function SummarySheetComponentController($sce,$scope,contentItemService,contentTypeService,contentCollectionManager,contentCollectionDataService){this.$sce=$sce,this.$scope=$scope,this.contentItemService=contentItemService,this.contentTypeService=contentTypeService,this.contentCollectionManager=contentCollectionManager,this.contentCollectionDataService=contentCollectionDataService,this.summarysheetitems=[],this.convertedSummarySheet=[],this.showAllThemes=!1;var vm=this;$scope.$watch("$scope.summarysheetmodel",function(newmodel){void 0!=vm.summarysheetmodel&&vm.init()},!0)}return SummarySheetComponentController.prototype.init=function(){var vm=this;vm.summarysheetitems=vm.summarysheetmodel.sfitemsummarysheet,vm.contentCollectionDataService.getData(2).then(function(data){vm.themes=data.pageResults,vm.buildConvertedSummarySheet()})},SummarySheetComponentController.prototype.buildConvertedSummarySheet=function(){for(var vm=this,i=0;i<vm.themes.length;i++){var theme=new ssTheme;if(theme.theme=vm.themes[i],vm.convertedSummarySheet.push(theme),void 0!=vm.themes[i].sfthemesftheme)for(var j=0;j<vm.themes[i].sfthemesftheme.length;j++){var subtheme=new ssSubTheme;subtheme.subtheme=vm.themes[i].sfthemesftheme[j],vm.convertedSummarySheet[i].addSSSubTheme(subtheme)}}for(var i=0;i<vm.summarysheetitems.length;i++)for(var item=new ssItem(vm.summarysheetitems[i],vm.$sce),themecounter=0,foundtheme=!1;themecounter<vm.convertedSummarySheet.length&&!foundtheme;){if(vm.summarysheetitems[i].sfthemesfitem[0].id==vm.convertedSummarySheet[themecounter].theme.id&&(foundtheme=!0,vm.convertedSummarySheet[themecounter].addSSItem(item)),!foundtheme)for(var subthemecounter=0;subthemecounter<vm.convertedSummarySheet[themecounter].ssSubthemes.length&&!foundtheme;)vm.summarysheetitems[i].sfthemesfitem[0].id==vm.convertedSummarySheet[themecounter].ssSubthemes[subthemecounter].subtheme.id&&(foundtheme=!0,vm.convertedSummarySheet[themecounter].ssSubthemes[subthemecounter].addSSItem(item)),subthemecounter++;themecounter++}vm.collapseAll()},SummarySheetComponentController.prototype.checkOpenCloseSituation=function(){for(var vm=this,allexpanded=!0,i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded||(allexpanded=!1);vm.allexpanded=allexpanded},SummarySheetComponentController.prototype.expandItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!0,vm.checkOpenCloseSituation()},SummarySheetComponentController.prototype.toggleShowAllThemes=function(){var vm=this;vm.showAllThemes=!vm.showAllThemes},SummarySheetComponentController.prototype.collapseItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!1,vm.checkOpenCloseSituation()},SummarySheetComponentController.prototype.toggleItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!vm.convertedSummarySheet[i].expanded,vm.checkOpenCloseSituation()},SummarySheetComponentController.prototype.expandAll=function(){var vm=this;vm.allexpanded=!0;for(var i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded=!0},SummarySheetComponentController.prototype.collapseAll=function(){var vm=this;vm.allexpanded=!1;for(var i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded=!1},SummarySheetComponentController.prototype.addCurrentItemToConvertedSummarySheet=function(item){},SummarySheetComponentController}();ComeosModule.SummarySheetComponentController=SummarySheetComponentController;var ssTheme=function(){function ssTheme(){this.ssItems=[],this.ssSubthemes=[],this.expanded=!1,this.hasContent=!1,this.subthemeWithContentCount=0}return ssTheme.prototype.shouldShow=function(){var vm=this;return vm.hasContent},ssTheme.prototype.addSSItem=function(itemToAdd){var vm=this;vm.ssItems.push(itemToAdd),vm.hasContent=!0},ssTheme.prototype.addSSSubTheme=function(subthemeToAdd){var vm=this;subthemeToAdd.setTheme(vm),vm.ssSubthemes.push(subthemeToAdd)},ssTheme}(),ssSubTheme=function(){function ssSubTheme(){this.ssItems=[],this.hasContent=!1}return ssSubTheme.prototype.shouldShow=function(){var vm=this;return vm.hasContent},ssSubTheme.prototype.setTheme=function(theme){var vm=this;vm.theme=theme},ssSubTheme.prototype.addSSItem=function(itemToAdd){var vm=this;vm.ssItems.push(itemToAdd),vm.hasContent=!0,vm.theme.hasContent=!0,vm.theme.subthemeWithContentCount++},ssSubTheme}(),ssItem=function(){function ssItem(item,$sce){var vm=this;vm.item=item,vm.item.description=$sce.trustAsHtml(vm.item.description)}return ssItem}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SummarySheetCompareComponent=function(){function SummarySheetCompareComponent(){this.restrict="E",this.bindings={summarysheets:"="},this.templateUrl="/api/template/Component/SummarySheetCompareComponent",this.controller=SummarySheetCompareComponentController}return SummarySheetCompareComponent}();ComeosModule.SummarySheetCompareComponent=SummarySheetCompareComponent;var SummarySheetCompareComponentController=function(){function SummarySheetCompareComponentController($sce,$scope,$timeout,exposedContentCollectionDataService){this.$sce=$sce,this.$scope=$scope,this.$timeout=$timeout,this.exposedContentCollectionDataService=exposedContentCollectionDataService,this.allexpanded=!1,this.convertedSummarySheet=[],this.showAllThemes=!1,this.comparatorInitialized=!1,this.pcNameList=[];var vm=this;$scope.$watch("$ctrl.summarysheets",function(newmodel){vm.init()},!0)}return SummarySheetCompareComponentController.prototype.init=function(){var vm=this;if(void 0!=vm.summarysheets)if(void 0==vm.themes){var searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{},ranges:[]};vm.exposedContentCollectionDataService.getData(119,searchRequest).then(function(data){void 0!=data&&(vm.themes=data.pageResults),vm.buildConvertedSummarySheet(),vm.checkOpenCloseSituation();
})}else vm.buildConvertedSummarySheet(),vm.checkOpenCloseSituation()},SummarySheetCompareComponentController.prototype.compareSummarySheets=function(sheetA,sheetB){return sheetA.pcsummarysheet.name<sheetB.pcsummarysheet.name?-1:sheetA.pcsummarysheet.name>sheetB.pcsummarysheet.name?1:0},SummarySheetCompareComponentController.prototype.buildConvertedSummarySheet=function(){var vm=this;vm.percentageWidth=100/(vm.summarysheets.length+1),vm.convertedSummarySheet.length=0,vm.pcNameList.length=0,vm.summarysheets.sort(vm.compareSummarySheets);for(var i=0;i<vm.themes.length;i++){var theme=new ssTheme;if(theme.theme=vm.themes[i],vm.convertedSummarySheet.push(theme),void 0!=vm.themes[i].sfthemesftheme)for(var j=0;j<vm.themes[i].sfthemesftheme.length;j++){var subtheme=new ssSubTheme;subtheme.subtheme=vm.themes[i].sfthemesftheme[j],vm.convertedSummarySheet[i].addSSSubTheme(subtheme)}}for(var i=0;i<vm.summarysheets.length;i++)vm.pcNameList.push(vm.summarysheets[i].pcsummarysheet.name);for(var i=0;i<vm.convertedSummarySheet.length;i++){for(var theme=vm.convertedSummarySheet[i],j=0;j<vm.summarysheets.length;j++){var summarysheet=vm.summarysheets[j],pc=summarysheet.pcsummarysheet.name,summarysheetitems=summarysheet.sfitemsummarysheet,summaryitemthemehit=!1,summaryitemthemecounter=0;if(void 0!=summarysheetitems)for(;!summaryitemthemehit&&summaryitemthemecounter<summarysheetitems.length;)theme.theme.id==summarysheetitems[summaryitemthemecounter].sfthemesfitem[0].id&&(summaryitemthemehit=!0,theme.addSSItem(new ssItem(pc,vm.$sce,summarysheetitems[summaryitemthemecounter]))),summaryitemthemecounter++;summaryitemthemehit||theme.addSSItem(new ssItem(pc,vm.$sce))}for(var k=0;k<theme.ssSubthemes.length;k++)for(var subtheme=theme.ssSubthemes[k],l=0;l<vm.summarysheets.length;l++){var summarysheet=vm.summarysheets[l],pc=summarysheet.pcsummarysheet.name,summarysheetitems=summarysheet.sfitemsummarysheet,summaryitemthemehit=!1,summaryitemsubthemecounter=0;if(void 0!=summarysheetitems)for(;!summaryitemthemehit&&summaryitemsubthemecounter<summarysheetitems.length;)subtheme.subtheme.id==summarysheetitems[summaryitemsubthemecounter].sfthemesfitem[0].id&&(summaryitemthemehit=!0,subtheme.addSSItem(new ssItem(pc,vm.$sce,summarysheetitems[summaryitemsubthemecounter]))),summaryitemsubthemecounter++;summaryitemthemehit||subtheme.addSSItem(new ssItem(pc,vm.$sce))}}if(!vm.$scope.$$phase)try{vm.$scope.$digest()}catch(e){}},SummarySheetCompareComponentController.prototype.checkOpenCloseSituation=function(){for(var vm=this,allexpanded=!0,i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded||(allexpanded=!1);vm.allexpanded=allexpanded},SummarySheetCompareComponentController.prototype.expandItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!0,vm.checkOpenCloseSituation()},SummarySheetCompareComponentController.prototype.toggleShowAllThemes=function(){var vm=this;vm.showAllThemes=!vm.showAllThemes},SummarySheetCompareComponentController.prototype.collapseItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!1,vm.checkOpenCloseSituation()},SummarySheetCompareComponentController.prototype.toggleItem=function(i){var vm=this;vm.convertedSummarySheet[i].expanded=!vm.convertedSummarySheet[i].expanded,vm.checkOpenCloseSituation()},SummarySheetCompareComponentController.prototype.expandAll=function(){var vm=this;vm.allexpanded=!0;for(var i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded=!0},SummarySheetCompareComponentController.prototype.collapseAll=function(){var vm=this;vm.allexpanded=!1;for(var i=0;i<vm.convertedSummarySheet.length;i++)vm.convertedSummarySheet[i].expanded=!1},SummarySheetCompareComponentController.prototype.addCurrentItemToConvertedSummarySheet=function(item){},SummarySheetCompareComponentController}();ComeosModule.SummarySheetCompareComponentController=SummarySheetCompareComponentController;var ssTheme=function(){function ssTheme(){this.ssItems=[],this.ssSubthemes=[],this.expanded=!1,this.hasContent=!1,this.hasThemeContent=!1,this.subthemeWithContentCount=0}return ssTheme.prototype.shouldShow=function(){var vm=this;return vm.hasContent},ssTheme.prototype.addSSSubTheme=function(subthemeToAdd){var vm=this;subthemeToAdd.setTheme(vm),vm.ssSubthemes.push(subthemeToAdd)},ssTheme.prototype.addSSItem=function(itemToAdd){var vm=this;vm.ssItems.push(itemToAdd),void 0!=itemToAdd.item&&(vm.hasThemeContent=!0)},ssTheme}(),ssSubTheme=function(){function ssSubTheme(){this.ssItems=[],this.hasContent=!1}return ssSubTheme.prototype.shouldShow=function(){var vm=this;return vm.hasContent},ssSubTheme.prototype.setTheme=function(theme){var vm=this;vm.theme=theme},ssSubTheme.prototype.addSSItem=function(itemToAdd){var vm=this;vm.ssItems.push(itemToAdd),void 0!=itemToAdd.item&&(vm.hasContent=!0,vm.theme.hasContent=!0,vm.theme.subthemeWithContentCount++)},ssSubTheme}(),ssItem=function(){function ssItem(pc,$sce,item){var vm=this;vm.pc=pc,void 0!=item?(vm.item=item,"string"==typeof vm.item.description&&(vm.item.description=$sce.trustAsHtml(vm.item.description))):vm.empty=!0}return ssItem}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var FAQComponent=function(){function FAQComponent(){this.restrict="E",this.bindings={faqmodel:"=",activelang:"=",answer:"<"},this.templateUrl="/api/template/Component/FAQComponent",this.controller=FAQComponentController}return FAQComponent}();ComeosModule.FAQComponent=FAQComponent;var FAQComponentController=function(){function FAQComponentController($scope){this.$scope=$scope,this.questionList=[],this.tagAnswerList=[],this.generalTagSelected=!0,this.generalAnswerSelected=!0,this.onlyGeneral=!0;var vm=this;vm.init()}return FAQComponentController.prototype.init=function(){},FAQComponentController.prototype.register=function(question){var vm=this;vm.questionList.push(question),question.onlyGeneral||(vm.onlyGeneral=!1),vm.expandTagAnswerList(question.tagAnswerList)},FAQComponentController.prototype.selectGeneralAnswer=function(){for(var vm=this,i=0;i<this.questionList.length;i++)this.questionList[i].selectGeneralAnswer();for(var i=0;i<this.tagAnswerList.length;i++)this.tagAnswerList[i].selected=!1;vm.generalAnswerSelected=!0},FAQComponentController.prototype.expandTagAnswerList=function(tagAnswerList){for(var vm=this,i=0;i<tagAnswerList.length;i++){for(var tagAnswerToAdd=tagAnswerList[i],selectedTagAnswer=void 0,j=0;j<vm.tagAnswerList.length&&void 0==selectedTagAnswer;)vm.tagAnswerList[j].tag.id==tagAnswerToAdd.tag.id&&(selectedTagAnswer=vm.tagAnswerList[j]),j++;if(void 0==selectedTagAnswer){var newTagAnswer=new ComeosModule.TagAnswer(tagAnswerToAdd.tag);tagAnswerToAdd.selected&&(newTagAnswer.selected=!0);for(var k=0;k<tagAnswerToAdd.answers.length;k++)newTagAnswer.answers.push(tagAnswerToAdd.answers[k]);this.tagAnswerList.push(newTagAnswer)}else for(var k=0;k<tagAnswerToAdd.answers.length;k++)selectedTagAnswer.answers.push(tagAnswerToAdd.answers[k])}},FAQComponentController.prototype.checkOpenCloseSituation=function(){for(var vm=this,allexpanded=!0,i=0;i<vm.questionList.length;i++)vm.questionList[i].expanded||(allexpanded=!1);vm.allexpanded=allexpanded},FAQComponentController.prototype.expandAll=function(){var vm=this;vm.allexpanded=!0;for(var i=0;i<vm.questionList.length;i++)vm.questionList[i].expand()},FAQComponentController.prototype.collapseAll=function(){var vm=this;vm.allexpanded=!1;for(var i=0;i<vm.questionList.length;i++)vm.questionList[i].collapse()},FAQComponentController.prototype.selectTag=function(tagAnswerList){var vm=this;vm.generalTagSelected=!1;for(var i=0;i<vm.tagAnswerList.length;i++)vm.tagAnswerList[i].tag.id==tagAnswerList.tag.id?vm.tagAnswerList[i].selected=!0:vm.tagAnswerList[i].selected=!1;for(var i=0;i<this.questionList.length;i++)this.questionList[i].selectTag(tagAnswerList)},FAQComponentController.prototype.selectGeneralTag=function(){var vm=this;vm.generalTagSelected=!0;for(var i=0;i<this.questionList.length;i++)this.questionList[i].selectGeneralTag()},FAQComponentController}();ComeosModule.FAQComponentController=FAQComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var FAQQuestionComponent=function(){function FAQQuestionComponent(){this.restrict="E",this.require={faq:"^faq"},this.bindings={faqquestionmodel:"=",activelang:"=",answer:"<"},this.templateUrl="/api/template/Component/FAQQuestionComponent",this.controller=FAQQuestionComponentController}return FAQQuestionComponent}();ComeosModule.FAQQuestionComponent=FAQQuestionComponent;var FAQQuestionComponentController=function(){function FAQQuestionComponentController($scope,$sce){this.$scope=$scope,this.$sce=$sce,this.answerlist=[],this.tagAnswerList=[],this.generalTagSelected=!0,this.generalAnswerSelected=!0,this.onlyGeneral=!0;var s=this;if(void 0!=s.faqquestionmodel.question_answer){s.generalTagAnswer=new TagAnswer({contentType:"pc",created:"2016-06-01T07:05:40.1661847",id:-1,lastUpdated:"2016-06-01T07:05:40.1661847",machineName:"PC-UNDEFINED",name:"PC-UNDEFINED",published:!0,title:"PC Undefined",selected:!0});for(var i=0;i<s.faqquestionmodel.question_answer.length;i++)if(s.answerlist.push(s.faqquestionmodel.question_answer[i]),void 0!=s.faqquestionmodel.question_answer[i].answer_pc){s.onlyGeneral&&(s.onlyGeneral=!1);for(var j=0;j<s.faqquestionmodel.question_answer[i].answer_pc.length;j++)s.expandTagAnswerList(s.faqquestionmodel.question_answer[i].answer_pc[j],s.faqquestionmodel.question_answer[i])}else s.expandGeneralTagAnswer(s.faqquestionmodel.question_answer[i])}}return FAQQuestionComponentController.prototype.$onInit=function(){var s=this;s.faq.register(s)},FAQQuestionComponentController.prototype.selectGeneralAnswer=function(){var vm=this;vm.unselectAllTagAnswers(),vm.generalAnswerSelected=!0},FAQQuestionComponentController.prototype.unselectAllTagAnswers=function(){for(var vm=this,i=0;i<vm.tagAnswerList.length;i++)vm.tagAnswerList[i].selected=!1},FAQQuestionComponentController.prototype.expand=function(){var vm=this;vm.expanded=!0},FAQQuestionComponentController.prototype.collapse=function(){var vm=this;vm.expanded=!1},FAQQuestionComponentController.prototype.toggle=function(){var vm=this;vm.expanded=!vm.expanded,vm.faq.checkOpenCloseSituation()},FAQQuestionComponentController.prototype.setAnswerList=function(){},FAQQuestionComponentController.prototype.trustHtmlAnswers=function(answerCollection){var s=this;return answerCollection&&(answerCollection=answerCollection.map(function(val){var newval=val;return newval.answer&&(newval.answer=s.$sce.trustAsHtml(val.answer)),newval})),answerCollection},FAQQuestionComponentController.prototype.expandGeneralTagAnswer=function(answer){var vm=this;vm.generalTagAnswer.answers.push(answer)},FAQQuestionComponentController.prototype.expandTagAnswerList=function(tag,answer){for(var selectedTagAnswer,vm=this,i=0;i<vm.tagAnswerList.length&&void 0==selectedTagAnswer;)vm.tagAnswerList[i].tag.id==tag.id&&(selectedTagAnswer=vm.tagAnswerList[i]),i++;if(void 0==selectedTagAnswer){var newTagAnswer=new TagAnswer(tag);newTagAnswer.answers.push(answer),this.tagAnswerList.push(newTagAnswer)}else selectedTagAnswer.answers.push(answer)},FAQQuestionComponentController.prototype.selectTag=function(tagAnswerList){var vm=this;vm.generalTagSelected=!1;for(var i=0;i<vm.tagAnswerList.length;i++)vm.tagAnswerList[i].tag.id==tagAnswerList.tag.id?vm.tagAnswerList[i].selected=!0:vm.tagAnswerList[i].selected=!1},FAQQuestionComponentController.prototype.selectGeneralTag=function(){var vm=this;vm.generalTagSelected=!0;for(var i=0;i<vm.tagAnswerList.length;i++)vm.tagAnswerList[i].selected=!1},FAQQuestionComponentController}();ComeosModule.FAQQuestionComponentController=FAQQuestionComponentController;var TagAnswer=function(){function TagAnswer(tag){this.answers=[],this.tag=tag}return TagAnswer.prototype.addAnswer=function(answer){this.answers.push(answer)},TagAnswer}();ComeosModule.TagAnswer=TagAnswer}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SectionComponent=function(){function SectionComponent(){this.restrict="E",this.bindings={sectionmodel:"="},this.templateUrl="/api/template/Component/SectionComponent",this.controller=SectionComponentController}return SectionComponent}();ComeosModule.SectionComponent=SectionComponent;var SectionComponentController=function(){function SectionComponentController($scope){this.$scope=$scope,this.subsectionList=[];var vm=this;vm.init()}return SectionComponentController.prototype.init=function(){},SectionComponentController.prototype.register=function(question){var vm=this;vm.subsectionList.push(question),1==vm.sectionmodel.length&&vm.expandAll()},SectionComponentController.prototype.checkOpenCloseSituation=function(){for(var vm=this,allexpanded=!0,i=0;i<vm.subsectionList.length;i++)vm.subsectionList[i].expanded||(allexpanded=!1);vm.allexpanded=allexpanded},SectionComponentController.prototype.expandAll=function(){var vm=this;vm.allexpanded=!0;for(var i=0;i<vm.subsectionList.length;i++)vm.subsectionList[i].expand()},SectionComponentController.prototype.collapseAll=function(){var vm=this;vm.allexpanded=!1;for(var i=0;i<vm.subsectionList.length;i++)vm.subsectionList[i].collapse()},SectionComponentController}();ComeosModule.SectionComponentController=SectionComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SubsectionComponent=function(){function SubsectionComponent(){this.restrict="E",this.require={section:"^altaisection"},this.bindings={subsectionmodel:"="},this.templateUrl="/api/template/Component/SubsectionComponent",this.controller=SubsectionComponentController}return SubsectionComponent}();ComeosModule.SubsectionComponent=SubsectionComponent;var SubsectionComponentController=function(){function SubsectionComponentController($scope,$sce){this.$scope=$scope,this.$sce=$sce}return SubsectionComponentController.prototype.$onInit=function(){var s=this;s.section.register(s),s.subsectionmodel.content=s.$sce.trustAsHtml(s.subsectionmodel.content)},SubsectionComponentController.prototype.expand=function(){var vm=this;vm.expanded=!0},SubsectionComponentController.prototype.collapse=function(){var vm=this;vm.expanded=!1},SubsectionComponentController.prototype.toggle=function(){var vm=this;vm.expanded=!vm.expanded,vm.section.checkOpenCloseSituation()},SubsectionComponentController.prototype.trustHtmlAnswers=function(answerCollection){var s=this;return answerCollection&&(answerCollection=answerCollection.map(function(val){var newval=val;return newval.answer&&(newval.answer=s.$sce.trustAsHtml(val.answer)),newval})),answerCollection},SubsectionComponentController}();ComeosModule.SubsectionComponentController=SubsectionComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCollectionMenuComponent=function(){function ComeosCollectionMenuComponent(){this.restrict="E",this.bindings={collectionItems:"="},this.templateUrl="/api/template/Component/ComeosCollectionMenu",this.controller=ComeosCollectionMenuController}return ComeosCollectionMenuComponent}();ComeosModule.ComeosCollectionMenuComponent=ComeosCollectionMenuComponent;var ComeosCollectionMenuController=function(){function ComeosCollectionMenuController($filter,$scope,$rootScope,$state,linkResolverService,myComeosDataService){this.$filter=$filter,this.$scope=$scope,this.$rootScope=$rootScope,this.$state=$state,this.linkResolverService=linkResolverService,this.myComeosDataService=myComeosDataService,this.showSearch=!1,this.menuItems={theme:{label:"theme",items:[],link:""},region:{label:"region",items:[],link:""},pc:{label:"paritaircomite",items:[],link:""},sector:{label:"sector",items:[],link:""}};var ctrl=this;ctrl.init(),$rootScope.$on("languageChanged",function(){ctrl.init()});var watchGroup=$scope.$watchGroup(["$ctrl.mySelection","$ctrl.collectionItems"],function(newValue){if(void 0!=newValue[0]&&void 0!=newValue[1]&&newValue[1].length>0){if(void 0!=ctrl.mySelection.theme)for(var x in ctrl.menuItems.theme.items)ctrl.mySelection.theme.some(function(themeId){return themeId==ctrl.menuItems.theme.items[x].id})&&(ctrl.menuItems.theme.items[x].mySelection=!0);if(void 0!=ctrl.mySelection.pc)for(var x in ctrl.menuItems.pc.items)ctrl.mySelection.pc.some(function(pcId){return pcId==ctrl.menuItems.pc.items[x].id})&&(ctrl.menuItems.pc.items[x].mySelection=!0);if(void 0!=ctrl.mySelection.sector)for(var x in ctrl.menuItems.sector.items)ctrl.mySelection.sector.some(function(sectorId){return sectorId==ctrl.menuItems.sector.items[x].id})&&(ctrl.menuItems.sector.items[x].mySelection=!0);if(void 0!=ctrl.mySelection.region)for(var x in ctrl.menuItems.region.items)ctrl.mySelection.region.some(function(regionId){return regionId==ctrl.menuItems.region.items[x].id})&&(ctrl.menuItems.region.items[x].mySelection=!0);watchGroup()}});myComeosDataService.getMySelection().then(function(mySelection){ctrl.mySelection=mySelection})}return ComeosCollectionMenuController.prototype.init=function(){var vm=this;vm.generateLinks(),vm.menuItems.theme.label=vm.$filter("translate")("THEMES"),vm.menuItems.sector.label=vm.$filter("translate")("SECTORS"),vm.menuItems.region.label=vm.$filter("translate")("REGIONS"),vm.menuItems.pc.label=vm.$filter("translate")("PCS");vm.$scope.$watch("$ctrl.collectionItems",function(newv){newv&&vm.groupCollection(newv)},!0)},ComeosCollectionMenuController.prototype.generateLinks=function(){for(var key in this.menuItems)this.menuItems[key].link=this.linkResolverService.getLink(key)},ComeosCollectionMenuController.prototype.groupCollection=function(col){var vm=this;this.menuItems.theme.items=col.filter(function(val){return val.link=vm.linkResolverService.getLink(val.contentType,val.id,val.title),"theme"==val.contentType&&1==val.isroot}),this.menuItems.region.items=col.filter(function(val){return val.link=vm.linkResolverService.getLink(val.contentType,val.id,val.title),"region"==val.contentType}),this.menuItems.pc.items=col.filter(function(val){return val.link=vm.linkResolverService.getLink(val.contentType,val.id,val.title),"pc"==val.contentType}),this.menuItems.sector.items=col.filter(function(val){return val.link=vm.linkResolverService.getLink(val.contentType,val.id,val.title),"sector"==val.contentType})},ComeosCollectionMenuController.prototype.openMobileMenu=function(){var vm=this;vm.$rootScope.$broadcast("toggleMobileMenu")},ComeosCollectionMenuController.prototype.onHoverSub=function(hoveredItem){var vm=this;vm.hoveredItem=hoveredItem},ComeosCollectionMenuController.prototype.onHoverSubOut=function(hoveredItem){var vm=this;vm.hoveredItem=void 0},ComeosCollectionMenuController.prototype.search=function(){var vm=this;vm.searchQuery&&vm.searchQuery.length>0&&vm.$state.go("Root.Content.Searcher",{q:vm.searchQuery}),vm.searchQuery="",vm.showSearch=!1},ComeosCollectionMenuController.prototype.toggleSearch=function(){var vm=this;vm.showSearch=!vm.showSearch},ComeosCollectionMenuController}();ComeosModule.ComeosCollectionMenuController=ComeosCollectionMenuController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCardComponent=function(){function ComeosCardComponent(){this.restrict="E",this.bindings={item:"=",hideTag:"="},this.templateUrl="/api/template/Component/ComeosCard",this.controller=ComeosCardComponentController}return ComeosCardComponent}();ComeosModule.ComeosCardComponent=ComeosCardComponent;var ComeosCardComponentController=function(){function ComeosCardComponentController(linkResolverService,$timeout,$translate){this.linkResolverService=linkResolverService,this.$timeout=$timeout,this.$translate=$translate,this.themePills=[],this.pcPills=[],this.regionPills=[],this.sectorPills=[],this.pills=[],this.share=!0;var vm=this;vm.item&&(vm.item.$ready=!1),vm.id=vm.item.id||vm.item.Id,vm.name=vm.item.title||vm.item.titel,vm.date=vm.item.date||vm.item.datum||vm.item.lastUpdated||vm.item.LastUpdated,vm.title=vm.item.title||vm.item.titel,vm.description=vm.item.shortintroduction||vm.item.membersintroduction||vm.item.publicintroduction||vm.item.intro||vm.item.content,vm.contenttype=vm.item.contentTypeLabel,vm.contenttypemachinename=vm.item.contentType,"commissievergadering"==vm.contenttypemachinename&&(vm.contenttype="Meeting",vm.share=!1),"workshop"==vm.contenttypemachinename&&vm.item.academyeventtypeworkshop&&vm.item.academyeventtypeworkshop.titel&&(vm.contenttype=vm.item.academyeventtypeworkshop.titel),"registrationmeeting"==vm.contenttypemachinename&&vm.item.registrationmeetingcommissievergadering[0]&&(vm.id=vm.item.registrationmeetingcommissievergadering[0].id,vm.date=vm.item.registrationmeetingcommissievergadering[0].date||vm.item.LastUpdated,vm.contenttype=vm.item.registrationmeetingcommissievergadering[0].contentTypeLabel,vm.contenttypemachinename=vm.item.registrationmeetingcommissievergadering[0].contentType,vm.title=null!=vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering?vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering.title:vm.item.registrationmeetingcommissievergadering[0].title,vm.name=null!=vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering?vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering.title:vm.item.registrationmeetingcommissievergadering[0].title,vm.description=null!=vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering?vm.item.registrationmeetingcommissievergadering[0].commissiecommissievergadering.description:vm.item.registrationmeetingcommissievergadering[0].invitationintro,vm.item.id=vm.id,vm.item.title=vm.title,vm.share=!1),"registrationacademy"==vm.contenttypemachinename&&(vm.item.registrationacademyworkshop?(vm.id=vm.item.registrationacademyworkshop.id,vm.name=vm.item.registrationacademyworkshop.title,vm.date=vm.item.registrationacademyworkshop.date||vm.item.LastUpdated,vm.contenttype=vm.item.registrationacademyworkshop.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationacademyworkshop.contentType,vm.title=vm.item.registrationacademyworkshop.title,vm.description=vm.item.registrationacademyworkshop.intro,vm.item.registrationacademyworkshop.fileworkshop3&&(vm.image=vm.item.registrationacademyworkshop.fileworkshop3.file),vm.item.id=vm.id,vm.item.title=vm.title,vm.share=!1):vm.item.registrationacademynetworkingevent&&(vm.id=vm.item.registrationacademynetworkingevent.id,vm.name=vm.item.registrationacademynetworkingevent.title,vm.date=vm.item.registrationacademynetworkingevent.date||vm.item.LastUpdated,vm.contenttype=vm.item.registrationacademynetworkingevent.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationacademynetworkingevent.contentType,vm.title=vm.item.registrationacademynetworkingevent.title,vm.description=vm.item.registrationacademynetworkingevent.intro,vm.item.registrationacademynetworkingevent.filenetworkingevent3&&(vm.image=vm.item.registrationacademynetworkingevent.filenetworkingevent3.file),vm.item.id=vm.id,vm.item.title=vm.title,vm.share=!1));var pcLink=vm.item.contentType+"_pc",regionLink=vm.item.contentType+"_region",themeLink=vm.item.contentType+"_theme",sectorLink=vm.item.contentType+"_sector",newpcLink="pc"+vm.item.contentType,newregionLink="region"+vm.item.contentType,newthemeLink="theme"+vm.item.contentType,newsectorLink="sector"+vm.item.contentType;vm.pcPills=vm.item[pcLink],void 0==vm.pcPills&&(vm.pcPills=vm.item[newpcLink]),vm.themePills=vm.item[themeLink],void 0==vm.themePills&&(vm.themePills=vm.item[newthemeLink]),vm.sectorPills=vm.item[sectorLink],void 0==vm.sectorPills&&(vm.sectorPills=vm.item[newsectorLink]),vm.regionPills=vm.item[regionLink],void 0==vm.regionPills&&(vm.regionPills=vm.item[newregionLink]),"commissievergadering"==vm.contenttypemachinename&&void 0!=vm.item.commissiecommissievergadering&&(vm.themePills=vm.item.commissiecommissievergadering.themecommissie,vm.sectorPills=vm.item.commissiecommissievergadering.sectorcommissie,vm.pcPills=vm.item.commissiecommissievergadering.pccommissie,vm.regionPills=vm.item.commissiecommissievergadering.regioncommissie),void 0!=vm.themePills&&vm.pushArray(vm.pills,vm.themePills),void 0!=vm.sectorPills&&vm.pushArray(vm.pills,vm.sectorPills),void 0!=vm.pcPills&&vm.pushArray(vm.pills,vm.pcPills),void 0!=vm.regionPills&&vm.pushArray(vm.pills,vm.regionPills),vm.createLink(),vm.image||vm.addImage()}return ComeosCardComponentController.prototype.pushArray=function(arr,arr2){arr.push.apply(arr,arr2)},ComeosCardComponentController.prototype.checkFileBased=function(){var vm=this;"magazine"!=vm.contenttypemachinename&&"magazineartikel"!=vm.contenttypemachinename&&"brochure"!=vm.contenttypemachinename&&"research"!=vm.contenttypemachinename||(vm.filebased=!0)},ComeosCardComponentController.prototype.createLink=function(){var vm=this;vm.link=this.linkResolverService.getLink(vm.contenttypemachinename,vm.id,vm.name)},ComeosCardComponentController.prototype.addImage=function(){var vm=this;"actumessage"==vm.item.contentType?vm.item.fileactumessage&&(vm.image=vm.item.fileactumessage.file):"networkingevent"==vm.item.contentType?vm.item.filenetworkingevent3&&(vm.image=vm.item.filenetworkingevent3.file):"workshop"==vm.item.contentType?vm.item.fileworkshop3&&(vm.image=vm.item.fileworkshop3.file):"complexdossier"==vm.item.contentType?vm.item.filecomplexdossier&&(vm.image=vm.item.filecomplexdossier.file):"pressrelease"==vm.item.contentType?vm.item.filepressrelease&&(vm.image=vm.item.filepressrelease.file):"ceoevent"==vm.item.contentType&&vm.item.fileceoevent&&(vm.image=vm.item.fileceoevent.file)},ComeosCardComponentController.prototype.$onInit=function(){this.item&&(this.item.$ready=!0)},ComeosCardComponentController}();ComeosModule.ComeosCardComponentController=ComeosCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCardDirectDownloadComponent=function(){function ComeosCardDirectDownloadComponent(){this.restrict="E",this.bindings={item:"=",hideTag:"="},this.templateUrl="/api/template/Component/ComeosCardDirectDownload",this.controller=ComeosCardDirectDownloadComponentController}return ComeosCardDirectDownloadComponent}();ComeosModule.ComeosCardDirectDownloadComponent=ComeosCardDirectDownloadComponent;var ComeosCardDirectDownloadComponentController=function(){function ComeosCardDirectDownloadComponentController(linkResolverService,$timeout,altaiLocalizationService){this.linkResolverService=linkResolverService,this.$timeout=$timeout,this.altaiLocalizationService=altaiLocalizationService,this.themePills=[],this.pcPills=[],this.regionPills=[],this.sectorPills=[],this.pills=[];var vm=this;if(vm.item&&(vm.item.$ready=!1),vm.id=vm.item.id||vm.item.Id,vm.date=vm.item.datum||vm.item.date||vm.item["laatste-update"]||vm.item.lastUpdated||vm.item.LastUpdated,vm.title=vm.item.title||vm.item.titel,vm.description=vm.item.shortintroduction||vm.item.membersintroduction||vm.item.publicintroduction||vm.item.intro||vm.item.content,vm.contenttype=vm.item.contentTypeLabel,vm.contenttypemachinename=vm.item.contentType,"registrationmeeting"==vm.contenttypemachinename&&vm.item.registrationmeetingcommissievergadering&&(vm.date=vm.item.registrationmeetingcommissievergadering.datum||vm.item.LastUpdated,vm.contenttype=vm.item.registrationmeetingcommissievergadering.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationmeetingcommissievergadering.contentType,vm.title=null!=vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2?vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2.title:"",vm.description=vm.item.registrationmeetingcommissievergadering.invitationintro),"registrationacademy"==vm.contenttypemachinename&&vm.item.registrationmeetingcommissievergadering&&(vm.date=vm.item.registrationmeetingcommissievergadering.datum||vm.item.LastUpdated,vm.contenttype=vm.item.registrationmeetingcommissievergadering.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationmeetingcommissievergadering.contentType,vm.title=null!=vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2?vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2.title:"",vm.description=vm.item.registrationmeetingcommissievergadering.invitationintro),"workshop"==vm.item.contentType)var pcLink="pc"+vm.item.contentType+"0",regionLink="region"+vm.item.contentType+"0",themeLink="theme"+vm.item.contentType+"0",sectorLink="sector"+vm.item.contentType+"0";else var pcLink=vm.item.contentType+"_pc",regionLink=vm.item.contentType+"_region",themeLink=vm.item.contentType+"_theme",sectorLink=vm.item.contentType+"_sector",newpcLink="pc"+vm.item.contentType,newregionLink="region"+vm.item.contentType,newthemeLink="theme"+vm.item.contentType,newsectorLink="sector"+vm.item.contentType;vm.pcPills=vm.item[pcLink],void 0==vm.pcPills&&(vm.pcPills=vm.item[newpcLink]),vm.themePills=vm.item[themeLink],void 0==vm.themePills&&(vm.themePills=vm.item[newthemeLink]),vm.sectorPills=vm.item[sectorLink],void 0==vm.sectorPills&&(vm.sectorPills=vm.item[newsectorLink]),vm.regionPills=vm.item[regionLink],void 0==vm.regionPills&&(vm.regionPills=vm.item[newregionLink]),void 0!=vm.themePills&&vm.pushArray(vm.pills,vm.themePills),void 0!=vm.sectorPills&&vm.pushArray(vm.pills,vm.sectorPills),void 0!=vm.pcPills&&vm.pushArray(vm.pills,vm.pcPills),void 0!=vm.regionPills&&vm.pushArray(vm.pills,vm.regionPills),vm.createLink()}return ComeosCardDirectDownloadComponentController.prototype.pushArray=function(arr,arr2){arr.push.apply(arr,arr2)},ComeosCardDirectDownloadComponentController.prototype.createLink=function(){var vm=this;"nl"==vm.altaiLocalizationService.getCurrentLangCode()?void 0!=vm.item.filemagazineartikel&&(vm.link=config.staticFileBase+"/"+vm.item.filemagazineartikel.file):void 0!=vm.item.filemagazineartikel1&&(vm.link=config.staticFileBase+"/"+vm.item.filemagazineartikel1.file)},ComeosCardDirectDownloadComponentController.prototype.$onInit=function(){this.item&&(this.item.$ready=!0)},ComeosCardDirectDownloadComponentController}();ComeosModule.ComeosCardDirectDownloadComponentController=ComeosCardDirectDownloadComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCardCaoComponent=function(){function ComeosCardCaoComponent(){this.restrict="E",this.bindings={item:"=",hideTag:"="},this.templateUrl="/api/template/Component/ComeosCardCao",this.controller=ComeosCardCaoComponentController}return ComeosCardCaoComponent}();ComeosModule.ComeosCardCaoComponent=ComeosCardCaoComponent;var ComeosCardCaoComponentController=function(){function ComeosCardCaoComponentController(linkResolverService,$timeout,$location,altaiLocalizationService){this.linkResolverService=linkResolverService,this.$timeout=$timeout,this.$location=$location,this.altaiLocalizationService=altaiLocalizationService,this.themePills=[],this.pcPills=[],this.regionPills=[],this.sectorPills=[],this.pills=[],this.activeLang={code:""};var vm=this;if(vm.activeLang.code=altaiLocalizationService.getCurrentLangCode(),vm.item&&(vm.item.$ready=!1),vm.id=vm.item.id||vm.item.Id,vm.date=vm.item.lastUpdated,vm.title=vm.item.title||vm.item.titel,vm.description=vm.item.shortintroduction||vm.item.membersintroduction||vm.item.publicintroduction||vm.item.intro||vm.item.content,vm.contenttype=vm.item.contentTypeLabel,vm.contenttypemachinename=vm.item.contentType,"registrationmeeting"==vm.contenttypemachinename&&vm.item.registrationmeetingcommissievergadering&&(vm.date=vm.item.registrationmeetingcommissievergadering.datum||vm.item.LastUpdated,vm.contenttype=vm.item.registrationmeetingcommissievergadering.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationmeetingcommissievergadering.contentType,vm.title=null!=vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2?vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2.title:"",vm.description=vm.item.registrationmeetingcommissievergadering.invitationintro),
"registrationacademy"==vm.contenttypemachinename&&vm.item.registrationmeetingcommissievergadering&&(vm.date=vm.item.registrationmeetingcommissievergadering.datum||vm.item.LastUpdated,vm.contenttype=vm.item.registrationmeetingcommissievergadering.contentTypeLabel,vm.contenttypemachinename=vm.item.registrationmeetingcommissievergadering.contentType,vm.title=null!=vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2?vm.item.registrationmeetingcommissievergadering.commissiecommissievergadering2.title:"",vm.description=vm.item.registrationmeetingcommissievergadering.invitationintro),"workshop"==vm.item.contentType)var pcLink="pc"+vm.item.contentType+"0",regionLink="region"+vm.item.contentType+"0",themeLink="theme"+vm.item.contentType+"0",sectorLink="sector"+vm.item.contentType+"0";else var pcLink=vm.item.contentType+"_pc",regionLink=vm.item.contentType+"_region",themeLink=vm.item.contentType+"_theme",sectorLink=vm.item.contentType+"_sector",newpcLink="pc"+vm.item.contentType,newregionLink="region"+vm.item.contentType,newthemeLink="theme"+vm.item.contentType,newsectorLink="sector"+vm.item.contentType;vm.pcPills=vm.item[pcLink],void 0==vm.pcPills&&(vm.pcPills=vm.item[newpcLink]),vm.themePills=vm.item[themeLink],void 0==vm.themePills&&(vm.themePills=vm.item[newthemeLink]),vm.sectorPills=vm.item[sectorLink],void 0==vm.sectorPills&&(vm.sectorPills=vm.item[newsectorLink]),vm.regionPills=vm.item[regionLink],void 0==vm.regionPills&&(vm.regionPills=vm.item[newregionLink]),void 0!=vm.themePills&&vm.pushArray(vm.pills,vm.themePills),void 0!=vm.sectorPills&&vm.pushArray(vm.pills,vm.sectorPills),void 0!=vm.pcPills&&vm.pushArray(vm.pills,vm.pcPills),void 0!=vm.regionPills&&vm.pushArray(vm.pills,vm.regionPills),vm.createLink(),vm.addImage()}return ComeosCardCaoComponentController.prototype.pushArray=function(arr,arr2){arr.push.apply(arr,arr2)},ComeosCardCaoComponentController.prototype.checkFileBased=function(){var vm=this;"magazine"!=vm.contenttypemachinename&&"magazineartikel"!=vm.contenttypemachinename&&"brochure"!=vm.contenttypemachinename&&"research"!=vm.contenttypemachinename||(vm.filebased=!0)},ComeosCardCaoComponentController.prototype.createLink=function(){var vm=this;void 0!=vm.item.filecao&&(vm.link=config.staticFileBase+"/"+vm.item.filecao.file),void 0!=vm.item.caobundel_file_fr&&"fr"==vm.activeLang.code&&(vm.link=config.staticFileBase+"/"+vm.item.caobundel_file_fr.file),void 0!=vm.item.caobundel_file_nl&&"nl"==vm.activeLang.code&&(vm.link=config.staticFileBase+"/"+vm.item.caobundel_file_nl.file)},ComeosCardCaoComponentController.prototype.addImage=function(){var vm=this;"actumessage"==vm.item.contentType?vm.item.fileactumessage&&(vm.image=vm.item.fileactumessage.file):"networkingevent"==vm.item.contentType?vm.item.filenetworkingevent3&&(vm.image=vm.item.filenetworkingevent3.file):"workshop"==vm.item.contentType?vm.item.fileworkshop3&&(vm.image=vm.item.fileworkshop3.file):"complexdossier"==vm.item.contentType&&vm.item.filecomplexdossier&&(vm.image=vm.item.filecomplexdossier.file)},ComeosCardCaoComponentController.prototype.$onInit=function(){this.item&&(this.item.$ready=!0)},ComeosCardCaoComponentController}();ComeosModule.ComeosCardCaoComponentController=ComeosCardCaoComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosEventCardComponent=function(){function ComeosEventCardComponent(){this.restrict="E",this.bindings={item:"=",hideTag:"="},this.templateUrl="/api/template/Component/ComeosEventCard",this.controller=ComeosEventCardComponentController}return ComeosEventCardComponent}();ComeosModule.ComeosEventCardComponent=ComeosEventCardComponent;var ComeosEventCardComponentController=function(){function ComeosEventCardComponentController(linkResolverService,$timeout){this.linkResolverService=linkResolverService,this.$timeout=$timeout,this.themePills=[],this.pcPills=[],this.regionPills=[],this.sectorPills=[],this.pills=[];var vm=this;vm.item&&(vm.item.$ready=!1),vm.id=vm.item.id||vm.item.Id,vm.date=vm.item.datum||vm.item.date||vm.item.lastUpdated,vm.title=vm.item.title||vm.item.titel,vm.item.intro?vm.description=vm.item.intro:vm.item.publicintroduction?vm.description=vm.item.publicintroduction:vm.item.invitationintro&&(vm.description=vm.item.invitationintro),vm.contenttype=vm.item.contentTypeLabel,vm.contenttypemachinename=vm.item.contentType,"networkingevent"==vm.item.contentType&&vm.item.filenetworkingevent3&&(vm.image=config.staticFileBase+"/"+vm.item.filenetworkingevent3.file),"workshop"==vm.item.contentType?vm.item.fileworkshop3&&(vm.image=config.staticFileBase+"/"+vm.item.fileworkshop3.file):"commissievergadering"==vm.item.contentType&&void 0!=vm.item.filecommissievergadering4&&(vm.image=config.staticFileBase+"/"+vm.item.filecommissievergadering4.file),vm.createLink()}return ComeosEventCardComponentController.prototype.createLink=function(){var vm=this;vm.link=this.linkResolverService.getLink(vm.contenttypemachinename,vm.id,vm.title)},ComeosEventCardComponentController}();ComeosModule.ComeosEventCardComponentController=ComeosEventCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var AltaiSlideshowGrid=function(){function AltaiSlideshowGrid(){this.bindings={items:"="},this.templateUrl="/api/template/Component/AltaiSlideshowGrid",this.controller=AltaiSlideshowGridController}return AltaiSlideshowGrid}();ComeosModule.AltaiSlideshowGrid=AltaiSlideshowGrid;var AltaiSlideshowGridController=function(){function AltaiSlideshowGridController($scope,$rootScope,linkResolverService,$interval,$timeout,imageStyleSetService){this.$scope=$scope,this.$rootScope=$rootScope,this.linkResolverService=linkResolverService,this.$interval=$interval,this.$timeout=$timeout,this.imageStyleSetService=imageStyleSetService,this.slides=[],this.slidesReady=!1,this.shouldShowSlides=!0,this.minposition=0,this.maxposition=0,this.newminposition=0,this.newmaxposition=0,this.activeIndex=0,this.slideshowPlaying=!1,this.slideHeightPercentage=1,this.slideContentLeftPercentage=.1,this.slideContentWidthPercentage=.25,this.slideContentBottomPercentage=.2,this.slideNavButtonsHeightPercentage=.4,this.slideTitleFontSize=60,this.slideTaglineFontSize=20,this.slideIndicatorBottomPercentage=.05,this.slideDownBottomPercentage=.05,this.shouldShowDownButton=!1,this.shouldShowIconBubbles=!1,this.shouldDeductMenuBar=!0,this.heightMenuBar=65,this.minHeight=350,this.numberofslidesvisibleatonce=1,this.maxslides=5,this.autostart=!0,this.shouldshowleftindicator=!0,this.shouldshowrightindicator=!0;var vm=this;vm.$scope=$scope,vm.shouldShowSlides&&(vm.slideWidth=vm.$rootScope.windowSize/vm.$rootScope.gridItems,vm.$rootScope.windowHeight<800||vm.slideWidth<700?(vm.slideSize="mini",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.8,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=20,vm.slideTaglineFontSize=12):vm.$rootScope.windowHeight<1100||vm.slideWidth<1200?(vm.slideSize="medi",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.65,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=35,vm.slideTaglineFontSize=16):(vm.slideSize="maxi",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.35,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=45,vm.slideTaglineFontSize=18),vm.slideHeight<vm.minHeight&&(vm.slideHeight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideHeight=vm.slideHeight-vm.heightMenuBar));var listener=$scope.$watch("$ctrl.items",function(newmodel){void 0!=vm.items&&(vm.init(),listener()),$rootScope.$watch("windowSize",function(){void 0!=vm.items&&vm.init()}),$rootScope.$watch("windowHeight",function(){void 0!=vm.items&&vm.init()})},!0);$rootScope.$on("activeimagestylesetupdated",function(){void 0!=vm.items&&vm.init()})}return AltaiSlideshowGridController.prototype.init=function(){var vm=this;if(vm.$rootScope.slideshowInit=!1,vm.slides.length=0,vm.slidesReady=!1,vm.shouldShowSlides=!0,vm.stopPlay(),vm.inputslideshow=vm.items[0],vm.slideshowmode=vm.inputslideshow.slideshowmodeslideshow.name,vm.inputslideshow.slideheightpercentage&&(vm.slideHeightPercentage=parseFloat(vm.inputslideshow.slideheightpercentage)),vm.inputslideshow.menuheight&&(vm.heightMenuBar=parseInt(vm.inputslideshow.menuheight)),vm.inputslideshow.alwaysshowmenu&&(vm.shouldDeductMenuBar=vm.inputslideshow.alwaysshowmenu),vm.inputslideshow.maxslides&&(vm.maxslides=parseInt(vm.inputslideshow.maxslides)),vm.inputslideshow.shouldshowdownbutton&&(vm.shouldShowDownButton=vm.inputslideshow.shouldshowdownbutton),vm.inputslideshow.iconbubbles&&(vm.shouldShowIconBubbles=vm.inputslideshow.iconbubbles),vm.inputslideshow.autostart&&(vm.autostart=vm.inputslideshow.autostart),vm.inputslideshow.numberofslidesvisibleatonce&&(vm.numberofslidesvisibleatonce=parseInt(vm.inputslideshow.numberofslidesvisibleatonce),vm.numberofslidesvisibleatonce>vm.inputslideshow.slide1slideshow.length&&(vm.numberofslidesvisibleatonce=vm.inputslideshow.slide1slideshow.length),vm.maxslides&&vm.numberofslidesvisibleatonce>vm.maxslides&&(vm.numberofslidesvisibleatonce=vm.maxslides)),vm.shouldShowSlides){vm.numberofslidesvisibleatonce?vm.slideWidth=vm.$rootScope.windowSize/vm.numberofslidesvisibleatonce:vm.slideWidth=vm.$rootScope.windowSize/vm.$rootScope.gridItems,vm.$rootScope.windowHeight<700||vm.slideWidth<700?(vm.slideSize="mini",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.8,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=18,vm.slideTaglineFontSize=12):vm.$rootScope.windowHeight<1100||vm.slideWidth<1200?(vm.slideSize="medi",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.65,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=35,vm.slideTaglineFontSize=16):(vm.slideSize="maxi",vm.slideHeight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideContentLeftPercentage=.1,vm.slideContentWidthPercentage=.35,vm.slideContentBottomPercentage=.2,vm.slideTitleFontSize=45,vm.slideTaglineFontSize=18),vm.slideHeight<vm.minHeight&&(vm.slideHeight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideHeight=vm.slideHeight-vm.heightMenuBar),vm.slideshowStyle={height:vm.slideHeight},vm.slideshowContentStyle={width:vm.slideWidth*vm.slideContentWidthPercentage,"margin-left":vm.slideWidth*vm.slideContentLeftPercentage,bottom:vm.slideHeight*vm.slideContentBottomPercentage},vm.slideshowNavigationStyle={height:vm.slideHeight,width:50,"padding-top":vm.slideHeight/2-10,"padding-left":19},vm.slideshowTitleStyle={"font-size":vm.slideTitleFontSize},vm.slideshowTaglineStyle={"font-size":vm.slideTaglineFontSize},vm.slideshowIndicatorsStyle={"margin-left":vm.$rootScope.windowSize*vm.slideContentLeftPercentage,bottom:vm.slideHeight*vm.slideIndicatorBottomPercentage},vm.slideshowDownStyle={"margin-left":vm.$rootScope.windowSize/2-15,bottom:vm.slideHeight*vm.slideDownBottomPercentage};var slideshowlength;slideshowlength=vm.inputslideshow.slide1slideshow.length>vm.inputslideshow.maxslides?vm.inputslideshow.maxslides:vm.inputslideshow.slide1slideshow.length;for(var i=0;slideshowlength>i;i++){var rawslide=vm.inputslideshow.slide1slideshow[i],imageurl=vm.determineImageURL(rawslide);imageurl=vm.imageStyleSetService.getImageUrlDirect("fps",imageurl);var style={"background-image":"url("+imageurl+")",width:vm.slideWidth,height:vm.slideHeight},slide={slideshowtitle:rawslide.title,slideshowtagline:rawslide.slideshowtagline,style:style,contentstyle:vm.slideshowContentStyle,titlestyle:vm.slideshowTitleStyle,taglinestyle:vm.slideshowTaglineStyle,slidelink:vm.determineLink(rawslide)};rawslide.linkslide1&&(slide.slidelinkraw=rawslide.linkslide1.linkurl),vm.slides.push(slide)}vm.sortSlides(vm.slides),vm.slides.splice(vm.maxslides),vm.slides.length==vm.numberofslidesvisibleatonce&&(vm.shouldshowleftindicator=!1,vm.shouldshowrightindicator=!1,vm.shouldShowIconBubbles=!1),vm.minposition=0,vm.maxposition=vm.numberofslidesvisibleatonce-1,vm.setVisibility(),vm.slidesReady=!0,vm.autostart&&vm.togglePlay()}vm.$rootScope.slideshowInit=!0},AltaiSlideshowGridController.prototype.togglePlay=function(){var vm=this;vm.slideshowPlaying?vm.stopPlay():vm.startPlay()},AltaiSlideshowGridController.prototype.startPlay=function(){var vm=this;vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.inputslideshow.slidedurationseconds),vm.slideshowPlaying=!0},AltaiSlideshowGridController.prototype.stopPlay=function(){var vm=this;angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.slideshowPlaying=!1},AltaiSlideshowGridController.prototype.resetPlay=function(){var vm=this;vm.slideshowPlaying&&(angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.inputslideshow.slidedurationseconds))},AltaiSlideshowGridController.prototype.determineImageURL=function(rawslide){var imageURL;return rawslide.fileslide1?imageURL=rawslide.fileslide1.file:rawslide.networkingeventslide1?imageURL=rawslide.networkingeventslide1.filenetworkingevent3.file:rawslide.complexdossierslide1?imageURL=rawslide.complexdossierslide1.filecomplexdossier.file:rawslide.actumessageslide1?imageURL=rawslide.actumessageslide1.fileactumessage.file:rawslide.workshopslide1?imageURL=rawslide.workshopslide1.fileworkshop3.file:rawslide.pressreleaseslide1?imageURL=rawslide.pressreleaseslide1.filepressrelease.file:rawslide.magazineslide1?imageURL=rawslide.magazineslide1.filemagazine.file:rawslide.researchslide1?imageURL=rawslide.researchslide1.fileresearch.file:rawslide.brochureslide1&&(imageURL=rawslide.brochureslide1.filebrochure.file),imageURL},AltaiSlideshowGridController.prototype.determineLink=function(rawslide){var link,vm=this;return link=rawslide.networkingeventslide1?vm.linkResolverService.getLink(rawslide.networkingeventslide1.contentType,rawslide.networkingeventslide1.id,rawslide.networkingeventslide1.name):rawslide.complexdossierslide1?vm.linkResolverService.getLink(rawslide.complexdossierslide1.contentType,rawslide.complexdossierslide1.id,rawslide.complexdossierslide1.name):rawslide.actumessageslide1?vm.linkResolverService.getLink(rawslide.actumessageslide1.contentType,rawslide.actumessageslide1.id,rawslide.actumessageslide1.name):rawslide.workshopslide1?vm.linkResolverService.getLink(rawslide.workshopslide1.contentType,rawslide.workshopslide1.id,rawslide.workshopslide1.name):rawslide.pressreleaseslide1?vm.linkResolverService.getLink(rawslide.pressreleaseslide1.contentType,rawslide.pressreleaseslide1.id,rawslide.pressreleaseslide1.name):rawslide.magazineslide1?vm.linkResolverService.getLink(rawslide.magazineslide1.contentType,rawslide.magazineslide1.id,rawslide.magazineslide1.name):rawslide.researchslide1?vm.linkResolverService.getLink(rawslide.researchslide1.contentType,rawslide.researchslide1.id,rawslide.researchslide1.name):rawslide.brochureslide1?vm.linkResolverService.getLink(rawslide.brochureslide1.contentType,rawslide.brochureslide1.id,rawslide.brochureslide1.name):vm.linkResolverService.getLink("home")},AltaiSlideshowGridController.prototype.sortSlides=function(slides){slides.sort(function(a,b){return b[1]-a[1]})},AltaiSlideshowGridController.prototype.setVisibility=function(){for(var vm=this,i=0;i<vm.slides.length;i++)i>=vm.minposition&&i<=vm.maxposition?vm.slides[i].visible=!0:vm.slides[i].visible=!1},AltaiSlideshowGridController.prototype.moveRight=function(){var vm=this;vm.maxposition=vm.maxposition+1==vm.slides.length?vm.numberofslidesvisibleatonce-1:vm.maxposition+1,vm.minposition=vm.maxposition-(vm.numberofslidesvisibleatonce-1),vm.setVisibility(),vm.resetPlay()},AltaiSlideshowGridController.prototype.moveLeft=function(){var vm=this;vm.minposition=0==vm.minposition?vm.slides.length-vm.numberofslidesvisibleatonce:vm.minposition-1,vm.maxposition=vm.minposition+(vm.numberofslidesvisibleatonce-1),vm.setVisibility(),vm.resetPlay()},AltaiSlideshowGridController.prototype.moveToPosition=function(index){var vm=this;0==vm.slides[index].visible&&(index>vm.maxposition?(vm.maxposition=index,vm.minposition=vm.maxposition-(vm.numberofslidesvisibleatonce-1)):index<vm.minposition&&(vm.minposition=index,vm.maxposition=vm.minposition+(vm.numberofslidesvisibleatonce-1))),vm.setVisibility(),vm.resetPlay()},AltaiSlideshowGridController.prototype.shuffle=function(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array},AltaiSlideshowGridController}();ComeosModule.AltaiSlideshowGridController=AltaiSlideshowGridController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiSlideshowGridTwoByTwo(){return{restrict:"AE",scope:{items:"=",positionChangePerTime:"@",itemsInSlideBucket:"@",gridsize:"@"},bindToController:!0,controllerAs:"$ctrl",controller:AltaiSlideshowGridTwoByTwoController,link:AltaiSlideshowGridTwoByTwoLink,templateUrl:"/api/template/Component/AltaiSlideshowGridTwoByTwo"}}ComeosModule.AltaiSlideshowGridTwoByTwo=AltaiSlideshowGridTwoByTwo;var AltaiSlideshowGridTwoByTwoLink=function(){function AltaiSlideshowGridTwoByTwoLink(scope,element){var closestrow=element.closest('[class*="col"]');scope.elementWidth=closestrow.width()}return AltaiSlideshowGridTwoByTwoLink}();ComeosModule.AltaiSlideshowGridTwoByTwoLink=AltaiSlideshowGridTwoByTwoLink;var AltaiSlideshowGridTwoByTwoController=function(){function AltaiSlideshowGridTwoByTwoController($scope,$rootScope,linkResolverService,$interval,$element){this.$scope=$scope,this.$rootScope=$rootScope,this.linkResolverService=linkResolverService,this.$interval=$interval,this.$element=$element,this.slideBuckets=[],this.gridItems=5,this.maxSlides=5,this.slidesReady=!1,this.shouldShowSlides=!0,this.position=0,this.activeIndex=0,this.slideshowPlaying=!1,this.allShown=!1,this.slidedurationseconds=2,this.slideHeightPercentage=.6,this.slideContentLeftPercentage=.1,this.slideContentWidthPercentage=.25,this.slideContentBottomPercentage=.2,this.slideNavButtonsHeightPercentage=.4,this.slideTitleFontSize=60,this.slideTaglineFontSize=20,this.slideIndicatorBottomPercentage=.05;var vm=this;vm.$scope=$scope,vm.positionChangePerTimeNumber=parseInt(vm.positionChangePerTime),vm.itemsInSlideBucketNumber=parseInt(vm.gridsize),vm.gridsizeNumber=parseInt(vm.gridsize);var listener=$scope.$watch("$ctrl.items",function(newmodel){void 0!=vm.items&&(vm.initme(),listener())},!0)}return AltaiSlideshowGridTwoByTwoController.prototype.initme=function(){var vm=this;vm.slideBuckets=[],console.log("entering initme");var closestrow=vm.$element.closest('[class*="col"]');vm.elementWidth=closestrow.width(),vm.slideBuckets.length=vm.gridsizeNumber,vm.position=0,vm.activeIndex=0,vm.slidesReady=!1,vm.shouldShowSlides=!0,vm.stopPlay(),vm.gridItems=vm.gridsizeNumber,vm.numberOfSlidebuckets=Math.ceil(vm.items.length/vm.itemsInSlideBucketNumber),vm.numberOfSlidebuckets<vm.gridItems&&(vm.allShown=!0),vm.slideHeight=200,vm.slideBucketHeight=2*vm.slideHeight,vm.slideBucketWidth=vm.slideHeight,vm.slideshowStyle={width:vm.slideBucketWidth*vm.gridsizeNumber,height:vm.slideBucketWidth*vm.gridsizeNumber,overflow:"hidden"},vm.slideshowNavigationStyle={height:vm.slideBucketHeight,width:50,"padding-top":vm.slideBucketHeight/2-10,"padding-left":19};var currentSlideBucketIndex=0;vm.slideBuckets[currentSlideBucketIndex]=[];var slideBucketStyle={width:vm.slideBucketWidth},slides=[];vm.slideBuckets[currentSlideBucketIndex]={style:slideBucketStyle,slides:slides};var currentSlideIndex=0;vm.shuffle(vm.items);for(var currentItemIndex=0;currentItemIndex<vm.items.length;currentItemIndex++){var rawslide=vm.items[currentItemIndex],imageurl=vm.determineImageURL(rawslide),slideStyle={"max-width":vm.slideBucketWidth,"max-height":vm.slideHeight,width:vm.slideBucketWidth,height:vm.slideHeight,padding:40},link=vm.determineLink(rawslide),slide={id:rawslide.id,companyname:rawslide.companyname,style:slideStyle,slidelink:link,imagesrc:imageurl};currentSlideIndex+1>vm.itemsInSlideBucketNumber&&(currentSlideBucketIndex+=1,slides=[],vm.slideBuckets[currentSlideBucketIndex]={style:slideBucketStyle,slides:slides},currentSlideIndex=0),vm.slideBuckets[currentSlideBucketIndex].slides[currentSlideIndex]=slide,currentSlideIndex++}vm.slidesReady=!0,vm.togglePlay()},AltaiSlideshowGridTwoByTwoController.prototype.togglePlay=function(){var vm=this;vm.slideshowPlaying?vm.stopPlay():vm.startPlay()},AltaiSlideshowGridTwoByTwoController.prototype.startPlay=function(){var vm=this;vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.slidedurationseconds),vm.slideshowPlaying=!0},AltaiSlideshowGridTwoByTwoController.prototype.stopPlay=function(){var vm=this;angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.slideshowPlaying=!1},AltaiSlideshowGridTwoByTwoController.prototype.resetPlay=function(){var vm=this;vm.slideshowPlaying&&(angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.slidedurationseconds))},AltaiSlideshowGridTwoByTwoController.prototype.determineImageURL=function(rawslide){var imageURL,imageBasePath=config.staticFileBase+"/";return rawslide.filecompany&&(imageURL=imageBasePath+rawslide.filecompany.file),imageURL},AltaiSlideshowGridTwoByTwoController.prototype.determineLink=function(rawslide){var link;return link=rawslide.linkcompany?rawslide.linkcompany.linkurl:"https://www.comeos.be"},AltaiSlideshowGridTwoByTwoController.prototype.sortSlides=function(slides){slides.sort(function(a,b){return b[1]-a[1]})},AltaiSlideshowGridTwoByTwoController.prototype.shuffle=function(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array},AltaiSlideshowGridTwoByTwoController.prototype.moveRight=function(){var numberOfPositionsToChange,vm=this;vm.position+vm.gridItems+vm.positionChangePerTimeNumber<=vm.slideBuckets.length&&(numberOfPositionsToChange=vm.positionChangePerTimeNumber),vm.position+vm.gridItems+vm.positionChangePerTimeNumber>vm.slideBuckets.length&&(numberOfPositionsToChange=vm.position+vm.gridItems+vm.positionChangePerTimeNumber-vm.slideBuckets.length),vm.position+vm.gridItems==vm.slideBuckets.length?vm.position=0:vm.position=vm.position+numberOfPositionsToChange,vm.activeIndex+vm.gridItems==vm.slideBuckets.length?vm.activeIndex=0:vm.activeIndex=vm.activeIndex+numberOfPositionsToChange,vm.resetPlay()},AltaiSlideshowGridTwoByTwoController.prototype.moveLeft=function(){var vm=this;vm.position=vm.position-1,vm.activeIndex=vm.activeIndex-1,vm.resetPlay()},AltaiSlideshowGridTwoByTwoController.prototype.moveToPosition=function(index){var vm=this;vm.position=index,vm.activeIndex=index,vm.resetPlay()},AltaiSlideshowGridTwoByTwoController}();ComeosModule.AltaiSlideshowGridTwoByTwoController=AltaiSlideshowGridTwoByTwoController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiSlideshowGridForCollections(){return{restrict:"AE",scope:{items:"=",positionChangePerTime:"@",itemsInSlideBucket:"@"},bindToController:!0,controllerAs:"$ctrl",controller:AltaiSlideshowGridForCollectionsController,link:AltaiSlideshowGridForCollectionsLink,templateUrl:"/api/template/Component/AltaiSlideshowGridForCollections"}}ComeosModule.AltaiSlideshowGridForCollections=AltaiSlideshowGridForCollections;var AltaiSlideshowGridForCollectionsLink=function(){function AltaiSlideshowGridForCollectionsLink(scope,element){var closestrow=element.closest('[class*="col"]');scope.elementWidth=closestrow.width()}return AltaiSlideshowGridForCollectionsLink}();ComeosModule.AltaiSlideshowGridForCollectionsLink=AltaiSlideshowGridForCollectionsLink;var AltaiSlideshowGridForCollectionsController=function(){function AltaiSlideshowGridForCollectionsController($scope,$rootScope,linkResolverService,$interval,$element){this.$scope=$scope,this.$rootScope=$rootScope,this.linkResolverService=linkResolverService,this.$interval=$interval,this.$element=$element,this.slideBuckets=[],this.gridItems=5,this.maxSlides=5,this.slidesReady=!1,this.shouldShowSlides=!0,this.position=0,this.activeIndex=0,this.slideshowPlaying=!1,this.allShown=!1,this.slidedurationseconds=5,this.slideHeightPercentage=.6,this.slideContentLeftPercentage=.1,this.slideContentWidthPercentage=.25,this.slideContentBottomPercentage=.2,this.slideNavButtonsHeightPercentage=.4,this.slideTitleFontSize=60,this.slideTaglineFontSize=20,this.slideIndicatorBottomPercentage=.05;var vm=this;vm.$scope=$scope,vm.positionChangePerTimeNumber=parseInt(vm.positionChangePerTime),vm.itemsInSlideBucketNumber=parseInt(vm.itemsInSlideBucket);var listener=$scope.$watch("$ctrl.items",function(newmodel){void 0!=vm.items&&(vm.initme(),listener()),$rootScope.$watch("windowSize",function(){void 0!=vm.items&&vm.initme()})},!0)}return AltaiSlideshowGridForCollectionsController.prototype.initme=function(){var vm=this;vm.slideBuckets=[];var closestrow=vm.$element.closest('[class*="col"]');vm.elementWidth=closestrow.width(),vm.slideBuckets.length=0,vm.elementWidth<600?vm.gridItems=2:vm.elementWidth<1024?vm.gridItems=3:vm.gridItems=5,vm.position=0,vm.activeIndex=0,vm.slidesReady=!1,vm.shouldShowSlides=!0,vm.stopPlay(),vm.slideHeight=100,vm.numberOfSlidebuckets=Math.floor(vm.items.length/vm.itemsInSlideBucketNumber),vm.numberOfSlidebuckets<vm.gridItems&&(vm.gridItems=vm.numberOfSlidebuckets,vm.allShown=!0),vm.slideBucketHeight=vm.itemsInSlideBucketNumber*vm.slideHeight,vm.slideBucketWidth=vm.elementWidth/vm.gridItems,vm.slideshowNavigationStyle={height:vm.slideBucketHeight,width:50,"padding-top":vm.slideBucketHeight/2-10,"padding-left":19};var currentSlideBucketIndex=0;vm.slideBuckets[currentSlideBucketIndex]=[];var slideBucketStyle={width:vm.slideBucketWidth},slides=[];vm.slideBuckets[currentSlideBucketIndex]={style:slideBucketStyle,slides:slides},vm.shuffle(vm.items);for(var currentSlideIndex=0,currentItemIndex=0;currentItemIndex<vm.items.length;currentItemIndex++){var rawslide=vm.items[currentItemIndex],imageurl=vm.determineImageURL(rawslide),slideStyle={width:vm.slideBucketWidth,height:vm.slideHeight},link=vm.determineLink(rawslide),slide={style:slideStyle,slidelink:link,imagesrc:imageurl};currentSlideIndex+1>vm.itemsInSlideBucket&&(currentSlideBucketIndex+=1,slides=[],vm.slideBuckets[currentSlideBucketIndex]={style:slideBucketStyle,slides:slides},currentSlideIndex=0),vm.slideBuckets[currentSlideBucketIndex].slides[currentSlideIndex]=slide,currentSlideIndex++}vm.slidesReady=!0,vm.togglePlay()},AltaiSlideshowGridForCollectionsController.prototype.togglePlay=function(){var vm=this;vm.slideshowPlaying?vm.stopPlay():vm.startPlay()},AltaiSlideshowGridForCollectionsController.prototype.startPlay=function(){var vm=this;vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.slidedurationseconds),vm.slideshowPlaying=!0},AltaiSlideshowGridForCollectionsController.prototype.stopPlay=function(){var vm=this;angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.slideshowPlaying=!1},AltaiSlideshowGridForCollectionsController.prototype.resetPlay=function(){var vm=this;vm.slideshowPlaying&&(angular.isDefined(vm.playTimer)&&vm.$interval.cancel(vm.playTimer),vm.playTimer=vm.$interval(function(){vm.moveRight()},1e3*vm.slidedurationseconds))},AltaiSlideshowGridForCollectionsController.prototype.determineImageURL=function(rawslide){var imageURL,imageBasePath=config.staticFileBase+"/";return rawslide.filesponsororganization&&(imageURL=imageBasePath+rawslide.filesponsororganization.file),imageURL},AltaiSlideshowGridForCollectionsController.prototype.determineLink=function(rawslide){var link;return link=rawslide.linksponsororganization?rawslide.linksponsororganization[0].linkurl:"https://www.comeos.be"},AltaiSlideshowGridForCollectionsController.prototype.sortSlides=function(slides){slides.sort(function(a,b){return b[1]-a[1]})},AltaiSlideshowGridForCollectionsController.prototype.moveRight=function(){var numberOfPositionsToChange,vm=this;vm.position+vm.gridItems+vm.positionChangePerTimeNumber<=vm.slideBuckets.length&&(numberOfPositionsToChange=vm.positionChangePerTimeNumber),vm.position+vm.gridItems+vm.positionChangePerTimeNumber>vm.slideBuckets.length&&(numberOfPositionsToChange=vm.position+vm.gridItems+vm.positionChangePerTimeNumber-(vm.slideBuckets.length+1)),vm.position+vm.gridItems==vm.slideBuckets.length?vm.position=0:vm.position=vm.position+numberOfPositionsToChange,vm.activeIndex+vm.gridItems==vm.slideBuckets.length?vm.activeIndex=0:vm.activeIndex=vm.activeIndex+numberOfPositionsToChange,vm.resetPlay()},AltaiSlideshowGridForCollectionsController.prototype.moveLeft=function(){var vm=this;vm.position=vm.position-1,vm.activeIndex=vm.activeIndex-1,vm.resetPlay()},AltaiSlideshowGridForCollectionsController.prototype.moveToPosition=function(index){var vm=this;vm.position=index,vm.activeIndex=index,vm.resetPlay()},AltaiSlideshowGridForCollectionsController.prototype.shuffle=function(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array},AltaiSlideshowGridForCollectionsController}();ComeosModule.AltaiSlideshowGridForCollectionsController=AltaiSlideshowGridForCollectionsController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiHeaderHeightCalculator(){return{restrict:"AE",bindToController:!0,controllerAs:"$ctrl",link:AltaiHeaderHeightCalculatorLink,controller:AltaiHeaderHeightCalculatorController}}ComeosModule.AltaiHeaderHeightCalculator=AltaiHeaderHeightCalculator;var AltaiHeaderHeightCalculatorLink=function(){function AltaiHeaderHeightCalculatorLink(rootScope,scope,element){this.slideHeightPercentage=.5}return AltaiHeaderHeightCalculatorLink}();ComeosModule.AltaiHeaderHeightCalculatorLink=AltaiHeaderHeightCalculatorLink;var AltaiHeaderHeightCalculatorController=function(){function AltaiHeaderHeightCalculatorController($rootScope,$scope,$state){this.$rootScope=$rootScope,this.$scope=$scope,this.$state=$state,this.slideHeightPercentage=.5,this.shouldDeductMenuBar=!0,this.heightMenuBar=65,this.minHeight=350;var vm=this,currentState=vm.$state.current.name;"Root.Home"==currentState&&(void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar)),$rootScope.$watch("windowSize",function(){void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar))}),$rootScope.$watch("windowHeight",function(){void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar))})),vm.$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){"Root.Home"==toState.name?(0==vm.$rootScope.slideshowInit,void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,
vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar)),$rootScope.$watch("windowSize",function(){void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight)),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar)}),$rootScope.$watch("windowHeight",function(){void 0!=vm.$rootScope.windowHeight&&(vm.slideheight=vm.$rootScope.windowHeight*vm.slideHeightPercentage,vm.slideheight<vm.minHeight&&(vm.slideheight=vm.minHeight)),1==vm.slideHeightPercentage&&vm.shouldDeductMenuBar&&(vm.slideheight=vm.slideheight-vm.heightMenuBar)})):vm.slideheight=void 0})}return AltaiHeaderHeightCalculatorController}();ComeosModule.AltaiHeaderHeightCalculatorController=AltaiHeaderHeightCalculatorController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiInitMediaMessageDirective(){return{restrict:"AE",scope:{youtubeidnl:"@",youtubeidfr:"@",title:"@",description:"@"},bindToController:!0,controllerAs:"$ctrl",controller:AltaiInitMediaMessageDirectiveController,link:AltaiInitMediaMessageDirectiveLink}}ComeosModule.AltaiInitMediaMessageDirective=AltaiInitMediaMessageDirective;var AltaiInitMediaMessageDirectiveLink=function(){function AltaiInitMediaMessageDirectiveLink(){}return AltaiInitMediaMessageDirectiveLink}();ComeosModule.AltaiInitMediaMessageDirectiveLink=AltaiInitMediaMessageDirectiveLink;var AltaiInitMediaMessageDirectiveController=function(){function AltaiInitMediaMessageDirectiveController(altaiClientDataStore,$location,$filter,$sce,$scope,$uibModal){this.altaiClientDataStore=altaiClientDataStore,this.$location=$location,this.$filter=$filter,this.$sce=$sce,this.$scope=$scope,this.$uibModal=$uibModal;var vm=this;vm.open()}return AltaiInitMediaMessageDirectiveController.prototype.open=function(size,parentSelector){var vm=this;if(this.displayInitMediaMessage=!vm.altaiClientDataStore.get("hideInitMediaMessage"),vm.displayInitMediaMessage){var parentElem=parentSelector?angular.element("#bodyView "+parentSelector):angular.element("#bodyView"),modalInstance=vm.$uibModal.open({animation:!1,component:"AltaiInitMediaMessageComponent",windowClass:"fullscreen-modal",resolve:{youtubeidnl:function(){return vm.youtubeidnl},youtubeidfr:function(){return vm.youtubeidfr},title:function(){return vm.title},description:function(){return vm.description}},appendTo:parentElem,backdrop:"static"});modalInstance.result.then(function(selectedItem){},function(){})}},AltaiInitMediaMessageDirectiveController}();ComeosModule.AltaiInitMediaMessageDirectiveController=AltaiInitMediaMessageDirectiveController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var AltaiGalleryComponent=function(){function AltaiGalleryComponent(){this.restrict="E",this.bindings={imagefiles:"="},this.templateUrl="/api/template/Component/AltaiGalleryTemplate",this.controller=AltaiGalleryComponentController}return AltaiGalleryComponent}();ComeosModule.AltaiGalleryComponent=AltaiGalleryComponent;var AltaiGalleryComponentController=function(){function AltaiGalleryComponentController($scope){this.$scope=$scope,this.images=[],this.methods={},this.thumbnails=!0,this.inline=!1,this.imgbubbles=!1,this.bgclose=!1,this.bubbles=!0;var vm=this;vm.$scope=$scope,$scope.$watch("$scope.imagefiles",function(newmodel){void 0!=vm.imagefiles&&vm.init()},!0)}return AltaiGalleryComponentController.prototype.init=function(){for(var vm=this,i=0;i<vm.imagefiles.length;i++){var newImage={title:"Image",alt:"Image",thumbUrl:config.staticFileBase+"/"+vm.imagefiles[i].file,url:config.staticFileBase+"/"+vm.imagefiles[i].file};vm.images.push(newImage)}vm.$scope.openGallery=function(){vm.$scope.methods.open()},vm.$scope.closeGallery=function(){vm.$scope.methods.close()}},AltaiGalleryComponentController}();ComeosModule.AltaiGalleryComponentController=AltaiGalleryComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var CollapserComponent=function(){function CollapserComponent(){this.restrict="E",this.bindings={collapsermodel:"=",activelang:"=",answer:"<"},this.templateUrl="/api/template/Component/CollapserComponent",this.controller=CollapserComponentController}return CollapserComponent}();ComeosModule.CollapserComponent=CollapserComponent;var CollapserComponentController=function(){function CollapserComponentController($scope){this.$scope=$scope,this.sectionList=[];var vm=this;vm.init()}return CollapserComponentController.prototype.init=function(){for(var vm=this,i=0;i<vm.collapsermodel.length;i++)vm.sectionList.push(new Section(vm.collapsermodel[i],vm))},CollapserComponentController.prototype.expandAll=function(){for(var vm=this,i=0;i<vm.sectionList.length;i++)vm.sectionList[i].expand();vm.allexpanded=!0},CollapserComponentController.prototype.collapseAll=function(){for(var vm=this,i=0;i<vm.sectionList.length;i++)vm.sectionList[i].collapse();vm.allexpanded=!1},CollapserComponentController.prototype.checkOpenCloseSituation=function(){for(var vm=this,allexpanded=!0,i=0;i<vm.sectionList.length;i++)vm.sectionList[i].expanded||(allexpanded=!1);vm.allexpanded=allexpanded},CollapserComponentController}();ComeosModule.CollapserComponentController=CollapserComponentController;var Section=function(){function Section(section,collapser){this.section=section,this.collapser=collapser}return Section.prototype.expand=function(){var vm=this;vm.expanded=!0,vm.collapser.checkOpenCloseSituation()},Section.prototype.collapse=function(){var vm=this;vm.expanded=!1,vm.collapser.checkOpenCloseSituation()},Section.prototype.toggle=function(){var vm=this;vm.expanded=!vm.expanded,vm.collapser.checkOpenCloseSituation()},Section}();ComeosModule.Section=Section}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var masonryInitialized=!1,ComeosWhoIsWhoComponent=function(){function ComeosWhoIsWhoComponent(){this.restrict="E",this.bindings={items:"="},this.templateUrl="/api/template/Component/WhoIsWho",this.controller=ComeosWhoIsWhoController}return ComeosWhoIsWhoComponent}();ComeosModule.ComeosWhoIsWhoComponent=ComeosWhoIsWhoComponent;var ComeosWhoIsWhoController=function(){function ComeosWhoIsWhoController($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout}return ComeosWhoIsWhoController.prototype.$onInit=function(){masonryInitialized=!1},ComeosWhoIsWhoController}();ComeosModule.ComeosWhoIsWhoController=ComeosWhoIsWhoController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosWhoIsWhoCardComponent=function(){function ComeosWhoIsWhoCardComponent(){this.restrict="E",this.bindings={item:"=",hideTag:"="},this.templateUrl="/api/template/Component/WhoIsWhoCard",this.controller=ComeosWhoIsWhoCardComponentController}return ComeosWhoIsWhoCardComponent}();ComeosModule.ComeosWhoIsWhoCardComponent=ComeosWhoIsWhoCardComponent;var ComeosWhoIsWhoCardComponentController=function(){function ComeosWhoIsWhoCardComponentController($scope,linkResolverService,$timeout){this.$scope=$scope,this.linkResolverService=linkResolverService,this.$timeout=$timeout;var vm=this;vm.item&&(vm.item.$ready=!1),$scope.$watch("$scope.item",function(newmodel){void 0!=vm.item&&vm.init()},!0),vm.createLink()}return ComeosWhoIsWhoCardComponentController.prototype.init=function(){var vm=this;vm.item.filepersoon1&&(vm.imagelink=vm.item.filepersoon1.file)},ComeosWhoIsWhoCardComponentController.prototype.onHoverIn=function(){var vm=this;vm.item.filepersoon&&(vm.imagelink=vm.item.filepersoon.file)},ComeosWhoIsWhoCardComponentController.prototype.onHoverOut=function(){var vm=this;vm.item.filepersoon1&&(vm.imagelink=vm.item.filepersoon1.file)},ComeosWhoIsWhoCardComponentController.prototype.createLink=function(){var vm=this;vm.link=this.linkResolverService.getLink("person",vm.item.id)},ComeosWhoIsWhoCardComponentController.prototype.$onInit=function(){this.item&&(this.item.$ready=!0)},ComeosWhoIsWhoCardComponentController}();ComeosModule.ComeosWhoIsWhoCardComponentController=ComeosWhoIsWhoCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var FileIconComponent=function(){function FileIconComponent(){this.restrict="E",this.bindings={doctype:"="},this.templateUrl="/api/template/Component/FileIcon",this.controller=FileIconComponentController}return FileIconComponent}();ComeosModule.FileIconComponent=FileIconComponent;var FileIconComponentController=function(){function FileIconComponentController($scope){this.$scope=$scope,this.doctypetext="mdi mdi-file-document-box filetype";var vm=this;$scope.$watch("vm.doctype",function(){void 0!=vm.doctype&&("pdf"==vm.doctype?vm.doctypetext="mdi mdi-file-pdf-box filetype filetypepdf":"doc"==vm.doctype||"docx"==vm.doctype?vm.doctypetext="mdi mdi-file-word-box filetype filetypeword":"xls"==vm.doctype||"xlsx"==vm.doctype?vm.doctypetext="mdi mdi-file-excel-box filetype filetypeexcel":"ppt"!=vm.doctype&&"pptx"!=vm.doctype||(vm.doctypetext="mdi mdi-file-powerpoint-box filetype filetypeppt"))},!0)}return FileIconComponentController}();ComeosModule.FileIconComponentController=FileIconComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosOverviewCardComponent=function(){function ComeosOverviewCardComponent(){this.bindings={item:"="},this.templateUrl="/api/template/Component/ComeosOverviewCard",this.controller=ComeosOverviewCardComponentController}return ComeosOverviewCardComponent}();ComeosModule.ComeosOverviewCardComponent=ComeosOverviewCardComponent;var ComeosOverviewCardComponentController=function(){function ComeosOverviewCardComponentController(linkResolverService){this.linkResolverService=linkResolverService;var vm=this;vm.title=vm.item.title||vm.item.titel,vm.contenttypemachinename=vm.item.contentType,vm.createLink()}return ComeosOverviewCardComponentController.prototype.pushArray=function(arr,arr2){arr.push.apply(arr,arr2)},ComeosOverviewCardComponentController.prototype.createLink=function(){var vm=this;vm.link=vm.linkResolverService.getLink(vm.contenttypemachinename,vm.item.id,vm.title)},ComeosOverviewCardComponentController}();ComeosModule.ComeosOverviewCardComponentController=ComeosOverviewCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosMenublockCardComponent=function(){function ComeosMenublockCardComponent(){this.bindings={item:"="},this.templateUrl="/api/template/Component/ComeosMenublockCard",this.controller=ComeosMenublockCardComponentController}return ComeosMenublockCardComponent}();ComeosModule.ComeosMenublockCardComponent=ComeosMenublockCardComponent;var ComeosMenublockCardComponentController=function(){function ComeosMenublockCardComponentController(linkResolverService,$state){this.linkResolverService=linkResolverService,this.$state=$state;var vm=this;vm.title=vm.item.label,vm.contenttypemachinename="menuitem",vm.createLink()}return ComeosMenublockCardComponentController.prototype.pushArray=function(arr,arr2){arr.push.apply(arr,arr2)},ComeosMenublockCardComponentController.prototype.createLink=function(){var vm=this;void 0!=vm.item.state&&(vm.link=vm.item.state.name)},ComeosMenublockCardComponentController.prototype.openLink=function(){var vm=this;void 0!=vm.link?vm.$state.go(vm.link):window.open(vm.item.url,"_blank")},ComeosMenublockCardComponentController}();ComeosModule.ComeosMenublockCardComponentController=ComeosMenublockCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosTopMenu=function(){function ComeosTopMenu(){this.bindings={showCircle:"="},this.restrict="E",this.templateUrl="/api/template/Component/ComeosTopMenu",this.controller=ComeosTopMenuController}return ComeosTopMenu}();ComeosModule.ComeosTopMenu=ComeosTopMenu;var ComeosTopMenuController=function(){function ComeosTopMenuController(authService,userInfoService,$state,$rootScope,languageFactory,altaiLocalizationService){this.authService=authService,this.userInfoService=userInfoService,this.$state=$state,this.languageFactory=languageFactory,this.altaiLocalizationService=altaiLocalizationService,this.isLoggedIn=!1,this.showAdmin=!1;var vm=this;vm.$rootScope=$rootScope,vm.$rootScope.$on("loaderShow",function(){vm.loading=!0}),vm.$rootScope.$on("loaderHide",function(){vm.loading=!1}),$rootScope.userinfo?authService.isAuthorized("admin.menu").then(function(result){vm.$rootScope.showAdmin=!0}):authService.getUserInfo().then(function(userinfo){vm.$rootScope.userinfo=userinfo,vm.$rootScope.isLoggedIn=!0,authService.isAuthorized("admin.menu").then(function(result){vm.$rootScope.showAdmin=!0})},function(reject){vm.$rootScope.isLoggedIn=!1}),vm.$rootScope.$on("userInfoChanged",function(){authService.getUserInfo().then(function(userinfo){vm.$rootScope.userinfo=userinfo,vm.$rootScope.isLoggedIn=!0},function(reject){vm.$rootScope.isLoggedIn=!1,vm.$rootScope.showAdmin=!1})}),vm.getLanguages()}return ComeosTopMenuController.prototype.logout=function(){window.location.href="/logout"},ComeosTopMenuController.prototype.login=function(){var ctrl=this;ctrl.authService.isAccessTokenExpired()?(ctrl.$rootScope.preLoginState={name:"Root.MyComeos.Dashboard"},ctrl.$rootScope.preLoginState.stateParams={},ctrl.$state.go("login")):ctrl.$state.go("Root.MyComeos.Dashboard")},ComeosTopMenuController.prototype.openAdmin=function(){window.location.href="/index-admin.html"},ComeosTopMenuController.prototype.getLanguages=function(){var vm=this;vm.languageFactory.listLanguage().then(function(languages){vm.languages=languages,vm.determineActiveLangCode()})},ComeosTopMenuController.prototype.selectLang=function(lang){var vm=this;vm.altaiLocalizationService.changeLang(lang.code).then(function(){vm.$rootScope.$broadcast("languageChanged"),window.location.reload()})},ComeosTopMenuController.prototype.determineActiveLangCode=function(){var vm=this;vm.activeLang=vm.altaiLocalizationService.getCurrentLangCode(),vm.languages=vm.languages.map(function(lang){return lang.selected=vm.activeLang==lang.code,lang})},ComeosTopMenuController}();ComeosModule.ComeosTopMenuController=ComeosTopMenuController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var LinkResolverService=function(){function LinkResolverService(){}return LinkResolverService.prototype.getLink=function(contentType,id,name){void 0===id&&(id=-1);var link;switch(name&&(name=name.substring(0,100).replace(/Â|À|Å|Ã/g,"A").replace(/â|à|å|ã/g,"a").replace(/Ä/g,"AE").replace(/ä/g,"ae").replace(/Ç/g,"C").replace(/ç/g,"c").replace(/É|Ê|È|Ë/g,"E").replace(/é|ê|è|ë/g,"e").replace(/Ó|Ô|Ò|Õ|Ø/g,"O").replace(/ó|ô|ò|õ/g,"o").replace(/Ö/g,"OE").replace(/ö/g,"oe").replace(/Š/g,"S").replace(/š/g,"s").replace(/ß/g,"ss").replace(/Ú|Û|Ù/g,"U").replace(/ú|û|ù/g,"u").replace(/Ü/g,"UE").replace(/ü/g,"ue").replace(/Ý|Ÿ/g,"Y").replace(/ý|ÿ/g,"y").replace(/Ž/g,"Z").replace(/ž/,"z").replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,"")),contentType){case"complexdossier":link="Root.Detail.Dossier({id:"+id+", name:'"+name+"'})";break;case"pcinfo":link="Root.Detail.PCInfo({id:"+id+", name:'"+name+"'})";break;case"onderhandeling":link="Root.Detail.Negotiation({id:"+id+", name:'"+name+"'})";break;case"actumessage":link="Root.Detail.Actumessage({id:"+id+", name:'"+name+"'})";break;case"grafiek":link="Root.Detail.Graph({id:"+id+", name:'"+name+"'})";break;case"vergelijker1":link="Root.Detail.Vergelijker({id:"+id+", name:'"+name+"'})";break;case"brochure":link="Root.Detail.Brochure({id:"+id+", name:'"+name+"'})";break;case"magazine":link="Root.Detail.Magazine({id:"+id+", name:'"+name+"'})";break;case"magazineartikel":link="Root.Detail.MagazineArtikel({id:"+id+", name:'"+name+"'})";break;case"research":link="Root.Detail.Research({id:"+id+", name:'"+name+"'})";break;case"pressrelease":link="Root.Detail.Pressrelease({id:"+id+", name:'"+name+"'})";break;case"job":link="Root.Detail.Job({id:"+id+", name:'"+name+"'})";break;case"voluntaryengagement":link="Root.Detail.VoluntaryEngagement({id:"+id+", name:'"+name+"'})";break;case"workshop":link="Root.Detail.AcademyEvent({id:"+id+", name:'"+name+"'})";break;case"commissievergadering":link="Root.Detail.Vergadering({id:"+id+", name:'"+name+"'})";break;case"networkingevent":link="Root.Detail.Networkingevent({id:"+id+", name:'"+name+"'})";break;case"ceoletter":link="Root.MyComeos.CEOLetter({id:"+id+", name:'"+name+"'})";break;case"ceoevent":link="Root.Detail.CEOEvent({id:"+id+", name:'"+name+"'})";break;case"region":link=-1==id?"Root.Content.Regions()":"Root.DetailOverview.Region({id:"+id+", name:'"+name+"'})";break;case"theme":link=-1==id?"Root.Content.Themes()":"Root.DetailOverview.Theme({id:"+id+", name:'"+name+"'})";break;case"pc":link=-1==id?"Root.Content.PCs()":"Root.DetailOverviewSubmenu.PC({id:"+id+", name:'"+name+"'})";break;case"sector":link=-1==id?"Root.Content.Sectors()":"Root.DetailOverview.Sector({id:"+id+", name:'"+name+"'})";break;default:link="Root.Home"}return link},LinkResolverService}();ComeosModule.LinkResolverService=LinkResolverService}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var MyComeosDataService=function(){function MyComeosDataService(altaiHttp,$q,altaiNotificationFactory,$filter,$http,$translate,$rootScope){this.altaiHttp=altaiHttp,this.$q=$q,this.altaiNotificationFactory=altaiNotificationFactory,this.$filter=$filter,this.$http=$http,this.$translate=$translate,this.$rootScope=$rootScope,this.myFavorites=[],this.mySelection=[],this.isLoaded=!1;var s=this;s.getMySelection().then(function(mySelection){s.mySelection=mySelection.length?mySelection:[]}),s.getMyFavorites().then(function(myFavorites){s.myFavorites=myFavorites.length?myFavorites:[]})}return MyComeosDataService.prototype.getIsFavourite=function(id){var s=this;return s.myFavorites.some(function(element){return element==id})},MyComeosDataService.prototype.likeContentItem=function(item){var d=this.$q.defer(),service=this;return this.altaiHttp.post("/api/comeos/like",{id:item.id}).success(function(result){service.altaiNotificationFactory.success(service.$filter("translate")("TheItem")+' "'+item.title+'" '+service.$filter("translate")("WasAddedToTheListOfFavorites")),service.myFavorites.push(result.contentId),d.resolve(result)}).error(function(){service.altaiNotificationFactory.error("Kindly login to like this content"),d.reject()}),d.promise},MyComeosDataService.prototype.unlikeContentItem=function(item){var d=this.$q.defer(),service=this;return this.altaiHttp.post("/api/comeos/unlike",{id:item.id}).success(function(result){service.altaiNotificationFactory.success(service.$filter("translate")("TheItem")+' "'+item.name+'" '+service.$filter("translate")("WasRemovedFromTheListOfFavorites"));var index=service.myFavorites.indexOf(item.id);index>=0&&service.myFavorites.splice(index,1),d.resolve(result)}).error(function(){service.altaiNotificationFactory.error("Kindly login to dislike this content"),d.reject()}),d.promise},MyComeosDataService.prototype.getMySelection=function(){var s=this,d=s.$q.defer();return s.altaiHttp.get("api/comeos/myselection").then(function(mySelection){d.resolve(mySelection)}),d.promise},MyComeosDataService.prototype.getMyFavorites=function(){var s=this,d=s.$q.defer();return s.altaiHttp.get("api/comeos/myfavorites").then(function(mySelection){s.isLoaded=!0,d.resolve(mySelection)}),d.promise},MyComeosDataService.prototype.getCompanies=function(){var s=this,d=s.$q.defer();return s.altaiHttp.get("api/comeos/companies").then(function(data){d.resolve(data)}),d.promise},MyComeosDataService.prototype.updateProfile=function(profileContentItem,password){var s=this,d=s.$q.defer();return password||(password={"new":"",old:"",newrepeated:""}),s.$translate(["passwordsdonotmatch","profileupdated","couldnotupdateprofile"]).then(function(translations){password&&password["new"]!=password.newrepeated?(s.altaiNotificationFactory.error(translations.passwordsdonotmatch),d.reject()):s.$http.put("/api/comeos/profile",{profileContentItem:profileContentItem,newPassword:password["new"],oldPassword:password.old}).then(function(result){s.altaiNotificationFactory.success(translations.profileupdated),s.$rootScope.$broadcast("userInfoChanged",null),d.resolve(result)},function(){s.altaiNotificationFactory.error(translations.couldnotupdateprofile)})}),d.promise},MyComeosDataService.prototype.inviteNewEmployee=function(email,efficyId){var s=this,d=s.$q.defer();return s.altaiHttp.post("api/comeos/inviteemployee",{email:email,efficyId:efficyId}).then(function(data){d.resolve(data),s.altaiNotificationFactory.success("employeeinvitedsuccesfully")},function(){s.altaiNotificationFactory.success("employeeinvitedfailed")}),d.promise},MyComeosDataService}();ComeosModule.MyComeosDataService=MyComeosDataService}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function comeosMasonryInit($timeout){return{link:function(scope,element,attrs){if(scope.$last)var stopReadyWatch=scope.$watch("item.$ready",function(){scope.item.$ready&&$timeout(function(){loadMasonry(),stopReadyWatch()})})}}}function loadMasonry(){var grid=$(".grid");masonryInitialized&&grid.masonry("reloadItems"),grid.masonry({itemSelector:".grid-item",gutter:25,columnWidth:360,isFitWidth:!0,transitionDuration:0}),masonryInitialized=!0}var masonryInitialized=!1,ComeosMasonryComponent=function(){function ComeosMasonryComponent(){this.restrict="E",this.bindings={items:"="},this.templateUrl="/api/template/Component/ComeosMasonryTemplate",this.controller=ComeosMasonryController}return ComeosMasonryComponent}();ComeosModule.ComeosMasonryComponent=ComeosMasonryComponent;var ComeosMasonryController=function(){function ComeosMasonryController($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout}return ComeosMasonryController.prototype.$onInit=function(){masonryInitialized=!1},ComeosMasonryController}();ComeosModule.ComeosMasonryController=ComeosMasonryController,ComeosModule.comeosMasonryInit=comeosMasonryInit}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function comeosMasonryClientSideInit($timeout){return{link:function(scope,element,attrs){scope.$watch("item.$ready",function(){scope.item.$ready&&$timeout(function(){loadMasonry()})})}}}function loadMasonry(){var grid=$(".grid");grid.masonry({itemSelector:".grid-item",gutter:25,columnWidth:265,isFitWidth:!0,transitionDuration:"0.4s"}),masonryInitialized&&grid.masonry("reloadItems"),masonryInitialized=!0}var masonryInitialized=!1,ComeosMasonryClientSideComponent=function(){function ComeosMasonryClientSideComponent(){this.restrict="E",this.bindings={items:"="},this.templateUrl="/api/template/Component/ComeosMasonryClientSideTemplate",this.controller=ComeosMasonryClientSideController}return ComeosMasonryClientSideComponent}();ComeosModule.ComeosMasonryClientSideComponent=ComeosMasonryClientSideComponent;var ComeosMasonryClientSideController=function(){function ComeosMasonryClientSideController($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout;var vm=this;$scope.$watch("$ctrl.items",function(newmodel){void 0!=vm.items&&vm.loadMasonry()},!0)}return ComeosMasonryClientSideController.prototype.$onInit=function(){masonryInitialized=!1},ComeosMasonryClientSideController.prototype.loadMasonry=function(){var vm=this,grid=$(".grid");vm.$timeout(function(){grid.masonry({itemSelector:".grid-item",gutter:25,columnWidth:265,isFitWidth:!0,transitionDuration:"0.4s"}),masonryInitialized&&grid.masonry("reloadItems"),masonryInitialized=!0})},ComeosMasonryClientSideController}();ComeosModule.ComeosMasonryClientSideController=ComeosMasonryClientSideController,ComeosModule.comeosMasonryClientSideInit=comeosMasonryClientSideInit}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var LinkShareComponent=function(){function LinkShareComponent(){this.bindings={},this.templateUrl="/api/template/Component/linkshare",this.controller=LinkShareComponentController,this.transclude=!0}return LinkShareComponent}();ComeosModule.LinkShareComponent=LinkShareComponent;var LinkShareComponentController=function(){function LinkShareComponentController($location,altaiNotificationFactory,$filter){this.$location=$location,this.$filter=$filter;var vm=this;vm.altaiNotificationFactory=altaiNotificationFactory,vm.link=$location.absUrl().split("?")[0]}return LinkShareComponentController.prototype.copied=function(){var vm=this,linktext=vm.$filter("translate")("the_link"),copiedtext=vm.$filter("translate")("succesfully_copied");vm.altaiNotificationFactory.success(linktext+" "+vm.link+" "+copiedtext)},LinkShareComponentController}();ComeosModule.LinkShareComponentController=LinkShareComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SocialShareCardComponent=function(){function SocialShareCardComponent(){this.bindings={item:"=",target:"=",contenttypemachinename:"="},this.templateUrl="/api/template/Component/socialsharecard",this.controller=SocialShareCardComponentController,this.transclude=!0}return SocialShareCardComponent}();ComeosModule.SocialShareCardComponent=SocialShareCardComponent;var SocialShareCardComponentController=function(){function SocialShareCardComponentController(){}return SocialShareCardComponentController}();ComeosModule.SocialShareCardComponentController=SocialShareCardComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var SocialShareHeaderComponent=function(){function SocialShareHeaderComponent(){this.bindings={item:"="},this.templateUrl="/api/template/Component/socialshareheader",this.controller=SocialShareHeaderComponentController,this.transclude=!0}return SocialShareHeaderComponent}();ComeosModule.SocialShareHeaderComponent=SocialShareHeaderComponent;var SocialShareHeaderComponentController=function(){function SocialShareHeaderComponentController(){}return SocialShareHeaderComponentController}();ComeosModule.SocialShareHeaderComponentController=SocialShareHeaderComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var AltaiSocialShareModalComponent=function(){function AltaiSocialShareModalComponent(){this.bindings={resolve:"<",close:"&",dismiss:"&"},this.templateUrl="/api/template/Component/socialShare",this.controller=AltaiSocialShareModalComponentController}return AltaiSocialShareModalComponent}();ComeosModule.AltaiSocialShareModalComponent=AltaiSocialShareModalComponent;var AltaiSocialShareModalComponentController=function(){function AltaiSocialShareModalComponentController($location,$state,altaiNotificationFactory,$filter,$sce,$scope){this.$location=$location,this.$state=$state,this.$filter=$filter,this.$sce=$sce,this.$scope=$scope;var vm=this;vm.altaiNotificationFactory=altaiNotificationFactory,$scope.$watch("$ctrl.item",function(val){val?(vm.item.socialsharehashtags="comeos",vm.item.socialshareurl=vm.link,vm.item.socialsharedescription=vm.HtmlDecode(vm.item.publicintroduction||vm.item.membersintroduction||vm.item.intro),vm.onlyImage=!1):vm.onlyImage=!0}),$scope.$watch("$ctrl.target",function(val){val?vm.link=vm.$state.href(val.split("(")[0],{id:vm.item.id,name:vm.item.title||vm.item.titel||vm.item.name?(vm.item.title||vm.item.titel||vm.item.name).substring(0,100).replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,""):void 0},{absolute:!0}):vm.link=vm.$location.absUrl().split("?")[0],vm.item&&(vm.item.socialshareurl=vm.link)})}return AltaiSocialShareModalComponentController.prototype.$onInit=function(){var vm=this;vm.item=vm.resolve.item,vm.item?(vm.item.socialsharehashtags="comeos",vm.item.socialshareurl=vm.link,vm.item.socialsharedescription=vm.HtmlDecode(vm.item.publicintroduction||vm.item.membersintroduction||vm.item.intro),vm.onlyImage=!1):vm.onlyImage=!0,vm.target=vm.resolve.target,console.log(vm.resolve),vm.target?vm.link=vm.$state.href(vm.target.split("(")[0],{id:vm.item.id},{absolute:!0}):vm.link=vm.$location.absUrl().split("?")[0],vm.item&&(vm.item.socialshareurl=vm.link)},AltaiSocialShareModalComponentController.prototype.getMail=function(link){var vm=this;return void 0!=vm.item.socialsharedescription?vm.item.socialsharedescription+"%0A%0A"+link+"%0A%0A":link+"%0A%0A"},AltaiSocialShareModalComponentController.prototype.cancel=function(){var vm=this;vm.dismiss({$value:"cancel"})},AltaiSocialShareModalComponentController.prototype.htmlToPlaintext=function(text){return text?$(text).text():""},AltaiSocialShareModalComponentController.prototype.HtmlDecode=function(s){var vm=this,text=vm.htmlToPlaintext(s);return text.replace(/&[a-z]+;/gi,function(entity){switch(entity){case"&quot;":return String.fromCharCode(34);case"&amp;":return String.fromCharCode(38);case"&lt;":return String.fromCharCode(60);case"&gt;":return String.fromCharCode(62);case"&nbsp;":return String.fromCharCode(160);case"&iexcl;":return String.fromCharCode(161);case"&cent;":return String.fromCharCode(162);case"&pound;":return String.fromCharCode(163);case"&curren;":return String.fromCharCode(164);case"&yen;":return String.fromCharCode(165);case"&brvbar;":return String.fromCharCode(166);case"&sect;":return String.fromCharCode(167);case"&uml;":return String.fromCharCode(168);case"&copy;":return String.fromCharCode(169);case"&ordf;":return String.fromCharCode(170);case"&laquo;":return String.fromCharCode(171);case"&not;":return String.fromCharCode(172);case"&shy;":return String.fromCharCode(173);case"&reg;":return String.fromCharCode(174);case"&macr;":return String.fromCharCode(175);case"&deg;":return String.fromCharCode(176);case"&plusmn;":return String.fromCharCode(177);case"&sup2;":return String.fromCharCode(178);case"&sup3;":return String.fromCharCode(179);case"&acute;":return String.fromCharCode(180);case"&micro;":return String.fromCharCode(181);case"&para;":return String.fromCharCode(182);case"&middot;":return String.fromCharCode(183);case"&cedil;":return String.fromCharCode(184);case"&sup1;":return String.fromCharCode(185);case"&ordm;":return String.fromCharCode(186);case"&raquo;":return String.fromCharCode(187);case"&frac14;":return String.fromCharCode(188);case"&frac12;":return String.fromCharCode(189);case"&frac34;":return String.fromCharCode(190);case"&iquest;":return String.fromCharCode(191);case"&Agrave;":return String.fromCharCode(192);case"&Aacute;":return String.fromCharCode(193);case"&Acirc;":return String.fromCharCode(194);case"&Atilde;":return String.fromCharCode(195);case"&Auml;":return String.fromCharCode(196);case"&Aring;":return String.fromCharCode(197);case"&AElig;":return String.fromCharCode(198);case"&Ccedil;":return String.fromCharCode(199);case"&Egrave;":return String.fromCharCode(200);case"&Eacute;":return String.fromCharCode(201);case"&Ecirc;":return String.fromCharCode(202);case"&Euml;":return String.fromCharCode(203);case"&Igrave;":return String.fromCharCode(204);case"&Iacute;":return String.fromCharCode(205);case"&Icirc;":return String.fromCharCode(206);case"&Iuml;":return String.fromCharCode(207);case"&ETH;":return String.fromCharCode(208);case"&Ntilde;":return String.fromCharCode(209);case"&Ograve;":return String.fromCharCode(210);case"&Oacute;":return String.fromCharCode(211);case"&Ocirc;":return String.fromCharCode(212);case"&Otilde;":return String.fromCharCode(213);case"&Ouml;":return String.fromCharCode(214);case"&times;":return String.fromCharCode(215);case"&Oslash;":return String.fromCharCode(216);case"&Ugrave;":return String.fromCharCode(217);case"&Uacute;":return String.fromCharCode(218);case"&Ucirc;":return String.fromCharCode(219);case"&Uuml;":return String.fromCharCode(220);case"&Yacute;":return String.fromCharCode(221);case"&THORN;":return String.fromCharCode(222);case"&szlig;":return String.fromCharCode(223);case"&agrave;":return String.fromCharCode(224);case"&aacute;":return String.fromCharCode(225);case"&acirc;":return String.fromCharCode(226);case"&atilde;":return String.fromCharCode(227);
case"&auml;":return String.fromCharCode(228);case"&aring;":return String.fromCharCode(229);case"&aelig;":return String.fromCharCode(230);case"&ccedil;":return String.fromCharCode(231);case"&egrave;":return String.fromCharCode(232);case"&eacute;":return String.fromCharCode(233);case"&ecirc;":return String.fromCharCode(234);case"&euml;":return String.fromCharCode(235);case"&igrave;":return String.fromCharCode(236);case"&iacute;":return String.fromCharCode(237);case"&icirc;":return String.fromCharCode(238);case"&iuml;":return String.fromCharCode(239);case"&eth;":return String.fromCharCode(240);case"&ntilde;":return String.fromCharCode(241);case"&ograve;":return String.fromCharCode(242);case"&oacute;":return String.fromCharCode(243);case"&ocirc;":return String.fromCharCode(244);case"&otilde;":return String.fromCharCode(245);case"&ouml;":return String.fromCharCode(246);case"&divide;":return String.fromCharCode(247);case"&oslash;":return String.fromCharCode(248);case"&ugrave;":return String.fromCharCode(249);case"&uacute;":return String.fromCharCode(250);case"&ucirc;":return String.fromCharCode(251);case"&uuml;":return String.fromCharCode(252);case"&yacute;":return String.fromCharCode(253);case"&thorn;":return String.fromCharCode(254);case"&yuml;":return String.fromCharCode(255);case"&OElig;":return String.fromCharCode(338);case"&oelig;":return String.fromCharCode(339);case"&Scaron;":return String.fromCharCode(352);case"&scaron;":return String.fromCharCode(353);case"&Yuml;":return String.fromCharCode(376);case"&fnof;":return String.fromCharCode(402);case"&circ;":return String.fromCharCode(710);case"&tilde;":return String.fromCharCode(732);case"&Alpha;":return String.fromCharCode(913);case"&Beta;":return String.fromCharCode(914);case"&Gamma;":return String.fromCharCode(915);case"&Delta;":return String.fromCharCode(916);case"&Epsilon;":return String.fromCharCode(917);case"&Zeta;":return String.fromCharCode(918);case"&Eta;":return String.fromCharCode(919);case"&Theta;":return String.fromCharCode(920);case"&Iota;":return String.fromCharCode(921);case"&Kappa;":return String.fromCharCode(922);case"&Lambda;":return String.fromCharCode(923);case"&Mu;":return String.fromCharCode(924);case"&Nu;":return String.fromCharCode(925);case"&Xi;":return String.fromCharCode(926);case"&Omicron;":return String.fromCharCode(927);case"&Pi;":return String.fromCharCode(928);case"&Rho ;":return String.fromCharCode(929);case"&Sigma;":return String.fromCharCode(931);case"&Tau;":return String.fromCharCode(932);case"&Upsilon;":return String.fromCharCode(933);case"&Phi;":return String.fromCharCode(934);case"&Chi;":return String.fromCharCode(935);case"&Psi;":return String.fromCharCode(936);case"&Omega;":return String.fromCharCode(937);case"&alpha;":return String.fromCharCode(945);case"&beta;":return String.fromCharCode(946);case"&gamma;":return String.fromCharCode(947);case"&delta;":return String.fromCharCode(948);case"&epsilon;":return String.fromCharCode(949);case"&zeta;":return String.fromCharCode(950);case"&eta;":return String.fromCharCode(951);case"&theta;":return String.fromCharCode(952);case"&iota;":return String.fromCharCode(953);case"&kappa;":return String.fromCharCode(954);case"&lambda;":return String.fromCharCode(955);case"&mu;":return String.fromCharCode(956);case"&nu;":return String.fromCharCode(957);case"&xi;":return String.fromCharCode(958);case"&omicron;":return String.fromCharCode(959);case"&pi;":return String.fromCharCode(960);case"&rho;":return String.fromCharCode(961);case"&sigmaf;":return String.fromCharCode(962);case"&sigma;":return String.fromCharCode(963);case"&tau;":return String.fromCharCode(964);case"&upsilon;":return String.fromCharCode(965);case"&phi;":return String.fromCharCode(966);case"&chi;":return String.fromCharCode(967);case"&psi;":return String.fromCharCode(968);case"&omega;":return String.fromCharCode(969);case"&thetasym;":return String.fromCharCode(977);case"&upsih;":return String.fromCharCode(978);case"&piv;":return String.fromCharCode(982);case"&ensp;":return String.fromCharCode(8194);case"&emsp;":return String.fromCharCode(8195);case"&thinsp;":return String.fromCharCode(8201);case"&zwnj;":return String.fromCharCode(8204);case"&zwj;":return String.fromCharCode(8205);case"&lrm;":return String.fromCharCode(8206);case"&rlm;":return String.fromCharCode(8207);case"&ndash;":return String.fromCharCode(8211);case"&mdash;":return String.fromCharCode(8212);case"&lsquo;":return String.fromCharCode(8216);case"&rsquo;":return String.fromCharCode(8217);case"&sbquo;":return String.fromCharCode(8218);case"&ldquo;":return String.fromCharCode(8220);case"&rdquo;":return String.fromCharCode(8221);case"&bdquo;":return String.fromCharCode(8222);case"&dagger;":return String.fromCharCode(8224);case"&Dagger;":return String.fromCharCode(8225);case"&bull;":return String.fromCharCode(8226);case"&hellip;":return String.fromCharCode(8230);case"&permil;":return String.fromCharCode(8240);case"&prime;":return String.fromCharCode(8242);case"&Prime;":return String.fromCharCode(8243);case"&lsaquo;":return String.fromCharCode(8249);case"&rsaquo;":return String.fromCharCode(8250);case"&oline;":return String.fromCharCode(8254);case"&frasl;":return String.fromCharCode(8260);case"&euro;":return String.fromCharCode(8364);case"&image;":return String.fromCharCode(8465);case"&weierp;":return String.fromCharCode(8472);case"&real;":return String.fromCharCode(8476);case"&trade;":return String.fromCharCode(8482);case"&alefsym;":return String.fromCharCode(8501);case"&larr;":return String.fromCharCode(8592);case"&uarr;":return String.fromCharCode(8593);case"&rarr;":return String.fromCharCode(8594);case"&darr;":return String.fromCharCode(8595);case"&harr;":return String.fromCharCode(8596);case"&crarr;":return String.fromCharCode(8629);case"&lArr;":return String.fromCharCode(8656);case"&uArr;":return String.fromCharCode(8657);case"&rArr;":return String.fromCharCode(8658);case"&dArr;":return String.fromCharCode(8659);case"&hArr;":return String.fromCharCode(8660);case"&forall;":return String.fromCharCode(8704);case"&part;":return String.fromCharCode(8706);case"&exist;":return String.fromCharCode(8707);case"&empty;":return String.fromCharCode(8709);case"&nabla;":return String.fromCharCode(8711);case"&isin;":return String.fromCharCode(8712);case"&notin;":return String.fromCharCode(8713);case"&ni;":return String.fromCharCode(8715);case"&prod;":return String.fromCharCode(8719);case"&sum;":return String.fromCharCode(8721);case"&minus;":return String.fromCharCode(8722);case"&lowast;":return String.fromCharCode(8727);case"&radic;":return String.fromCharCode(8730);case"&prop;":return String.fromCharCode(8733);case"&infin;":return String.fromCharCode(8734);case"&ang;":return String.fromCharCode(8736);case"&and;":return String.fromCharCode(8743);case"&or;":return String.fromCharCode(8744);case"&cap;":return String.fromCharCode(8745);case"&cup;":return String.fromCharCode(8746);case"&int;":return String.fromCharCode(8747);case"&there4;":return String.fromCharCode(8756);case"&sim;":return String.fromCharCode(8764);case"&cong;":return String.fromCharCode(8773);case"&asymp;":return String.fromCharCode(8776);case"&ne;":return String.fromCharCode(8800);case"&equiv;":return String.fromCharCode(8801);case"&le;":return String.fromCharCode(8804);case"&ge;":return String.fromCharCode(8805);case"&sub;":return String.fromCharCode(8834);case"&sup;":return String.fromCharCode(8835);case"&nsub;":return String.fromCharCode(8836);case"&sube;":return String.fromCharCode(8838);case"&supe;":return String.fromCharCode(8839);case"&oplus;":return String.fromCharCode(8853);case"&otimes;":return String.fromCharCode(8855);case"&perp;":return String.fromCharCode(8869);case"&sdot;":return String.fromCharCode(8901);case"&lceil;":return String.fromCharCode(8968);case"&rceil;":return String.fromCharCode(8969);case"&lfloor;":return String.fromCharCode(8970);case"&rfloor;":return String.fromCharCode(8971);case"&lang;":return String.fromCharCode(9001);case"&rang;":return String.fromCharCode(9002);case"&loz;":return String.fromCharCode(9674);case"&spades;":return String.fromCharCode(9824);case"&clubs;":return String.fromCharCode(9827);case"&hearts;":return String.fromCharCode(9829);case"&diams;":return String.fromCharCode(9830);case"&#39;":return String.fromCharCode(546);default:return""}})},AltaiSocialShareModalComponentController}();ComeosModule.AltaiSocialShareModalComponentController=AltaiSocialShareModalComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var AltaiInitMediaMessageComponent=function(){function AltaiInitMediaMessageComponent(){this.bindings={resolve:"<",close:"&",dismiss:"&"},this.templateUrl="/api/template/Component/AltaiInitMediaMessage",this.controller=AltaiInitMediaMessageComponentController}return AltaiInitMediaMessageComponent}();ComeosModule.AltaiInitMediaMessageComponent=AltaiInitMediaMessageComponent;var AltaiInitMediaMessageComponentController=function(){function AltaiInitMediaMessageComponentController(altaiClientDataStore,altaiLocalizationService,$rootScope,$location,$state,altaiNotificationFactory,$filter,$sce,$scope,languageFactory){this.altaiClientDataStore=altaiClientDataStore,this.altaiLocalizationService=altaiLocalizationService,this.$rootScope=$rootScope,this.$location=$location,this.$state=$state,this.altaiNotificationFactory=altaiNotificationFactory,this.$filter=$filter,this.$sce=$sce,this.$scope=$scope,this.languageFactory=languageFactory,this.hideInitMediaMessage=!0,this.inited=!1;var vm=this;vm.altaiClientDataStore.get("hideInitMediaMessage")&&(vm.hideInitMediaMessage="true"==vm.altaiClientDataStore.get("hideInitMediaMessage")),vm.getLanguages()}return AltaiInitMediaMessageComponentController.prototype.$onInit=function(){var vm=this;vm.item=vm.resolve,"nl"==vm.altaiLocalizationService.getCurrentLangCode()?vm.item.url=vm.$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+vm.item.youtubeidnl+"?autoplay=0&origin=http://www.comeos.be&loop=1&modestbranding=1&fs=1"):vm.item.url=vm.$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+vm.item.youtubeidfr+"?autoplay=0&origin=http://www.comeos.be&loop=1&modestbranding=1&fs=1"),vm.inited=!0},AltaiInitMediaMessageComponentController.prototype.getMail=function(link){},AltaiInitMediaMessageComponentController.prototype.cancel=function(){var vm=this;vm.hideInitMediaMessage&&vm.altaiClientDataStore.set("hideInitMediaMessage",!0),vm.dismiss({$value:"cancel"})},AltaiInitMediaMessageComponentController.prototype.getLanguages=function(){var vm=this;vm.languageFactory.listLanguage().then(function(languages){vm.languages=languages,vm.determineActiveLangCode()})},AltaiInitMediaMessageComponentController.prototype.selectLang=function(lang){var vm=this;vm.altaiLocalizationService.changeLang(lang.code).then(function(){vm.$rootScope.$broadcast("languageChanged"),window.location.reload()})},AltaiInitMediaMessageComponentController.prototype.determineActiveLangCode=function(){var vm=this;vm.activeLang=vm.altaiLocalizationService.getCurrentLangCode(),vm.languages=vm.languages.map(function(lang){return lang.selected=vm.activeLang==lang.code,lang})},AltaiInitMediaMessageComponentController}();ComeosModule.AltaiInitMediaMessageComponentController=AltaiInitMediaMessageComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiSocialShare(){return{restrict:"AE",scope:{item:"=",target:"<"},bindToController:!0,controllerAs:"$ctrl",controller:AltaiSocialShareController,link:AltaiSocialShareLink}}ComeosModule.AltaiSocialShare=AltaiSocialShare;var AltaiSocialShareLink=function(){function AltaiSocialShareLink(scope,element,attr,ctrls){element.on("click",function(){ctrls.open()})}return AltaiSocialShareLink}();ComeosModule.AltaiSocialShareLink=AltaiSocialShareLink;var AltaiSocialShareController=function(){function AltaiSocialShareController($location,$filter,$sce,$scope,$uibModal){this.$location=$location,this.$filter=$filter,this.$sce=$sce,this.$scope=$scope,this.$uibModal=$uibModal}return AltaiSocialShareController.prototype.open=function(size,parentSelector){var vm=this,parentElem=parentSelector?angular.element("#bodyView "+parentSelector):angular.element("#bodyView"),modalInstance=vm.$uibModal.open({animation:!1,component:"AltaiSocialShareModal",resolve:{item:function(){return vm.item},target:function(){return vm.target}},appendTo:parentElem});modalInstance.result.then(function(selectedItem){},function(){})},AltaiSocialShareController}();ComeosModule.AltaiSocialShareController=AltaiSocialShareController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiHoverIntent($timeout){return{restrict:"A",link:function(scope,element,attributes){var hoverIntentPromise;element.bind("mouseenter",function(event){var delay=scope.$eval(attributes.hoverIntentDelay);void 0===delay&&(delay=500),hoverIntentPromise=$timeout(function(){scope.$eval(attributes.altaiHoverIntent,{$event:event})},delay)}),element.bind("mouseleave",function(){$timeout.cancel(hoverIntentPromise)})}}}ComeosModule.AltaiHoverIntent=AltaiHoverIntent}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function AltaiUnHoverIntent($timeout){return{restrict:"A",link:function(scope,element,attributes){var unHoverIntentPromise;element.bind("mouseleave",function(event){var delay=scope.$eval(attributes.unHoverIntentDelay);void 0===delay&&(delay=500),unHoverIntentPromise=$timeout(function(){scope.$eval(attributes.altaiUnHoverIntent,{$event:event})},delay)}),element.bind("mouseenter",function(){$timeout.cancel(unHoverIntentPromise)})}}}ComeosModule.AltaiUnHoverIntent=AltaiUnHoverIntent}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosMobileMenuComponent=function(){function ComeosMobileMenuComponent(){this.restrict="E",this.bindings={menuItems:"="},this.templateUrl="/api/template/Component/ComeosMobileMenu",this.controller=ComeosMobileMenuComponentController}return ComeosMobileMenuComponent}();ComeosModule.ComeosMobileMenuComponent=ComeosMobileMenuComponent;var ComeosMobileMenuComponentController=function(){function ComeosMobileMenuComponentController($scope,$rootScope,$state,authService,userInfoService,languageFactory,altaiLocalizationService){this.$scope=$scope,this.$rootScope=$rootScope,this.$state=$state,this.authService=authService,this.userInfoService=userInfoService,this.languageFactory=languageFactory,this.altaiLocalizationService=altaiLocalizationService,this.visible=!1,this.searcher=!1,this.loading=!1;var vm=this;$rootScope.$on("toggleMobileMenu",function(r){vm.visible=!vm.visible}),$rootScope.$on("loaderShow",function(){vm.loading=!0}),$rootScope.$on("loaderHide",function(){vm.loading=!1}),authService.getUserInfo().then(function(userinfo){vm.isLoggedIn=!0},function(reject){vm.isLoggedIn=!1}),vm.getLanguages()}return ComeosMobileMenuComponentController.prototype.search=function(){var vm=this;vm.searcher=!1,vm.searchQuery&&vm.searchQuery.length>0&&vm.$state.go("Root.Content.Searcher",{q:vm.searchQuery}),vm.searchQuery=""},ComeosMobileMenuComponentController.prototype.openMobileMenu=function(){var vm=this;vm.searcher&&(vm.searcher=!1),vm.visible=!vm.visible,vm.$rootScope.mobilemenu=vm.visible},ComeosMobileMenuComponentController.prototype.openSearcher=function(){var vm=this;vm.visible&&(vm.visible=!1),vm.searcher=!vm.searcher},ComeosMobileMenuComponentController.prototype.openLink=function(link){var vm=this;void 0!=link.state?vm.$state.go(link.state.name):void 0!=link.url&&window.open(link.url,"_blank"),vm.visible=!1},ComeosMobileMenuComponentController.prototype.openAdmin=function(){window.location.href="/index-admin.html"},ComeosMobileMenuComponentController.prototype.logout=function(){window.location.href="/logout"},ComeosMobileMenuComponentController.prototype.getLanguages=function(){var vm=this;vm.languageFactory.listLanguage().then(function(languages){vm.languages=languages,vm.determineActiveLangCode()})},ComeosMobileMenuComponentController.prototype.selectLang=function(lang){var vm=this;vm.altaiLocalizationService.changeLang(lang.code).then(function(){vm.$rootScope.$broadcast("refreshWindow"),vm.$rootScope.$broadcast("languageChanged"),vm.determineActiveLangCode()}),window.location.reload()},ComeosMobileMenuComponentController.prototype.determineActiveLangCode=function(){var vm=this;vm.activeLang=vm.altaiLocalizationService.getCurrentLangCode(),vm.languages=vm.languages.map(function(lang){return lang.selected=vm.activeLang==lang.code,lang})},ComeosMobileMenuComponentController}();ComeosModule.ComeosMobileMenuComponentController=ComeosMobileMenuComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function comeosFixedMenu($rootScope,$timeout){return{link:function(scope,element,attrs){$.fn.exists=function(){return 0!==this.length};var bodyViewElm=$("#bodyview"),$w=$(window),a=$("[comeos-fixed-menu]"),b=$("#comeosMenuPlaceholder").height(),c=0,fixed=!1;$rootScope.$on("$stateChangeSuccess",function(){fixed=!1}),$rootScope.$on("$stateChangeStart",function(){$(document).off("load scroll resize")}),$w.on("load scroll resize",function(){fixed||(a=$("[comeos-fixed-menu]"),b=$("#comeosMenuPlaceholder").height(),c=(void 0!=a.offset()?a.offset().top:0)-(void 0!=b?b:0),0>c?c=0:""),window.pageYOffset>c?(a.addClass("fixed midmenu"),bodyViewElm.addClass("withfixedmenu"),fixed=!0):(a.removeClass("fixed midmenu"),bodyViewElm.removeClass("withfixedmenu"),fixed=!1)})},controller:function($scope,$state){$scope.State=$state}}}ComeosModule.comeosFixedMenu=comeosFixedMenu}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function myComeosFixedMenu($rootScope,$timeout){function myComeosthrottle(fn,threshhold,scope){threshhold||(threshhold=250);var last,deferTimer;return function(){var context=scope||this,now=+new Date,args=arguments;last&&last+threshhold>now?(clearTimeout(deferTimer),deferTimer=setTimeout(function(){last=now,fn.apply(context,args)},threshhold)):(last=now,fn.apply(context,args))}}return{link:function(scope,element,attrs){var initialPosition,fixed,bodyViewElm,placeHolderElm,myComeosFixedMenuElm,windowElm;$timeout(function(){bodyViewElm=$("#bodyView"),placeHolderElm=$("[ui-view='topMenuView']"),myComeosFixedMenuElm=$("[my-comeos-fixed-menu]"),windowElm=$(window),placeHolderElm&&(initialPosition=myComeosFixedMenuElm.position().top-(placeHolderElm.position().top+placeHolderElm.height()))}),$(document).on("scroll","",myComeosthrottle(function(e){placeHolderElm&&(windowElm.scrollTop()>=initialPosition?fixed||(bodyViewElm.addClass("mycomeosfixed"),myComeosFixedMenuElm.addClass("fixed midmenu"),fixed=!0):fixed&&(bodyViewElm.removeClass("mycomeosfixed"),myComeosFixedMenuElm.removeClass("fixed midmenu"),fixed=!1))},200,null)),$rootScope.$on("$stateChangeSuccess",function(){$(document).on("scroll","",myComeosthrottle(function(e){placeHolderElm&&(windowElm.scrollTop()>=initialPosition?fixed||(bodyViewElm.addClass("mycomeosfixed"),myComeosFixedMenuElm.addClass("fixed midmenu"),fixed=!0):fixed&&(bodyViewElm.removeClass("mycomeosfixed"),myComeosFixedMenuElm.removeClass("fixed midmenu"),fixed=!1))},200,null))}),$rootScope.$on("$stateChangeStart",function(){$(document).off("scroll","",myComeosthrottle(function(e){placeHolderElm&&(windowElm.scrollTop()>=initialPosition?fixed||(bodyViewElm.addClass("mycomeosfixed"),myComeosFixedMenuElm.addClass("fixed midmenu"),fixed=!0):fixed&&(bodyViewElm.removeClass("mycomeosfixed"),myComeosFixedMenuElm.removeClass("fixed midmenu"),fixed=!1))},200,null))})},controller:function($scope,$state){$scope.State=$state}}}ComeosModule.myComeosFixedMenu=myComeosFixedMenu}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function myComeosMenu($rootScope,$timeout){return{controller:function($scope,$state){$scope.State=$state}}}ComeosModule.myComeosMenu=myComeosMenu}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCollectionSelectionComponent=function(){function ComeosCollectionSelectionComponent(){this.restrict="E",this.bindings={columns:"@",title:"@",items:"=","typeof":"@"},this.template='<div class="subsubtitle">{{$ctrl.title}}</div>                           <div class="Rtable Rtable--{{$ctrl.columns}}cols Rtable--collapse">                            <div class="Rtable-cell" ng-repeat="item in $ctrl.allitems track by item.id" class="col-xs-12 col-sm-6 col-md-3 col-lg-2">                                <div class="checkbox checkbox-info"><input type="checkbox" id="{{item.id}}" ng-change="$ctrl.changedValue(item)"  ng-model="item.selected" name="{{item.title}}" />                                    <label for="{{item.id}}">                                        {{item.title}}                                    </label>                                </div >                            </div>                            <div class="Rtable-cell" ng-repeat="i in $ctrl.getRest() track by $index" class="col-xs-12 col-sm-6 col-md-3 col-lg-2">                                &nbsp;                            </div>                          </div>',this.controller=ComeosCollectionSelectionComponentController}return ComeosCollectionSelectionComponent}();ComeosModule.ComeosCollectionSelectionComponent=ComeosCollectionSelectionComponent;var ComeosCollectionSelectionComponentController=function(){function ComeosCollectionSelectionComponentController($scope,contentCollectionDataService){this.$scope=$scope,this.contentCollectionDataService=contentCollectionDataService;var vm=this;void 0==vm.columns&&(vm.columns=3);var all=vm.contentCollectionDataService.getDataByName(vm["typeof"]);all.then(function(allitems){vm.allitems=allitems.pageResults,void 0!=vm.allitems&&vm.allitems.filter(function(item){vm.findIdinItems(item.id)?item.selected=!0:item.selected=!1})})}return ComeosCollectionSelectionComponentController.prototype.findIdinItems=function(itemId){var ctrl=this,selected=void 0;return void 0!=ctrl.items&&(selected=ctrl.items.filter(function(item){return item.id==itemId})[0]),!!selected},ComeosCollectionSelectionComponentController}();ComeosModule.ComeosCollectionSelectionComponentController=ComeosCollectionSelectionComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosLoginComponent=function(){function ComeosLoginComponent(){this.restrict="A",this.templateUrl="/api/template/Component/ComeosLogin",this.controller=ComeosLoginController}return ComeosLoginComponent}();ComeosModule.ComeosLoginComponent=ComeosLoginComponent;var ComeosLoginController=function(){function ComeosLoginController($scope,$state,authService,config){authService.isAuthorizedSync("mycomeos")?$state.go("Root.MyComeos.Favorieten"):($scope.loginData={},$scope.doLogin=function(loginData){authService.login(loginData).then(function(){$state.reload()})})}return ComeosLoginController}();ComeosModule.ComeosLoginController=ComeosLoginController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCalendarComponent=function(){function ComeosCalendarComponent(){this.restrict="E",this.bindings={ngModel:"=",setRangeFilter:"&",resolve:"<"},this.templateUrl="/api/template/Component/ComeosCalendar",this.controller=ComeosCalendarController}return ComeosCalendarComponent}();ComeosModule.ComeosCalendarComponent=ComeosCalendarComponent;var ComeosCalendarController=function(){function ComeosCalendarController($filter,$scope,$compile,$rootScope,linkResolverService,uiCalendarConfig,$timeout,contentTypeService,$state,altaiLocalizationService){var _this=this;this.$filter=$filter,this.$scope=$scope,this.$compile=$compile,this.$rootScope=$rootScope,this.linkResolverService=linkResolverService,this.uiCalendarConfig=uiCalendarConfig,this.contentTypeService=contentTypeService,this.$state=$state,this.altaiLocalizationService=altaiLocalizationService,this.calendarItems=[],this.calendar=[{events:[]}],this.events=[],this.eventSource=[],this.loaded=!1,this.eventRender=function(event,element){var ctrl=_this;ctrl.$compile(element)(ctrl.$scope),event.icon&&element.find(".fc-title").prepend("<i class='mdi mdi-"+event.icon+"' style='color: "+event.textColor+"; font-size: 120%;'></i> ")},this.getData=function(view,element){var ctrl=_this;if(ctrl.loaded){var range={selected:!0,field:"*date",type:"date",startValue:new Date(view.start),endValue:new Date(view.end)};ctrl.setRangeFilter({range:range})}else ctrl.loaded=!0},this.alertOnEventClick=function(event,jsEvent,view){var ctrl=_this;ctrl.contentTypeService.getLinkedState(event.contentTypeId).then(function(stateName){stateName&&ctrl.$state.go(stateName,{id:event.id,name:event.title.substring(0,100).replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,"")})})},this.renderCalendar=function(calendar){var ctrl=this;ctrl.timeout(function(){ctrl.uiCalendarConfig.calendars[calendar]&&(console.log(calendar),ctrl.uiCalendarConfig.calendars[calendar].fullCalendar("render"))})};var ctrl=this;this.timeout=$timeout;var date=new Date;date.getDate(),date.getMonth(),date.getFullYear();ctrl.eventSources=[],ctrl.uiConfig={calendar:{height:"auto",editable:!1,handleWindowResize:!0,timeFormat:"H:mm",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},lang:ctrl.altaiLocalizationService.getCurrentLangCode(),defaultView:"month",minTime:"07:00:00",maxTime:"24:00:00",navLinks:!0,displayEventTime:!0,eventClick:ctrl.alertOnEventClick,viewRender:ctrl.getData,eventRender:ctrl.eventRender}},$scope.$watch("$ctrl.ngModel",function(newValue,oldValue){void 0!=newValue&&ctrl.copyEvents()})}return ComeosCalendarController.prototype.eventsF=function(start,end,timezone,callback){var ctrl=this;new Date(start).getTime()/1e3,new Date(end).getTime()/1e3,new Date(start).getMonth();callback(ctrl.events)},ComeosCalendarController.prototype.copyEvents=function(){var ctrl=this,z=0;ctrl.events=[];for(var x in ctrl.ngModel)if("commissievergadering"==ctrl.ngModel[x].contentType){var date=new Date(ctrl.ngModel[x].date),d=date.getDate(),m=date.getMonth(),y=date.getFullYear();if(void 0!=ctrl.ngModel[x].tijdvan&&void 0!=ctrl.ngModel[x].tijdtot){var from=new Date(ctrl.ngModel[x].tijdvan),hfrom=from.getHours(),mfrom=from.getMinutes(),until=new Date(ctrl.ngModel[x].tijdtot),huntil=until.getHours(),muntil=until.getMinutes();ctrl.events[z]={title:ctrl.ngModel[x].title,description:ctrl.ngModel[x].description&&ctrl.ngModel[x].description.length>150?ctrl.ngModel[x].description.slice(0,147)+"...":ctrl.ngModel[x].description?ctrl.ngModel[x].description:"",start:new Date(y,m,d,hfrom,mfrom),end:new Date(y,m,d,huntil,muntil),allDay:!1,color:"#F43122",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"commissievergadering",icon:ctrl.ngModel[x].enrolled?"check":""}}else ctrl.events[z]={title:ctrl.ngModel[x].commissiecommissievergadering.title,description:ctrl.ngModel[x].description&&ctrl.ngModel[x].description.length>150?ctrl.ngModel[x].description.slice(0,147)+"...":ctrl.ngModel[x].description?ctrl.ngModel[x].description:"",start:new Date(y,m,d),end:new Date(y,m,d),allDay:!0,color:"#F43122",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"commissievergadering",icon:ctrl.ngModel[x].enrolled?"check":""};z++}else if("workshop"==ctrl.ngModel[x].contentType)if(void 0!=ctrl.ngModel[x].singledatetimeselectionworkshop)for(var p in ctrl.ngModel[x].singledatetimeselectionworkshop){var date=new Date(ctrl.ngModel[x].singledatetimeselectionworkshop[p].datum),d=date.getDate(),m=date.getMonth(),y=date.getFullYear();if(void 0==ctrl.ngModel[x].singledatetimeselectionworkshop[p].tijdvan||void 0==ctrl.ngModel[x].singledatetimeselectionworkshop[p].tijdtot||ctrl.ngModel[x].singledatetimeselectionworkshop[p].deheledag)ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d),end:new Date(y,m,d),allDay:!0,color:"#00B4E1",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"workshop",icon:ctrl.ngModel[x].enrolled?"check":""};else{var from=new Date(ctrl.ngModel[x].singledatetimeselectionworkshop[p].tijdvan),hfrom=from.getHours(),mfrom=from.getMinutes(),until=new Date(ctrl.ngModel[x].singledatetimeselectionworkshop[p].tijdtot),huntil=until.getHours(),muntil=until.getMinutes();ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d,hfrom,mfrom),end:new Date(y,m,d,huntil,muntil),allDay:ctrl.ngModel[x].singledatetimeselectionworkshop[p].deheledag,color:"#00B4E1",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"workshop",icon:ctrl.ngModel[x].enrolled?"check":""}}z++}else{if(void 0!=ctrl.ngModel[x].tijdvan&&void 0!=ctrl.ngModel[x].tijdtot){var date=new Date(ctrl.ngModel[x].date),d=date.getDate(),m=date.getMonth(),y=date.getFullYear(),from=new Date(ctrl.ngModel[x].tijdvan),hfrom=from.getHours(),mfrom=from.getMinutes(),until=new Date(ctrl.ngModel[x].tijdtot),huntil=until.getHours(),muntil=until.getMinutes();ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d,hfrom,mfrom),end:new Date(y,m,d,huntil,muntil),allDay:!1,color:"#00B4E1",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"workshop",icon:ctrl.ngModel[x].enrolled?"check":""}}else{var date=new Date(ctrl.ngModel[x].date),d=date.getDate(),m=date.getMonth(),y=date.getFullYear();ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d),end:new Date(y,m,d),allDay:!0,color:"#00B4E1",textColor:"#FFFFFF",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"workshop",icon:ctrl.ngModel[x].enrolled?"check":""}}z++}else if("networkingevent"==ctrl.ngModel[x].contentType){var date=new Date(ctrl.ngModel[x].date),d=date.getDate(),m=date.getMonth(),y=date.getFullYear();if(void 0!=ctrl.ngModel[x].tijdvan&&void 0!=ctrl.ngModel[x].tijdtot){var from=new Date(ctrl.ngModel[x].tijdvan),hfrom=from.getHours(),mfrom=from.getMinutes(),until=new Date(ctrl.ngModel[x].tijdtot),huntil=until.getHours(),muntil=until.getMinutes();ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d,hfrom,mfrom),end:new Date(y,m,d,huntil,muntil),allDay:!1,color:"#FFCE00",textColor:"#000000",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"networkingevent",icon:ctrl.ngModel[x].enrolled?"check":""}}else ctrl.events[z]={title:ctrl.ngModel[x].title,description:(ctrl.ngModel[x].intro&&ctrl.ngModel[x].intro.length)>150?ctrl.ngModel[x].intro.slice(0,147)+"...":ctrl.ngModel[x].intro,start:new Date(y,m,d),end:new Date(y,m,d),allDay:!0,color:"#FFCE00",textColor:"#000000",contentTypeId:ctrl.ngModel[x].contentTypeId,id:ctrl.ngModel[x].id,contentType:"networkingevent",icon:ctrl.ngModel[x].enrolled?"check":""};z++}ctrl.events.length<=z&&(ctrl.uiCalendarConfig.calendars.myCalendar.fullCalendar("removeEvents"),ctrl.uiCalendarConfig.calendars.myCalendar.fullCalendar("addEventSource",ctrl.events))},ComeosCalendarController}();ComeosModule.ComeosCalendarController=ComeosCalendarController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var masonryInitialized=!1,ComeosHotTopicComponent=function(){function ComeosHotTopicComponent(){this.restrict="E",this.bindings={item:"="
},this.templateUrl="/api/template/Component/ComeosHotTopic",this.controller=ComeosHotTopicComponentController}return ComeosHotTopicComponent}();ComeosModule.ComeosHotTopicComponent=ComeosHotTopicComponent;var ComeosHotTopicComponentController=function(){function ComeosHotTopicComponentController($scope,$timeout){this.$scope=$scope,this.$timeout=$timeout,this.completeHotTopic=!1;var vm=this,loader=$scope.$watch("$scope.item",function(newmodel){void 0!=vm.item&&(vm.init(),loader())},!0)}return ComeosHotTopicComponentController.prototype.$onInit=function(){masonryInitialized=!1},ComeosHotTopicComponentController.prototype.toggleCompleteHotTopic=function(){var vm=this;vm.completeHotTopic=!vm.completeHotTopic,vm.init()},ComeosHotTopicComponentController.prototype.init=function(){var vm=this,tempItems=[];if(vm.item.actumessage_hottheme)for(var i=0;i<vm.item.actumessage_hottheme.length;i++)tempItems.push(vm.item.actumessage_hottheme[i]);if(vm.item.brochurehottheme)for(var i=0;i<vm.item.brochurehottheme.length;i++)tempItems.push(vm.item.brochurehottheme[i]);if(vm.item.complexdossier_hottheme)for(var i=0;i<vm.item.complexdossier_hottheme.length;i++)tempItems.push(vm.item.complexdossier_hottheme[i]);if(vm.item.magazineartikel_hottheme)for(var i=0;i<vm.item.magazineartikel_hottheme.length;i++)tempItems.push(vm.item.magazineartikel_hottheme[i]);if(vm.item.networkingeventhottheme)for(var i=0;i<vm.item.networkingeventhottheme.length;i++)tempItems.push(vm.item.networkingeventhottheme[i]);if(vm.item.workshophottheme)for(var i=0;i<vm.item.workshophottheme.length;i++)tempItems.push(vm.item.workshophottheme[i]);if(vm.item.commissievergaderinghottheme)for(var i=0;i<vm.item.commissievergaderinghottheme.length;i++)tempItems.push(vm.item.commissievergaderinghottheme[i]);if(vm.item.pressrelease_hottheme)for(var i=0;i<vm.item.pressrelease_hottheme.length;i++)tempItems.push(vm.item.pressrelease_hottheme[i]);if(vm.item.researchhottheme)for(var i=0;i<vm.item.researchhottheme.length;i++)tempItems.push(vm.item.researchhottheme[i]);vm.itemcount=tempItems.length,tempItems.sort(function(a,b){var dateA=new Date(a.date),dateB=new Date(b.date);return dateB-dateA}),vm.completeHotTopic||(tempItems=tempItems.slice(0,3)),vm.items=angular.copy(tempItems),masonryInitialized=!0},ComeosHotTopicComponentController.prototype.sortByDate=function(items){},ComeosHotTopicComponentController}();ComeosModule.ComeosHotTopicComponentController=ComeosHotTopicComponentController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var PayWallComponent=function(){function PayWallComponent(){this.templateUrl="/api/template/Component/paywall",this.controller=PayWallComponentController}return PayWallComponent}();ComeosModule.PayWallComponent=PayWallComponent;var PayWallComponentController=function(){function PayWallComponentController($state,$stateParams,$rootScope){this.$state=$state,this.$stateParams=$stateParams,this.$rootScope=$rootScope}return PayWallComponentController.prototype.login=function(){var ctrl=this;ctrl.$rootScope.preLoginState=ctrl.$state.current,ctrl.$rootScope.preLoginState.stateParams=angular.copy(ctrl.$stateParams),ctrl.$state.go("login")},PayWallComponentController.prototype.noMember=function(){var ctrl=this;ctrl.$state.go("Root.Content.ContactFormMember")},PayWallComponentController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var PayWallWithCustomMessageComponent=function(){function PayWallWithCustomMessageComponent(){this.bindings={title:"@",message:"@",loginButton:"@",loginButtonText:"@",contactButton:"@",contactButtonText:"@",contactButtonUrl:"@"},this.templateUrl="/api/template/Component/paywallwithcustommessage",this.controller=PayWallWithCustomMessageComponentController}return PayWallWithCustomMessageComponent}();ComeosModule.PayWallWithCustomMessageComponent=PayWallWithCustomMessageComponent;var PayWallWithCustomMessageComponentController=function(){function PayWallWithCustomMessageComponentController($state,$stateParams,$rootScope){this.$state=$state,this.$stateParams=$stateParams,this.$rootScope=$rootScope}return PayWallWithCustomMessageComponentController.prototype.login=function(){var ctrl=this;ctrl.$rootScope.preLoginState=ctrl.$state.current,ctrl.$rootScope.preLoginState.stateParams=angular.copy(ctrl.$stateParams),ctrl.$state.go("login")},PayWallWithCustomMessageComponentController.prototype.contact=function(){var ctrl=this;ctrl.$state.go("Root.Content.ContactForm")},PayWallWithCustomMessageComponentController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosContentItemLikeComponent=function(){function ComeosContentItemLikeComponent(){this.template='<div ng-if="$ctrl.loaded"><div class=\'mail\' uib-tooltip="{{ \'favoritethis\' | translate }}" tooltip-placement="left" ng-click="$ctrl.likeContentItem($ctrl.contentItem); $event.stopPropagation();"  ng-if="!$ctrl.isFavourite"><i  class="mdi mdi-heart-outline "></i></div> <div class=\'mail\' ng-click="$ctrl.unlikeContentItem($ctrl.contentItem); $event.stopPropagation();" ng-if="$ctrl.isFavourite" uib-tooltip="{{ \'unfavoritethis\' | translate }}" tooltip-placement="left" ><i class="mdi mdi-heart "></i></div></div>',this.bindings={contentItem:"="},this.controller=ComeosContentItemLikeComponentController}return ComeosContentItemLikeComponent}();ComeosModule.ComeosContentItemLikeComponent=ComeosContentItemLikeComponent;var ComeosContentItemLikeComponentController=function(){function ComeosContentItemLikeComponentController(myComeosDataService){this.myComeosDataService=myComeosDataService,this.loaded=!1;var ctrl=this;ctrl.loaded=myComeosDataService.isLoaded,ctrl.isFavourite=myComeosDataService.getIsFavourite(ctrl.contentItem.id)}return ComeosContentItemLikeComponentController.prototype.likeContentItem=function(contentItem){var s=this;s.myComeosDataService.likeContentItem(contentItem).then(function(){s.isFavourite=!0})},ComeosContentItemLikeComponentController.prototype.unlikeContentItem=function(contentItem){var s=this;s.myComeosDataService.unlikeContentItem(contentItem).then(function(){s.isFavourite=!1})},ComeosContentItemLikeComponentController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosContentItemLikeHeaderComponent=function(){function ComeosContentItemLikeHeaderComponent(){this.template='<div ng-if="$ctrl.loaded"><div class=\'mail\' uib-tooltip="{{ \'favoritethis\' | translate }}" tooltip-placement="top" ng-click="$ctrl.likeContentItem($ctrl.contentItem); $event.stopPropagation();"  ng-if="!$ctrl.isFavourite"><i  class="mdi mdi-heart-outline "></i></div> <div class=\'mail\' ng-click="$ctrl.unlikeContentItem($ctrl.contentItem); $event.stopPropagation();" ng-if="$ctrl.isFavourite" uib-tooltip="{{ \'unfavoritethis\' | translate }}" tooltip-placement="top" ><i class="mdi mdi-heart "></i></div></div>',this.bindings={contentItem:"="},this.controller=ComeosContentItemLikeHeaderComponentController}return ComeosContentItemLikeHeaderComponent}();ComeosModule.ComeosContentItemLikeHeaderComponent=ComeosContentItemLikeHeaderComponent;var ComeosContentItemLikeHeaderComponentController=function(){function ComeosContentItemLikeHeaderComponentController(myComeosDataService){this.myComeosDataService=myComeosDataService,this.loaded=!1;var ctrl=this;ctrl.loaded=myComeosDataService.isLoaded,ctrl.isFavourite=myComeosDataService.getIsFavourite(ctrl.contentItem.id)}return ComeosContentItemLikeHeaderComponentController.prototype.likeContentItem=function(contentItem){var s=this;s.myComeosDataService.likeContentItem(contentItem).then(function(){s.isFavourite=!0})},ComeosContentItemLikeHeaderComponentController.prototype.unlikeContentItem=function(contentItem){var s=this;s.myComeosDataService.unlikeContentItem(contentItem).then(function(){s.isFavourite=!1})},ComeosContentItemLikeHeaderComponentController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){function ComeosQuestionsContactUs(){return{restrict:"AE",controller:ComeosQuestionsContactUsController,link:ComeosQuestionsContactUsLink,bindToController:!0,controllerAs:"$ctrl",scope:{itemname:"=",manager:"="}}}ComeosModule.ComeosQuestionsContactUs=ComeosQuestionsContactUs;var ComeosQuestionsContactUsLink=function(){function ComeosQuestionsContactUsLink(scope,element,attr,ctrls){element.on("click",function(){ctrls.open()})}return ComeosQuestionsContactUsLink}();ComeosModule.ComeosQuestionsContactUsLink=ComeosQuestionsContactUsLink;var ComeosQuestionsContactUsController=function(){function ComeosQuestionsContactUsController($state,$location,authService){this.$state=$state,this.$location=$location,this.authService=authService}return ComeosQuestionsContactUsController.prototype.open=function(){var vm=this;vm.authService.getUserInfo().then(function(value){var urlExt="";vm.manager&&(urlExt+="&manager="+encodeURI(vm.manager)),vm.itemname&&(urlExt+="&item="+encodeURI(vm.itemname)),window.open("http://servicedesk.comeos.be?origine=web"+urlExt,"_blank")},function(reason){vm.$state.go("Root.Content.ContactForm")})},ComeosQuestionsContactUsController}();ComeosModule.ComeosQuestionsContactUsController=ComeosQuestionsContactUsController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosContactFormComponent=function(){function ComeosContactFormComponent(){this.restrict="E",this.templateUrl=function($attrs){return void 0!=$attrs.template?$attrs.template:"/api/template/Component/ComeosContactForm"},this.controller=ComeosContactFormController}return ComeosContactFormComponent}();ComeosModule.ComeosContactFormComponent=ComeosContactFormComponent;var ComeosContactFormController=function(){function ComeosContactFormController($scope,comeosDataService,$translate,$attrs){this.$scope=$scope,this.comeosDataService=comeosDataService,this.$translate=$translate,this.type=0;var vm=this;$attrs&&$attrs.type&&(vm.type=$attrs.type)}return ComeosContactFormController.prototype.submitForm=function(){var vm=this;vm.loading=!0,vm.$translate(["succescontactform","errorcontactform"]).then(function(translations){vm.formData.type=vm.type,vm.comeosDataService.postContactForm(vm.formData).then(function(result){result?(vm.errorMsg=void 0,vm.succesMsg=translations.succescontactform,vm.loading=!1):(vm.errorMsg=translations.errorcontactform,vm.loading=!1)},function(reject){vm.errorMsg=translations.errorcontactform})})},ComeosContactFormController}();ComeosModule.ComeosContactFormController=ComeosContactFormController}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosDataService=function(){function ComeosDataService(altaiHttp,$q){this.altaiHttp=altaiHttp,this.$q=$q}return ComeosDataService.prototype.postContactForm=function(item){var d=this.$q.defer();return this.altaiHttp.post("/api/comeos/contact",item).success(function(result){d.resolve(result)}).error(function(){d.reject()}),d.promise},ComeosDataService}();ComeosModule.ComeosDataService=ComeosDataService}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosProfileUpdateButtonComponent=function(){function ComeosProfileUpdateButtonComponent(){this.template="<div class='comeos-button no-animate' ng-class=\"{'no-pointer': $ctrl.loading}\" ng-click='!$ctrl.loading && $ctrl.updateProfile()'><span ng-if='!$ctrl.loading'>{{::'savechanges'|translate}}</span><span ng-if='$ctrl.loading'>{{::'saving...'|translate}}</span></div>",this.controller=ComeosProfileUpdateButtonComponentController,this.bindings={contentItem:"=",updateModel:"=",contentType:"=",languages:"=",linkedContentTypes:"=",password:"="}}return ComeosProfileUpdateButtonComponent}();ComeosModule.ComeosProfileUpdateButtonComponent=ComeosProfileUpdateButtonComponent;var ComeosProfileUpdateButtonComponentController=function(){function ComeosProfileUpdateButtonComponentController($q,contentItemService,myComeosDataService){this.$q=$q,this.contentItemService=contentItemService,this.myComeosDataService=myComeosDataService,this.loading=!1}return ComeosProfileUpdateButtonComponentController.prototype.updateProfile=function(){var ctrl=this;ctrl.$q.defer();ctrl.loading=!0;var updatedContentItemModel=ctrl.contentItemService.updateContentItemModel(ctrl.contentItem,ctrl.updateModel,ctrl.contentType,ctrl.languages,ctrl.linkedContentTypes);ctrl.myComeosDataService.updateProfile(updatedContentItemModel,ctrl.password).then(function(result){ctrl.contentItemService.resetCache(),ctrl.loading=!1},function(error){ctrl.loading=!1})},ComeosProfileUpdateButtonComponentController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var ComeosCeoCornerOrganizationsComponent=function(){function ComeosCeoCornerOrganizationsComponent(){this.templateUrl="/api/template/Component/ComeosCeoCornerOrganizations",this.controller=ComeosCeoCornerOrganizationsController}return ComeosCeoCornerOrganizationsComponent}();ComeosModule.ComeosCeoCornerOrganizationsComponent=ComeosCeoCornerOrganizationsComponent;var ComeosCeoCornerOrganizationsController=function(){function ComeosCeoCornerOrganizationsController(myComeosDataService){this.myComeosDataService=myComeosDataService;var ctrl=this;myComeosDataService.getCompanies().then(function(data){ctrl.companies=data})}return ComeosCeoCornerOrganizationsController.prototype.inviteNewEmployee=function(email,efficyId){var ctrl=this;ctrl.myComeosDataService.inviteNewEmployee(email,efficyId).then(function(){})},ComeosCeoCornerOrganizationsController}()}(ComeosModule||(ComeosModule={}));var ComeosModule;!function(ComeosModule){var mod=angular.module("comeos",["duScroll","thatisuday.ng-image-gallery","hmTouchEvents"]);config.modules.push(mod.name),mod.component("altaigallery",new ComeosModule.AltaiGalleryComponent),mod.component("faq",new ComeosModule.FAQComponent),mod.component("collapser",new ComeosModule.CollapserComponent),mod.component("faqquestion",new ComeosModule.FAQQuestionComponent),mod.component("altaisection",new ComeosModule.SectionComponent),mod.component("summarysheet",new ComeosModule.SummarySheetComponent),mod.component("summarysheetcompare",new ComeosModule.SummarySheetCompareComponent),mod.component("altaisubsection",new ComeosModule.SubsectionComponent),mod.component("comeosCollectionMenu",new ComeosModule.ComeosCollectionMenuComponent),mod.component("comeosCard",new ComeosModule.ComeosCardComponent),mod.component("comeosCardDirectDownload",new ComeosModule.ComeosCardDirectDownloadComponent),mod.component("comeosCardCao",new ComeosModule.ComeosCardCaoComponent),mod.component("comeosEventCard",new ComeosModule.ComeosEventCardComponent),mod.component("fileicon",new ComeosModule.FileIconComponent),mod.component("comeosOverviewCard",new ComeosModule.ComeosOverviewCardComponent),mod.component("comeosMenublockCard",new ComeosModule.ComeosMenublockCardComponent),mod.component("comeosMasonry",new ComeosModule.ComeosMasonryComponent),mod.component("comeosMasonryClientSide",new ComeosModule.ComeosMasonryClientSideComponent),mod.component("whoiswho",new ComeosModule.ComeosWhoIsWhoComponent),mod.component("whoiswhocard",new ComeosModule.ComeosWhoIsWhoCardComponent),mod.component("linkShare",new ComeosModule.LinkShareComponent),mod.component("altaiSocialShareModal",new ComeosModule.AltaiSocialShareModalComponent),mod.component("altaiInitMediaMessageComponent",new ComeosModule.AltaiInitMediaMessageComponent),mod.component("altaiSlideshowGrid",new ComeosModule.AltaiSlideshowGrid),mod.component("comeosMobileMenu",new ComeosModule.ComeosMobileMenuComponent),mod.component("comeosTopMenu",new ComeosModule.ComeosTopMenu),mod.component("comeosCollectionSelectionComponent",new ComeosModule.ComeosCollectionSelectionComponent),mod.component("comeosCalendar",new ComeosModule.ComeosCalendarComponent),mod.component("hottopic",new ComeosModule.ComeosHotTopicComponent),mod.component("paywall",new ComeosModule.PayWallComponent),mod.component("socialshareheader",new ComeosModule.SocialShareHeaderComponent),mod.component("socialsharecard",new ComeosModule.SocialShareCardComponent),mod.component("comeosContentItemLikeComponent",new ComeosModule.ComeosContentItemLikeComponent),mod.component("comeosContentItemLikeHeaderComponent",new ComeosModule.ComeosContentItemLikeHeaderComponent),mod.component("comeosProfileUpdateButton",new ComeosModule.ComeosProfileUpdateButtonComponent),mod.component("comeosCeoCornerOrganizations",new ComeosModule.ComeosCeoCornerOrganizationsComponent),mod.component("payWallWithCustomMessage",new ComeosModule.PayWallWithCustomMessageComponent),mod.component("comeosContactForm",new ComeosModule.ComeosContactFormComponent),mod.directive("comeosFixedMenu",ComeosModule.comeosFixedMenu),mod.directive("myComeosFixedMenu",ComeosModule.myComeosFixedMenu),mod.directive("myComeosMenu",ComeosModule.myComeosMenu),mod.directive("altaiSlideshowGridForCollections",ComeosModule.AltaiSlideshowGridForCollections),mod.directive("altaiSlideshowGridTwoByTwo",ComeosModule.AltaiSlideshowGridTwoByTwo),mod.directive("altaiSocialShare",ComeosModule.AltaiSocialShare),mod.directive("altaiInitMediaMessageDirective",ComeosModule.AltaiInitMediaMessageDirective),mod.directive("altaiHoverIntent",ComeosModule.AltaiHoverIntent),mod.directive("altaiUnHoverIntent",ComeosModule.AltaiUnHoverIntent),mod.directive("altaiHeaderHeightCalculator",ComeosModule.AltaiHeaderHeightCalculator),mod.directive("comeosQuestionsContactUs",ComeosModule.ComeosQuestionsContactUs),mod.directive("comeosMasonryInit",ComeosModule.comeosMasonryInit),mod.directive("comeosMasonryClientSideInit",ComeosModule.comeosMasonryClientSideInit),mod.service("linkResolverService",ComeosModule.LinkResolverService),mod.service("myComeosDataService",ComeosModule.MyComeosDataService),mod.service("comeosDataService",ComeosModule.ComeosDataService),mod.config(function($stateProvider){$stateProvider.state("unsubscribeactu",{url:"/unsubscribeactu",system:!0,views:{bodyView:{templateUrl:"/api/template/system/unsubscribe",controller:ComeosModule.UnsubscribeActuController,controllerAs:"$ctrl"}}}),$stateProvider.state("unsubscribe",{url:"/unsubscribe",system:!0,views:{bodyView:{templateUrl:"api/template/system/unsubscribe",controller:ComeosModule.UnsubscribeController,controllerAs:"$ctrl"}}})}),mod.run(function($rootScope,$timeout,$state,$ocLazyLoad,$q){function setWindowSize(){$rootScope.slideshowInit=!1,$rootScope.windowSize=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,$rootScope.windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,$rootScope.gridItems=1}var calendar=!1,profile=!1;$rootScope.$on("$stateChangeStart",function(e,toState,toParams,fromState,fromParams){config.admin||(toState.name.indexOf("Root.MyComeos.MyCalendar")>-1&&!calendar?(e.preventDefault(),$ocLazyLoad.load({serie:!0,files:["lib/fullcalendar/dist/fullcalendar.js","lib/angular-ui-calendar/src/calendar.js","lib/fullcalendar/dist/lang-all.js","lib/fullcalendar/dist/gcal.js"]}).then(function(){calendar=!0,$state.go("Root.MyComeos.MyCalendar")})):toState.name.indexOf("Root.MyComeos.Profile")>-1&&!profile&&(e.preventDefault(),$ocLazyLoad.load({serie:!0,files:["App/AltaiContent/Components/AltaiContentCollectionUpdateRelationcomponent.js","App/AltaiContent/Components/AltaiTagSelectorComponent.js","App/AltaiContent/Directives/AltaiContentItemUpdateInnerClientDirective.js","App/AltaiContent/Directives/AltaiContentItemUpdateClientDirective.js","App/AltaiContent/Directives/AltaiContentAttributeUpdateDirective.js","App/AltaiContent/Directives/AltaiContentRelationUpdateClientDirective.js","App/AltaiContent/Services/ContentItemService.js","App/AltaiContent/Services/contentRelationFactory.js","App/AltaiContent/Services/contentCreateItemProcessor.js","App/AltaiContent/Services/ContentUpdateModelManager.js","App/AltaiContent/Services/ContentCollectionManager.js","App/AltaiContent/Services/ContentCollectionDataService.js","lib/ng-file-upload/ng-file-upload.js","App/AltaiContent/AltaiContentClientEditModule.js"]}).then(function(){profile=!0,$state.go("Root.MyComeos.Profile")})))}),window.onresize=function(event){setWindowSize(),$rootScope.$apply()},$timeout(function(){setWindowSize()},1e3),setWindowSize()}),mod.filter("unique",function(){return function(input){return input}}),mod.filter("crop",function(){return function(input,limit,respectWordBoundaries,suffix){if(input=String(input).replace(/<[^>]+>/gm,""),null===input||void 0===input||null===limit||void 0===limit||""===limit)return input;if(angular.isUndefined(respectWordBoundaries)&&(respectWordBoundaries=!0),angular.isUndefined(suffix)&&(suffix="..."),input.length<=limit)return input;var trimmedString=input.substr(0,limit);return respectWordBoundaries?trimmedString.substr(0,Math.min(trimmedString.length,trimmedString.lastIndexOf(" ")))+suffix:trimmedString+suffix}}),mod.value("duScrollOffset",250)}(ComeosModule||(ComeosModule={}));var AltaiEngage;!function(AltaiEngage){var AltaiContactListComponent=function(){function AltaiContactListComponent(){this.templateUrl="/api/template/Admin/AltaiContactList",this.controller=AltaiContactListComponentController}return AltaiContactListComponent}();AltaiEngage.AltaiContactListComponent=AltaiContactListComponent;var AltaiContactListComponentController=function(){function AltaiContactListComponentController($scope,contentItemService,contentTypeService,wmContainerFactory,altaiConfirmationService){this.createOption=!0;var vm=this;this.contentItemService=contentItemService,this.contentTypeService=contentTypeService,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.init(),$scope.$watch("vm.searchModel",function(newVal,oldVal){vm.searchModel.windowId=vm.windowId,vm.searchModelHasChanged(newVal,oldVal)&&vm.getData(),1!=vm.searchModel.chosenContentTypeModel.length?vm.createOption=!1:vm.contentTypeService.getById(vm.searchModel.chosenContentTypeModel[0].id).then(function(ct){vm.createOption=ct.directCreatePossible})},!0),$scope.$on(AltaiContent.ContentEvents.contentItemUpdated,function(){vm.getData()}),$scope.$on(AltaiContent.ContentEvents.contentItemCreated,function(){vm.getData()})}return AltaiContactListComponentController.prototype.searchModelHasChanged=function(newVal,oldVal){return newVal.pageNr!=oldVal.pageNr||newVal.sorterAttr!=oldVal.sorterAttr||newVal.sorterDesc!=oldVal.sorterDesc||newVal.chosenContentTypeModel.length!=oldVal.chosenContentTypeModel.length||newVal.name!=oldVal.name},AltaiContactListComponentController.prototype.init=function(){var s=this;s.searchModel=new AltaiContent.ContentItemSearchModel,s.searchModel.chosenContentTypeModel=[],this.contentTypeService.list().then(function(contentTypes){s.contentTypes=angular.copy(contentTypes),s.selectedContentType=s.contentTypes.filter(function(ct){return"contact"==ct.name})[0],s.selectedContentType&&s.embedContentTypeInSelection(s.selectedContentType),s.contentItems||s.getData()})},AltaiContactListComponentController.prototype.embedContentTypeInSelection=function(contentType){contentType.ticked=!0,this.searchModel.chosenContentTypeModel.push(contentType)},AltaiContactListComponentController.prototype.getData=function(){var s=this;this.contentItemService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},AltaiContactListComponentController.prototype.setSorting=function(sortAttr){this.searchModel.pageNr=0,this.searchModel.sorterAttr==sortAttr?this.searchModel.sorterDesc=!this.searchModel.sorterDesc:this.searchModel.sorterDesc=!1,this.searchModel.sorterAttr=sortAttr,this.getData()},AltaiContactListComponentController.prototype.openContentItemProfile=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemProfile,contentItem.name,contentItem.id)},AltaiContactListComponentController.prototype.openContactTimeline=function(contentItem){this.wmContainerFactory.createWindow(AltaiEngage.EngagementWindows.contactTimeline,contentItem.name,contentItem.id)},AltaiContactListComponentController.prototype.getSearchResults=function(){var s=this;this.contentItemService.listAdvanced(this.searchModel).then(function(contentItems){s.contentItems=contentItems})},AltaiContactListComponentController.prototype.updateContentItem=function(contentItem){this.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemUpdate,contentItem.name,contentItem.id)},AltaiContactListComponentController.prototype.deleteContentItem=function(contentItem){var s=this;s.altaiConfirmationService.confirm().then(function(){s.contentItemService["delete"](contentItem).then(function(){s.getData()})})},AltaiContactListComponentController.prototype.createContact=function(){var s=this;s.contentTypeService.getById(s.selectedContentType.id).then(function(contentType){s.wmContainerFactory.createWindow(AltaiContent.ContentWindows.contentItemCreate,contentType.label,s.selectedContentType.id)})},AltaiContactListComponentController.prototype.openPage=function(pageIndex){this.searchModel.pageNr=pageIndex},AltaiContactListComponentController}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var AltaiContactTimelineComponent=function(){function AltaiContactTimelineComponent(){this.templateUrl="/api/template/Admin/AltaiContactTimeline",this.controller=AltaiContactTimelineComponentController,this.bindings={contactId:"="}}return AltaiContactTimelineComponent}();AltaiEngage.AltaiContactTimelineComponent=AltaiContactTimelineComponent;var AltaiContactTimelineComponentController=function(){function AltaiContactTimelineComponentController(contactManager){this.contactManager=contactManager;var ctrl=this;contactManager.getHistory(ctrl.contactId).then(function(history){ctrl.history=history})}return AltaiContactTimelineComponentController}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var AltaiInsightLogComponent=function(){function AltaiInsightLogComponent(){this.templateUrl="/api/template/Insight/InsightLogComponent",this.controller=AltaiInsightLogComponentController}return AltaiInsightLogComponent}();AltaiEngage.AltaiInsightLogComponent=AltaiInsightLogComponent;var AltaiInsightLogComponentController=function(){function AltaiInsightLogComponentController($scope,wmContainerFactory){this.createOption=!0;var s=this;s.wmContainerFactory=wmContainerFactory,s.maximizeWindow()}return AltaiInsightLogComponentController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiEngage.EngagementWindows.insightLog);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},AltaiInsightLogComponentController}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var AltaiInsightDashboardComponent=function(){function AltaiInsightDashboardComponent(){this.templateUrl="/api/template/Insight/InsightDashboardComponent",this.controller=AltaiInsightDashboardComponentController}return AltaiInsightDashboardComponent}();AltaiEngage.AltaiInsightDashboardComponent=AltaiInsightDashboardComponent;var AltaiInsightDashboardComponentController=function(){function AltaiInsightDashboardComponentController($scope,wmContainerFactory){this.createOption=!0;var s=this;s.wmContainerFactory=wmContainerFactory,s.maximizeWindow()}return AltaiInsightDashboardComponentController.prototype.maximizeWindow=function(){var currentWindow=this.wmContainerFactory.findWindow(AltaiEngage.EngagementWindows.insightLog);currentWindow&&(currentWindow.toggleMaximize(),this.wmContainerFactory.focusOnWindow(currentWindow))},AltaiInsightDashboardComponentController}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){function compareChartValues(a,b){return a.value<b.value?1:a.value>b.value?-1:0}var AltaiInsightDashboardAggregationComponent=function(){function AltaiInsightDashboardAggregationComponent(){this.templateUrl="/api/template/Insight/InsightDashboardAggregationComponent",this.controller=AltaiInsightDashboardAggregationComponentController,this.bindings={aggregation:"=",charttype:"@",enablechart:"=",enabletable:"="}}return AltaiInsightDashboardAggregationComponent}();AltaiEngage.AltaiInsightDashboardAggregationComponent=AltaiInsightDashboardAggregationComponent;var AltaiInsightDashboardAggregationComponentController=function(){function AltaiInsightDashboardAggregationComponentController(){this.stateMinimized="minimized",this.stateNormal="normal",this.stateMaximized="maximized",this.maximize=function(){var ctrl=this;ctrl.state=ctrl.stateMaximized};var ctrl=this;ctrl.state=ctrl.stateNormal,ctrl.initchart()}return AltaiInsightDashboardAggregationComponentController.prototype.refresh=function(){var ctrl=this;ctrl.initchart()},AltaiInsightDashboardAggregationComponentController.prototype.initchart=function(){var ctrl=this;ctrl.options=ctrl.getChartOptionsForAggregation(),ctrl.chartdata=ctrl.getChartDataForAggregation(),ctrl.tabledata=ctrl.getTableDataForAggregation(),ctrl.label=ctrl.aggregation.value.label},AltaiInsightDashboardAggregationComponentController.prototype.getChartOptionsForAggregation=function(){var options,ctrl=this;return options="discreteBarChart"==ctrl.charttype?{chart:{type:"discreteBarChart",height:400,width:700,margin:{top:20,right:20,bottom:50,left:55},rotateLabels:-45,growOnHover:!0,x:function(d){return d.label},y:function(d){return d.value},showValues:!0,valueFormat:function(d){return d3.format("")(d)},duration:500,xAxis:{},yAxis:{axisLabel:"Count",axisLabelDistance:-10}}}:{chart:{type:"pieChart",height:400,width:650,x:function(d){return d.label},y:function(d){return d.value},showLabels:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,growOnHover:!0,labelType:function(d,i,values){var percent=(d.endAngle-d.startAngle)/(2*Math.PI);return values.key+" : "+d3.format(".2%")(percent)},donut:!0,legend:{margin:{top:5,right:0,bottom:5,left:0}},legendPosition:"right",pie:{dispatch:{elementDblClick:function(e){console.log("clicked on "+e)}}}},title:{enable:!0,text:ctrl.aggregation.label}}},AltaiInsightDashboardAggregationComponentController.prototype.getTableDataForAggregation=function(){for(var ctrl=this,tabledata=[],i=0;i<ctrl.aggregation.value.items.length;i++){var datapoint={label:ctrl.aggregation.value.items[i].item.key,value:ctrl.aggregation.value.items[i].docCount};tabledata.push(datapoint)}return tabledata.sort(compareChartValues),tabledata},AltaiInsightDashboardAggregationComponentController.prototype.getChartDataForAggregation=function(){var ctrl=this,chartdata=[];if("discreteBarChart"==ctrl.charttype)chartdata.push({key:ctrl.aggregation.value.label,values:ctrl.getChartDataForDiscreteBarChart()});else{for(var i=0;i<ctrl.aggregation.value.items.length;i++){var datapoint={label:ctrl.aggregation.value.items[i].item.key,value:ctrl.aggregation.value.items[i].docCount};chartdata.push(datapoint)}chartdata.sort(compareChartValues)}return chartdata},AltaiInsightDashboardAggregationComponentController.prototype.getChartDataForDiscreteBarChart=function(){for(var ctrl=this,chartdata=[],i=0;i<ctrl.aggregation.value.items.length;i++){var datapoint={label:ctrl.aggregation.value.items[i].item.key,value:ctrl.aggregation.value.items[i].docCount};chartdata.push(datapoint)}return chartdata.sort(compareChartValues),chartdata},AltaiInsightDashboardAggregationComponentController.prototype.toggleChart=function(){var ctrl=this;ctrl.enablechart=!ctrl.enablechart},AltaiInsightDashboardAggregationComponentController.prototype.setChartType=function(charttype){var ctrl=this;ctrl.charttype=charttype,ctrl.initchart()},AltaiInsightDashboardAggregationComponentController.prototype.toggleTable=function(){var ctrl=this;ctrl.enabletable=!ctrl.enabletable},AltaiInsightDashboardAggregationComponentController.prototype.minimize=function(){var ctrl=this;ctrl.state=ctrl.stateMinimized},AltaiInsightDashboardAggregationComponentController.prototype.normalize=function(){var ctrl=this;ctrl.state=ctrl.stateNormal},AltaiInsightDashboardAggregationComponentController;
}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var AltaiInsightDashboardExposedContentCollectionComponent=function(){function AltaiInsightDashboardExposedContentCollectionComponent(){this.controller=AltaiInsightDashboardExposedContentCollectionComponentController,this.templateUrl=function($attrs){return void 0!=$attrs.templateId?"/api/template/"+$attrs.templateId:void 0!=$attrs.templateType&&void 0!=$attrs.templateName?"/api/template/"+$attrs.templateType+"/"+$attrs.templateName:void 0},this.bindings={exposedContentCollectionId:"=",selection:"=",parameters:"=",titleexp:"<",classes:"@",noResults:"@"}}return AltaiInsightDashboardExposedContentCollectionComponent}();AltaiEngage.AltaiInsightDashboardExposedContentCollectionComponent=AltaiInsightDashboardExposedContentCollectionComponent;var AltaiInsightDashboardExposedContentCollectionComponentController=function(){function AltaiInsightDashboardExposedContentCollectionComponentController($scope,$rootScope,exposedContentCollectionQueryManager,exposedContentCollectionDataService,$stateParams,$state,altaiLocalizationService,altaiNotificationFactory){this.exposedContentCollectionQueryManager=exposedContentCollectionQueryManager,this.exposedContentCollectionDataService=exposedContentCollectionDataService,this.$stateParams=$stateParams,this.$state=$state,this.altaiLocalizationService=altaiLocalizationService,this.altaiNotificationFactory=altaiNotificationFactory,this.searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{},ranges:[],queryField:void 0},this.aggregationsForCharts=[],this.activeFilters=[],this.activeLang={code:""},this.loadMorePage=0,this.loadingMore=!1,this.unAuthorized=!1;var ctrl=this;ctrl.notificationFactory=altaiNotificationFactory,void 0!=$stateParams.q&&(this.searchRequest.queryField=$stateParams.q),this.searchRequest.parameters=angular.copy($stateParams);var savedRequest=ctrl.exposedContentCollectionQueryManager.getRequest(ctrl.exposedContentCollectionId,this.searchRequest.parameters);if(savedRequest&&ctrl.setActiveFiltersForExistingRequest(savedRequest),void 0!=$stateParams.theme){var themeId=$stateParams.theme;""!=themeId&&this.addSearchOption(themeId,20==this.exposedContentCollectionId?56:59),this.searchRequest.parameters.theme=void 0}if("Root.DetailOverviewSubmenu.PC"==ctrl.$state.current.name&&void 0!=ctrl.$stateParams.id&&""!=ctrl.$stateParams.id&&16==ctrl.exposedContentCollectionId&&(this.addSearchOption(ctrl.$stateParams.id,94),ctrl.activeFilters.push({value:ctrl.$stateParams.id,filterId:94,item:null,label:null})),null!=ctrl.parameters)for(var property in ctrl.parameters)ctrl.parameters.hasOwnProperty(property)&&(ctrl.searchRequest.parameters[property]=ctrl.parameters[property]);ctrl.activeLang.code=altaiLocalizationService.getCurrentLangCode(),$rootScope.$on("languageChanged",function(event){ctrl.getData()}),$scope.$watch("$ctrl.searchRequest",function(newReq,oldReq){newReq.page==oldReq.page&&(ctrl.searchRequest.page=0),ctrl.getData(),ctrl.exposedContentCollectionQueryManager.setRequest(ctrl.exposedContentCollectionId,ctrl.activeFilters,ctrl.searchRequest.parameters)},!0)}return AltaiInsightDashboardExposedContentCollectionComponentController.prototype.setActiveFiltersForExistingRequest=function(savedRequest){for(var ctrl=this,i=0;i<savedRequest.length;i++)ctrl.selectFilterValue(savedRequest[i].item,savedRequest[i].filterId,savedRequest[i].label)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.openPage=function(pageIndex){var ctrl=this;ctrl.searchRequest.page=pageIndex},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.loadMore=function(){var ctrl=this;ctrl.loadingMore=!0,ctrl.loadMorePage+=1;var request=angular.copy(ctrl.searchRequest);request.page=ctrl.loadMorePage,ctrl.loadMorePage<=Math.ceil(ctrl.data.totalCount/ctrl.data.pageSize)&&ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,request).then(function(result){ctrl.data.pageResults.push.apply(ctrl.data.pageResults,result.pageResults),ctrl.loadingMore=!1})},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.selectFilterValue=function(inItem,filterId,filterLabel){var ctrl=this;if(void 0!=inItem){var field="";field=void 0!=inItem.item.contentType?inItem.item.contentType+".id":"contentTypeId";var value=inItem.item.id;void 0==value&&(value=inItem.item.value);var item=ctrl.findSearchOptionInRequest(filterId,value);if(void 0==item)inItem.selected=!0,ctrl.addSearchOption(value,filterId),ctrl.activeFilters.push({value:value,filterId:filterId,item:inItem,label:filterLabel});else{inItem.selected=!1,ctrl.removeFilterItemFromRequestFilter(filterId,value);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==filterId&&filter.value==value})[0];activeFilter&&ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter),1)}}},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.selectAggregation=function(aggregation,state){var ctrl=this;if(state)for(var x in aggregation.items){var value=aggregation.items[x].item.id;void 0==value&&(value=aggregation.items[x].item.value),aggregation.items[x].selected=!0,ctrl.addSearchOption(value,aggregation.filterId),void 0==ctrl.activeFilters.filter(function(filter){return filter.value==value})[0]&&ctrl.activeFilters.push({value:value,filterId:aggregation.filterId,item:aggregation.items[x],label:aggregation.label})}else{var group=(aggregation.items[0].item.contentType+".id",ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==aggregation.filterId})[0]);group&&ctrl.searchRequest.searchOptions.splice(ctrl.searchRequest.searchOptions.indexOf(group),1);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==aggregation.filterId});if(activeFilter)for(var x in activeFilter)ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter[x]),1)}},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.removeActiveFilter=function(filter){var ctrl=this;ctrl.selectFilterValue(filter.item,filter.filterId,filter.label)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.removeAllFilters=function(){var ctrl=this;ctrl.activeFilters=[],ctrl.searchRequest.searchOptions=[]},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.findSearchOptionInRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0];return group?group.values.filter(function(item){return item==value})[0]:void 0},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.addSearchOption=function(value,filterId){var ctrl=this,existingOptionGroup=ctrl.searchRequest.searchOptions.filter(function(option){return option.filterId==filterId})[0];existingOptionGroup||(ctrl.searchRequest.searchOptions.push({filterId:filterId,values:[]}),existingOptionGroup=ctrl.searchRequest.searchOptions[ctrl.searchRequest.searchOptions.length-1]),existingOptionGroup.values.push(value)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.removeFilterItemFromRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.removeFilterItemFromRequestFilter=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.applySelectionOfFilters=function(){for(var ctrl=this,i=0;i<ctrl.searchRequest.searchOptions.length;i++)for(var j=0;j<ctrl.searchRequest.searchOptions[i].values.length;j++){var value=(ctrl.searchRequest.searchOptions[i].filterId,ctrl.searchRequest.searchOptions[i].values[j]);if(ctrl.data.aggregations)for(var aggregationKeys=Object.keys(ctrl.data.aggregations),a=0;a<aggregationKeys.length;a++){var item=ctrl.data.aggregations[aggregationKeys[a]].items.filter(function(selItem){return selItem.item.id==value||selItem.item.value==value})[0];item&&(item.selected=!0)}}},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.changeSorting=function(fieldname,order){void 0===order&&(order=0);var ctrl=this;ctrl.searchRequest.sort.field==fieldname?0==order?ctrl.searchRequest.sort.Asc=!ctrl.searchRequest.sort.Asc:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1):(ctrl.searchRequest.sort.field=fieldname,0==order?ctrl.searchRequest.sort.Asc=!0:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1))},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.buildTree=function(){var ctrl=this;for(var x in ctrl.data.aggregations){var temp=angular.copy(ctrl.data.aggregations[x].items);if(ctrl.data.aggregations[x].items=[],"Root.DetailOverview.Theme"==ctrl.$state.current.name&&56==ctrl.data.aggregations[x].filterId){var parents=temp.filter(function(el){return null==el.item.parentId&&el.item.id==ctrl.$stateParams.id});for(var y in parents){ctrl.data.aggregations[x].items.push(parents[y]);var parentIndex=ctrl.data.aggregations[x].items.length-1,childs=temp.filter(function(el){return el.item.parentId==ctrl.$stateParams.id});for(var z in childs)childs[z].child=!0,ctrl.data.aggregations[x].items.push(childs[z]),ctrl.data.aggregations[x].items[parentIndex].docCount+=childs[z].docCount}}else{var parents=temp.filter(function(el){return null==el.item.parentId});for(var y in parents){ctrl.data.aggregations[x].items.push(parents[y]);var parentIndex=ctrl.data.aggregations[x].items.length-1;if("term"!=ctrl.data.aggregations[x].type){var childs=temp.filter(function(el){return el.item.parentId==parents[y].item.id});for(var z in childs)childs[z].child=!0,ctrl.data.aggregations[x].items.push(childs[z]),ctrl.data.aggregations[x].items[parentIndex].docCount+=childs[z].docCount}}}}},AltaiInsightDashboardExposedContentCollectionComponentController.prototype["export"]=function(){var ctrl=this;ctrl.exposedContentCollectionDataService["export"](ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.exportTree=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.exportTree(ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.exportAccompany=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.exportAccompany(ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,ctrl.searchRequest).then(function(result){if(ctrl.data=result,ctrl.applySelectionOfFilters(),ctrl.buildTree(),ctrl.loading=!1,ctrl.loadMorePage=0,void 0!=ctrl.data.aggregations)if(void 0!=ctrl.$stateParams.theme&&""!=ctrl.$stateParams.theme){if(void 0!=ctrl.data.aggregations.thema){var index=ctrl.data.aggregations.thema.items.indexOf(ctrl.data.aggregations.thema.items.filter(function(agg){return agg.item.id==ctrl.$stateParams.theme})[0]),searchIndex=ctrl.searchRequest.searchOptions.indexOf(ctrl.searchRequest.searchOptions.filter(function(req){return 56==req.filterId})[0]),request=-1;searchIndex>=0&&(request=ctrl.searchRequest.searchOptions[searchIndex].values.findIndex(function(req){return req==ctrl.$stateParams.theme})),index>=0&&request>=0&&ctrl.activeFilters.indexOf(ctrl.activeFilters.filter(function(agg){return agg.value==parseInt(ctrl.$stateParams.theme)})[0])<0&&ctrl.activeFilters.push({value:parseInt(ctrl.$stateParams.theme),filterId:56,item:ctrl.data.aggregations.thema.items[index],label:ctrl.data.aggregations.thema.label})}}else if(void 0!=ctrl.$stateParams.theme&&""!=ctrl.$stateParams.theme&&void 0!=ctrl.data.aggregations["thème"]){var index=ctrl.data.aggregations["thème"].items.indexOf(ctrl.data.aggregations["thème"].items.filter(function(agg){return agg.item.id==ctrl.$stateParams.theme})[0]),searchIndex=ctrl.searchRequest.searchOptions.indexOf(ctrl.searchRequest.searchOptions.filter(function(req){return 56==req.filterId})[0]),request=-1;searchIndex>=0&&(request=ctrl.searchRequest.searchOptions[searchIndex].values.findIndex(function(req){return req==ctrl.$stateParams.theme})),index>=0&&request>=0&&ctrl.activeFilters.indexOf(ctrl.activeFilters.filter(function(agg){return agg.value==parseInt(ctrl.$stateParams.theme)})[0])<0&&ctrl.activeFilters.push({value:parseInt(ctrl.$stateParams.theme),filterId:56,item:ctrl.data.aggregations["thème"].items[index],label:ctrl.data.aggregations["thème"].label})}ctrl.aggregationArray=ctrl.objArray(ctrl.data.aggregations)},function(error){401==error&&(ctrl.unAuthorized=!0)})},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.objArray=function(obj){var result=[];for(var key in obj)result.push({key:key,value:obj[key]});return result},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.setRangeFilter=function(range){var ctrl=this,index=ctrl.searchRequest.ranges.map(function(rangerequest){return rangerequest.field}).indexOf(range.field);index>=0?ctrl.searchRequest.ranges[index]=range:ctrl.searchRequest.ranges.push(range)},AltaiInsightDashboardExposedContentCollectionComponentController.prototype.getName=function(name){return void 0!=name?name.substring(0,100).replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,""):""},AltaiInsightDashboardExposedContentCollectionComponentController}()}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){function AltaiContactListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEngage.EngagementWindows.contactsList,"Contacts")}AltaiEngage.AltaiContactListController=AltaiContactListController}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){function AltaiCompanyListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEngage.EngagementWindows.companyList,"Organizations")}AltaiEngage.AltaiCompanyListController=AltaiCompanyListController}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){function AltaiInsightLogController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEngage.EngagementWindows.insightLog,"InsightLogLines")}AltaiEngage.AltaiInsightLogController=AltaiInsightLogController}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){function AltaiInsightDashboardController(wmContainerFactory){wmContainerFactory.createWindow(AltaiEngage.EngagementWindows.insightDashboard,"InsightDashboard")}AltaiEngage.AltaiInsightDashboardController=AltaiInsightDashboardController}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var EngagementWindows=function(){function EngagementWindows(){}return EngagementWindows}();EngagementWindows.contactsList=new AltaiWindowManager.wmWindowType("contactslist",'<altai-exposed-content-collection template-id="308" exposed-content-collection-id="57" class="ng-scope ng-isolate-scope">',800,900,1e3),EngagementWindows.companyList=new AltaiWindowManager.wmWindowType("contactslist",'<altai-exposed-content-collection template-id="308" exposed-content-collection-id="58" class="ng-scope ng-isolate-scope">',800,900,1e3),EngagementWindows.contactTimeline=new AltaiWindowManager.wmWindowType("contactTimeline","<altai-contact-timeline contact-id='vm.window.entityId'></altai-contact-timeline>",800,900,1e3),EngagementWindows.insightLog=new AltaiWindowManager.wmWindowType("insightLog","<altai-insight-log></altai-insight-log>",1600,1600,1600),EngagementWindows.insightDashboard=new AltaiWindowManager.wmWindowType("insightDashboard","<altai-insight-dashboard></altai-insight-dashboard>",1600,1600,1600),AltaiEngage.EngagementWindows=EngagementWindows}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var ContactManager=function(){function ContactManager($q,$http){this.$q=$q,this.$http=$http}return ContactManager.prototype.getHistory=function(contactId){var d=this.$q.defer();return this.$http.get("/api/contact/"+contactId+"/history").success(function(contactHistory){d.resolve(contactHistory)}),d.promise},ContactManager}();AltaiEngage.ContactManager=ContactManager}(AltaiEngage||(AltaiEngage={}));var AltaiEngage;!function(AltaiEngage){var mod=angular.module("altai.engage",["nvd3","ui.grid"]);mod.component("altaiContactList",new AltaiEngage.AltaiContactListComponent),mod.component("altaiContactTimeline",new AltaiEngage.AltaiContactTimelineComponent),mod.component("altaiInsightLog",new AltaiEngage.AltaiInsightLogComponent),mod.component("altaiInsightDashboard",new AltaiEngage.AltaiInsightDashboardComponent),mod.component("altaiInsightDashboardAggregationComponent",new AltaiEngage.AltaiInsightDashboardAggregationComponent),mod.component("altaiInsightDashboardExposedContentCollection",new AltaiEngage.AltaiInsightDashboardExposedContentCollectionComponent),mod.service("contactManager",AltaiEngage.ContactManager),mod.config(function(altaiAdminMenuProvider,$stateProvider){altaiAdminMenuProvider.add({name:"engagement",order:1,label:"engagement",securable:"engagement",icon:"mdi mdi-chart-line menuicontoolbar"}),altaiAdminMenuProvider.add({parent:"engagement",name:"engagement.organization",securable:"engagement",label:"organizations",icon:"mdi mdi-city menuicon",state:"admin.engage.organization"}),altaiAdminMenuProvider.add({parent:"engagement",name:"engagement.people",securable:"engagement",label:"people",icon:"mdi mdi-human-male-female menuicon",state:"admin.engage.contact"}),altaiAdminMenuProvider.add({parent:"engagement",name:"engagement.insightlog",securable:"engagement",label:"insightlog",icon:"mdi mdi-format-list-bulleted-type menuicon",state:"admin.engage.insightlog"}),$stateProvider.state("admin.engage",{"abstract":!0,url:"/engage"}).state("admin.engage.contact",{url:"/contact",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEngage.AltaiContactListController}}}).state("admin.engage.organization",{url:"/organization",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEngage.AltaiCompanyListController}}}).state("admin.engage.insightlog",{url:"/insightlog",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEngage.AltaiInsightLogController}}}).state("admin.engage.insightdashboard",{url:"/insightdashboard",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiEngage.AltaiInsightDashboardController}}})}),config.modules.push(mod.name)}(AltaiEngage||(AltaiEngage={}));var AltaiInsights;!function(AltaiInsights){function AltaiUtmLinkDirective(){return{scope:{link:"@",campaign:"@",source:"@",medium:"@"},template:"<a ng-href='{{$ctrl.fullHref}}' ng-transclude></a>",controllerAs:"$ctrl",replace:!0,transclude:!0,bindToController:!0,controller:function($scope,$element,$sce,$attrs){function encodeUrlData(data){return Object.keys(data).map(function(key){return[key,data[key]].join("=")}).join("&")}var s=this,hrefWatch=$scope.$watch("$ctrl.link",function(){if(s.link){var urlParams=[];s.campaign&&(urlParams.utm_campaign=s.campaign),s.source&&(urlParams.utm_source=s.source),s.medium&&(urlParams.utm_medium=s.medium);var paramsString=encodeUrlData(urlParams);-1!==s.link.indexOf("?")?s.fullHref=s.link+"&"+paramsString:s.fullHref=s.link+"?"+paramsString,hrefWatch()}})}}}AltaiInsights.AltaiUtmLinkDirective=AltaiUtmLinkDirective}(AltaiInsights||(AltaiInsights={}));var AltaiInsights;!function(AltaiInsights){function AltaiAnalyticsLoggingDirective(){return{restrict:"AE",scope:{analyticsItem:"=",analyticsLinkedItem:"=",analyticsOnView:"@",analyticsOnClick:"@",analyticsFormData:"="},bindToController:!0,controllerAs:"$ctrl",transclude:!1,controller:AltaiAnalyticsLoggingDirectiveController,link:AltaiAnalyticsLoggingDirectiveLink}}AltaiInsights.AltaiAnalyticsLoggingDirective=AltaiAnalyticsLoggingDirective;var AltaiAnalyticsLoggingDirectiveLink=function(){function AltaiAnalyticsLoggingDirectiveLink(scope,element,attr,ctrls){"download"==attr.analyticsOnClick?element.on("click",function(){ctrls.logDownload()}):"eventregistrationstart"==attr.analyticsOnClick?element.on("click",function(){ctrls.logEventRegistrationStart()}):"eventregistrationend"==attr.analyticsOnClick?element.on("click",function(){ctrls.logEventRegistrationEnd()}):"login"==attr.analyticsOnClick?element.on("click",function(){ctrls.logLogin()}):"logout"==attr.analyticsOnClick?element.on("click",function(){ctrls.logLogout()}):"logfavorite"==attr.analyticsOnClick?element.on("click",function(){ctrls.logFavorite()}):"logcontact"==attr.analyticsOnClick?element.on("click",function(){ctrls.logContact()}):"logprint"==attr.analyticsOnClick&&element.on("click",function(){ctrls.logPrint()})}return AltaiAnalyticsLoggingDirectiveLink}();AltaiInsights.AltaiAnalyticsLoggingDirectiveLink=AltaiAnalyticsLoggingDirectiveLink;var AltaiAnalyticsLoggingDirectiveController=function(){function AltaiAnalyticsLoggingDirectiveController($location,$scope,insightsservice,$window){this.$location=$location,this.$scope=$scope,this.insightsservice=insightsservice,this.$window=$window,this.theme=[],this.sector=[],this.region=[],this.pc=[],this.metaDataFilled=!1;var vm=this,watcher=$scope.$watch("$ctrl.analyticsItem",function(val){val&&("true"==vm.analyticsOnView?(vm.fillMetaData(),vm.logItemView()):"pageview"==vm.analyticsOnView?(vm.fillMetaData(),vm.logPageView()):"eventregistrationstart"==vm.analyticsOnView?(vm.fillMetaData(),vm.logEventRegistrationStart()):"eventregistrationend"==vm.analyticsOnView&&(vm.fillMetaData(),vm.logEventRegistrationEnd()),watcher())})}return AltaiAnalyticsLoggingDirectiveController.prototype.fillMetaData=function(){var vm=this;if(void 0!=vm.analyticsItem&&"theme"!=vm.analyticsItem.contentType&&"sector"!=vm.analyticsItem.contentType&&"pc"!=vm.analyticsItem.contentType&&"region"!=vm.analyticsItem.contentType)for(var keys=Object.keys(vm.analyticsItem),i=0;i<keys.length;i++)if(0==keys[i].indexOf("theme")||keys[i].length>5&&keys[i].indexOf("theme")==keys[i].length-5)for(var j=0;j<vm.analyticsItem[keys[i]].length;j++)vm.theme.push({id:vm.analyticsItem[keys[i]][j].id,title:vm.analyticsItem[keys[i]][j].title});else if(0==keys[i].indexOf("sector")||keys[i].length>6&&keys[i].indexOf("sector")==keys[i].length-6)for(var j=0;j<vm.analyticsItem[keys[i]].length;j++)vm.sector.push({id:vm.analyticsItem[keys[i]][j].id,title:vm.analyticsItem[keys[i]][j].title});else if(0==keys[i].indexOf("region")||keys[i].length>6&&keys[i].indexOf("region")==keys[i].length-6)for(var j=0;j<vm.analyticsItem[keys[i]].length;j++)vm.region.push({id:vm.analyticsItem[keys[i]][j].id,title:vm.analyticsItem[keys[i]][j].title});else if(0==keys[i].indexOf("pc")||keys[i].length>2&&keys[i].indexOf("pc")==keys[i].length-2&&0!=keys[i].indexOf("pcinfo"))for(var j=0;j<vm.analyticsItem[keys[i]].length;j++)vm.pc.push({id:vm.analyticsItem[keys[i]][j].id,title:vm.analyticsItem[keys[i]][j].title});vm.metaDataFilled=!0},AltaiAnalyticsLoggingDirectiveController.prototype.logItemView=function(){var vm=this,log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),vm.insightsservice.registerEventTrack("itemview",log)},AltaiAnalyticsLoggingDirectiveController.prototype.logPrint=function(){var vm=this,log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),vm.insightsservice.registerEventTrack("print",log)},AltaiAnalyticsLoggingDirectiveController.prototype.logPageView=function(){var vm=this,log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),vm.insightsservice.registerEventTrack("pageview",log)},AltaiAnalyticsLoggingDirectiveController.prototype.test=function(){alert("log")},AltaiAnalyticsLoggingDirectiveController.prototype.logDownload=function(){var vm=this;vm.metaDataFilled||vm.fillMetaData();var log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),vm.insightsservice.registerEventTrack("download",log)},AltaiAnalyticsLoggingDirectiveController.prototype.logEventRegistrationStart=function(){var vm=this;vm.metaDataFilled||vm.fillMetaData();var log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),void 0!=vm.analyticsFormData&&(log.form=JSON.stringify(vm.analyticsFormData)),vm.insightsservice.registerEventTrack("eventregistrationstart",log)},AltaiAnalyticsLoggingDirectiveController.prototype.logEventRegistrationEnd=function(){var vm=this;vm.metaDataFilled||vm.fillMetaData();var log={absurl:vm.$location.absUrl(),url:vm.$location.url(),protocol:vm.$location.protocol(),host:vm.$location.host(),port:vm.$location.port(),path:vm.$location.path(),search:JSON.stringify(vm.$location.search()),hash:vm.$location.hash(),sectoranalyticslogevent:vm.sector,regionanalyticslogevent:vm.region,pcanalyticslogevent:vm.pc,themeanalyticslogevent:vm.theme};void 0!=vm.analyticsItem&&(log.contentitemid=vm.analyticsItem.id,vm.analyticsItem.name&&(log.contentitemname=vm.analyticsItem.name),log.itemcontenttypeid=vm.analyticsItem.contentTypeId,log.itemcontenttype=vm.analyticsItem.contentType),void 0!=vm.analyticsFormData&&(log.form=JSON.stringify(vm.analyticsFormData)),vm.insightsservice.registerEventTrack("eventregistrationend",log)},AltaiAnalyticsLoggingDirectiveController}();AltaiInsights.AltaiAnalyticsLoggingDirectiveController=AltaiAnalyticsLoggingDirectiveController}(AltaiInsights||(AltaiInsights={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiInsights;!function(AltaiInsights){var InsightsService=function(_super){function InsightsService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"/api/insights","Insights",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.loggingServiceActive=!0,_this.enableCaching=!1,_this}return __extends(InsightsService,_super),InsightsService.prototype.registerPageTrack=function(logitem){var vm=this;vm.loggingServiceActive&&this.$http.post(config.backendUrl+"/api/insights/pagetrack",logitem)},InsightsService.prototype.registerEventTrack=function(eventtype,logitem){var vm=this;vm.loggingServiceActive&&this.$http.post(config.backendUrl+"/api/insights/eventtrack/"+eventtype,logitem)},InsightsService}(AltaiCore.AltaiDataService);AltaiInsights.InsightsService=InsightsService}(AltaiInsights||(AltaiInsights={}));var AltaiInsights;!function(AltaiInsights){var mod=angular.module("altai.insights",["angulartics","angulartics.google.analytics"]);mod.service("insightsservice",AltaiInsights.InsightsService),mod.directive("analytics",AltaiInsights.AltaiAnalyticsLoggingDirective),mod.config(function($analyticsProvider){$analyticsProvider.firstPageview(!0),$analyticsProvider.withAutoBase(!1)}),mod.run(function($rootScope,$analytics,userInfoService){userInfoService.getUserInfo().then(function(userInfo){void 0!=userInfo?$analytics.setUsername(userInfo.name):$analytics.setUsername("")},function(){$analytics.setUsername("")}),$rootScope.$on("userInfoChanged",function(){userInfoService.getUserInfo().then(function(userInfo){void 0!=userInfo?$analytics.setUsername(userInfo.name):$analytics.setUsername("")},function(){$analytics.setUsername("")})})}),config.modules.push(mod.name)}(AltaiInsights||(AltaiInsights={}));var AltaiElasticSearch;!function(AltaiElasticSearch){function AltaiFileListDecorator($delegate){return[$delegate[1]]}var AltaiFileListWithSearchComponent=function(){function AltaiFileListWithSearchComponent(){this.template="<altai-content-item-list content-type-id='$ctrl.contentTypeId' selection='$ctrl.selection'></altai-content-item-list>",this.controller=AltaiFileListWithSearchComponentController,this.bindings={selection:"="}}return AltaiFileListWithSearchComponent}();AltaiElasticSearch.AltaiFileListWithSearchComponent=AltaiFileListWithSearchComponent;var AltaiFileListWithSearchComponentController=function(){function AltaiFileListWithSearchComponentController(){this.contentTypeId=1}return AltaiFileListWithSearchComponentController}();AltaiElasticSearch.AltaiFileListDecorator=AltaiFileListDecorator}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){function AltaiContentItemListDecorator($delegate){return[$delegate[1]]}var AltaiContentItemListWithSearchComponent=function(){function AltaiContentItemListWithSearchComponent(){this.controller=AltaiContentItemListWithSearchComponentController,
this.bindings={contentTypeId:"=",windowId:"=",selection:"="}}return AltaiContentItemListWithSearchComponent}();AltaiElasticSearch.AltaiContentItemListWithSearchComponent=AltaiContentItemListWithSearchComponent;var AltaiContentItemListWithSearchComponentController=function(){function AltaiContentItemListWithSearchComponentController(exposedContentCollectionManager,$element,$compile,$scope){this.exposedContentCollectionManager=exposedContentCollectionManager;var ctrl=this;exposedContentCollectionManager.getForContentType(ctrl.contentTypeId).then(function(exposedCollection){var params="";ctrl.selection&&(params="selection = '$ctrl.selection'"),exposedCollection?$element.html($compile("<altai-exposed-content-collection "+params+" template-id='"+exposedCollection.templateId+"' exposed-content-collection-id='"+exposedCollection.id+"'></altai-content-search>")($scope)):$element.html($compile("<altai-content-item-list-inner content-type-id='$ctrl.contentTypeId' "+params+" window-id='$ctrl.windowId'></altai-content-item-list-inner>")($scope))})}return AltaiContentItemListWithSearchComponentController}();AltaiElasticSearch.AltaiContentItemListWithSearchComponentController=AltaiContentItemListWithSearchComponentController,AltaiElasticSearch.AltaiContentItemListDecorator=AltaiContentItemListDecorator}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){var AltaiExposedContentCollectionComponent=function(){function AltaiExposedContentCollectionComponent(){this.controller=AltaiExposedContentCollectionComponentController,this.templateUrl=function($attrs){return void 0!=$attrs.templateId?"/api/template/"+$attrs.templateId:void 0!=$attrs.templateType&&void 0!=$attrs.templateName?"/api/template/"+$attrs.templateType+"/"+$attrs.templateName:void 0},this.bindings={exposedContentCollectionId:"=",selection:"=",parameters:"=",titleexp:"<",classes:"@",noResults:"@"}}return AltaiExposedContentCollectionComponent}();AltaiElasticSearch.AltaiExposedContentCollectionComponent=AltaiExposedContentCollectionComponent;var AltaiExposedContentCollectionComponentController=function(){function AltaiExposedContentCollectionComponentController($scope,$rootScope,exposedContentCollectionQueryManager,exposedContentCollectionDataService,$stateParams,$state,altaiLocalizationService,altaiNotificationFactory){this.exposedContentCollectionQueryManager=exposedContentCollectionQueryManager,this.exposedContentCollectionDataService=exposedContentCollectionDataService,this.$stateParams=$stateParams,this.$state=$state,this.altaiLocalizationService=altaiLocalizationService,this.altaiNotificationFactory=altaiNotificationFactory,this.searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{},ranges:[],queryField:void 0},this.activeFilters=[],this.activeLang={code:""},this.loadMorePage=0,this.loadingMore=!1,this.unAuthorized=!1;var ctrl=this;ctrl.notificationFactory=altaiNotificationFactory,void 0!=$stateParams.q&&(this.searchRequest.queryField=$stateParams.q),this.searchRequest.parameters=angular.copy($stateParams);var savedRequest=ctrl.exposedContentCollectionQueryManager.getRequest(ctrl.exposedContentCollectionId,this.searchRequest.parameters);if(savedRequest&&ctrl.setActiveFiltersForExistingRequest(savedRequest),void 0!=$stateParams.theme){var themeId=$stateParams.theme;""!=themeId&&this.addSearchOption(themeId,20==this.exposedContentCollectionId?56:59),this.searchRequest.parameters.theme=void 0}if("Root.DetailOverviewSubmenu.PC"==ctrl.$state.current.name&&void 0!=ctrl.$stateParams.id&&""!=ctrl.$stateParams.id&&16==ctrl.exposedContentCollectionId&&(this.addSearchOption(ctrl.$stateParams.id,94),ctrl.activeFilters.push({value:ctrl.$stateParams.id,filterId:94,item:null,label:null})),null!=ctrl.parameters)for(var property in ctrl.parameters)ctrl.parameters.hasOwnProperty(property)&&(ctrl.searchRequest.parameters[property]=ctrl.parameters[property]);ctrl.activeLang.code=altaiLocalizationService.getCurrentLangCode(),$rootScope.$on("languageChanged",function(event){ctrl.getData()}),$scope.$watch("$ctrl.searchRequest",function(newReq,oldReq){newReq.page==oldReq.page&&(ctrl.searchRequest.page=0),ctrl.getData(),ctrl.exposedContentCollectionQueryManager.setRequest(ctrl.exposedContentCollectionId,ctrl.activeFilters,ctrl.searchRequest.parameters)},!0)}return AltaiExposedContentCollectionComponentController.prototype.setActiveFiltersForExistingRequest=function(savedRequest){for(var ctrl=this,i=0;i<savedRequest.length;i++)ctrl.selectFilterValue(savedRequest[i].item,savedRequest[i].filterId,savedRequest[i].label)},AltaiExposedContentCollectionComponentController.prototype.openPage=function(pageIndex){var ctrl=this;ctrl.searchRequest.page=pageIndex},AltaiExposedContentCollectionComponentController.prototype.loadMore=function(){var ctrl=this;ctrl.loadingMore=!0,ctrl.loadMorePage+=1;var request=angular.copy(ctrl.searchRequest);request.page=ctrl.loadMorePage,ctrl.loadMorePage<=Math.ceil(ctrl.data.totalCount/ctrl.data.pageSize)&&ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,request).then(function(result){ctrl.data.pageResults.push.apply(ctrl.data.pageResults,result.pageResults),ctrl.loadingMore=!1})},AltaiExposedContentCollectionComponentController.prototype.selectFilterValue=function(inItem,filterId,filterLabel){var ctrl=this;if(void 0!=inItem){var field="";field=void 0!=inItem.item.contentType?inItem.item.contentType+".id":"contentTypeId";var value=inItem.item.id;void 0==value&&(value=inItem.item.value);var item=ctrl.findSearchOptionInRequest(filterId,value);if(void 0==item)inItem.selected=!0,ctrl.addSearchOption(value,filterId),ctrl.activeFilters.push({value:value,filterId:filterId,item:inItem,label:filterLabel});else{inItem.selected=!1,ctrl.removeFilterItemFromRequestFilter(filterId,value);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==filterId&&filter.value==value})[0];activeFilter&&ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter),1)}}},AltaiExposedContentCollectionComponentController.prototype.selectAggregation=function(aggregation,state){var ctrl=this;if(state)for(var x in aggregation.items){var value=aggregation.items[x].item.id;void 0==value&&(value=aggregation.items[x].item.value),aggregation.items[x].selected=!0,ctrl.addSearchOption(value,aggregation.filterId),void 0==ctrl.activeFilters.filter(function(filter){return filter.value==value})[0]&&ctrl.activeFilters.push({value:value,filterId:aggregation.filterId,item:aggregation.items[x],label:aggregation.label})}else{var group=(aggregation.items[0].item.contentType+".id",ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==aggregation.filterId})[0]);group&&ctrl.searchRequest.searchOptions.splice(ctrl.searchRequest.searchOptions.indexOf(group),1);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==aggregation.filterId});if(activeFilter)for(var x in activeFilter)ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter[x]),1)}},AltaiExposedContentCollectionComponentController.prototype.removeActiveFilter=function(filter){var ctrl=this;ctrl.selectFilterValue(filter.item,filter.filterId,filter.label)},AltaiExposedContentCollectionComponentController.prototype.removeAllFilters=function(){var ctrl=this;ctrl.activeFilters=[],ctrl.searchRequest.searchOptions=[]},AltaiExposedContentCollectionComponentController.prototype.findSearchOptionInRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0];return group?group.values.filter(function(item){return item==value})[0]:void 0},AltaiExposedContentCollectionComponentController.prototype.addSearchOption=function(value,filterId){var ctrl=this,existingOptionGroup=ctrl.searchRequest.searchOptions.filter(function(option){return option.filterId==filterId})[0];existingOptionGroup||(ctrl.searchRequest.searchOptions.push({filterId:filterId,values:[]}),existingOptionGroup=ctrl.searchRequest.searchOptions[ctrl.searchRequest.searchOptions.length-1]),existingOptionGroup.values.push(value)},AltaiExposedContentCollectionComponentController.prototype.removeFilterItemFromRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiExposedContentCollectionComponentController.prototype.removeFilterItemFromRequestFilter=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiExposedContentCollectionComponentController.prototype.applySelectionOfFilters=function(){for(var ctrl=this,i=0;i<ctrl.searchRequest.searchOptions.length;i++)for(var j=0;j<ctrl.searchRequest.searchOptions[i].values.length;j++){var value=(ctrl.searchRequest.searchOptions[i].filterId,ctrl.searchRequest.searchOptions[i].values[j]);if(ctrl.data.aggregations)for(var aggregationKeys=Object.keys(ctrl.data.aggregations),a=0;a<aggregationKeys.length;a++){var item=ctrl.data.aggregations[aggregationKeys[a]].items.filter(function(selItem){return selItem.item.id==value||selItem.item.value==value})[0];item&&(item.selected=!0)}}},AltaiExposedContentCollectionComponentController.prototype.changeSorting=function(fieldname,order){void 0===order&&(order=0);var ctrl=this;ctrl.searchRequest.sort.field==fieldname?0==order?ctrl.searchRequest.sort.Asc=!ctrl.searchRequest.sort.Asc:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1):(ctrl.searchRequest.sort.field=fieldname,0==order?ctrl.searchRequest.sort.Asc=!0:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1))},AltaiExposedContentCollectionComponentController.prototype.buildTree=function(){var ctrl=this;for(var x in ctrl.data.aggregations){var temp=angular.copy(ctrl.data.aggregations[x].items);if(ctrl.data.aggregations[x].items=[],"Root.DetailOverview.Theme"==ctrl.$state.current.name&&56==ctrl.data.aggregations[x].filterId){var parents=temp.filter(function(el){return null==el.item.parentId&&el.item.id==ctrl.$stateParams.id});for(var y in parents){ctrl.data.aggregations[x].items.push(parents[y]);var parentIndex=ctrl.data.aggregations[x].items.length-1,childs=temp.filter(function(el){return el.item.parentId==ctrl.$stateParams.id});for(var z in childs)childs[z].child=!0,ctrl.data.aggregations[x].items.push(childs[z]),ctrl.data.aggregations[x].items[parentIndex].docCount+=childs[z].docCount}}else{var parents=temp.filter(function(el){return null==el.item.parentId});for(var y in parents){ctrl.data.aggregations[x].items.push(parents[y]);var parentIndex=ctrl.data.aggregations[x].items.length-1;if("term"!=ctrl.data.aggregations[x].type){var childs=temp.filter(function(el){return el.item.parentId==parents[y].item.id});for(var z in childs)childs[z].child=!0,ctrl.data.aggregations[x].items.push(childs[z]),ctrl.data.aggregations[x].items[parentIndex].docCount+=childs[z].docCount}}}}},AltaiExposedContentCollectionComponentController.prototype["export"]=function(){var ctrl=this;ctrl.exposedContentCollectionDataService["export"](ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiExposedContentCollectionComponentController.prototype.exportTree=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.exportTree(ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiExposedContentCollectionComponentController.prototype.exportAccompany=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.exportAccompany(ctrl.exposedContentCollectionId,ctrl.data.actualCount,ctrl.searchRequest).then(function(result){window.location.href="/ExcelExport/"+result.data})},AltaiExposedContentCollectionComponentController.prototype.getData=function(){var ctrl=this;ctrl.loading=!0,ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,ctrl.searchRequest).then(function(result){if(ctrl.data=result,ctrl.applySelectionOfFilters(),ctrl.buildTree(),ctrl.loading=!1,ctrl.loadMorePage=0,void 0!=ctrl.data.aggregations)if(void 0!=ctrl.$stateParams.theme&&""!=ctrl.$stateParams.theme){if(void 0!=ctrl.data.aggregations.thema){var index=ctrl.data.aggregations.thema.items.indexOf(ctrl.data.aggregations.thema.items.filter(function(agg){return agg.item.id==ctrl.$stateParams.theme})[0]),searchIndex=ctrl.searchRequest.searchOptions.indexOf(ctrl.searchRequest.searchOptions.filter(function(req){return 56==req.filterId})[0]),request=-1;searchIndex>=0&&(request=ctrl.searchRequest.searchOptions[searchIndex].values.findIndex(function(req){return req==ctrl.$stateParams.theme})),index>=0&&request>=0&&ctrl.activeFilters.indexOf(ctrl.activeFilters.filter(function(agg){return agg.value==parseInt(ctrl.$stateParams.theme)})[0])<0&&ctrl.activeFilters.push({value:parseInt(ctrl.$stateParams.theme),filterId:56,item:ctrl.data.aggregations.thema.items[index],label:ctrl.data.aggregations.thema.label})}}else if(void 0!=ctrl.$stateParams.theme&&""!=ctrl.$stateParams.theme&&void 0!=ctrl.data.aggregations["thème"]){var index=ctrl.data.aggregations["thème"].items.indexOf(ctrl.data.aggregations["thème"].items.filter(function(agg){return agg.item.id==ctrl.$stateParams.theme})[0]),searchIndex=ctrl.searchRequest.searchOptions.indexOf(ctrl.searchRequest.searchOptions.filter(function(req){return 56==req.filterId})[0]),request=-1;searchIndex>=0&&(request=ctrl.searchRequest.searchOptions[searchIndex].values.findIndex(function(req){return req==ctrl.$stateParams.theme})),index>=0&&request>=0&&ctrl.activeFilters.indexOf(ctrl.activeFilters.filter(function(agg){return agg.value==parseInt(ctrl.$stateParams.theme)})[0])<0&&ctrl.activeFilters.push({value:parseInt(ctrl.$stateParams.theme),filterId:56,item:ctrl.data.aggregations["thème"].items[index],label:ctrl.data.aggregations["thème"].label})}},function(error){401==error&&(ctrl.unAuthorized=!0)})},AltaiExposedContentCollectionComponentController.prototype.setRangeFilter=function(range){var ctrl=this,index=ctrl.searchRequest.ranges.map(function(rangerequest){return rangerequest.field}).indexOf(range.field);index>=0?ctrl.searchRequest.ranges[index]=range:ctrl.searchRequest.ranges.push(range)},AltaiExposedContentCollectionComponentController.prototype.getName=function(name){return void 0!=name?name.substring(0,100).replace(/[\W_]/g,"-").replace(/-{2,}/g,"-").replace(/-\s*$/,""):""},AltaiExposedContentCollectionComponentController}()}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){var AltaiExposedContentCollectionClientSideComponent=function(){function AltaiExposedContentCollectionClientSideComponent(){this.controller=AltaiExposedContentCollectionClientSideComponentController,this.templateUrl=function($attrs){return"/api/template/"+$attrs.templateId},this.bindings={exposedContentCollectionId:"=",selection:"=",parameters:"="}}return AltaiExposedContentCollectionClientSideComponent}();AltaiElasticSearch.AltaiExposedContentCollectionClientSideComponent=AltaiExposedContentCollectionClientSideComponent;var AltaiExposedContentCollectionClientSideComponentController=function(){function AltaiExposedContentCollectionClientSideComponentController($scope,$rootScope,exposedContentCollectionQueryManager,exposedContentCollectionDataService,$stateParams,$timeout){this.exposedContentCollectionQueryManager=exposedContentCollectionQueryManager,this.exposedContentCollectionDataService=exposedContentCollectionDataService,this.$timeout=$timeout,this.searchRequest={page:0,searchOptions:[],sort:{field:"",Asc:!1},parameters:{},ranges:[]},this.activeFilters=[],this.inited=!1;var ctrl=this;this.searchRequest.parameters=angular.copy($stateParams);var savedRequest=ctrl.exposedContentCollectionQueryManager.getRequest(ctrl.exposedContentCollectionId,this.searchRequest.parameters);if(savedRequest&&ctrl.setActiveFiltersForExistingRequest(savedRequest),null!=ctrl.parameters)for(var property in ctrl.parameters)ctrl.parameters.hasOwnProperty(property)&&(ctrl.searchRequest.parameters[property]=ctrl.parameters[property]);$rootScope.$on("languageChanged",function(event){ctrl.getData()}),$scope.$watch("$ctrl.searchRequest",function(newReq,oldReq){newReq.queryField!=oldReq.queryField&&(ctrl.searchRequest.page=0),ctrl.inited?ctrl.updateResultset():(ctrl.getData(),ctrl.inited=!0),ctrl.exposedContentCollectionQueryManager.setRequest(ctrl.exposedContentCollectionId,ctrl.activeFilters,ctrl.searchRequest.parameters)},!0)}return AltaiExposedContentCollectionClientSideComponentController.prototype.setActiveFiltersForExistingRequest=function(savedRequest){for(var ctrl=this,i=0;i<savedRequest.length;i++)ctrl.selectFilterValue(savedRequest[i].item,savedRequest[i].filterId,savedRequest[i].label)},AltaiExposedContentCollectionClientSideComponentController.prototype.openPage=function(pageIndex){var ctrl=this;ctrl.searchRequest.page=pageIndex},AltaiExposedContentCollectionClientSideComponentController.prototype.selectFilterValue=function(inItem,filterId,filterLabel){var ctrl=this;ctrl.removeAllFilters();var field="";field=void 0!=inItem.item.contentType?inItem.item.contentType+".id":"contentTypeId";var value=inItem.item.id,item=ctrl.findSearchOptionInRequest(filterId,value);if(void 0==item)inItem.selected=!0,ctrl.addSearchOption(value,filterId),ctrl.activeFilters.push({value:value,filterId:filterId,item:inItem,label:filterLabel});else{inItem.selected=!1,ctrl.removeFilterItemFromRequestFilter(filterId,value);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==filterId&&filter.value==value})[0];activeFilter&&ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter),1)}},AltaiExposedContentCollectionClientSideComponentController.prototype.selectAggregation=function(aggregation,state){var ctrl=this;if(state)for(var x in aggregation.items){var value=aggregation.items[x].item.id;void 0==value&&(value=aggregation.items[x].item.value),aggregation.items[x].selected=!0,ctrl.addSearchOption(value,aggregation.filterId),void 0==ctrl.activeFilters.filter(function(filter){return filter.value==value})[0]&&(console.log(ctrl.activeFilters.filter(function(filter){return filter.value==value})[0]),console.log(ctrl.activeFilters),ctrl.activeFilters.push({value:value,filterId:aggregation.filterId,item:aggregation.items[x],label:aggregation.label}))}else{var group=(aggregation.items[0].item.contentType+".id",ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==aggregation.filterId})[0]);group&&ctrl.searchRequest.searchOptions.splice(ctrl.searchRequest.searchOptions.indexOf(group),1);var activeFilter=ctrl.activeFilters.filter(function(filter){return filter.filterId==aggregation.filterId});if(activeFilter)for(var x in activeFilter)ctrl.activeFilters.splice(ctrl.activeFilters.indexOf(activeFilter[x]),1)}},AltaiExposedContentCollectionClientSideComponentController.prototype.removeActiveFilter=function(filter){var ctrl=this;ctrl.selectFilterValue(filter.item,filter.filterId,filter.label)},AltaiExposedContentCollectionClientSideComponentController.prototype.removeAllFilters=function(){var ctrl=this;ctrl.activeFilters=[],ctrl.searchRequest.searchOptions=[]},AltaiExposedContentCollectionClientSideComponentController.prototype.findSearchOptionInRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0];return group?group.values.filter(function(item){return item==value})[0]:void 0},AltaiExposedContentCollectionClientSideComponentController.prototype.addSearchOption=function(value,filterId){var ctrl=this,existingOptionGroup=ctrl.searchRequest.searchOptions.filter(function(option){return option.filterId==filterId})[0];existingOptionGroup||(ctrl.searchRequest.searchOptions.push({filterId:filterId,values:[]}),existingOptionGroup=ctrl.searchRequest.searchOptions[ctrl.searchRequest.searchOptions.length-1]),existingOptionGroup.values.push(value)},AltaiExposedContentCollectionClientSideComponentController.prototype.removeFilterItemFromRequest=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiExposedContentCollectionClientSideComponentController.prototype.removeFilterItemFromRequestFilter=function(filterId,value){var ctrl=this,group=ctrl.searchRequest.searchOptions.filter(function(item){return item.filterId==filterId})[0],item=group.values.filter(function(item){return item==value})[0];group&&group.values.splice(group.values.indexOf(item),1)},AltaiExposedContentCollectionClientSideComponentController.prototype.applySelectionOfFilters=function(){for(var ctrl=this,i=0;i<ctrl.searchRequest.searchOptions.length;i++)for(var j=0;j<ctrl.searchRequest.searchOptions[i].values.length;j++)for(var value=(ctrl.searchRequest.searchOptions[i].filterId,ctrl.searchRequest.searchOptions[i].values[j]),aggregationKeys=Object.keys(ctrl.data.aggregations),a=0;a<aggregationKeys.length;a++){var item=ctrl.data.aggregations[aggregationKeys[a]].items.filter(function(selItem){return selItem.item.id==value||selItem.item.value==value})[0];item&&(item.selected=!0)}},AltaiExposedContentCollectionClientSideComponentController.prototype.changeSorting=function(fieldname,order){void 0===order&&(order=0);var ctrl=this;ctrl.searchRequest.sort.field==fieldname?0==order?ctrl.searchRequest.sort.Asc=!ctrl.searchRequest.sort.Asc:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1):(ctrl.searchRequest.sort.field=fieldname,0==order?ctrl.searchRequest.sort.Asc=!0:1==order?ctrl.searchRequest.sort.Asc=!0:2==order&&(ctrl.searchRequest.sort.Asc=!1))},AltaiExposedContentCollectionClientSideComponentController.prototype.buildTree=function(){var ctrl=this;for(var x in ctrl.data.aggregations){var temp=angular.copy(ctrl.data.aggregations[x].items);ctrl.data.aggregations[x].items=[];var parents=temp.filter(function(el){return null==el.item.parentId});for(var y in parents){ctrl.data.aggregations[x].items.push(parents[y]);var parentIndex=ctrl.data.aggregations[x].items.length-1,childs=temp.filter(function(el){return el.item.parentId==parents[y].item.id});for(var z in childs)childs[z].child=!0,ctrl.data.aggregations[x].items.push(childs[z]),ctrl.data.aggregations[x].items[parentIndex].docCount+=childs[z].docCount}}},AltaiExposedContentCollectionClientSideComponentController.prototype.getData=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,ctrl.searchRequest).then(function(result){ctrl.data=result,ctrl.outputData=ctrl.data.pageResults,ctrl.applySelectionOfFilters(),ctrl.buildTree()})},AltaiExposedContentCollectionClientSideComponentController.prototype.updateResultset=function(){var ctrl=this;ctrl.exposedContentCollectionDataService.getData(ctrl.exposedContentCollectionId,ctrl.searchRequest).then(function(result){ctrl.$timeout(function(){ctrl.data=result,ctrl.outputData=ctrl.data.pageResults,ctrl.applySelectionOfFilters(),ctrl.buildTree()},0)})},AltaiExposedContentCollectionClientSideComponentController.prototype.checkIfElementAdheresToFilters=function(el){},AltaiExposedContentCollectionClientSideComponentController.prototype.setRangeFilter=function(range){var ctrl=this,index=ctrl.searchRequest.ranges.map(function(rangerequest){return rangerequest.field}).indexOf(range.field);index>=0?ctrl.searchRequest.ranges[index]=range:ctrl.searchRequest.ranges.push(range)},AltaiExposedContentCollectionClientSideComponentController}()}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){var ExposedContentCollectionQueryManager=function(){function ExposedContentCollectionQueryManager(){this.savedQueries={},this.savedRequests={}}return ExposedContentCollectionQueryManager.prototype.setQuery=function(exposedContentCollectionId,query,filters,sort){this.savedQueries[exposedContentCollectionId]||(this.savedQueries[exposedContentCollectionId]={}),this.savedQueries[exposedContentCollectionId].filters=filters,this.savedQueries[exposedContentCollectionId].query=query,this.savedQueries[exposedContentCollectionId].sort=sort},ExposedContentCollectionQueryManager.prototype.getFilters=function(exposedContentCollectionId){return this.savedQueries[exposedContentCollectionId]?this.savedQueries[exposedContentCollectionId].filters:void 0},ExposedContentCollectionQueryManager.prototype.getQuery=function(exposedContentCollectionId){return this.savedQueries[exposedContentCollectionId]?this.savedQueries[exposedContentCollectionId].query:void 0},ExposedContentCollectionQueryManager.prototype.getSort=function(exposedContentCollectionId){return this.savedQueries[exposedContentCollectionId]?this.savedQueries[exposedContentCollectionId].sort:void 0},ExposedContentCollectionQueryManager.prototype.getRequest=function(exposedContentCollectionId,parameters){if(this.savedRequests[exposedContentCollectionId]){if(void 0!=parameters&&void 0!=parameters.id&&this.savedRequests[exposedContentCollectionId][parameters.id])return this.savedRequests[exposedContentCollectionId][parameters.id];if(this.savedRequests[exposedContentCollectionId][0])return this.savedRequests[exposedContentCollectionId][0]}},ExposedContentCollectionQueryManager.prototype.setRequest=function(exposedContentCollectionId,request,parameters){void 0==this.savedRequests[exposedContentCollectionId]&&(this.savedRequests[exposedContentCollectionId]=[]),void 0!=parameters&&void 0!=parameters.id?this.savedRequests[exposedContentCollectionId][parameters.id]=angular.copy(request):this.savedRequests[exposedContentCollectionId][0]=angular.copy(request)},ExposedContentCollectionQueryManager}();AltaiElasticSearch.ExposedContentCollectionQueryManager=ExposedContentCollectionQueryManager}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){var ExposedContentCollectionDataService=function(){function ExposedContentCollectionDataService(altaiHttp,$state,$q){this.altaiHttp=altaiHttp,this.$state=$state,this.$q=$q}return ExposedContentCollectionDataService.prototype.getData=function(exposedContentCollectionId,searchRequest){var s=this,d=s.$q.defer();return s.altaiHttp.postNew("/api/exposedcontentcollection/"+exposedContentCollectionId+"/data",searchRequest).then(function(collectionData){d.resolve(angular.copy(collectionData))},function(result){result?404===result.status?(s.$state.go("Root.Content.NotFound"),d.reject()):d.reject(result.status):d.reject()}),d.promise},ExposedContentCollectionDataService.prototype["export"]=function(exposedContentCollectionId,actualCount,searchRequest){var s=this,d=s.$q.defer();return s.altaiHttp.post("/api/exposedcontentcollection/"+exposedContentCollectionId+"/"+actualCount+"/data/export/flat",searchRequest).then(function(collectionData){d.resolve(collectionData)}),d.promise},ExposedContentCollectionDataService.prototype.exportAccompany=function(exposedContentCollectionId,actualCount,searchRequest){var s=this,d=s.$q.defer();return s.altaiHttp.post("/api/exposedcontentcollection/"+exposedContentCollectionId+"/"+actualCount+"/data/exportAccompany/flat",searchRequest).then(function(collectionData){d.resolve(collectionData)}),d.promise},ExposedContentCollectionDataService.prototype.exportTree=function(exposedContentCollectionId,actualCount,searchRequest){var s=this,d=s.$q.defer();return s.altaiHttp.post("/api/exposedcontentcollection/"+exposedContentCollectionId+"/"+actualCount+"/data/export",searchRequest).then(function(collectionData){d.resolve(collectionData)}),d.promise},ExposedContentCollectionDataService}();AltaiElasticSearch.ExposedContentCollectionDataService=ExposedContentCollectionDataService}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElasticSearch;!function(AltaiElasticSearch){var mod=angular.module("altai.elasticsearch",[]);mod.component("altaiContentItemList",new AltaiElasticSearch.AltaiContentItemListWithSearchComponent),mod.component("altaiFileList",new AltaiElasticSearch.AltaiFileListWithSearchComponent),mod.component("altaiExposedContentCollection",new AltaiElasticSearch.AltaiExposedContentCollectionComponent),mod.component("altaiExposedContentCollectionClientSide",new AltaiElasticSearch.AltaiExposedContentCollectionClientSideComponent),mod.decorator("altaiContentItemListDirective",AltaiElasticSearch.AltaiContentItemListDecorator),mod.decorator("altaiFileListDirective",AltaiElasticSearch.AltaiFileListDecorator),mod.service("exposedContentCollectionQueryManager",AltaiElasticSearch.ExposedContentCollectionQueryManager),mod.service("exposedContentCollectionDataService",AltaiElasticSearch.ExposedContentCollectionDataService),mod.config(function($stateProvider,buildingBlockTypeProvider,altaiAdminMenuProvider){buildingBlockTypeProvider.add({name:"ExposedContentCollection",label:"Exposed Content Collection",directive:"altai-exposed-content-collection",icon:"mdi-magnify",createComponent:"<altai-content-search-create-building-block></altai-content-search-create-building-block>"}),buildingBlockTypeProvider.add({name:"ExposedContentCollectionClientSide",label:"Client Side Exposed Content Collection",directive:"altai-exposed-content-collection-client-side",icon:"mdi-magnify",createComponent:"<altai-content-search-client-side-create-building-block></altai-content-search-client-side-create-building-block>"})}),config.modules.push(mod.name)}(AltaiElasticSearch||(AltaiElasticSearch={}));var AltaiElastic;!function(AltaiElastic){function ElasticConfigController(wmContainerFactory){wmContainerFactory.createWindow(AltaiElastic.ElasticWindows.elasticConfig,"Elastic Configuration","")}AltaiElastic.ElasticConfigController=ElasticConfigController}(AltaiElastic||(AltaiElastic={}));var AltaiElastic;!function(AltaiElastic){var AltaiIndexTreeSelectorComponent=function(){function AltaiIndexTreeSelectorComponent(){this.templateUrl="/api/template/Admin/Search:AltaiIndexTreeSelector",this.bindings={tree:"<",relationId:"<",relationLinkId:"<",depth:"<",relationName:"<",addAttribute:"&",includes:"="},this.controller=AltaiIndexTreeSelectorComponentController}return AltaiIndexTreeSelectorComponent}();AltaiElastic.AltaiIndexTreeSelectorComponent=AltaiIndexTreeSelectorComponent;var AltaiIndexTreeSelectorComponentController=function(){function AltaiIndexTreeSelectorComponentController($scope,wmContainerFactory,contentTypeService,contentRelationFactory,contentTypeAttributeManager){this.$scope=$scope,this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,this.contentRelationFactory=contentRelationFactory,this.contentTypeAttributeManager=contentTypeAttributeManager,this.attributes=[];var ctrl=this;ctrl.tree&&(ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes,ctrl.contentType=ctrl.contentTypes.filter(function(contentType){return contentType.id==ctrl.tree})[0]}),ctrl.contentRelationFactory.listWithLinks().then(function(relations){ctrl.relations=relations.filter(function(rel){return rel.contentTypeRelationLinks.some(function(element,index,array){return element.contentTypeId==ctrl.tree})&&rel.contentTypeRelationLinks.some(function(element,index,array){return element.contentTypeId!=ctrl.tree&&1==element.includeByDefault})||rel.contentTypeRelationLinks.every(function(element,index,array){return element.contentTypeId==ctrl.tree})&&rel.contentTypeRelationLinks.some(function(element,index,array){return 1==element.includeByDefault});
})}),ctrl.contentTypeAttributeManager.list().then(function(contentTypeAttributes){ctrl.contentTypeAttributes=contentTypeAttributes.filter(function(attr){return attr.contentTypeId==ctrl.tree}),ctrl.contentTypeAttributes.splice(0,0,{attributeId:-9,attribute:{id:-9,name:"id"}}),ctrl.contentTypeAttributes.splice(1,0,{attributeId:-8,attribute:{id:-8,name:"name"}}),ctrl.contentTypeAttributes.splice(2,0,{attributeId:-7,attribute:{id:-7,name:"created"}}),ctrl.contentTypeAttributes.splice(3,0,{attributeId:-6,attribute:{id:-6,name:"lastUpdated"}}),ctrl.contentTypeAttributes.splice(4,0,{attributeId:-5,attribute:{id:-5,name:"published"}}),ctrl.contentTypeAttributes.splice(5,0,{attributeId:-4,attribute:{id:-4,name:"contentType"}}),ctrl.contentTypeAttributes.splice(6,0,{attributeId:-3,attribute:{id:-3,name:"contentTypeLabel"}}),ctrl.contentTypeAttributes.splice(7,0,{attributeId:-2,attribute:{id:-2,name:"contentTypeId"}}),ctrl.contentTypeAttributes.splice(8,0,{attributeId:-1,attribute:{id:-1,name:"machineName"}})}),ctrl.addTreeToDepth());var group=$scope.$watchGroup(["$ctrl.contentTypes","$ctrl.relations","$ctrl.contentTypeAttributes","$ctrl.includes"],function(newValue,oldValue,scope){var ctrl=scope.$ctrl;if(void 0!=newValue[0]&&void 0!=newValue[1]&&void 0!=newValue[2]&&void 0!=newValue[3]){for(var x in ctrl.includes){var found=!0;for(var y in ctrl.childDepth)found=found&&ctrl.includes[x].contentTypeIndexedFieldPaths.some(function(element,index,array){return element.contentTypeRelationId==ctrl.childDepth[y]&&element.niveau==y});if(ctrl.includes[x].contentTypeIndexedFieldPaths.length!=ctrl.childDepth.length+1&&(found=!1),found){var attributes=ctrl.includes[x].contentTypeIndexedFieldPaths.filter(function(path){return path.niveau==ctrl.childDepth.length&&(null!=path.contentTypeAttributeId||null!=path.metaAttribute)});for(var y in attributes){var contentTypeAttributes=ctrl.contentTypeAttributes.filter(function(attr){return attr.id==attributes[y].contentTypeAttributeId&&void 0!=attr.id||attr.attribute.name==attributes[y].metaAttribute&&null!=attributes[y].metaAttribute});if(contentTypeAttributes.length>0)for(var z in contentTypeAttributes)ctrl.attributes[contentTypeAttributes[z].attributeId]=!0}}}group()}})}return AltaiIndexTreeSelectorComponentController.prototype.getRelationLinkId=function(relation){var ctrl=this,link=relation.contentTypeRelationLinks.filter(function(l){return l.contentTypeId!=ctrl.tree});return link.length>0?link[0].id:relation.contentTypeRelationLinks[0].id},AltaiIndexTreeSelectorComponentController.prototype.getTypeId=function(index){var ctrl=this,contentTypeId=void 0;return index>=0&&angular.forEach(ctrl.relations[index].contentTypeRelationLinks,function(value,key){value.contentTypeId!=ctrl.tree&&(contentTypeId=value.contentTypeId)}),void 0==contentTypeId&&(ctrl.relations[index].contentTypeRelationLinks.some(function(element,index,array){element.contentTypeId!=ctrl.tree})||(contentTypeId=ctrl.tree)),contentTypeId},AltaiIndexTreeSelectorComponentController.prototype.addRelationToAttribute=function(index){var ctrl=this;ctrl.childDepth.length>0&&ctrl.includes[index].contentTypeIndexedFieldPaths.push({niveau:ctrl.childDepth.length-1,contentTypeRelationId:ctrl.relationId,contentTypeRelationLinkId:ctrl.relationLinkId}),ctrl.addAttribute({index:index})},AltaiIndexTreeSelectorComponentController.prototype.removeRelationFromAttribute=function(index){var ctrl=this;ctrl.includes[index].contentTypeIndexedFieldPaths.length==ctrl.childDepth.length&&ctrl.includes[index].contentTypeIndexedFieldPaths.pop(),ctrl.removeAttribute({index:index})},AltaiIndexTreeSelectorComponentController.prototype.addAttr=function(index,value,attributeId,attributeTypeId,name){var ctrl=this;if(1==value)void 0==ctrl.includes[index]&&(ctrl.includes[index]={contentTypeIndexedFieldPaths:[]}),null!=attributeId&&attributeId>0&&(name=void 0),null!=attributeId&&0==attributeId&&(attributeId=void 0),ctrl.includes[index].contentTypeIndexedFieldPaths.push({niveau:ctrl.childDepth.length,contentTypeAttributeId:attributeTypeId,metaAttribute:name}),0==ctrl.childDepth.length?ctrl.addAttribute({index:index}):ctrl.addRelationToAttribute(index);else{var includedindex=ctrl.includes.filter(function(includes){var found=!0;for(var x in ctrl.childDepth)found=found&&includes.contentTypeIndexedFieldPaths.some(function(element,index,array){return element.contentTypeRelationId==ctrl.childDepth[x]&&element.niveau==x});return found=found&&includes.contentTypeIndexedFieldPaths.some(function(element,index,array){return(element.contentTypeAttributeId==attributeTypeId||element.metaAttribute==name&&void 0!=name)&&element.niveau==ctrl.childDepth.length})});includedindex.length>0&&void 0!=includedindex[0]&&(index=ctrl.includes.findIndex(function(include){return include==includedindex[0]}),index>=0&&ctrl.includes.splice(index,1))}},AltaiIndexTreeSelectorComponentController.prototype.addTreeToDepth=function(){var ctrl=this;ctrl.childDepth=angular.copy(ctrl.depth),void 0!=ctrl.relationId&&(ctrl.childDepth[ctrl.depth.length]=ctrl.relationId)},AltaiIndexTreeSelectorComponentController}()}(AltaiElastic||(AltaiElastic={}));var AltaiElastic;!function(AltaiElastic){function AltaiElasticConfigDirective(){return{scope:{languages:"="},bindToController:!0,templateUrl:"/api/template/Admin/ElasticConfig",controller:ElasticConfigDirectiveController,controllerAs:"vm",link:ElasticConfigDirectiveLink}}AltaiElastic.AltaiElasticConfigDirective=AltaiElasticConfigDirective;var ElasticConfigDirectiveLink=function(){function ElasticConfigDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-ray-start-arrow",action:function(){scope.vm.startFlow()},name:"saveandstartflow","class":"altai-button-go",disableByFormValidity:scope.contentItemCreateForm,separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}}return ElasticConfigDirectiveLink}(),ElasticConfigDirectiveController=function(){function ElasticConfigDirectiveController(contentTypeService,elasticIndexService,wmContainerFactory){this.contentTypeService=contentTypeService,this.elasticIndexService=elasticIndexService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.progress=[],vm.contentTypeService.list().then(function(result){vm.contentTypes=result})}return ElasticConfigDirectiveController.prototype.openSettings=function(id){var vm=this;vm.wmContainerFactory.createWindow(AltaiElastic.ElasticWindows.ElasticConfiguration,"Select indexed fields",id)},ElasticConfigDirectiveController.prototype.indexAll=function(){var vm=this;vm.elasticIndexService.indexAllTypes().then(function(result){});for(var i=0;i<vm.contentTypes.length;i++)vm.progress[vm.contentTypes[i].id]=0;vm.getProgressAll()},ElasticConfigDirectiveController.prototype.deleteAll=function(){var vm=this;vm.elasticIndexService.deleteAllTypes().then(function(result){})},ElasticConfigDirectiveController.prototype.indexContentType=function(contentTypeId){var vm=this;vm.elasticIndexService.getById(contentTypeId).then(function(result){}),vm.progress[contentTypeId]=0,vm.getProgress(contentTypeId)},ElasticConfigDirectiveController.prototype.getProgress=function(contentTypeId){var vm=this;return vm.progress[contentTypeId]>=0?void setTimeout(function(){vm.elasticIndexService.getProgress(contentTypeId).then(function(result){return vm.progress[contentTypeId]=result,vm.progress[contentTypeId]>=0?vm.getProgress(contentTypeId):(vm.progress[contentTypeId]=null,result)})},5e3):-1},ElasticConfigDirectiveController.prototype.getProgressAll=function(){var vm=this;setTimeout(function(){vm.elasticIndexService.getProgressList().then(function(result){for(var i=0;i<result.length;i++)0==result[i].total&&0==result[i].counter?vm.progress[result[i].id]=1:vm.progress[result[i].id]=result[i].counter/result[i].total;if(result.length>0){vm.getProgressAll();for(var n in vm.progress){for(var inResult=!1,i=0;i<result.length;i++)result[i].id==n&&(inResult=!0);!inResult&&vm.progress[n]>0&&(vm.progress[n]=1)}}else for(var n in vm.progress)vm.progress[n]=null})},2e3)},ElasticConfigDirectiveController.prototype.deleteContentTypeIndex=function(contentTypeId){var vm=this;vm.elasticIndexService["delete"](contentTypeId).then(function(result){})},ElasticConfigDirectiveController}()}(AltaiElastic||(AltaiElastic={}));var AltaiElastic;!function(AltaiElastic){function AltaiElasticConfigurationDirective(){return{scope:{contentTypeId:"<"},bindToController:!0,templateUrl:"/api/template/Admin/Search:ElasticSearchConfiguration",controller:ElasticConfigurationDirectiveController,controllerAs:"$ctrl"}}AltaiElastic.AltaiElasticConfigurationDirective=AltaiElasticConfigurationDirective;var ElasticConfigurationDirectiveController=function(){function ElasticConfigurationDirectiveController(contentTypeService,contentTypeAttributeManager,wmContainerFactory,elasticConfigurationService,$rootScope,$scope){this.contentTypeService=contentTypeService,this.contentTypeAttributeManager=contentTypeAttributeManager,this.wmContainerFactory=wmContainerFactory,this.elasticConfigurationService=elasticConfigurationService,this.$rootScope=$rootScope,this.relation=[],this.fixed=!1,this.newAttribute={ExposedContentCollectionId:0,ExpContCollFields:[{ExpContCollPaths:[]}]},this.includes=[],this.depth=[],this.firstLevel=[];var ctrl=this;ctrl.elasticConfigurationService.getById(ctrl.contentTypeId).then(function(result){void 0!=result&&(ctrl.includes=result)})}return ElasticConfigurationDirectiveController.prototype.update=function(){var ctrl=this;ctrl.elasticConfigurationService.updateElasticConfiguration(ctrl.contentTypeId,ctrl.includes).then(function(result){ctrl.includes=result})},ElasticConfigurationDirectiveController}()}(AltaiElastic||(AltaiElastic={}));var AltaiElastic;!function(AltaiElastic){var ElasticWindows=function(){function ElasticWindows(){}return ElasticWindows}();ElasticWindows.elasticConfig=new AltaiWindowManager.wmWindowType("elasticConfig","<altai-elastic-config></altai-elastic-config>",600,800,1600),ElasticWindows.ElasticConfiguration=new AltaiWindowManager.wmWindowType("elasticConfiguration","<altai-elastic-configuration content-type-id='vm.window.entityId'></altai-elastic-configuration>",600,800,1600),AltaiElastic.ElasticWindows=ElasticWindows}(AltaiElastic||(AltaiElastic={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiElastic;!function(AltaiElastic){var ElasticIndexService=function(_super){function ElasticIndexService($http,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/elasticindex","Elastic Index",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.dataListForActiveUser=[],_this.dataListForCandidateGroups=[],_this.dataListForProcessInstance=[],_this}return __extends(ElasticIndexService,_super),ElasticIndexService.prototype.indexAllTypes=function(){var s=this,d=s.$q.defer();return s.$http.get("/api/elasticindex/index/all").success(function(response){d.resolve(response)}),d.promise},ElasticIndexService.prototype.deleteAllTypes=function(){var s=this,d=s.$q.defer();return s.$http["delete"]("/api/elasticindex/index/all").success(function(result){d.resolve(result)}),d.promise},ElasticIndexService.prototype.getProgress=function(id){var s=this,d=s.$q.defer();return s.$http.get("api/elasticindex/progress/"+id).success(function(response){d.resolve(response)}),d.promise},ElasticIndexService.prototype.getProgressList=function(){var s=this,d=s.$q.defer();return s.$http.get("api/elasticindex/progress/").success(function(response){d.resolve(response)}),d.promise},ElasticIndexService}(AltaiCore.AltaiDataService);AltaiElastic.ElasticIndexService=ElasticIndexService}(AltaiElastic||(AltaiElastic={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiElastic;!function(AltaiElastic){var ElasticConfigurationService=function(_super){function ElasticConfigurationService($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/elasticconfiguration","ExposedContentCollectionAttribute",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(ElasticConfigurationService,_super),ElasticConfigurationService.prototype.getElasticConfiguration=function(contentTypeId){var d=this.$q.defer(),service=this;return this.$http.get(service.apiUrl+"/"+contentTypeId).success(function(result){d.resolve(result)}).error(function(result){service.error("Could not Get "+service.apiUrl+"/"+contentTypeId)}),d.promise},ElasticConfigurationService.prototype.updateElasticConfiguration=function(contentTypeId,attributes){var d=this.$q.defer(),service=this;return this.$http.put(service.apiUrl+"/"+contentTypeId,attributes).success(function(result){service.success("Succesfully updated "+service.objectName),service.dataList=result,d.resolve(result)}).error(function(result){service.error("Could not POST "+service.apiUrl)}),d.promise},ElasticConfigurationService}(AltaiCore.AltaiDataService);AltaiElastic.ElasticConfigurationService=ElasticConfigurationService}(AltaiElastic||(AltaiElastic={}));var AltaiElastic;!function(AltaiElastic){var mod=angular.module("altai.elastic",["altai.core"]);mod.component("altaiIndexTreeSelector",new AltaiElastic.AltaiIndexTreeSelectorComponent),mod.directive("altaiElasticConfig",AltaiElastic.AltaiElasticConfigDirective),mod.directive("altaiElasticConfiguration",AltaiElastic.AltaiElasticConfigurationDirective),mod.service("elasticIndexService",AltaiElastic.ElasticIndexService),mod.service("elasticConfigurationService",AltaiElastic.ElasticConfigurationService),mod.config(function($stateProvider,buildingBlockTypeProvider,altaiAdminMenuProvider){$stateProvider.state("admin.elastic",{url:"/elastic","abstract":!0}).state("admin.elastic.config",{url:"/config",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiElastic.ElasticConfigController}}}),altaiAdminMenuProvider.add({parent:"config",name:"elastic.configuration",securable:"elastic.config.read",label:"elasticconfig",icon:"mdi mdi-google-circles-communities menuicon",state:"admin.elastic.config"})})}(AltaiElastic||(AltaiElastic={})),config.modules.push("altai.elastic");var AltaiMailing;!function(AltaiMailing){var AltaiMailingConfigComponent=function(){function AltaiMailingConfigComponent(){this.templateUrl="/api/template/Admin/Mailing:MailingConfig",this.controller=AltaiMailingConfigComponentController}return AltaiMailingConfigComponent}();AltaiMailing.AltaiMailingConfigComponent=AltaiMailingConfigComponent;var AltaiMailingConfigComponentController=function(){function AltaiMailingConfigComponentController(mailingCampaignTypeManager,wmContainerFactory,altaiConfirmationService){this.mailingCampaignTypeManager=mailingCampaignTypeManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService;var ctrl=this;mailingCampaignTypeManager.list().then(function(types){ctrl.mailingCampaignTypes=types})}return AltaiMailingConfigComponentController.prototype.deleteCampaignType=function(mailingCampaignType){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.mailingCampaignTypeManager["delete"](mailingCampaignType)})},AltaiMailingConfigComponentController.prototype.updateCampaignType=function(selectedType){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignTypeUpdate,selectedType.label,selectedType.id)},AltaiMailingConfigComponentController.prototype.createType=function(){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignTypeCreate,"Create mailingcampaign type")},AltaiMailingConfigComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingListUpdateComponent=function(){function AltaiMailingListUpdateComponent(){this.templateUrl="/api/template/Admin/Mailing:MailingListUpdate",this.controller=AltaiMailingListUpdateComponentController,this.bindings={mailingListId:"="}}return AltaiMailingListUpdateComponent}();AltaiMailing.AltaiMailingListUpdateComponent=AltaiMailingListUpdateComponent;var AltaiMailingListUpdateComponentController=function(){function AltaiMailingListUpdateComponentController(mailingListManager,wmContainerFactory,exposedContentCollectionManager,contentAttributeService){this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionManager=exposedContentCollectionManager,this.contentAttributeService=contentAttributeService;var ctrl=this;mailingListManager.getById(this.mailingListId).then(function(mailingList){ctrl.mailingList=mailingList}),ctrl.exposedContentCollectionManager.list().then(function(collections){ctrl.collections=collections}),ctrl.contentAttributeService.list().then(function(attributes){ctrl.attributes=attributes})}return AltaiMailingListUpdateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.updateMailingList()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingListUpdateComponentController.prototype.updateMailingList=function(){var ctrl=this;ctrl.mailingListManager.update(ctrl.mailingList).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingListUpdate,ctrl.mailingListId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiMailingListUpdateComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingListCreateComponent=function(){function AltaiMailingListCreateComponent(){this.templateUrl="/api/template/Admin/Mailing:MailingListCreate",this.controller=AltaiMailingListCreateComponentController}return AltaiMailingListCreateComponent}();AltaiMailing.AltaiMailingListCreateComponent=AltaiMailingListCreateComponent;var AltaiMailingListCreateComponentController=function(){function AltaiMailingListCreateComponentController(mailingListManager,wmContainerFactory,exposedContentCollectionManager,contentAttributeService){this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory,this.exposedContentCollectionManager=exposedContentCollectionManager,this.contentAttributeService=contentAttributeService;var ctrl=this;ctrl.exposedContentCollectionManager.list().then(function(collections){ctrl.collections=collections}),ctrl.contentAttributeService.list().then(function(attributes){ctrl.attributes=attributes})}return AltaiMailingListCreateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.createNewMailingList()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingListCreateComponentController.prototype.createNewMailingList=function(){var ctrl=this;ctrl.mailingListManager.add(ctrl.newMailingList).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingListCreate);ctrl.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiMailingListCreateComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingListListComponent=function(){function AltaiMailingListListComponent(){this.templateUrl="/api/template/Admin/Mailing:MailingListList",this.controller=AltaiMailingListListComponentController}return AltaiMailingListListComponent}();AltaiMailing.AltaiMailingListListComponent=AltaiMailingListListComponent;var AltaiMailingListListComponentController=function(){function AltaiMailingListListComponentController(mailingListManager,wmContainerFactory){this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.mailingListManager.list().then(function(lists){ctrl.mailingLists=lists})}return AltaiMailingListListComponentController.prototype.manageLists=function(){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingListList,"MailingLists")},AltaiMailingListListComponentController.prototype.createList=function(){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingListCreate,"Create mailing list")},AltaiMailingListListComponentController.prototype.updateList=function(list){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingListUpdate,list.label,list.id)},AltaiMailingListListComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingCampaignCreateComponent=function(){function AltaiMailingCampaignCreateComponent(){this.templateUrl="/api/template/Admin/Mailing:CampaignCreate",this.controller=AltaiMailingCampaignCreateComponentController}return AltaiMailingCampaignCreateComponent}();AltaiMailing.AltaiMailingCampaignCreateComponent=AltaiMailingCampaignCreateComponent;var AltaiMailingCampaignCreateComponentController=function(){function AltaiMailingCampaignCreateComponentController($scope,mailingCampaignManager,mailingCampaignTypeManager,wmContainerFactory,contentItemService){this.$scope=$scope,this.mailingCampaignManager=mailingCampaignManager,this.mailingCampaignTypeManager=mailingCampaignTypeManager,this.wmContainerFactory=wmContainerFactory,this.contentItemService=contentItemService,this.newMailingCampaign={};var ctrl=this;mailingCampaignTypeManager.list().then(function(campaignTypes){ctrl.mailingCampaignTypes=angular.copy(campaignTypes),ctrl.mailingCampaignTypes.push({id:0,label:"Custom"})}),$scope.$watch("$ctrl.selectedCampaignType",function(){ctrl.selectedCampaignType&&ctrl.contentItemService.listContentByType(ctrl.selectedCampaignType.mailingCampaignTypeContentType[0].contentTypeId).then(function(items){ctrl.contentItems=items})})}return AltaiMailingCampaignCreateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.createNewCampaign()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingCampaignCreateComponentController.prototype.createNewCampaign=function(){var ctrl=this;ctrl.selectedCampaignType&&0!=ctrl.selectedCampaignType.id&&(ctrl.newMailingCampaign.campaignType=0,ctrl.newMailingCampaign.contentItemId=ctrl.selectedContentItem.id,ctrl.newMailingCampaign.templateId=ctrl.selectedCampaignType.templateId,ctrl.selectedCampaignType.mailingCampaignTypeDefaultAudience[0]&&(ctrl.newMailingCampaign.mailingCampaignLists=[{mailingListId:ctrl.selectedCampaignType.mailingCampaignTypeDefaultAudience[0].mailingListId}]),ctrl.newMailingCampaign.labelTranslatable={translatableValues:[{languageCode:"nl",value:ctrl.selectedContentItem.name},{languageCode:"fr",value:ctrl.selectedContentItem.name}]}),ctrl.newMailingCampaign.campaignType=parseInt(ctrl.newMailingCampaign.campaignType),ctrl.mailingCampaignManager.add(ctrl.newMailingCampaign).then(function(result){var currentWin=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingCampaignCreate);ctrl.wmContainerFactory.destroyWindow(currentWin.id),ctrl.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignUpdate,result.title,result.id)})},AltaiMailingCampaignCreateComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingCampaignListComponent=function(){function AltaiMailingCampaignListComponent(){this.templateUrl="/api/template/Admin/Mailing:CampaignList",this.controller=AltaiMailingCampaignListComponentController,this.bindings={contentItemId:"="}}return AltaiMailingCampaignListComponent}();AltaiMailing.AltaiMailingCampaignListComponent=AltaiMailingCampaignListComponent;var AltaiMailingCampaignListComponentController=function(){function AltaiMailingCampaignListComponentController(mailingCampaignManager,wmContainerFactory,altaiConfirmationService,$scope){this.mailingCampaignManager=mailingCampaignManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService;var ctrl=this;ctrl.getData(),$scope.$on("campaignStarted",function(){ctrl.getData()})}return AltaiMailingCampaignListComponentController.prototype.getData=function(){var ctrl=this;ctrl.mailingCampaignManager.list().then(function(campaigns){ctrl.contentItemId?ctrl.mailingCampaigns=campaigns.filter(function(campaign){return campaign.contentItemId==ctrl.contentItemId}):ctrl.mailingCampaigns=campaigns})},AltaiMailingCampaignListComponentController.prototype.manageLists=function(){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingListList,"MailingLists")},AltaiMailingCampaignListComponentController.prototype.deleteCampaign=function(campaign){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.mailingCampaignManager["delete"](campaign)})},AltaiMailingCampaignListComponentController.prototype.createCampaign=function(){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignCreate,"Create mailing campaign")},AltaiMailingCampaignListComponentController.prototype.updateCampaign=function(campaign){this.wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignUpdate,campaign.label,campaign.id)},AltaiMailingCampaignListComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingCampaignUpdateComponent=function(){function AltaiMailingCampaignUpdateComponent(){this.templateUrl="/api/template/Admin/Mailing:CampaignUpdate",this.controller=AltaiMailingCampaignUpdateComponentController,this.bindings={mailingCampaignId:"="}}return AltaiMailingCampaignUpdateComponent}();AltaiMailing.AltaiMailingCampaignUpdateComponent=AltaiMailingCampaignUpdateComponent;var AltaiMailingCampaignUpdateComponentController=function(){function AltaiMailingCampaignUpdateComponentController($scope,$q,mailingCampaignManager,mailingListManager,wmContainerFactory,altaiConfirmationService,contentTypeService,contentItemService,$element,$compile,$timeout,$templateFactory){this.$scope=$scope,this.$q=$q,this.mailingCampaignManager=mailingCampaignManager,this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory,this.altaiConfirmationService=altaiConfirmationService,this.contentTypeService=contentTypeService,this.contentItemService=contentItemService,this.$element=$element,this.$compile=$compile,this.$timeout=$timeout,this.$templateFactory=$templateFactory;var ctrl=this;$scope.$watch("$ctrl.selectedContentTypeId",function(){ctrl.selectedContentTypeId&&ctrl.contentTypeService.getById(ctrl.selectedContentTypeId).then(function(ct){ctrl.selectedContentTemplateId=ct.templateId,ctrl.contentItemService.listContentByType(ctrl.selectedContentTypeId).then(function(items){ctrl.contentItems=items})})}),$templateFactory.listTemplateByTypeName("Content").then(function(contentTemplates){ctrl.contentTemplates=contentTemplates}),$scope.$watch("$ctrl.selectedContentItem",function(){ctrl.updateContentItemHTML()}),$scope.$watch("$ctrl.selectedContentTemplateId",function(){ctrl.updateContentItemHTML()}),ctrl.contentTypeService.list().then(function(contentTypes){ctrl.contentTypes=contentTypes,ctrl.mailingCampaignManager.getById(ctrl.mailingCampaignId).then(function(mailingCampaign){ctrl.mailingCampaign=mailingCampaign,ctrl.selectedContentTemplateId=mailingCampaign.templateId,ctrl.mailingCampaign.contentItemId&&ctrl.contentItemService.getById(ctrl.mailingCampaign.contentItemId).then(function(item){ctrl.selectedContentTypeId=item.contentTypeId;var itemWatcher=ctrl.$scope.$watch("$ctrl.contentItems",function(){ctrl.contentItems&&(ctrl.selectedContentItem=ctrl.contentItems.filter(function(item){return item.id===ctrl.mailingCampaign.contentItemId})[0],ctrl.$timeout(function(){ctrl.mailingCampaign.contentTranslatableId||ctrl.renderHTML()}),itemWatcher())},!0)}),ctrl.mailingListManager.list().then(function(mailingLists){mailingLists=mailingLists.filter(function(ml){return!ml.system});for(var i=0;i<mailingLists.length;i++){var item=mailingLists[i];item.ticked=0!==ctrl.mailingCampaign.mailingCampaignLists.filter(function(list){return list.mailingListId==item.id||list.id==item.id}).length}ctrl.mailingLists=mailingLists})})})}return AltaiMailingCampaignUpdateComponentController.prototype.updateContentItemHTML=function(){var ctrl=this;!ctrl.selectedContentItem||ctrl.selectedContentItem.id==ctrl.mailingCampaign.contentItemId&&ctrl.mailingCampaign.templateId==ctrl.selectedContentTemplateId||ctrl.renderHTML()},AltaiMailingCampaignUpdateComponentController.prototype.renderHTML=function(){var ctrl=this;ctrl.mailingCampaign.contentItemId=ctrl.selectedContentItem.id,ctrl.currentlySelectedTemplateId=ctrl.selectedContentTemplateId,ctrl.mailingCampaign.templateId=ctrl.currentlySelectedTemplateId,ctrl.mailingCampaign.contentTranslatable||(ctrl.mailingCampaign.contentTranslatable={},ctrl.mailingCampaign.contentTranslatable.translatableValues=[]),ctrl.mailingCampaignManager.generateHtmlForCampaign(ctrl.mailingCampaign.contentItemId,ctrl.mailingCampaign.templateId).then(function(contentTranslatable){ctrl.mailingCampaign.contentTranslatable=contentTranslatable})},AltaiMailingCampaignUpdateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.updateCampaign()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingCampaignUpdateComponentController.prototype.sendMailing=function(){var ctrl=this;ctrl.altaiConfirmationService.confirm().then(function(){ctrl.updateCampaign().then(function(savedCampaign){ctrl.mailingCampaignManager.sendMailing(ctrl.mailingCampaign).then(function(result){ctrl.mailingCampaign.sent=!0,ctrl.closeUpdateWindow()})})})},AltaiMailingCampaignUpdateComponentController.prototype.closeUpdateWindow=function(){var ctrl=this,currentWin=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingCampaignUpdate,ctrl.mailingCampaignId);ctrl.wmContainerFactory.destroyWindow(currentWin.id)},AltaiMailingCampaignUpdateComponentController.prototype.updateCampaign=function(){var ctrl=this,d=ctrl.$q.defer();ctrl.mailingCampaign.templateId=ctrl.selectedContentTemplateId;var saveItem=angular.copy(ctrl.mailingCampaign);return saveItem.mailingCampaignLists=saveItem.mailingCampaignLists.map(function(item){return{mailingListId:item.id,mailingCampaignId:ctrl.mailingCampaignId}}),ctrl.mailingCampaignManager.update(saveItem).then(function(result){d.resolve(result)}),d.promise},AltaiMailingCampaignUpdateComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingCampaignTypeCreateComponent=function(){function AltaiMailingCampaignTypeCreateComponent(){this.templateUrl="/api/template/Admin/Mailing:CampaignTypeCreate",this.controller=AltaiMailingCampaignTypeCreateComponentController}return AltaiMailingCampaignTypeCreateComponent}();AltaiMailing.AltaiMailingCampaignTypeCreateComponent=AltaiMailingCampaignTypeCreateComponent;var AltaiMailingCampaignTypeCreateComponentController=function(){function AltaiMailingCampaignTypeCreateComponentController(mailingListManager,wmContainerFactory,contentTypeService,$templateFactory,mailingCampaignTypeManager){this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,
this.$templateFactory=$templateFactory,this.mailingCampaignTypeManager=mailingCampaignTypeManager;var ctrl=this;contentTypeService.list().then(function(cts){ctrl.contentTypes=cts}),$templateFactory.listTemplateByTypeName("Content").then(function(tpls){ctrl.templates=tpls}),ctrl.mailingListManager.list().then(function(mailingLists){ctrl.mailingLists=mailingLists})}return AltaiMailingCampaignTypeCreateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.createNewType()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingCampaignTypeCreateComponentController.prototype.closeWindow=function(){var ctrl=this,win=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingCampaignTypeCreate);ctrl.wmContainerFactory.destroyWindow(win.id)},AltaiMailingCampaignTypeCreateComponentController.prototype.createNewType=function(){var ctrl=this;ctrl.newCampaignType.mailingCampaignTypeContentType=[{contentTypeId:ctrl.selectedContentType.id}],ctrl.newCampaignType.mailingCampaignTypeDefaultAudience=ctrl.mailingLists.filter(function(item){return item.ticked}).map(function(item){return{mailingListId:item.id}}),ctrl.mailingCampaignTypeManager.add(ctrl.newCampaignType).then(function(result){ctrl.closeWindow()})},AltaiMailingCampaignTypeCreateComponentController}()}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var AltaiMailingCampaignTypeUpdateComponent=function(){function AltaiMailingCampaignTypeUpdateComponent(){this.templateUrl="/api/template/Admin/Mailing:CampaignTypeUpdate",this.controller=AltaiMailingCampaignTypeUpdateComponentController,this.bindings={campaignTypeId:"="}}return AltaiMailingCampaignTypeUpdateComponent}();AltaiMailing.AltaiMailingCampaignTypeUpdateComponent=AltaiMailingCampaignTypeUpdateComponent;var AltaiMailingCampaignTypeUpdateComponentController=function(){function AltaiMailingCampaignTypeUpdateComponentController(mailingListManager,wmContainerFactory,contentTypeService,$templateFactory,mailingCampaignTypeManager){this.mailingListManager=mailingListManager,this.wmContainerFactory=wmContainerFactory,this.contentTypeService=contentTypeService,this.$templateFactory=$templateFactory,this.mailingCampaignTypeManager=mailingCampaignTypeManager;var ctrl=this;mailingCampaignTypeManager.getById(ctrl.campaignTypeId).then(function(campaignType){ctrl.campaignType=campaignType,ctrl.mailingListManager.list().then(function(mailingLists){ctrl.mailingLists=angular.copy(mailingLists),ctrl.mailingLists.map(function(item){return item.ticked=1===ctrl.campaignType.mailingCampaignTypeDefaultAudience.filter(function(list){return list.mailingListId===item.id}).length,item})})}),contentTypeService.list().then(function(cts){ctrl.contentTypes=cts}),$templateFactory.listTemplateByTypeName("Content").then(function(tpls){ctrl.templates=tpls})}return AltaiMailingCampaignTypeUpdateComponentController.prototype.$onInit=function(){var ctrl=this;ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){ctrl.updateCampaignType()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!0,allowMultipleLanguages:!0}},AltaiMailingCampaignTypeUpdateComponentController.prototype.closeWindow=function(){var ctrl=this,win=ctrl.wmContainerFactory.findWindow(AltaiMailing.MailingWindows.mailingCampaignTypeUpdate);ctrl.wmContainerFactory.destroyWindow(win.id)},AltaiMailingCampaignTypeUpdateComponentController.prototype.updateCampaignType=function(){var ctrl=this;ctrl.campaignType.mailingCampaignTypeDefaultAudience=ctrl.mailingLists.filter(function(item){return item.ticked}).map(function(item){return{mailingListId:item.id}}),ctrl.mailingCampaignTypeManager.update(ctrl.campaignType).then(function(result){ctrl.closeWindow()})},AltaiMailingCampaignTypeUpdateComponentController}()}(AltaiMailing||(AltaiMailing={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMailing;!function(AltaiMailing){var MailingCampaignManager=function(_super){function MailingCampaignManager($http,altaiHttp,$q,altaiNotificationFactory,contentItemService,languageFactory,$compile,$timeout,$rootScope,$sce){var _this=_super.call(this,"/api/mailingcampaign","MailingCampaign",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.contentItemService=contentItemService,_this.languageFactory=languageFactory,_this.$compile=$compile,_this.$timeout=$timeout,_this.$rootScope=$rootScope,_this.$sce=$sce,_this}return __extends(MailingCampaignManager,_super),MailingCampaignManager.prototype.sendMailing=function(mailingCampaign){var s=this,d=s.$q.defer(),dataListItem=s.dataList.filter(function(campaign){return campaign.id==mailingCampaign.id})[0];return dataListItem&&(dataListItem.sent=!0),s.altaiHttp.get(s.apiUrl+"/"+mailingCampaign.id+"/send").then(function(result){d.resolve(result)}),d.promise},MailingCampaignManager.prototype.generateHtmlForCampaign=function(contentItemId,templateId){var s=this,d=s.$q.defer(),contentTranslatable={translatableValues:[]};return s.languageFactory.listLanguage().then(function(languages){s.contentItemService.getTemplateId(contentItemId).then(function(templateIdItem){for(var parserPromisses=[],l=0;l<languages.length;l++)!function(langCode,contentItem,l){var ds=s.$q.defer();parserPromisses.push(ds.promise),templateId||(templateId=templateIdItem);var newEl="<altai-content-item content-item-id='"+contentItemId+"' template-id='"+templateId+"' language-code='"+langCode+"'></altai-content-item>",newScope=s.$rootScope.$new(),compiledElm=s.$compile(newEl)(newScope),trValue={languageCode:langCode,value:""};contentTranslatable.translatableValues.push(trValue),newScope.$on("contentItemLoaded",function(){s.$timeout(function(){var doc=document.implementation.createHTMLDocument(""),body=compiledElm[0].innerHTML;doc.open(),doc.write(body),doc.close(),doc.documentElement.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),doc.documentElement.setAttribute("lang",langCode),doc.documentElement.setAttribute("xml:lang",langCode),doc.documentElement.setAttribute("style","background:#f3f3f3!important"),doc.documentElement.setAttribute("xmlns:v","urn:schemas-microsoft-com:vml"),doc.documentElement.setAttribute("xmlns:o","urn:schemas-microsoft-com:office:office"),trValue.value=doc.documentElement.outerHTML,ds.resolve(contentTranslatable)},1e3)})}(languages[l].code,templateIdItem,l);s.$q.all(parserPromisses).then(function(result){d.resolve(contentTranslatable)})})}),d.promise},MailingCampaignManager}(AltaiCore.AltaiDataService);AltaiMailing.MailingCampaignManager=MailingCampaignManager}(AltaiMailing||(AltaiMailing={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMailing;!function(AltaiMailing){var MailingListManager=function(_super){function MailingListManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/mailinglist","MailingList",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MailingListManager,_super),MailingListManager}(AltaiCore.AltaiDataService);AltaiMailing.MailingListManager=MailingListManager}(AltaiMailing||(AltaiMailing={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMailing;!function(AltaiMailing){var MailingListSubscriptionManager=function(_super){function MailingListSubscriptionManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/mailinglistsubscription","MailingListSubscription",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MailingListSubscriptionManager,_super),MailingListSubscriptionManager}(AltaiCore.AltaiDataService);AltaiMailing.MailingListSubscriptionManager=MailingListSubscriptionManager}(AltaiMailing||(AltaiMailing={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiMailing;!function(AltaiMailing){var MailingCampaignTypeManager=function(_super){function MailingCampaignTypeManager($http,altaiHttp,$q,altaiNotificationFactory){return _super.call(this,"/api/mailingcampaigntype","MailingCampaignType",altaiHttp,$http,$q,altaiNotificationFactory)||this}return __extends(MailingCampaignTypeManager,_super),MailingCampaignTypeManager}(AltaiCore.AltaiDataService);AltaiMailing.MailingCampaignTypeManager=MailingCampaignTypeManager}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var MailingWindows=function(){function MailingWindows(){}return MailingWindows}();MailingWindows.mailingCampaignList=new AltaiWindowManager.wmWindowType("mailingCampaignList","<altai-mailing-campaign-list></altai-mailing-campaign-list>",500,960,1600),MailingWindows.mailingCampaignCreate=new AltaiWindowManager.wmWindowType("mailingCampaignCreate","<altai-mailing-campaign-create></altai-mailing-campaign-create>",500,600,800),MailingWindows.mailingCampaignUpdate=new AltaiWindowManager.wmWindowType("mailingCampaignUpdate","<altai-mailing-campaign-update mailing-campaign-id='vm.window.entityId'></altai-mailing-campaign-update>",500,960,1600),MailingWindows.mailingListList=new AltaiWindowManager.wmWindowType("mailingListList","<altai-mailing-list-list></altai-mailing-list-list>",500,960,1600),MailingWindows.mailingListCreate=new AltaiWindowManager.wmWindowType("mailingListCreate","<altai-mailing-list-create></altai-mailing-list-create>",500,600,800),MailingWindows.mailingListUpdate=new AltaiWindowManager.wmWindowType("mailingListUpdate","<altai-mailing-list-update mailing-list-id='vm.window.entityId'></altai-mailing-list-update>",500,600,800),MailingWindows.mailingConfig=new AltaiWindowManager.wmWindowType("mailingConfig","<altai-mailing-config></altai-mailing-config>",500,600,800),MailingWindows.mailingCampaignTypeCreate=new AltaiWindowManager.wmWindowType("mailingCampaignTypeCreate","<altai-mailing-campaign-type-create></altai-mailing-campaign-type-create>",500,600,800),MailingWindows.mailingCampaignTypeUpdate=new AltaiWindowManager.wmWindowType("mailingCampaignTypeUpdate","<altai-mailing-campaign-type-update campaign-type-id='::vm.window.entityId'></altai-mailing-campaign-type-update>",500,600,800),AltaiMailing.MailingWindows=MailingWindows,config.windows.push(MailingWindows.mailingListCreate)}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){function AltaiMailingCampaignListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingCampaignList,"Campaigns")}AltaiMailing.AltaiMailingCampaignListController=AltaiMailingCampaignListController}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){function AltaiMailingCampaignConfigController(wmContainerFactory){wmContainerFactory.createWindow(AltaiMailing.MailingWindows.mailingConfig,"Campaigns config")}AltaiMailing.AltaiMailingCampaignConfigController=AltaiMailingCampaignConfigController}(AltaiMailing||(AltaiMailing={}));var AltaiMailing;!function(AltaiMailing){var mod=angular.module("altai.mailing",[]);mod.component("altaiMailingCampaignList",new AltaiMailing.AltaiMailingCampaignListComponent),mod.component("altaiMailingCampaignCreate",new AltaiMailing.AltaiMailingCampaignCreateComponent),mod.component("altaiMailingCampaignUpdate",new AltaiMailing.AltaiMailingCampaignUpdateComponent),mod.component("altaiMailingListList",new AltaiMailing.AltaiMailingListListComponent),mod.component("altaiMailingListCreate",new AltaiMailing.AltaiMailingListCreateComponent),mod.component("altaiMailingListUpdate",new AltaiMailing.AltaiMailingListUpdateComponent),mod.component("altaiMailingConfig",new AltaiMailing.AltaiMailingConfigComponent),mod.component("altaiMailingCampaignTypeCreate",new AltaiMailing.AltaiMailingCampaignTypeCreateComponent),mod.component("altaiMailingCampaignTypeUpdate",new AltaiMailing.AltaiMailingCampaignTypeUpdateComponent),mod.service("mailingCampaignTypeManager",AltaiMailing.MailingCampaignTypeManager),mod.service("mailingCampaignManager",AltaiMailing.MailingCampaignManager),mod.service("mailingListManager",AltaiMailing.MailingListManager),mod.service("mailingListSubscriptionManager",AltaiMailing.MailingListSubscriptionManager),mod.config(function(altaiAdminMenuProvider,$stateProvider){altaiAdminMenuProvider.add({name:"engagement.mailing",parent:"engagement",label:"mailings",state:"admin.mailing.campaigns",icon:"mdi mdi-contact-mail"}),altaiAdminMenuProvider.add({name:"config.mailing",parent:"config",securable:"config.eventcenter",label:"mailingconfig",state:"admin.mailing.config",icon:"mdi mdi-contact-mail"}),$stateProvider.state("admin.mailing",{"abstract":!0,url:"/mailing"}).state("admin.mailing.campaigns",{url:"/campaigns",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiMailing.AltaiMailingCampaignListController}}}).state("admin.mailing.config",{url:"/config",views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiMailing.AltaiMailingCampaignConfigController}}})}),config.modules.push(mod.name)}(AltaiMailing||(AltaiMailing={}));var AltaiContentEditor;!function(AltaiContentEditor){function TemplateListController($scope,wmContainerFactory){wmContainerFactory.createWindow(AltaiContentEditor.TemplateWindows.templateList,"Theme editor filemanager","")}AltaiContentEditor.TemplateListController=TemplateListController}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){function AddSubfolderDialogController($scope,$mdDialog,$filter,$stateParams){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.newSubfolder={},$scope.addNewSubfolder=function(newSubfolder){$mdDialog.hide({node:newSubfolder})}}AltaiContentEditor.AddSubfolderDialogController=AddSubfolderDialogController}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){function UpdateTemplateNameController($scope,$mdDialog,$filter,$stateParams,file){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.existingFile=file,$scope.updateTemplateName=function(existingFile){$mdDialog.hide({file:existingFile})}}AltaiContentEditor.UpdateTemplateNameController=UpdateTemplateNameController}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){function TemplateListDirective(){return{templateUrl:"/api/template/ContentEditor/TemplateList",controller:TemplateListDirectiveController,controllerAs:"vm",bindToController:!0,link:TemplateListDirectiveLink}}AltaiContentEditor.TemplateListDirective=TemplateListDirective;var TemplateListDirectiveLink=function(){function TemplateListDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.applychanges()},"class":"altai-button-go",name:"applychanges",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return TemplateListDirectiveLink}(),TemplateListDirectiveController=function(){function TemplateListDirectiveController($scope,contentEditorService,wmContainerFactory,authService){this.contentEditorService=contentEditorService,this.wmContainerFactory=wmContainerFactory,this.tree_options={};var ctrl=this;$scope.templateSearch="",ctrl.$scope=$scope,contentEditorService.listContentTemplates().then(function(templateTypes){ctrl.templateTypes=templateTypes,$scope.hierarchy=templateTypes}),$scope.my_tree_handler=function(branch){branch.isTemplate&&wmContainerFactory.createWindow(AltaiContentEditor.TemplateWindows.templateUpdate,branch.label,branch.id,{path:branch.path,mode:branch.mode})},$scope.filterTree=function(){$scope.searched_array=[],""==$scope.templateSearch?$scope.vm.templateTypes=$scope.hierarchy:$scope.returnsearch($scope.hierarchy[0],$scope.templateSearch)},$scope.returnsearch=function(tree,s){tree.isTemplate&&-1!=tree.label.indexOf(s)&&$scope.searched_array.push(tree),0!=tree.children.length?$.each(tree.children,function(index,node){$scope.returnsearch(node,s)}):$scope.vm.templateTypes=$scope.searched_array}}return TemplateListDirectiveController.prototype.onSelect=function(templateType,tree){templateType.isTemplate&&this.wmContainerFactory.createWindow(AltaiContentEditor.TemplateWindows.templateUpdate,templateType.label,templateType.id,{path:templateType.path})},TemplateListDirectiveController}();AltaiContentEditor.TemplateListDirectiveController=TemplateListDirectiveController}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){function TemplateUpdateDirective(){return{scope:{templateId:"=",templatePath:"=",templateMode:"="},bindToController:!0,templateUrl:"/api/template/ContentEditor/TemplateUpdate",controller:TemplateUpdateDirectiveController,controllerAs:"vm",link:TemplateUpdateDirectiveLink}}AltaiContentEditor.TemplateUpdateDirective=TemplateUpdateDirective;var TemplateUpdateDirectiveLink=function(){function TemplateUpdateDirectiveLink(scope){scope.vm.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.vm.updateTemplateData()},"class":"altai-button-go",name:"save",separator:!0},{icon:"mdi-close",action:function(){scope.vm.closeWindow()},"class":"altai-button-back",name:"cancel",separator:!0},{icon:"mdi-format-align-left",action:function(){scope.format()},"class":"altai-button-secondary",name:"Format Document",separator:!0},{icon:"mdi-format-indent-increase",action:function(){scope.indent()},"class":"altai-button-secondary",name:"Indent",separator:!0},{icon:"mdi-format-indent-decrease",action:function(){scope.outdent()},"class":"altai-button-secondary",name:"Outdent",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return TemplateUpdateDirectiveLink}(),TemplateUpdateDirectiveController=function(){function TemplateUpdateDirectiveController($scope,$rootScope,$http,$uibModal,contentEditorService,$templateFactory,logService,altaiConfirmationService,wmContainerFactory){this.aceOption={};var ctrl=this;this.$scope=$scope,this.contentEditorService=contentEditorService,this.altaiConfirmationService=altaiConfirmationService,this.wmContainerFactory=wmContainerFactory,$scope.mode=ctrl.templateMode,this.loadData(ctrl.templatePath),this.$scope.htmlIndentSize=3,this.$scope.cssIndentSize=3,this.$scope.jsIndentSize=3}return TemplateUpdateDirectiveController.prototype.updateTemplateData=function(){var ctrl=this,updatedContent=new AltaiContentEditor.TemplateContentUpdateModel;updatedContent.Path=ctrl.templatePath,updatedContent.Content=ctrl.$scope.content,ctrl.contentEditorService.UpdateContentFlowTaskType(updatedContent).then(function(){ctrl.minimizeWindow(),ctrl.closeWindow()})},TemplateUpdateDirectiveController.prototype.closeWindow=function(){var s=this,currentWin=s.wmContainerFactory.findWindow(AltaiContentEditor.TemplateWindows.templateUpdate);s.wmContainerFactory.destroyWindow(currentWin.id)},TemplateUpdateDirectiveController.prototype.minimizeWindow=function(){this.wmContainerFactory.removeFocusOnWindow()},TemplateUpdateDirectiveController.prototype.loadData=function(path){var s=this;s.contentEditorService.getTemplate(path).then(function(result){s.$scope.content=result.content,s.$scope.currentTheme=result.theme,s.$scope.aceOption={theme:s.$scope.currentTheme.toLowerCase(),mode:s.$scope.mode.toLowerCase(),opacity:65,useWrapMode:!0,showGutter:!0,splitMode:!1,themeCycle:!0,require:["ace/ext/language_tools"],advanced:{enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0},rendererOptions:{maxLinks:1/0},onLoad:function(_ace){s.$scope.format=function(){if("css"==s.$scope.mode.toLowerCase()||"less"==s.$scope.mode.toLowerCase()){var options={wrap_line_length:3e3,indent_size:s.$scope.htmlIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=css_beautify(s.$scope.content,options)}else if("html"==s.$scope.mode.toLowerCase()){var options={wrap_line_length:3e3,indent_size:s.$scope.cssIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=html_beautify(s.$scope.content,options)}else if("js"==s.$scope.mode.toLowerCase()||"ts"==s.$scope.mode.toLowerCase()){var options={wrap_line_length:3e3,indent_size:s.$scope.jsIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=js_beautify(s.$scope.content,options)}},s.$scope.indent=function(){if("css"==s.$scope.mode.toLowerCase()||"less"==s.$scope.mode.toLowerCase()){s.$scope.htmlIndentSize=s.$scope.htmlIndentSize+1;var options2={indent_size:s.$scope.htmlIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=css_beautify(s.$scope.content,options2)}else if("html"==s.$scope.mode.toLowerCase()){s.$scope.cssIndentSize=s.$scope.cssIndentSize+1;var options2={indent_size:s.$scope.cssIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=html_beautify(s.$scope.content,options2)}else if("js"==s.$scope.mode.toLowerCase()||"ts"==s.$scope.mode.toLowerCase()){s.$scope.jsIndentSize=s.$scope.jsIndentSize+1;var options2={indent_size:s.$scope.jsIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=js_beautify(s.$scope.content,options2)}},s.$scope.outdent=function(){if("css"==s.$scope.mode.toLowerCase()||"less"==s.$scope.mode.toLowerCase()){s.$scope.htmlIndentSize>3&&(s.$scope.htmlIndentSize=s.$scope.htmlIndentSize-1);var options2={indent_size:s.$scope.htmlIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=css_beautify(s.$scope.content,options2)}else if("html"==s.$scope.mode.toLowerCase()){s.$scope.cssIndentSize>3&&(s.$scope.cssIndentSize=s.$scope.cssIndentSize-1);var options2={indent_size:s.$scope.cssIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=html_beautify(s.$scope.content,options2)}else if("js"==s.$scope.mode.toLowerCase()||"ts"==s.$scope.mode.toLowerCase()){s.$scope.jsIndentSize>3&&(s.$scope.jsIndentSize=s.$scope.jsIndentSize-1);var options2={indent_size:s.$scope.jsIndentSize,indent_char:" ",indent_with_tab:!0};s.$scope.content=js_beautify(s.$scope.content,options2)}}}}})},TemplateUpdateDirectiveController}();AltaiContentEditor.TemplateUpdateDirectiveController=TemplateUpdateDirectiveController}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){function NodeElementDirective($compile){return{scope:{node:"=",count:"@",showchildren:"="},templateUrl:"/api/template/ContentEditor/NodeElement",controller:NodeElementDirectiveController,controllerAs:"vm",link:function(scope,element){element.append($compile("<div ng-if='node.children.length > 0 && node.showChildren' ng-repeat='childNode in node.children' class='node-indent'  node='childNode' showchildren='node.showChildren' ></div>'")(scope))}}}AltaiContentEditor.NodeElementDirective=NodeElementDirective;var NodeElementDirectiveController=function(){function NodeElementDirectiveController($scope,$mdDialog,$stateParams,contentEditorService,wmContainerFactory,authService){this.contentEditorService=contentEditorService,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.$scope=$scope,$scope.createSubfolder=function(node){var parentNode=node;$mdDialog.show({controller:AltaiContentEditor.AddSubfolderDialogController,templateUrl:"/api/template/ContentEditor/CreateSubfolderModal",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!0}).then(function(node){"undefined"!=typeof node&&contentEditorService.AddSubfolder(node,parentNode).then(function(result){parentNode.showChildren=!0,parentNode.children.push(result)})},function(){$scope.status="You cancelled the dialog."})},$scope.updateTemplateName=function(file){var parentNode=file;$mdDialog.show({controller:AltaiContentEditor.UpdateTemplateNameController,templateUrl:"/api/template/ContentEditor/UpdateFileModal",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!0,locals:{file:file}}).then(function(file){"undefined"!=typeof file&&contentEditorService.UpdateFile(file.file).then(function(result){parentNode.label=result.label,parentNode.path=result.path})},function(){$scope.status="You cancelled the dialog."})},$scope.deleteSubfolder=function(node){contentEditorService.DeleteSubfolder(node.path).then(function(result){})},$scope.deleteFile=function(node){contentEditorService.DeleteFile(node.path).then(function(result){})};var originatorEv;$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.expandCollapse=function(node){node.isTemplate?wmContainerFactory.createWindow(AltaiContentEditor.TemplateWindows.templateUpdate,node.label,node.id,{path:node.path,mode:node.mode}):$scope.node.showChildren=!$scope.node.showChildren},$scope.editNode=function(node){wmContainerFactory.createWindow(AltaiContentEditor.TemplateWindows.templateUpdate,node.label,node.id,{path:node.path,mode:node.mode})}}return NodeElementDirectiveController}()}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var ContentEditorService=function(){function ContentEditorService($q,$http){this.q=$q,this.http=$http,this.templates=[]}return ContentEditorService.prototype.listContentTemplates=function(){var d=this.q.defer(),service=this,url="/api/contentEditor/";return this.http.get(url,{cache:!1}).success(function(result){angular.copy(result,service.templates),d.resolve(service.templates)}),d.promise},ContentEditorService.prototype.getTemplate=function(path){var model=new AltaiContentEditor.TemplatePathModel;model.path=path;var d=this.q.defer(),url="/api/contentEditor/template";return this.http.post(url,model).success(function(result){d.resolve(result)}),d.promise},ContentEditorService.prototype.UpdateContentFlowTaskType=function(updatedContent){var d=this.q.defer(),requestUrl="/api/contentEditor/";return this.http.put(requestUrl,updatedContent).success(function(result){d.resolve()}).error(function(){d.reject()}),d.promise},ContentEditorService.prototype.AddSubfolder=function(node,parentNode){var d=this.q.defer(),model=new AltaiContentEditor.CreateSubfolderModel;model.parentPath=parentNode.path,model.folderName=node.node.label;var requestUrl="/api/contentEditor/createSubfolder";return this.http.post(requestUrl,model).success(function(result){d.resolve(result)}).error(function(){d.reject()}),d.promise},ContentEditorService.prototype.UpdateFile=function(file){var d=this.q.defer(),model=new AltaiContentEditor.UpdateFileNameModel;model.path=file.path,model.name=file.label;var requestUrl="/api/contentEditor/renameFile";return this.http.post(requestUrl,model).success(function(result){d.resolve(result)}).error(function(){d.reject()}),d.promise},ContentEditorService.prototype.iterateTemplatesAndRemove=function(tree,path){for(var i=0;i<tree.length;i++)tree[i].children.length>0&&(this.iterateTemplatesAndRemove(tree[i].children,path),tree[i].children.forEach(function(result,index){result.path===path&&tree[i].children.splice(index,1)}))},ContentEditorService.prototype.DeleteSubfolder=function(path){var d=this.q.defer(),service=this,model=new AltaiContentEditor.DeleteDirectoryModel;model.path=path;var requestUrl="/api/contentEditor/deleteSubfolder";return this.http.post(requestUrl,model).success(function(result){service.iterateTemplatesAndRemove(service.templates,path),d.resolve(service.templates)}).error(function(){d.reject()}),d.promise},ContentEditorService.prototype.DeleteFile=function(path){var d=this.q.defer(),service=this,model=new AltaiContentEditor.DeleteDirectoryModel;model.path=path;var requestUrl="/api/contentEditor/deleteFile";return this.http.post(requestUrl,model).success(function(result){service.iterateTemplatesAndRemove(service.templates,path),d.resolve(service.templates)}).error(function(){d.reject()}),d.promise},ContentEditorService}();AltaiContentEditor.ContentEditorService=ContentEditorService}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var TemplateWindows=function(){function TemplateWindows(){}return TemplateWindows}();TemplateWindows.templateList=new AltaiWindowManager.wmWindowType("templateList","<template-list></template-list>",300,600,1600),TemplateWindows.templateUpdate=new AltaiWindowManager.wmWindowType("templateUpdate","<template-update template-id='vm.window.entityId' template-path='vm.window.entityProperties.path' template-mode='vm.window.entityProperties.mode'></template-update>",250,960,1600),AltaiContentEditor.TemplateWindows=TemplateWindows}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var TemplateContentUpdateModel=function(){function TemplateContentUpdateModel(){}return TemplateContentUpdateModel}();AltaiContentEditor.TemplateContentUpdateModel=TemplateContentUpdateModel}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var UpdateFileNameModel=function(){function UpdateFileNameModel(){}return UpdateFileNameModel}();AltaiContentEditor.UpdateFileNameModel=UpdateFileNameModel}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var TemplateItem=function(){function TemplateItem(){}return TemplateItem}();AltaiContentEditor.TemplateItem=TemplateItem}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var TemplatePathModel=function(){function TemplatePathModel(){}return TemplatePathModel}();AltaiContentEditor.TemplatePathModel=TemplatePathModel}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var CreateSubfolderModel=function(){function CreateSubfolderModel(){}return CreateSubfolderModel}();AltaiContentEditor.CreateSubfolderModel=CreateSubfolderModel}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var DeleteDirectoryModel=function(){function DeleteDirectoryModel(){}return DeleteDirectoryModel}();AltaiContentEditor.DeleteDirectoryModel=DeleteDirectoryModel}(AltaiContentEditor||(AltaiContentEditor={}));var AltaiContentEditor;!function(AltaiContentEditor){var mod=angular.module("altai.contenteditor",["ui.ace"]);mod.directive("templateList",AltaiContentEditor.TemplateListDirective),mod.directive("templateUpdate",AltaiContentEditor.TemplateUpdateDirective),mod.directive("nodeElement",AltaiContentEditor.NodeElementDirective),mod.service("contentEditorService",AltaiContentEditor.ContentEditorService),mod.config(function($stateProvider,$sceProvider,$urlRouterProvider,$locationProvider,altaiAdminMenuProvider){$stateProvider.state("admin.template",{url:"/template","abstract":!0}).state("admin.template.type",{url:"/type",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"admin",controller:AltaiContentEditor.TemplateListController}}})}),config.modules.push(mod.name)}(AltaiContentEditor||(AltaiContentEditor={}));
var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleSetListController(wmContainerFactory){wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleSetList,"Image Style Sets")}AltaiImageStyleSets.ImageStyleSetListController=ImageStyleSetListController}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionBlurDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionBlurPartial",controller:AltaiImageStyleActionBlurDirectiveController,link:AltaiImageStyleActionBlurDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionBlurDirective=ImageStyleActionBlurDirective;var AltaiImageStyleActionBlurDirectiveLink=function(){function AltaiImageStyleActionBlurDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionBlurDirectiveLink}(),AltaiImageStyleActionBlurDirectiveController=function(){function AltaiImageStyleActionBlurDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionBlurDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("Blur",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionBlurDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,blurRadius:vm.imageStyleAction.blurRadius,sigma:vm.imageStyleAction.sigma};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionBlurProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionBlurDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionBorderDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionBorderPartial",controller:AltaiImageStyleActionBorderDirectiveController,link:AltaiImageStyleActionBorderDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionBorderDirective=ImageStyleActionBorderDirective;var AltaiImageStyleActionBorderDirectiveLink=function(){function AltaiImageStyleActionBorderDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionBorderDirectiveLink}(),AltaiImageStyleActionBorderDirectiveController=function(){function AltaiImageStyleActionBorderDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionBorderDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("Border",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionBorderDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,color:vm.imageStyleAction.color,size:vm.imageStyleAction.size};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionBorderProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionBorderDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionChangeFileFormatDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionChangeFileFormatPartial",controller:AltaiImageStyleActionChangeFileFormatDirectiveController,link:AltaiImageStyleActionChangeFileFormatDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionChangeFileFormatDirective=ImageStyleActionChangeFileFormatDirective;var AltaiImageStyleActionChangeFileFormatDirectiveLink=function(){function AltaiImageStyleActionChangeFileFormatDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionChangeFileFormatDirectiveLink}(),AltaiImageStyleActionChangeFileFormatDirectiveController=function(){function AltaiImageStyleActionChangeFileFormatDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory,this.fileFormatList=[{value:"Png",text:"Png"},{value:"Jpg",text:"Jpg"},{value:"Gif",text:"Gif"}];var vm=this;vm.getData()}return AltaiImageStyleActionChangeFileFormatDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("ChangeFileFormat",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionChangeFileFormatDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,formatTo:vm.imageStyleAction.formatTo,quality:vm.imageStyleAction.quality};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionChangeFileFormatProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionChangeFileFormatDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionGrayScaleDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionGrayScalePartial",controller:AltaiImageStyleActionGrayScaleDirectiveController,link:AltaiImageStyleActionGrayScaleDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionGrayScaleDirective=ImageStyleActionGrayScaleDirective;var AltaiImageStyleActionGrayScaleDirectiveLink=function(){function AltaiImageStyleActionGrayScaleDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionGrayScaleDirectiveLink}(),AltaiImageStyleActionGrayScaleDirectiveController=function(){function AltaiImageStyleActionGrayScaleDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionGrayScaleDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("GrayScale",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionGrayScaleDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionGrayScaleProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionGrayScaleDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionPolaroidDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionPolaroidPartial",controller:AltaiImageStyleActionPolaroidDirectiveController,link:AltaiImageStyleActionPolaroidDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionPolaroidDirective=ImageStyleActionPolaroidDirective;var AltaiImageStyleActionPolaroidDirectiveLink=function(){function AltaiImageStyleActionPolaroidDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionPolaroidDirectiveLink}(),AltaiImageStyleActionPolaroidDirectiveController=function(){function AltaiImageStyleActionPolaroidDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionPolaroidDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("Polaroid",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionPolaroidDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,caption:vm.imageStyleAction.caption,angle:vm.imageStyleAction.angle};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionPolaroidProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionPolaroidDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionRoundedCornersDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionRoundedCornersPartial",controller:AltaiImageStyleActionRoundedCornersDirectiveController,link:AltaiImageStyleActionRoundedCornersDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionRoundedCornersDirective=ImageStyleActionRoundedCornersDirective;var AltaiImageStyleActionRoundedCornersDirectiveLink=function(){function AltaiImageStyleActionRoundedCornersDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionRoundedCornersDirectiveLink}(),AltaiImageStyleActionRoundedCornersDirectiveController=function(){function AltaiImageStyleActionRoundedCornersDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionRoundedCornersDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("RoundedCorners",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionRoundedCornersDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,radius:vm.imageStyleAction.radius};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionRoundedCornersProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionRoundedCornersDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionScaleAndCircleDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionScaleAndCirclePartial",controller:AltaiImageStyleActionScaleAndCircleDirectiveController,link:AltaiImageStyleActionScaleAndCircleDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionScaleAndCircleDirective=ImageStyleActionScaleAndCircleDirective;var AltaiImageStyleActionScaleAndCircleDirectiveLink=function(){function AltaiImageStyleActionScaleAndCircleDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionScaleAndCircleDirectiveLink}(),AltaiImageStyleActionScaleAndCircleDirectiveController=function(){function AltaiImageStyleActionScaleAndCircleDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionScaleAndCircleDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("ScaleAndCircle",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionScaleAndCircleDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,radius:vm.imageStyleAction.radius};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionScaleAndCircleProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionScaleAndCircleDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionScaleAndCropDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionScaleAndCropPartial",controller:AltaiImageStyleActionScaleAndCropDirectiveController,link:AltaiImageStyleActionScaleAndCropDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionScaleAndCropDirective=ImageStyleActionScaleAndCropDirective;var AltaiImageStyleActionScaleAndCropDirectiveLink=function(){function AltaiImageStyleActionScaleAndCropDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionScaleAndCropDirectiveLink}(),AltaiImageStyleActionScaleAndCropDirectiveController=function(){function AltaiImageStyleActionScaleAndCropDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionScaleAndCropDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("ScaleAndCrop",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionScaleAndCropDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,width:vm.imageStyleAction.width,height:vm.imageStyleAction.height};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionScaleAndCropProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionScaleAndCropDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionScaleWithinBoundsDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionScaleWithinBoundsPartial",controller:AltaiImageStyleActionScaleWithinBoundsDirectiveController,link:AltaiImageStyleActionScaleWithinBoundsDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionScaleWithinBoundsDirective=ImageStyleActionScaleWithinBoundsDirective;var AltaiImageStyleActionScaleWithinBoundsDirectiveLink=function(){function AltaiImageStyleActionScaleWithinBoundsDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionScaleWithinBoundsDirectiveLink}(),AltaiImageStyleActionScaleWithinBoundsDirectiveController=function(){function AltaiImageStyleActionScaleWithinBoundsDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionScaleWithinBoundsDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("ScaleWithinBounds",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionScaleWithinBoundsDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,width:vm.imageStyleAction.width,height:vm.imageStyleAction.height};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionScaleWithinBoundsProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionScaleWithinBoundsDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionVergeDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionVergePartial",controller:AltaiImageStyleActionVergeDirectiveController,link:AltaiImageStyleActionVergeDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionVergeDirective=ImageStyleActionVergeDirective;var AltaiImageStyleActionVergeDirectiveLink=function(){function AltaiImageStyleActionVergeDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionVergeDirectiveLink}(),AltaiImageStyleActionVergeDirectiveController=function(){function AltaiImageStyleActionVergeDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionVergeDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("Verge",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionVergeDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,firstColor:vm.imageStyleAction.firstColor,secondColor:vm.imageStyleAction.secondColor,transparency:vm.imageStyleAction.transparency};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionVergeProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionVergeDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleActionVignetteDirective(){return{scope:{imageStyleActionId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleActionVignettePartial",controller:AltaiImageStyleActionVignetteDirectiveController,link:AltaiImageStyleActionVignetteDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleActionVignetteDirective=ImageStyleActionVignetteDirective;var AltaiImageStyleActionVignetteDirectiveLink=function(){function AltaiImageStyleActionVignetteDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return AltaiImageStyleActionVignetteDirectiveLink}(),AltaiImageStyleActionVignetteDirectiveController=function(){function AltaiImageStyleActionVignetteDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var vm=this;vm.getData()}return AltaiImageStyleActionVignetteDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleAction("Vignette",vm.imageStyleActionId).then(function(imageStyleAction){vm.imageStyleAction=imageStyleAction})},AltaiImageStyleActionVignetteDirectiveController.prototype.save=function(){var vm=this,item={id:vm.imageStyleActionId,name:vm.imageStyleAction.name,order:vm.imageStyleAction.order,color:vm.imageStyleAction.color,transparency:vm.imageStyleAction.transparency};vm.imageStyleSetService.updateImageStyleAction(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleActionVignetteProfile);vm.wmContainerFactory.destroyWindow(currentWin.id)})},AltaiImageStyleActionVignetteDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleCreateDirective(){return{scope:{imageStyleSetId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleCreate",controller:ImageStyleDirectiveController,link:ImageStyleDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleCreateDirective=ImageStyleCreateDirective;var ImageStyleDirectiveLink=function(){function ImageStyleDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return ImageStyleDirectiveLink}(),ImageStyleDirectiveController=function(){function ImageStyleDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory,this.orientationList=[{value:"all",text:"all"},{value:"portrait",text:"portrait"},{value:"landscape",text:"landscape"}],this.retinaList=[{value:"all",text:"all"},{value:"retina",text:"retina"},{value:"non-retina",text:"non-retina"}],this.imageStyleActionTypeList=[{value:"border",text:"border"},{value:"changefileformat",text:"changefileformat"},{value:"grayscale",text:"grayscale"},{value:"polaroid",text:"polaroid"},{value:"roundedcorners",text:"roundedcorners"},{value:"scaleandcrop",text:"scaleandcrop"},{value:"scaleandcircle",text:"scaleandcircle"},{value:"verge",text:"verge"},{value:"vignette",text:"vignette"}]}return ImageStyleDirectiveController.prototype.save=function(){var vm=this,item={name:vm.name,minWidth:vm.minWidth,retina:vm.retina,orientation:vm.orientation,imageStyleSetId:vm.imageStyleSetId};vm.imageStyleSetService.createImageStyle(item).then(function(result){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleCreate);vm.wmContainerFactory.destroyWindow(currentWin.id)})},ImageStyleDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleUpdateDirective(){return{scope:{imageStyleId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleUpdate",controller:ImageStyleDirectiveController,link:ImageStyleDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.ImageStyleUpdateDirective=ImageStyleUpdateDirective;var ImageStyleDirectiveLink=function(){function ImageStyleDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.updateImageStyle()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return ImageStyleDirectiveLink}(),ImageStyleDirectiveController=function(){function ImageStyleDirectiveController(imageStyleSetService,$templateCache,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.$templateCache=$templateCache,this.wmContainerFactory=wmContainerFactory,this.predicateimagestyleaction="order",this.reverseimagestyleaction=!1,this.orientationList=[{value:"all",text:"all"},{value:"portrait",text:"portrait"},{value:"landscape",text:"landscape"}],this.retinaList=[{value:"all",text:"all"},{value:"retina",text:"retina"},{value:"non-retina",text:"non-retina"}],this.imageStyleActionTypeList=[{value:"blur",text:"blur"},{value:"border",text:"border"},{value:"changefileformat",text:"changefileformat"},{value:"grayscale",text:"grayscale"},{value:"polaroid",text:"polaroid"},{value:"roundedcorners",text:"roundedcorners"},{value:"scaleandcrop",text:"scaleandcrop"},{value:"scalewithinbounds",text:"scalewithinbounds"},{value:"scaleandcircle",text:"scaleandcircle"},{value:"verge",text:"verge"},{value:"vignette",text:"vignette"}],this.addImageStyleAction=function(){var vm=this;vm.imageStyleSetService.addImageStyleAction(vm.selectedImageStyleActionType,vm.imageStyle).then(function(data){vm.getData()},function(error){})},this.cloneImageStyleAction=function(imageStyleAction){var vm=this;vm.imageStyleSetService.cloneImageStyleAction(imageStyleAction).then(function(data){vm.loadSelectedAction(data)},function(error){})},this.sortableOptions={update:function(e,ui){},stop:function(e,ui){for(var vm=this,i=0;i<vm.imageStyle.imageStyleActions.length;i++)vm.imageStyle.imageStyleActions[i].order=i+1,vm.imageStyleSetService.updateImageStyleAction(vm.imageStyle.imageStyleActions[i]).then(function(result){})}};var vm=this;vm.getData()}return ImageStyleDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyle(vm.imageStyleId).then(function(imageStyle){vm.imageStyle=imageStyle,vm.imageStyleActions=vm.imageStyle.imageStyleActions})},ImageStyleDirectiveController.prototype.updateImageStyle=function(){var vm=this;vm.imageStyleSetService.updateImageStyle(vm.imageStyle).then(function(result){})},ImageStyleDirectiveController.prototype.removeImageStyle=function(){},ImageStyleDirectiveController.prototype.openImageStyleAction=function(imageStyleAction){var imageStyleActionName="ImageStyleAction"+imageStyleAction.name+"Profile";this.wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows[imageStyleActionName],imageStyleAction.name,imageStyleAction.id)},ImageStyleDirectiveController.prototype.removeImageStyleAction=function(imageStyleActionId){var vm=this;vm.imageStyleSetService.deleteImageStyleAction(imageStyleActionId).then(function(data){vm.getData()},function(error){})},ImageStyleDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleSetDirective(imageStyleSetService){return{scope:{imageStyleSet:"@imagestyleset",image:"="},template:"<img ng-src='{{imageFile}}'/>",replace:!0,link:function($scope,$element,$rootScope){$scope.$watch("image",function(){if(void 0!=$scope.image){var fullPath=$scope.image;fullPath=fullPath.split("/");var fullname=fullPath[fullPath.length-1];fullname.substr(0,fullname.lastIndexOf(".")),fullname.substr(fullname.lastIndexOf(".")+1,fullname.length);$scope.imageFile=imageStyleSetService.getImageUrlDirect($scope.imageStyleSet,$scope.image)}})}}}AltaiImageStyleSets.ImageStyleSetDirective=ImageStyleSetDirective}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function ImageStyleSetBackgroundDirective(imageStyleSetService,$sce,$rootScope,$window){return{scope:{imageStyleSet:"@imagestyleset",image:"="},link:function($scope,$element){$scope.$watch("image",function(){if($scope.image){var fullPath=$scope.image;fullPath=fullPath.split("/"),fullPath=fullPath[fullPath.length-1].split(".");var imageFile=(fullPath[fullPath.length-2],fullPath[fullPath.length-1],imageStyleSetService.getImageUrlDirect($scope.imageStyleSet,$scope.image));$element.attr("style","background-image:url("+imageFile+")")}}),$rootScope.$on("activeimagestylesetupdated",function(){if($scope.image){var fullPath=$scope.image;fullPath=fullPath.split("/"),fullPath=fullPath[fullPath.length-1].split(".");var imageFile=(fullPath[fullPath.length-2],fullPath[fullPath.length-1],imageStyleSetService.getImageUrlDirect($scope.imageStyleSet,$scope.image));$element.attr("style","background-image:url("+imageFile+")")}})}}}AltaiImageStyleSets.ImageStyleSetBackgroundDirective=ImageStyleSetBackgroundDirective}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function AltaiImageStyleSetListDirective(){return{templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleSetList",controller:AltaiImageStyleSetListDirectiveController,controllerAs:"$ctrl"}}AltaiImageStyleSets.AltaiImageStyleSetListDirective=AltaiImageStyleSetListDirective;var AltaiImageStyleSetListDirectiveController=function(){function AltaiImageStyleSetListDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory,this.predicateimagestyleset="name",this.reverseimagestyleset=!1,this.predicateimagestyle="minWidth",this.reverseimagestyle=!1,this.lastInsert="";var ctrl=this;ctrl.getData()}return AltaiImageStyleSetListDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.listImageStyleSet().then(function(imageStyleSetList){vm.imageStyleSetList=imageStyleSetList;for(var i=0;i<vm.imageStyleSetList.length;i++){angular.extend(imageStyleSetList[i],{showDetails:!1});for(var j=0;j<vm.imageStyleSetList[i].imageStyles.length;j++)angular.extend(imageStyleSetList[i].imageStyles[j],{showDetails:!1})}})},AltaiImageStyleSetListDirectiveController.prototype.recycleEntireImageCache=function(){var vm=this;vm.imageStyleSetService.recycleEntireImageCache().then(function(data){},function(error){})},AltaiImageStyleSetListDirectiveController.prototype.recycleImageCache=function(Id){var vm=this;vm.imageStyleSetService.recycleImageCache(Id).then(function(data){},function(error){})},AltaiImageStyleSetListDirectiveController.prototype.clearAllImageStyleSets=function(){var vm=this;vm.imageStyleSetService.clearAllImageStyleSets().then(function(data){},function(error){})},AltaiImageStyleSetListDirectiveController.prototype.clearSingleImageStyleSet=function(imageStyleSetName){var vm=this;vm.imageStyleSetService.clearOneImageStyleSet(imageStyleSetName).then(function(data){},function(error){})},AltaiImageStyleSetListDirectiveController.prototype.removeImageStyleSet=function(imageStyleSetId){var vm=this;vm.imageStyleSetService.deleteImageStyleSet(imageStyleSetId).then(function(data){
vm.getData()},function(error){})},AltaiImageStyleSetListDirectiveController.prototype.updateImageStyleSet=function(data,imageStyleSetId){var vm=this;angular.extend(data,{id:imageStyleSetId}),vm.imageStyleSetService.updateImageStyleSet(data).then(function(result){})},AltaiImageStyleSetListDirectiveController.prototype.openImageStyleSet=function(imageStyleSet){this.wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleSetUpdate,imageStyleSet.name,imageStyleSet.id)},AltaiImageStyleSetListDirectiveController.prototype.addImageStyleSet=function(){this.wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleSetCreate,void 0,void 0)},AltaiImageStyleSetListDirectiveController.prototype.addImageStyle=function(imageStyleSetId){var vm=this;vm.inserted={imageStyleSetId:imageStyleSetId,name:"",minWidth:"",retina:"",orientation:""},vm.imageStyleSetService.createImageStyle(vm.inserted).then(function(result){vm.lastInsertedImageStyleSet=result})},AltaiImageStyleSetListDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function AltaiImageStyleSetCreateDirective(){return{templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleSetCreate",controller:AltaiImageStyleSetCreateDirectiveController,link:ImageStyleSetCreateDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.AltaiImageStyleSetCreateDirective=AltaiImageStyleSetCreateDirective;var ImageStyleSetCreateDirectiveLink=function(){function ImageStyleSetCreateDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.save()},"class":"altai-button-go",name:"save",separator:!0}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return ImageStyleSetCreateDirectiveLink}(),AltaiImageStyleSetCreateDirectiveController=function(){function AltaiImageStyleSetCreateDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory}return AltaiImageStyleSetCreateDirectiveController.prototype.save=function(){var vm=this,item={name:vm.name};vm.imageStyleSetService.createImageStyleSet(item).then(function(data){var currentWin=vm.wmContainerFactory.findWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleSetCreate);vm.wmContainerFactory.destroyWindow(currentWin.id)},function(error){})},AltaiImageStyleSetCreateDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){function AltaiImageStyleSetUpdateDirective(){return{scope:{imageStyleSetId:"="},templateUrl:"/api/template/Admin/ImageStyleSets:imageStyleSetUpdate",controller:AltaiImageStyleSetUpdateDirectiveController,link:ImageStyleSetUpdateDirectiveLink,controllerAs:"$ctrl",bindToController:!0}}AltaiImageStyleSets.AltaiImageStyleSetUpdateDirective=AltaiImageStyleSetUpdateDirective;var ImageStyleSetUpdateDirectiveLink=function(){function ImageStyleSetUpdateDirectiveLink(scope){scope.$ctrl.toolbar={menuGroups:[{menuItems:[{icon:"mdi-content-save",action:function(){scope.$ctrl.updateImageStyleSet()},"class":"altai-button-go",name:"save",separator:!1},{icon:"mdi-flask-outline",action:function(){scope.$ctrl.recycleImageCache()},"class":"altai-button-primary",name:"recycle",separator:!1}],align:"left"}],showLanguages:!1,allowMultipleLanguages:!1}}return ImageStyleSetUpdateDirectiveLink}(),AltaiImageStyleSetUpdateDirectiveController=function(){function AltaiImageStyleSetUpdateDirectiveController(imageStyleSetService,wmContainerFactory){this.imageStyleSetService=imageStyleSetService,this.wmContainerFactory=wmContainerFactory;var ctrl=this;ctrl.getData()}return AltaiImageStyleSetUpdateDirectiveController.prototype.getData=function(){var vm=this;vm.imageStyleSetService.getImageStyleSet(vm.imageStyleSetId).then(function(imageStyleSet){vm.imageStyleSet=imageStyleSet})},AltaiImageStyleSetUpdateDirectiveController.prototype.recycleImageCache=function(){var vm=this;vm.imageStyleSetService.recycleImageCache(vm.imageStyleSetId).then(function(data){},function(error){})},AltaiImageStyleSetUpdateDirectiveController.prototype.deleteImageStyle=function(imageStyleId){var vm=this;vm.imageStyleSetService.deleteImageStyle(imageStyleId).then(function(data){vm.getData()},function(error){})},AltaiImageStyleSetUpdateDirectiveController.prototype.openImageStyle=function(imageStyle){this.wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleUpdate,imageStyle.name,imageStyle.id)},AltaiImageStyleSetUpdateDirectiveController.prototype.updateImageStyleSet=function(){var vm=this;vm.imageStyleSetService.updateImageStyleSet(vm.imageStyleSet).then(function(result){})},AltaiImageStyleSetUpdateDirectiveController.prototype.addImageStyle=function(){var vm=this;vm.wmContainerFactory.createWindow(AltaiImageStyleSets.ImageStyleSetWindows.ImageStyleCreate,void 0,vm.imageStyleSetId)},AltaiImageStyleSetUpdateDirectiveController}()}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){var ImageStyleSetWindows=function(){function ImageStyleSetWindows(){}return ImageStyleSetWindows}();ImageStyleSetWindows.ImageStyleSetList=new AltaiWindowManager.wmWindowType("imageStyleSetList","<altai-image-style-set-list></altai-image-style-set-list>",500,700,1600),ImageStyleSetWindows.ImageStyleSetCreate=new AltaiWindowManager.wmWindowType("imageStyleSetCreate","<altai-image-style-set-create></altai-image-style-set-create>",500,700,1600),ImageStyleSetWindows.ImageStyleSetUpdate=new AltaiWindowManager.wmWindowType("imageStyleSetUpdate","<altai-image-style-set-update image-style-set-id='vm.window.entityId'></altai-image-style-set-update>",500,700,1600),ImageStyleSetWindows.ImageStyleCreate=new AltaiWindowManager.wmWindowType("imageStyleCreate","<altai-image-style-create image-style-set-id='vm.window.entityId'></altai-image-style-update>",500,700,1600),ImageStyleSetWindows.ImageStyleUpdate=new AltaiWindowManager.wmWindowType("imageStyleUpdate","<altai-image-style-update image-style-id='vm.window.entityId'></altai-image-style-update>",500,700,1600),ImageStyleSetWindows.ImageStyleActionBorderProfile=new AltaiWindowManager.wmWindowType("imageStyleActionBorderProfile","<altai-image-style-action-border image-style-action-id='vm.window.entityId'></altai-image-style-action-border>",500,700,1600),ImageStyleSetWindows.ImageStyleActionChangeFileFormatProfile=new AltaiWindowManager.wmWindowType("imageStyleActionChangeFileFormatProfile","<altai-image-style-action-change-file-format image-style-action-id='vm.window.entityId'></altai-image-style-action-change-file-format>",500,700,1600),ImageStyleSetWindows.ImageStyleActionGrayScaleProfile=new AltaiWindowManager.wmWindowType("imageStyleActionGrayScaleProfile","<altai-image-style-action-gray-scale image-style-action-id='vm.window.entityId'></altai-image-style-action-gray-scale>",500,700,1600),ImageStyleSetWindows.ImageStyleActionPolaroidProfile=new AltaiWindowManager.wmWindowType("imageStyleActionPolaroidProfile","<altai-image-style-action-polaroid image-style-action-id='vm.window.entityId'></altai-image-style-action-polaroid>",500,700,1600),ImageStyleSetWindows.ImageStyleActionRoundedCornersProfile=new AltaiWindowManager.wmWindowType("imageStyleActionRoundedCornersProfile","<altai-image-style-action-rounded-corners image-style-action-id='vm.window.entityId'></altai-image-style-action-rounded-corners>",500,700,1600),ImageStyleSetWindows.ImageStyleActionScaleAndCircleProfile=new AltaiWindowManager.wmWindowType("imageStyleActionScaleAndCircleProfile","<altai-image-style-action-scale-and-circle image-style-action-id='vm.window.entityId'></altai-image-style-action-scale-and-circle>",500,700,1600),ImageStyleSetWindows.ImageStyleActionScaleAndCropProfile=new AltaiWindowManager.wmWindowType("imageStyleActionScaleAndCropProfile","<altai-image-style-action-scale-and-crop image-style-action-id='vm.window.entityId'></altai-image-style-action-scale-and-crop>",500,700,1600),ImageStyleSetWindows.ImageStyleActionScaleWithinBoundsProfile=new AltaiWindowManager.wmWindowType("imageStyleActionScaleWithinBoundsProfile","<altai-image-style-action-scale-within-bounds image-style-action-id='vm.window.entityId'></altai-image-style-action-scale-within-bounds>",500,700,1600),ImageStyleSetWindows.ImageStyleActionVergeProfile=new AltaiWindowManager.wmWindowType("imageStyleActionVergeProfile","<altai-image-style-action-verge image-style-action-id='vm.window.entityId'></altai-image-style-action-verge>",500,700,1600),ImageStyleSetWindows.ImageStyleActionVignetteProfile=new AltaiWindowManager.wmWindowType("imageStyleActionVignetteProfile","<altai-image-style-action-vignette image-style-action-id='vm.window.entityId'></altai-image-style-action-vignette>",500,700,1600),ImageStyleSetWindows.ImageStyleActionBlurProfile=new AltaiWindowManager.wmWindowType("imageStyleActionBlurProfile","<altai-image-style-action-blur image-style-action-id='vm.window.entityId'></altai-image-style-action-blur>",500,700,1600),AltaiImageStyleSets.ImageStyleSetWindows=ImageStyleSetWindows}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiImageStyleSets;!function(AltaiImageStyleSets){var ImageStyleSetService=function(_super){function ImageStyleSetService($http,$rootScope,altaiHttp,$q,altaiNotificationFactory){var _this=_super.call(this,"api/imagestyleset","Image Style Set",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$rootScope=$rootScope,_this.altaiNotificationFactory=altaiNotificationFactory,_this.imageStyleList=[],_this.imageStyleSetList=[],_this.imageStyleActionList=[],_this}return __extends(ImageStyleSetService,_super),ImageStyleSetService.prototype.listImageStyle=function(){var s=this,deferred=s.$q.defer();return s.$http.get("/api/imagestyle").then(function(result){angular.copy(result.data,s.imageStyleList),deferred.resolve(s.imageStyleList)},function(error){s.altaiNotificationFactory.error("Could not load the imagestyle list"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.getImageStyle=function(imageStyleId){var s=this,deferred=s.$q.defer();return s.$http.get("/api/imagestyle/"+imageStyleId).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not load the imagestyle list"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.readImageStyle=function(imageStyleId){var s=this,deferred=s.$q.defer();if(0!=s.imageStyleList.length){var cachedImageStyle=s.imageStyleList.filter(function(imageStyle){return imageStyle.id==imageStyleId}),cachedImageStyleIndex=s.imageStyleList.indexOf(cachedImageStyle[0]);deferred.resolve(s.imageStyleList[cachedImageStyleIndex])}else s.listImageStyle().then(function(){var cachedImageStyle=s.imageStyleList.filter(function(imageStyle){return imageStyle.id==imageStyleId}),cachedImageStyleIndex=s.imageStyleList.indexOf(cachedImageStyle[0]);deferred.resolve(s.imageStyleList[cachedImageStyleIndex])},function(error){deferred.reject()});return deferred.promise},ImageStyleSetService.prototype.updateImageStyle=function(updatedImageStyle){var s=this,deferred=s.$q.defer(),objectToSend={Id:updatedImageStyle.id,Name:updatedImageStyle.name,Orientation:updatedImageStyle.orientation,MinWidth:updatedImageStyle.minWidth,Retina:updatedImageStyle.retina};return s.$http.put("/api/imagestyle",objectToSend).then(function(result){s.altaiNotificationFactory.success("Successfully updated the image style"),deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not update the image style"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.createImageStyle=function(newImageStyle){var s=this,deferred=s.$q.defer();return s.$http({method:"POST",url:"/api/imagestyle",data:newImageStyle}).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error(error.data.message),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.deleteImageStyle=function(imageStyleId){var s=this,deferred=s.$q.defer();return s.$http({method:"DELETE",url:"/api/imagestyle/"+imageStyleId}).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not delete the image style"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.listImageStyleSet=function(){var s=this,deferred=s.$q.defer();return s.$http.get("/api/listimagestyleset").then(function(result){angular.copy(result.data,s.imageStyleSetList),deferred.resolve(s.imageStyleSetList)},function(error){s.altaiNotificationFactory.error("Could not get the image style set list"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.getImageStyleSet=function(imageStyleSetId){var s=this,deferred=s.$q.defer();return s.$http.get("/api/imagestyleset/"+imageStyleSetId).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not load the imagestyleset"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.readImageStyleSet=function(imageStyleSetId){var s=this,deferred=s.$q.defer();if(0!=s.imageStyleSetList.length){var cachedImageStyleSet=s.imageStyleSetList.filter(function(imageStyleSet){return imageStyleSet.id==imageStyleSetId}),cachedImageStyleSetIndex=s.imageStyleSetList.indexOf(cachedImageStyleSet[0]);deferred.resolve(s.imageStyleSetList[cachedImageStyleSetIndex])}else s.listImageStyleSet().then(function(){var cachedImageStyleSet=s.imageStyleSetList.filter(function(imageStyleSet){return imageStyleSet.id==imageStyleSetId}),cachedImageStyleSetIndex=s.imageStyleSetList.indexOf(cachedImageStyleSet[0]);deferred.resolve(s.imageStyleSetList[cachedImageStyleSetIndex])},function(error){deferred.reject()});return deferred.promise},ImageStyleSetService.prototype.updateImageStyleSet=function(updatedImageStyleSet){var s=this,deferred=s.$q.defer(),objectToSend={Id:updatedImageStyleSet.id,Name:updatedImageStyleSet.name};return s.$http({method:"PUT",url:"/api/imagestyleset",data:objectToSend}).then(function(result){s.altaiNotificationFactory.success("Sucessfully updated the image style set"),deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not update the image style set"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.createImageStyleSet=function(newImageStyleSet){var s=this,deferred=s.$q.defer();return s.$http({method:"POST",url:"/api/imagestyleset",data:newImageStyleSet}).then(function(result){s.imageStyleSetList.push(result.data),deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not create the new Image Style Set"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.deleteImageStyleSet=function(imageStyleSetId){var s=this,deferred=s.$q.defer();return s.$http({method:"DELETE",url:"/api/imagestyleset/"+imageStyleSetId}).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not delete the image style"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.recycleEntireImageCache=function(){var s=this,deferred=s.$q.defer();return s.$http.get("/api/rebuildallimages").then(function(result){deferred.resolve()},function(error){s.altaiNotificationFactory.error("Could not reload the image cache"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.clearAllImageStyleSets=function(){var s=this,deferred=s.$q.defer();return s.$http.get("/api/clearallimagestylesets").then(function(result){deferred.resolve()},function(error){s.altaiNotificationFactory.error("Could not clear all image style sets"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.clearOneImageStyleSet=function(imageStyleSetName){var s=this,deferred=s.$q.defer();return s.$http.get("api/clearoneimagestylesets/"+imageStyleSetName).then(function(result){deferred.resolve()},function(error){s.altaiNotificationFactory.error("Could not clear the image style set"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.recycleImageCache=function(Id){var s=this,deferred=s.$q.defer();return s.$http.get("/api/rebuildallimages/"+Id).then(function(result){deferred.resolve()},function(error){s.altaiNotificationFactory.error("Could not reload the image cache"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.updateImageStyleAction=function(updatedImageStyleAction){var s=this,deferred=s.$q.defer(),urlToContact="/api/imagestyleaction/"+updatedImageStyleAction.name.toLowerCase()+"/";return s.$http.put(urlToContact,updatedImageStyleAction).then(function(result){var imageStyleActionToUpdate=s.imageStyleActionList.filter(function(imageStyleAction){return imageStyleAction.id==updatedImageStyleAction.id}),imageStyleActionToUpdateIndex=s.imageStyleActionList.indexOf(imageStyleActionToUpdate[0]);s.imageStyleActionList[imageStyleActionToUpdateIndex]=imageStyleActionToUpdate[0],s.altaiNotificationFactory.success("Sucessfully updated the image style action"),deferred.resolve()},function(error){s.altaiNotificationFactory.error("Could not update the image style action"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.getImageStyleAction=function(imageStyleActionName,imageStyleActionId){var s=this,deferred=s.$q.defer();return s.$http.get("/api/imagestyleaction/"+imageStyleActionId).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not load the imagestyle list"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.addImageStyleAction=function(choice,imageStyle){var s=this,deferred=s.$q.defer(),urlToContact="/api/imagestyleaction/"+choice.toLowerCase()+"/";return s.$http.post(urlToContact,imageStyle.id).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not update the image style action"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.cloneImageStyleAction=function(imageStyleAction){var s=this,deferred=s.$q.defer(),urlToContact="/api/imagestyleaction/"+imageStyleAction.name.toLowerCase()+"/?clone=true";return s.$http.post(urlToContact,imageStyleAction).then(function(result){loop1:for(var indexImageStyleSet=0;indexImageStyleSet<s.imageStyleSetList.length;indexImageStyleSet++)for(var indexImageStyle=0;indexImageStyle<s.imageStyleSetList[indexImageStyleSet].imageStyles.length;indexImageStyle++)if(s.imageStyleSetList[indexImageStyleSet].imageStyles[indexImageStyle].id==imageStyleAction.imageStyleId){s.imageStyleSetList[indexImageStyleSet].imageStyles[indexImageStyle].imageStyleActions.push(result.data);break loop1}deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not update the image style action"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.deleteImageStyleAction=function(imageStyleActionId){var s=this,deferred=s.$q.defer();return s.$http({method:"DELETE",url:"/api/imagestyleaction/"+imageStyleActionId}).then(function(result){deferred.resolve(result.data)},function(error){s.altaiNotificationFactory.error("Could not delete the image style"),deferred.reject()}),deferred.promise},ImageStyleSetService.prototype.listActiveImageStyle=function(){var s=this;s.retina=!1,s.width=window.innerWidth,s.orientation,window.innerHeight>window.innerWidth?s.orientation="portrait":s.orientation="landscape";var d=s.$q.defer();return s.$http.get("/api/activeimagestyleset/"+s.orientation+"/"+s.retina+"/"+s.width).then(function(result){s.activeImageStyleSets=result.data,d.resolve(result.data),s.$rootScope.$broadcast("activeimagestylesetupdated")},function(error){d.reject()}),d.promise},ImageStyleSetService.prototype.getImageUrl=function(imageStyleSet,image){var s=this,imageFile=s.$rootScope.staticFileBase+"/"+image,fullPath=image;fullPath=fullPath.split("/"),fullPath=fullPath[fullPath.length-1].split(".");var fileName=fullPath[fullPath.length-2],fileExtension=fullPath[fullPath.length-1],styleSet=s.activeImageStyleSets.filter(function(elm){return elm.name==imageStyleSet})[0],d=s.$q.defer();return s.$http.get("/api/checkexistence/"+imageStyleSet+"/"+image).then(function(result){void 0!=styleSet&&void 0!=styleSet.imageStyles&&1==styleSet.imageStyles.length&&(""!=styleSet.imageStyles[0].fileFormat&&(fileExtension=styleSet.imageStyles[0].fileFormat),imageFile=s.$rootScope.staticFileBase+"/cache/"+imageStyleSet+"/"+styleSet.imageStyles[0].minWidth+"/"+styleSet.imageStyles[0].orientation+"/"+styleSet.imageStyles[0].retina+"/"+fileName+"."+fileExtension,d.resolve(imageFile))},function(error){d.reject()}),d.promise},ImageStyleSetService.prototype.getImageUrlDirect=function(imageStyleSet,image){var s=this,imageFile=s.$rootScope.staticFileBase+"/"+image,fullPath=image;fullPath=fullPath.split("/");var fullname=fullPath[fullPath.length-1],fileName=fullname.substr(0,fullname.lastIndexOf(".")),fileExtension=fullname.substr(fullname.lastIndexOf(".")+1,fullname.length),styleSet=s.activeImageStyleSets.filter(function(elm){return elm.name==imageStyleSet})[0];return void 0!=styleSet&&void 0!=styleSet.imageStyles&&1==styleSet.imageStyles.length&&(""!=styleSet.imageStyles[0].fileFormat&&(fileExtension=styleSet.imageStyles[0].fileFormat),imageFile=s.$rootScope.staticFileBase+"/cache/"+imageStyleSet+"/"+styleSet.imageStyles[0].minWidth+"/"+styleSet.imageStyles[0].orientation+"/"+styleSet.imageStyles[0].retina+"/"+fileName+"."+fileExtension),imageFile},ImageStyleSetService}(AltaiCore.AltaiDataService);AltaiImageStyleSets.ImageStyleSetService=ImageStyleSetService}(AltaiImageStyleSets||(AltaiImageStyleSets={}));var AltaiImageStyleSets;!function(AltaiImageStyleSets){var mod=angular.module("altai.imageStyleSets",["xeditable"]);mod.service("imageStyleSetService",AltaiImageStyleSets.ImageStyleSetService),mod.directive("altaiImageStyleSetList",AltaiImageStyleSets.AltaiImageStyleSetListDirective),mod.directive("altaiImageStyleSetUpdate",AltaiImageStyleSets.AltaiImageStyleSetUpdateDirective),mod.directive("altaiImageStyleSetCreate",AltaiImageStyleSets.AltaiImageStyleSetCreateDirective),mod.directive("altaiImageStyleUpdate",AltaiImageStyleSets.ImageStyleUpdateDirective),mod.directive("altaiImageStyleCreate",AltaiImageStyleSets.ImageStyleCreateDirective),mod.directive("altaiImageStyleActionBlur",AltaiImageStyleSets.ImageStyleActionBlurDirective),mod.directive("altaiImageStyleActionBorder",AltaiImageStyleSets.ImageStyleActionBorderDirective),mod.directive("altaiImageStyleActionChangeFileFormat",AltaiImageStyleSets.ImageStyleActionChangeFileFormatDirective),mod.directive("altaiImageStyleActionGrayScale",AltaiImageStyleSets.ImageStyleActionGrayScaleDirective),mod.directive("altaiImageStyleActionPolaroid",AltaiImageStyleSets.ImageStyleActionPolaroidDirective),mod.directive("altaiImageStyleActionRoundedCorners",AltaiImageStyleSets.ImageStyleActionRoundedCornersDirective),mod.directive("altaiImageStyleActionScaleAndCircle",AltaiImageStyleSets.ImageStyleActionScaleAndCircleDirective),mod.directive("altaiImageStyleActionScaleAndCrop",AltaiImageStyleSets.ImageStyleActionScaleAndCropDirective),mod.directive("altaiImageStyleActionScaleWithinBounds",AltaiImageStyleSets.ImageStyleActionScaleWithinBoundsDirective),mod.directive("altaiImageStyleActionVerge",AltaiImageStyleSets.ImageStyleActionVergeDirective),mod.directive("altaiImageStyleActionVignette",AltaiImageStyleSets.ImageStyleActionVignetteDirective),mod.directive("altaiImageStyleSet",AltaiImageStyleSets.ImageStyleSetDirective),mod.directive("altaiImageStyleSetBackground",AltaiImageStyleSets.ImageStyleSetBackgroundDirective),mod.config(function($stateProvider,altaiAdminMenuProvider){$stateProvider.state("admin.imagestyleset",{url:"/imagestyleset","abstract":!0}).state("admin.imagestyleset.list",{url:"/list",system:!0,views:{"bodyView@":{altaiTemplate:"admin",altaiTemplateType:"Admin",controller:AltaiImageStyleSets.ImageStyleSetListController}}}),altaiAdminMenuProvider.add({parent:"config",name:"config.imagestylesets",securable:"accessmanagement",label:"imagestylesets",icon:"mdi mdi-camera",state:"admin.imagestyleset.list"})}),mod.run(function(imageStyleSetService,$rootScope){imageStyleSetService.listActiveImageStyle().then(function(result){})})}(AltaiImageStyleSets||(AltaiImageStyleSets={})),config.modules.push("altai.imageStyleSets");var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AltaiBackgroundWork;!function(AltaiBackgroundWork){var BackgroundJobService=function(_super){function BackgroundJobService($http,altaiHttp,$q,$interval,altaiNotificationFactory){var _this=_super.call(this,"api/backgroundjob","BackgroundJob",altaiHttp,$http,$q,altaiNotificationFactory)||this;return _this.$interval=$interval,_this}return __extends(BackgroundJobService,_super),BackgroundJobService.prototype.waitForJob=function(jobId){var _this=this,d=this.$q.defer(),checker=this.$interval(function(){_this.altaiHttp.get("/api/backgroundjob/"+jobId+"/state").then(function(res){res&&(_this.$interval.cancel(checker),d.resolve())})},5e3);return d.promise},BackgroundJobService.prototype.getActiveJobs=function(){var s=this,d=s.$q.defer();return s.altaiHttp.get(s.apiUrl).then(function(result){d.resolve(result)},function(error){d.reject(error)}),d.promise},BackgroundJobService.prototype.getJobCount=function(){var s=this,d=s.$q.defer();return s.altaiHttp.get(s.apiUrl+"/count").then(function(result){d.resolve(result)},function(error){d.reject(error)}),d.promise},BackgroundJobService}(AltaiCore.AltaiDataService);AltaiBackgroundWork.BackgroundJobService=BackgroundJobService}(AltaiBackgroundWork||(AltaiBackgroundWork={}));var AltaiBackgroundWork;!function(AltaiBackgroundWork){function BackgroundWorkInfoCenter(){return{scope:{languages:"="},templateUrl:"/api/template/Admin/Background:InfoCenter",controller:BackgroundWorkInfoCenterDirectiveController,controllerAs:"vm",bindToController:!0}}AltaiBackgroundWork.BackgroundWorkInfoCenter=BackgroundWorkInfoCenter;var BackgroundWorkInfoCenterDirectiveController=function(){function BackgroundWorkInfoCenterDirectiveController($interval,$scope,backgroundJobService){this.$interval=$interval,this.$scope=$scope,this.backgroundJobService=backgroundJobService,this.jobcount=0,this.showBackgroundWorkInfoCenter=!1;this.getJobCount()}return BackgroundWorkInfoCenterDirectiveController.prototype.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev)},BackgroundWorkInfoCenterDirectiveController.prototype.toggleBackgroundWorkInfoCenterView=function(){var vm=this;vm.showBackgroundWorkInfoCenter=!vm.showBackgroundWorkInfoCenter},BackgroundWorkInfoCenterDirectiveController.prototype.setBackgroundWorkInfoCenterView=function(value){var vm=this;vm.showBackgroundWorkInfoCenter=value},BackgroundWorkInfoCenterDirectiveController.prototype.getJobCount=function(){var s=this;this.$interval(function(){s.backgroundJobService.getJobCount().then(function(result){s.jobcount=result},function(error){console.log("issue with getting the jobcount")})},5e3)},BackgroundWorkInfoCenterDirectiveController.prototype.toggleData=function(){var s=this;s.showBackgroundWorkInfoCenter=!s.showBackgroundWorkInfoCenter},BackgroundWorkInfoCenterDirectiveController}()}(AltaiBackgroundWork||(AltaiBackgroundWork={}));var AltaiBackgroundWork;!function(AltaiBackgroundWork){var mod=angular.module("altai.backgroundwork",[]);mod.service("backgroundJobService",AltaiBackgroundWork.BackgroundJobService),mod.directive("backgroundWorkInfoCenter",AltaiBackgroundWork.BackgroundWorkInfoCenter),config.modules.push(mod.name)}(AltaiBackgroundWork||(AltaiBackgroundWork={}));